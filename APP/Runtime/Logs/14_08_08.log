[ 2014-08-08T00:36:42+08:00 ] 127.0.0.1 /php_demo/shizhan/10/10wish/index.php/Njb/Index
INFO: [ route_check ] --START--
INFO: CheckRoute Behavior ::run [ RunTime:0.007001s ]
INFO: [ route_check ] --END-- [ RunTime:0.011001s ]
INFO: [ app_begin ] --START--
INFO: ReadHtmlCache Behavior ::run [ RunTime:0.009000s ]
INFO: [ app_begin ] --END-- [ RunTime:0.013000s ]
SQL: SELECT l.name,COALESCE(a.ucount,0) as yhs,COALESCE(c.ulcount,0) as dlyhs,COALESCE(c.logCount,0) as dlcs FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(ud.id) ucount FROM   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud     GROUP BY ud.locid  ) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>=(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-1))) AND lo.login_time<(SELECT TIMESTAMP(DATE(SYSDATE())))   GROUP BY ud.locid) c ON l.id=c.locid WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.063003s ]
SQL: SELECT l.name,COALESCE(a.noticeCount,0) noticeCount,COALESCE(a.userCount,0) userCount FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(n.id) noticeCount,COUNT(DISTINCT ud.id) userCount FROM notice n,   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud   WHERE n.owner_id=ud.id AND n.publish_time>=(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-1)))    AND n.publish_time<(SELECT TIMESTAMP(DATE(SYSDATE()))) GROUP BY ud.locid) a  ON l.id=a.locid WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.006000s ]
SQL: SELECT l.name,COALESCE(a.asCount,0) a,COALESCE(b.adminCount,0) b,COALESCE(c.noAdminCount,0) c FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(t.id) asCount FROM assignment t,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE t.creator_id=ud.id AND t.create_time>=(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-1))) AND  t.create_time<(SELECT TIMESTAMP(DATE(SYSDATE())))  GROUP BY ud.locid) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) adminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud   WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='TechAdmin'   AND t.create_time>=(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-1))) AND  t.create_time<(SELECT TIMESTAMP(DATE(SYSDATE())))  GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) noAdminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='Technician'   AND t.create_time>=(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-1))) AND  t.create_time<(SELECT TIMESTAMP(DATE(SYSDATE())))  GROUP BY ud.locid ) c ON l.id=c.locid  WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.023002s ]
SQL: SELECT l.name,COALESCE(a.worklogCount,0) a,COALESCE(a.uCount,0) b,COALESCE(b.docCount,0) c,COALESCE(c.phoCount,0) d,COALESCE(d.audioCount,0) e FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(DISTINCT w.id) worklogCount,COUNT(DISTINCT w.owner_id) uCount FROM work_log w,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE w.owner_id=ud.id    AND w.create_time>=(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-1))) AND w.create_time<(SELECT TIMESTAMP(DATE(SYSDATE())))  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) docCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>=(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-1))) AND w.create_time<(SELECT TIMESTAMP(DATE(SYSDATE())))  AND i.media_type=1   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) phoCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>=(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-1))) AND w.create_time<(SELECT TIMESTAMP(DATE(SYSDATE())))  AND i.media_type=2   GROUP BY ud.locid ) c ON l.id=c.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) audioCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>=(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-1))) AND w.create_time<(SELECT TIMESTAMP(DATE(SYSDATE())))  AND i.media_type=3   GROUP BY ud.locid ) d ON l.id=d.locid   WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.043003s ]
SQL: SELECT l.name,COALESCE(a.photoCount,0) a,COALESCE(a.ucount,0) b,COALESCE(b.priseCount,0) c,COALESCE(c.comCount,0) d FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(i.id) photoCount,COUNT(DISTINCT ud.id) ucount FROM album m,album_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE m.owner_id=ud.id AND i.album_id=m.id   AND i.create_time>=(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-1))) AND i.create_time<(SELECT TIMESTAMP(DATE(SYSDATE())))  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,COUNT(uc.id) priseCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='AlbumItem'   AND uc.create_time>(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-1))) AND uc.create_time<(SELECT TIMESTAMP(DATE(SYSDATE())))   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(uc.id) comCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='SystemComment'   AND uc.create_time>=(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-1))) AND uc.create_time<(SELECT TIMESTAMP(DATE(SYSDATE())))  GROUP BY ud.locid) c ON l.id=c.locid  WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.016001s ]
SQL: SELECT a.rname a,l.name b,d.name c,a.age d FROM (SELECT u.id uid,u.real_name rname,u.location_id locid,u.dept_id depId,(2014-(SELECT SUBSTR(u.identify_value,7,4))+0) age FROM app_user u WHERE NOT EXISTS ( SELECT lo.user_id FROM login_log lo WHERE u.id=lo.user_id  ) AND u.id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422) )) a,location l,department d WHERE a.depId=d.id AND a.locid=l.id [ RunTime:2.167124s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) AND w.create_time>=(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-8))) AND w.create_time<(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-1))) GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) AND lo.login_time>=(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-8))) AND lo.login_time<(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-1))) GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.397023s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) AND w.create_time>=(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-8))) AND w.create_time<(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-1))) GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) AND lo.login_time>=(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-8))) AND lo.login_time<(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-1))) GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.372021s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) AND w.create_time>=(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-8))) AND w.create_time<(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-1))) GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) AND lo.login_time>=(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-8))) AND lo.login_time<(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-1))) GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.386022s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) AND w.create_time>=(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-8))) AND w.create_time<(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-1))) GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) AND lo.login_time>=(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-8))) AND lo.login_time<(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-1))) GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.381022s ]
INFO: [ view_parse ] --START--
NOTIC: [8] Undefined variable: data11 D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Runtime\Cache\Njb\607530d18d80e845b263da305b2f6c77.php 第 203 行.
INFO: ParseTemplate Behavior ::run [ RunTime:0.561032s ]
INFO: [ view_parse ] --END-- [ RunTime:0.567032s ]
INFO: [ view_filter ] --START--
INFO: ContentReplace Behavior ::run [ RunTime:0.011001s ]
INFO: TokenBuild Behavior ::run [ RunTime:0.011001s ]
INFO: WriteHtmlCache Behavior ::run [ RunTime:0.004000s ]
INFO: ShowRuntime Behavior ::run [ RunTime:0.013001s ]
INFO: [ view_filter ] --END-- [ RunTime:0.054003s ]
INFO: [ view_end ] --START--
INFO: ShowPageTrace Behavior ::run [ RunTime:0.010000s ]
INFO: [ view_end ] --END-- [ RunTime:0.016001s ]

[ 2014-08-08T00:37:25+08:00 ] 127.0.0.1 /php_demo/shizhan/10/10wish/index.php/Njb/Index
INFO: [ route_check ] --START--
INFO: CheckRoute Behavior ::run [ RunTime:0.007000s ]
INFO: [ route_check ] --END-- [ RunTime:0.011001s ]
INFO: [ app_begin ] --START--
INFO: ReadHtmlCache Behavior ::run [ RunTime:0.010001s ]
INFO: [ app_begin ] --END-- [ RunTime:0.015001s ]
SQL: SELECT l.name,COALESCE(a.ucount,0) as yhs,COALESCE(c.ulcount,0) as dlyhs,COALESCE(c.logCount,0) as dlcs FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(ud.id) ucount FROM   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud     GROUP BY ud.locid  ) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>=(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-1))) AND lo.login_time<(SELECT TIMESTAMP(DATE(SYSDATE())))   GROUP BY ud.locid) c ON l.id=c.locid WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.040003s ]
SQL: SELECT l.name,COALESCE(a.noticeCount,0) noticeCount,COALESCE(a.userCount,0) userCount FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(n.id) noticeCount,COUNT(DISTINCT ud.id) userCount FROM notice n,   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud   WHERE n.owner_id=ud.id AND n.publish_time>=(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-1)))    AND n.publish_time<(SELECT TIMESTAMP(DATE(SYSDATE()))) GROUP BY ud.locid) a  ON l.id=a.locid WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.005000s ]
SQL: SELECT l.name,COALESCE(a.asCount,0) a,COALESCE(b.adminCount,0) b,COALESCE(c.noAdminCount,0) c FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(t.id) asCount FROM assignment t,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE t.creator_id=ud.id AND t.create_time>=(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-1))) AND  t.create_time<(SELECT TIMESTAMP(DATE(SYSDATE())))  GROUP BY ud.locid) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) adminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud   WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='TechAdmin'   AND t.create_time>=(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-1))) AND  t.create_time<(SELECT TIMESTAMP(DATE(SYSDATE())))  GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) noAdminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='Technician'   AND t.create_time>=(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-1))) AND  t.create_time<(SELECT TIMESTAMP(DATE(SYSDATE())))  GROUP BY ud.locid ) c ON l.id=c.locid  WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.015001s ]
SQL: SELECT l.name,COALESCE(a.worklogCount,0) a,COALESCE(a.uCount,0) b,COALESCE(b.docCount,0) c,COALESCE(c.phoCount,0) d,COALESCE(d.audioCount,0) e FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(DISTINCT w.id) worklogCount,COUNT(DISTINCT w.owner_id) uCount FROM work_log w,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE w.owner_id=ud.id    AND w.create_time>=(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-1))) AND w.create_time<(SELECT TIMESTAMP(DATE(SYSDATE())))  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) docCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>=(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-1))) AND w.create_time<(SELECT TIMESTAMP(DATE(SYSDATE())))  AND i.media_type=1   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) phoCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>=(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-1))) AND w.create_time<(SELECT TIMESTAMP(DATE(SYSDATE())))  AND i.media_type=2   GROUP BY ud.locid ) c ON l.id=c.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) audioCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>=(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-1))) AND w.create_time<(SELECT TIMESTAMP(DATE(SYSDATE())))  AND i.media_type=3   GROUP BY ud.locid ) d ON l.id=d.locid   WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.037002s ]
SQL: SELECT l.name,COALESCE(a.photoCount,0) a,COALESCE(a.ucount,0) b,COALESCE(b.priseCount,0) c,COALESCE(c.comCount,0) d FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(i.id) photoCount,COUNT(DISTINCT ud.id) ucount FROM album m,album_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE m.owner_id=ud.id AND i.album_id=m.id   AND i.create_time>=(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-1))) AND i.create_time<(SELECT TIMESTAMP(DATE(SYSDATE())))  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,COUNT(uc.id) priseCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='AlbumItem'   AND uc.create_time>(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-1))) AND uc.create_time<(SELECT TIMESTAMP(DATE(SYSDATE())))   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(uc.id) comCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='SystemComment'   AND uc.create_time>=(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-1))) AND uc.create_time<(SELECT TIMESTAMP(DATE(SYSDATE())))  GROUP BY ud.locid) c ON l.id=c.locid  WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.014001s ]
SQL: SELECT a.rname a,l.name b,d.name c,a.age d FROM (SELECT u.id uid,u.real_name rname,u.location_id locid,u.dept_id depId,(2014-(SELECT SUBSTR(u.identify_value,7,4))+0) age FROM app_user u WHERE NOT EXISTS ( SELECT lo.user_id FROM login_log lo WHERE u.id=lo.user_id  ) AND u.id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422) )) a,location l,department d WHERE a.depId=d.id AND a.locid=l.id [ RunTime:2.441140s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) AND w.create_time>=(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-8))) AND w.create_time<(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-1))) GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) AND lo.login_time>=(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-8))) AND lo.login_time<(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-1))) GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.385022s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) AND w.create_time>=(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-8))) AND w.create_time<(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-1))) GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) AND lo.login_time>=(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-8))) AND lo.login_time<(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-1))) GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.422025s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) AND w.create_time>=(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-8))) AND w.create_time<(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-1))) GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) AND lo.login_time>=(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-8))) AND lo.login_time<(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-1))) GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.404023s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) AND w.create_time>=(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-8))) AND w.create_time<(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-1))) GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) AND lo.login_time>=(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-8))) AND lo.login_time<(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-1))) GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.381022s ]
SQL: SELECT l.name,COALESCE(a.ulcount,0) b FROM  location l LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>=(TIMESTAMP(ADDDATE(DATE(SYSDATE()),-(DAYOFWEEK(NOW())-2))))   GROUP BY ud.locid) a ON a.locid=l.id WHERE l.id IN (24521,24543,24561,28422) [ RunTime:0.093005s ]
INFO: [ view_parse ] --START--
INFO: ParseTemplate Behavior ::run [ RunTime:0.516030s ]
INFO: [ view_parse ] --END-- [ RunTime:0.521030s ]
INFO: [ view_filter ] --START--
INFO: ContentReplace Behavior ::run [ RunTime:0.009001s ]
INFO: TokenBuild Behavior ::run [ RunTime:0.012001s ]
INFO: WriteHtmlCache Behavior ::run [ RunTime:0.005000s ]
INFO: ShowRuntime Behavior ::run [ RunTime:0.014001s ]
INFO: [ view_filter ] --END-- [ RunTime:0.058003s ]
INFO: [ view_end ] --START--
INFO: ShowPageTrace Behavior ::run [ RunTime:0.014001s ]
INFO: [ view_end ] --END-- [ RunTime:0.019001s ]

[ 2014-08-08T00:53:30+08:00 ] 127.0.0.1 /php_demo/shizhan/10/10wish/index.php/Njb/Index
INFO: [ route_check ] --START--
INFO: CheckRoute Behavior ::run [ RunTime:0.009001s ]
INFO: [ route_check ] --END-- [ RunTime:0.014001s ]
INFO: [ app_begin ] --START--
INFO: ReadHtmlCache Behavior ::run [ RunTime:0.009000s ]
INFO: [ app_begin ] --END-- [ RunTime:0.015001s ]
SQL: SELECT l.name,COALESCE(a.ucount,0) as yhs,COALESCE(c.ulcount,0) as dlyhs,COALESCE(c.logCount,0) as dlcs FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(ud.id) ucount FROM   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud     GROUP BY ud.locid  ) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>=(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-1))) AND lo.login_time<(SELECT TIMESTAMP(DATE(SYSDATE())))   GROUP BY ud.locid) c ON l.id=c.locid WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.038002s ]
SQL: SELECT l.name,COALESCE(a.noticeCount,0) noticeCount,COALESCE(a.userCount,0) userCount FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(n.id) noticeCount,COUNT(DISTINCT ud.id) userCount FROM notice n,   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud   WHERE n.owner_id=ud.id AND n.publish_time>=(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-1)))    AND n.publish_time<(SELECT TIMESTAMP(DATE(SYSDATE()))) GROUP BY ud.locid) a  ON l.id=a.locid WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.004000s ]
SQL: SELECT l.name,COALESCE(a.asCount,0) a,COALESCE(b.adminCount,0) b,COALESCE(c.noAdminCount,0) c FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(t.id) asCount FROM assignment t,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE t.creator_id=ud.id AND t.create_time>=(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-1))) AND  t.create_time<(SELECT TIMESTAMP(DATE(SYSDATE())))  GROUP BY ud.locid) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) adminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud   WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='TechAdmin'   AND t.create_time>=(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-1))) AND  t.create_time<(SELECT TIMESTAMP(DATE(SYSDATE())))  GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) noAdminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='Technician'   AND t.create_time>=(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-1))) AND  t.create_time<(SELECT TIMESTAMP(DATE(SYSDATE())))  GROUP BY ud.locid ) c ON l.id=c.locid  WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.016001s ]
SQL: SELECT l.name,COALESCE(a.worklogCount,0) a,COALESCE(a.uCount,0) b,COALESCE(b.docCount,0) c,COALESCE(c.phoCount,0) d,COALESCE(d.audioCount,0) e FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(DISTINCT w.id) worklogCount,COUNT(DISTINCT w.owner_id) uCount FROM work_log w,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE w.owner_id=ud.id    AND w.create_time>=(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-1))) AND w.create_time<(SELECT TIMESTAMP(DATE(SYSDATE())))  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) docCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>=(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-1))) AND w.create_time<(SELECT TIMESTAMP(DATE(SYSDATE())))  AND i.media_type=1   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) phoCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>=(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-1))) AND w.create_time<(SELECT TIMESTAMP(DATE(SYSDATE())))  AND i.media_type=2   GROUP BY ud.locid ) c ON l.id=c.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) audioCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>=(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-1))) AND w.create_time<(SELECT TIMESTAMP(DATE(SYSDATE())))  AND i.media_type=3   GROUP BY ud.locid ) d ON l.id=d.locid   WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.040002s ]
SQL: SELECT l.name,COALESCE(a.photoCount,0) a,COALESCE(a.ucount,0) b,COALESCE(b.priseCount,0) c,COALESCE(c.comCount,0) d FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(i.id) photoCount,COUNT(DISTINCT ud.id) ucount FROM album m,album_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE m.owner_id=ud.id AND i.album_id=m.id   AND i.create_time>=(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-1))) AND i.create_time<(SELECT TIMESTAMP(DATE(SYSDATE())))  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,COUNT(uc.id) priseCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='AlbumItem'   AND uc.create_time>(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-1))) AND uc.create_time<(SELECT TIMESTAMP(DATE(SYSDATE())))   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(uc.id) comCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='SystemComment'   AND uc.create_time>=(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-1))) AND uc.create_time<(SELECT TIMESTAMP(DATE(SYSDATE())))  GROUP BY ud.locid) c ON l.id=c.locid  WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.036002s ]
SQL: SELECT a.rname a,l.name b,d.name c,a.age d FROM (SELECT u.id uid,u.real_name rname,u.location_id locid,u.dept_id depId,(2014-(SELECT SUBSTR(u.identify_value,7,4))+0) age FROM app_user u WHERE NOT EXISTS ( SELECT lo.user_id FROM login_log lo WHERE u.id=lo.user_id  ) AND u.id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422) )) a,location l,department d WHERE a.depId=d.id AND a.locid=l.id [ RunTime:2.174124s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) AND w.create_time>=(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-8))) AND w.create_time<(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-1))) GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) AND lo.login_time>=(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-8))) AND lo.login_time<(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-1))) GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.440025s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) AND w.create_time>=(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-8))) AND w.create_time<(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-1))) GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) AND lo.login_time>=(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-8))) AND lo.login_time<(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-1))) GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.385022s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) AND w.create_time>=(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-8))) AND w.create_time<(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-1))) GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) AND lo.login_time>=(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-8))) AND lo.login_time<(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-1))) GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.393023s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) AND w.create_time>=(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-8))) AND w.create_time<(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-1))) GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) AND lo.login_time>=(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-8))) AND lo.login_time<(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-1))) GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.378022s ]
SQL: SELECT l.name,COALESCE(a.ulcount,0) b FROM  location l LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>=(TIMESTAMP(ADDDATE(DATE(SYSDATE()),-(DAYOFWEEK(NOW())-2))))   GROUP BY ud.locid) a ON a.locid=l.id WHERE l.id IN (24521,24543,24561,28422) [ RunTime:0.092005s ]
INFO: [ view_parse ] --START--
INFO: ParseTemplate Behavior ::run [ RunTime:0.528030s ]
INFO: [ view_parse ] --END-- [ RunTime:0.533030s ]
INFO: [ view_filter ] --START--
INFO: ContentReplace Behavior ::run [ RunTime:0.009000s ]
INFO: TokenBuild Behavior ::run [ RunTime:0.011001s ]
INFO: WriteHtmlCache Behavior ::run [ RunTime:0.007000s ]
INFO: ShowRuntime Behavior ::run [ RunTime:0.013000s ]
INFO: [ view_filter ] --END-- [ RunTime:0.059004s ]
INFO: [ view_end ] --START--
INFO: ShowPageTrace Behavior ::run [ RunTime:0.012001s ]
INFO: [ view_end ] --END-- [ RunTime:0.020001s ]

[ 2014-08-08T00:55:25+08:00 ] 127.0.0.1 /php_demo/shizhan/10/10wish/index.php/Njb/Index
INFO: [ route_check ] --START--
INFO: CheckRoute Behavior ::run [ RunTime:0.007000s ]
INFO: [ route_check ] --END-- [ RunTime:0.013001s ]
INFO: [ app_begin ] --START--
INFO: ReadHtmlCache Behavior ::run [ RunTime:0.008001s ]
INFO: [ app_begin ] --END-- [ RunTime:0.015001s ]
SQL: SELECT l.name,COALESCE(a.ucount,0) as yhs,COALESCE(c.ulcount,0) as dlyhs,COALESCE(c.logCount,0) as dlcs FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(ud.id) ucount FROM   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud     GROUP BY ud.locid  ) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>=(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-1))) AND lo.login_time<(SELECT TIMESTAMP(DATE(SYSDATE())))   GROUP BY ud.locid) c ON l.id=c.locid WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.039002s ]
SQL: SELECT l.name,COALESCE(a.noticeCount,0) noticeCount,COALESCE(a.userCount,0) userCount FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(n.id) noticeCount,COUNT(DISTINCT ud.id) userCount FROM notice n,   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud   WHERE n.owner_id=ud.id AND n.publish_time>=(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-1)))    AND n.publish_time<(SELECT TIMESTAMP(DATE(SYSDATE()))) GROUP BY ud.locid) a  ON l.id=a.locid WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.004000s ]
SQL: SELECT l.name,COALESCE(a.asCount,0) a,COALESCE(b.adminCount,0) b,COALESCE(c.noAdminCount,0) c FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(t.id) asCount FROM assignment t,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE t.creator_id=ud.id AND t.create_time>=(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-1))) AND  t.create_time<(SELECT TIMESTAMP(DATE(SYSDATE())))  GROUP BY ud.locid) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) adminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud   WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='TechAdmin'   AND t.create_time>=(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-1))) AND  t.create_time<(SELECT TIMESTAMP(DATE(SYSDATE())))  GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) noAdminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='Technician'   AND t.create_time>=(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-1))) AND  t.create_time<(SELECT TIMESTAMP(DATE(SYSDATE())))  GROUP BY ud.locid ) c ON l.id=c.locid  WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.016001s ]
SQL: SELECT l.name,COALESCE(a.worklogCount,0) a,COALESCE(a.uCount,0) b,COALESCE(b.docCount,0) c,COALESCE(c.phoCount,0) d,COALESCE(d.audioCount,0) e FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(DISTINCT w.id) worklogCount,COUNT(DISTINCT w.owner_id) uCount FROM work_log w,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE w.owner_id=ud.id    AND w.create_time>=(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-1))) AND w.create_time<(SELECT TIMESTAMP(DATE(SYSDATE())))  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) docCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>=(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-1))) AND w.create_time<(SELECT TIMESTAMP(DATE(SYSDATE())))  AND i.media_type=1   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) phoCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>=(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-1))) AND w.create_time<(SELECT TIMESTAMP(DATE(SYSDATE())))  AND i.media_type=2   GROUP BY ud.locid ) c ON l.id=c.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) audioCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>=(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-1))) AND w.create_time<(SELECT TIMESTAMP(DATE(SYSDATE())))  AND i.media_type=3   GROUP BY ud.locid ) d ON l.id=d.locid   WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.044003s ]
SQL: SELECT l.name,COALESCE(a.photoCount,0) a,COALESCE(a.ucount,0) b,COALESCE(b.priseCount,0) c,COALESCE(c.comCount,0) d FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(i.id) photoCount,COUNT(DISTINCT ud.id) ucount FROM album m,album_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE m.owner_id=ud.id AND i.album_id=m.id   AND i.create_time>=(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-1))) AND i.create_time<(SELECT TIMESTAMP(DATE(SYSDATE())))  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,COUNT(uc.id) priseCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='AlbumItem'   AND uc.create_time>(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-1))) AND uc.create_time<(SELECT TIMESTAMP(DATE(SYSDATE())))   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(uc.id) comCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='SystemComment'   AND uc.create_time>=(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-1))) AND uc.create_time<(SELECT TIMESTAMP(DATE(SYSDATE())))  GROUP BY ud.locid) c ON l.id=c.locid  WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.013001s ]
SQL: SELECT a.rname a,l.name b,d.name c,a.age d FROM (SELECT u.id uid,u.real_name rname,u.location_id locid,u.dept_id depId,(2014-(SELECT SUBSTR(u.identify_value,7,4))+0) age FROM app_user u WHERE NOT EXISTS ( SELECT lo.user_id FROM login_log lo WHERE u.id=lo.user_id  ) AND u.id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422) )) a,location l,department d WHERE a.depId=d.id AND a.locid=l.id [ RunTime:2.598149s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) AND w.create_time>=(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-8))) AND w.create_time<(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-1))) GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) AND lo.login_time>=(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-8))) AND lo.login_time<(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-1))) GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.461026s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) AND w.create_time>=(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-8))) AND w.create_time<(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-1))) GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) AND lo.login_time>=(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-8))) AND lo.login_time<(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-1))) GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.466027s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) AND w.create_time>=(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-8))) AND w.create_time<(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-1))) GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) AND lo.login_time>=(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-8))) AND lo.login_time<(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-1))) GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.462027s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) AND w.create_time>=(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-8))) AND w.create_time<(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-1))) GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) AND lo.login_time>=(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-8))) AND lo.login_time<(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-1))) GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.460027s ]
SQL: SELECT l.name,COALESCE(a.ulcount,0) b FROM  location l LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>=(TIMESTAMP(ADDDATE(DATE(SYSDATE()),-(DAYOFWEEK(NOW())-2))))   GROUP BY ud.locid) a ON a.locid=l.id WHERE l.id IN (24521,24543,24561,28422) [ RunTime:0.119007s ]
INFO: [ view_parse ] --START--
INFO: ParseTemplate Behavior ::run [ RunTime:0.709041s ]
INFO: [ view_parse ] --END-- [ RunTime:0.717041s ]
INFO: [ view_filter ] --START--
INFO: ContentReplace Behavior ::run [ RunTime:0.012001s ]
INFO: TokenBuild Behavior ::run [ RunTime:0.016001s ]
INFO: WriteHtmlCache Behavior ::run [ RunTime:0.007000s ]
INFO: ShowRuntime Behavior ::run [ RunTime:0.019001s ]
INFO: [ view_filter ] --END-- [ RunTime:0.073004s ]
INFO: [ view_end ] --START--
INFO: ShowPageTrace Behavior ::run [ RunTime:0.018001s ]
INFO: [ view_end ] --END-- [ RunTime:0.033002s ]

[ 2014-08-08T00:55:27+08:00 ] 127.0.0.1 /php_demo/shizhan/10/10wish/index.php/Njb/Index
INFO: [ route_check ] --START--
INFO: CheckRoute Behavior ::run [ RunTime:0.013001s ]
INFO: [ route_check ] --END-- [ RunTime:0.024001s ]
INFO: [ app_begin ] --START--
INFO: ReadHtmlCache Behavior ::run [ RunTime:0.015001s ]
INFO: [ app_begin ] --END-- [ RunTime:0.023001s ]
SQL: SELECT l.name,COALESCE(a.ucount,0) as yhs,COALESCE(c.ulcount,0) as dlyhs,COALESCE(c.logCount,0) as dlcs FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(ud.id) ucount FROM   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud     GROUP BY ud.locid  ) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>=(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-1))) AND lo.login_time<(SELECT TIMESTAMP(DATE(SYSDATE())))   GROUP BY ud.locid) c ON l.id=c.locid WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.189011s ]
SQL: SELECT l.name,COALESCE(a.noticeCount,0) noticeCount,COALESCE(a.userCount,0) userCount FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(n.id) noticeCount,COUNT(DISTINCT ud.id) userCount FROM notice n,   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud   WHERE n.owner_id=ud.id AND n.publish_time>=(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-1)))    AND n.publish_time<(SELECT TIMESTAMP(DATE(SYSDATE()))) GROUP BY ud.locid) a  ON l.id=a.locid WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.007001s ]
SQL: SELECT l.name,COALESCE(a.asCount,0) a,COALESCE(b.adminCount,0) b,COALESCE(c.noAdminCount,0) c FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(t.id) asCount FROM assignment t,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE t.creator_id=ud.id AND t.create_time>=(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-1))) AND  t.create_time<(SELECT TIMESTAMP(DATE(SYSDATE())))  GROUP BY ud.locid) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) adminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud   WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='TechAdmin'   AND t.create_time>=(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-1))) AND  t.create_time<(SELECT TIMESTAMP(DATE(SYSDATE())))  GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) noAdminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='Technician'   AND t.create_time>=(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-1))) AND  t.create_time<(SELECT TIMESTAMP(DATE(SYSDATE())))  GROUP BY ud.locid ) c ON l.id=c.locid  WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.023002s ]
SQL: SELECT l.name,COALESCE(a.worklogCount,0) a,COALESCE(a.uCount,0) b,COALESCE(b.docCount,0) c,COALESCE(c.phoCount,0) d,COALESCE(d.audioCount,0) e FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(DISTINCT w.id) worklogCount,COUNT(DISTINCT w.owner_id) uCount FROM work_log w,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE w.owner_id=ud.id    AND w.create_time>=(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-1))) AND w.create_time<(SELECT TIMESTAMP(DATE(SYSDATE())))  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) docCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>=(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-1))) AND w.create_time<(SELECT TIMESTAMP(DATE(SYSDATE())))  AND i.media_type=1   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) phoCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>=(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-1))) AND w.create_time<(SELECT TIMESTAMP(DATE(SYSDATE())))  AND i.media_type=2   GROUP BY ud.locid ) c ON l.id=c.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) audioCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>=(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-1))) AND w.create_time<(SELECT TIMESTAMP(DATE(SYSDATE())))  AND i.media_type=3   GROUP BY ud.locid ) d ON l.id=d.locid   WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.056004s ]
SQL: SELECT l.name,COALESCE(a.photoCount,0) a,COALESCE(a.ucount,0) b,COALESCE(b.priseCount,0) c,COALESCE(c.comCount,0) d FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(i.id) photoCount,COUNT(DISTINCT ud.id) ucount FROM album m,album_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE m.owner_id=ud.id AND i.album_id=m.id   AND i.create_time>=(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-1))) AND i.create_time<(SELECT TIMESTAMP(DATE(SYSDATE())))  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,COUNT(uc.id) priseCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='AlbumItem'   AND uc.create_time>(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-1))) AND uc.create_time<(SELECT TIMESTAMP(DATE(SYSDATE())))   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(uc.id) comCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='SystemComment'   AND uc.create_time>=(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-1))) AND uc.create_time<(SELECT TIMESTAMP(DATE(SYSDATE())))  GROUP BY ud.locid) c ON l.id=c.locid  WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.024001s ]
SQL: SELECT a.rname a,l.name b,d.name c,a.age d FROM (SELECT u.id uid,u.real_name rname,u.location_id locid,u.dept_id depId,(2014-(SELECT SUBSTR(u.identify_value,7,4))+0) age FROM app_user u WHERE NOT EXISTS ( SELECT lo.user_id FROM login_log lo WHERE u.id=lo.user_id  ) AND u.id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422) )) a,location l,department d WHERE a.depId=d.id AND a.locid=l.id [ RunTime:2.749157s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) AND w.create_time>=(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-8))) AND w.create_time<(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-1))) GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) AND lo.login_time>=(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-8))) AND lo.login_time<(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-1))) GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.483027s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) AND w.create_time>=(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-8))) AND w.create_time<(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-1))) GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) AND lo.login_time>=(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-8))) AND lo.login_time<(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-1))) GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.566033s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) AND w.create_time>=(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-8))) AND w.create_time<(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-1))) GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) AND lo.login_time>=(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-8))) AND lo.login_time<(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-1))) GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.459027s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) AND w.create_time>=(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-8))) AND w.create_time<(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-1))) GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) AND lo.login_time>=(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-8))) AND lo.login_time<(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-1))) GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.477027s ]
SQL: SELECT l.name,COALESCE(a.ulcount,0) b FROM  location l LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>=(TIMESTAMP(ADDDATE(DATE(SYSDATE()),-(DAYOFWEEK(NOW())-2))))   GROUP BY ud.locid) a ON a.locid=l.id WHERE l.id IN (24521,24543,24561,28422) [ RunTime:0.114007s ]
INFO: [ view_parse ] --START--
INFO: ParseTemplate Behavior ::run [ RunTime:0.588033s ]
INFO: [ view_parse ] --END-- [ RunTime:0.595034s ]
INFO: [ view_filter ] --START--
INFO: ContentReplace Behavior ::run [ RunTime:0.006000s ]
INFO: TokenBuild Behavior ::run [ RunTime:0.010000s ]
INFO: WriteHtmlCache Behavior ::run [ RunTime:0.004001s ]
INFO: ShowRuntime Behavior ::run [ RunTime:0.013000s ]
INFO: [ view_filter ] --END-- [ RunTime:0.048003s ]
INFO: [ view_end ] --START--
INFO: ShowPageTrace Behavior ::run [ RunTime:0.017001s ]
INFO: [ view_end ] --END-- [ RunTime:0.023001s ]

[ 2014-08-08T00:58:29+08:00 ] 127.0.0.1 /php_demo/shizhan/10/10wish/index.php/Njb/Index
INFO: [ route_check ] --START--
INFO: CheckRoute Behavior ::run [ RunTime:0.007000s ]
INFO: [ route_check ] --END-- [ RunTime:0.012001s ]
INFO: [ app_begin ] --START--
INFO: ReadHtmlCache Behavior ::run [ RunTime:0.010001s ]
INFO: [ app_begin ] --END-- [ RunTime:0.016001s ]

[ 2014-08-08T00:59:09+08:00 ] 127.0.0.1 /php_demo/shizhan/10/10wish/index.php/Njb/Index
INFO: [ route_check ] --START--
INFO: CheckRoute Behavior ::run [ RunTime:0.006001s ]
INFO: [ route_check ] --END-- [ RunTime:0.013001s ]
INFO: [ app_begin ] --START--
INFO: ReadHtmlCache Behavior ::run [ RunTime:0.011001s ]
INFO: [ app_begin ] --END-- [ RunTime:0.016001s ]
SQL: SELECT l.name,COALESCE(a.ucount,0) as yhs,COALESCE(c.ulcount,0) as dlyhs,COALESCE(c.logCount,0) as dlcs FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(ud.id) ucount FROM   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud     GROUP BY ud.locid  ) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>="2014-07-09 00:00:00" AND lo.login_time<(SELECT TIMESTAMP(DATE(SYSDATE())))   GROUP BY ud.locid) c ON l.id=c.locid WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.840048s ]
SQL: SELECT l.name,COALESCE(a.noticeCount,0) noticeCount,COALESCE(a.userCount,0) userCount FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(n.id) noticeCount,COUNT(DISTINCT ud.id) userCount FROM notice n,   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud   WHERE n.owner_id=ud.id AND n.publish_time>=(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-1)))    AND n.publish_time<(SELECT TIMESTAMP(DATE(SYSDATE()))) GROUP BY ud.locid) a  ON l.id=a.locid WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.022002s ]
SQL: SELECT l.name,COALESCE(a.asCount,0) a,COALESCE(b.adminCount,0) b,COALESCE(c.noAdminCount,0) c FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(t.id) asCount FROM assignment t,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE t.creator_id=ud.id AND t.create_time>=(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-1))) AND  t.create_time<(SELECT TIMESTAMP(DATE(SYSDATE())))  GROUP BY ud.locid) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) adminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud   WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='TechAdmin'   AND t.create_time>=(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-1))) AND  t.create_time<(SELECT TIMESTAMP(DATE(SYSDATE())))  GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) noAdminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='Technician'   AND t.create_time>=(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-1))) AND  t.create_time<(SELECT TIMESTAMP(DATE(SYSDATE())))  GROUP BY ud.locid ) c ON l.id=c.locid  WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.017001s ]
SQL: SELECT l.name,COALESCE(a.worklogCount,0) a,COALESCE(a.uCount,0) b,COALESCE(b.docCount,0) c,COALESCE(c.phoCount,0) d,COALESCE(d.audioCount,0) e FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(DISTINCT w.id) worklogCount,COUNT(DISTINCT w.owner_id) uCount FROM work_log w,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE w.owner_id=ud.id    AND w.create_time>=(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-1))) AND w.create_time<(SELECT TIMESTAMP(DATE(SYSDATE())))  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) docCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>=(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-1))) AND w.create_time<(SELECT TIMESTAMP(DATE(SYSDATE())))  AND i.media_type=1   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) phoCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>=(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-1))) AND w.create_time<(SELECT TIMESTAMP(DATE(SYSDATE())))  AND i.media_type=2   GROUP BY ud.locid ) c ON l.id=c.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) audioCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>=(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-1))) AND w.create_time<(SELECT TIMESTAMP(DATE(SYSDATE())))  AND i.media_type=3   GROUP BY ud.locid ) d ON l.id=d.locid   WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.051003s ]
SQL: SELECT l.name,COALESCE(a.photoCount,0) a,COALESCE(a.ucount,0) b,COALESCE(b.priseCount,0) c,COALESCE(c.comCount,0) d FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(i.id) photoCount,COUNT(DISTINCT ud.id) ucount FROM album m,album_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE m.owner_id=ud.id AND i.album_id=m.id   AND i.create_time>=(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-1))) AND i.create_time<(SELECT TIMESTAMP(DATE(SYSDATE())))  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,COUNT(uc.id) priseCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='AlbumItem'   AND uc.create_time>(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-1))) AND uc.create_time<(SELECT TIMESTAMP(DATE(SYSDATE())))   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(uc.id) comCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='SystemComment'   AND uc.create_time>=(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-1))) AND uc.create_time<(SELECT TIMESTAMP(DATE(SYSDATE())))  GROUP BY ud.locid) c ON l.id=c.locid  WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.020001s ]
SQL: SELECT a.rname a,l.name b,d.name c,a.age d FROM (SELECT u.id uid,u.real_name rname,u.location_id locid,u.dept_id depId,(2014-(SELECT SUBSTR(u.identify_value,7,4))+0) age FROM app_user u WHERE NOT EXISTS ( SELECT lo.user_id FROM login_log lo WHERE u.id=lo.user_id  ) AND u.id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422) )) a,location l,department d WHERE a.depId=d.id AND a.locid=l.id [ RunTime:2.407138s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) AND w.create_time>=(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-8))) AND w.create_time<(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-1))) GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) AND lo.login_time>=(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-8))) AND lo.login_time<(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-1))) GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.400023s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) AND w.create_time>=(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-8))) AND w.create_time<(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-1))) GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) AND lo.login_time>=(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-8))) AND lo.login_time<(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-1))) GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.373021s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) AND w.create_time>=(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-8))) AND w.create_time<(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-1))) GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) AND lo.login_time>=(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-8))) AND lo.login_time<(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-1))) GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.384022s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) AND w.create_time>=(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-8))) AND w.create_time<(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-1))) GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) AND lo.login_time>=(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-8))) AND lo.login_time<(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-1))) GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.372022s ]
SQL: SELECT l.name,COALESCE(a.ulcount,0) b FROM  location l LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>=(TIMESTAMP(ADDDATE(DATE(SYSDATE()),-(DAYOFWEEK(NOW())-2))))   GROUP BY ud.locid) a ON a.locid=l.id WHERE l.id IN (24521,24543,24561,28422) [ RunTime:0.098006s ]
INFO: [ view_parse ] --START--
INFO: ParseTemplate Behavior ::run [ RunTime:0.528030s ]
INFO: [ view_parse ] --END-- [ RunTime:0.532031s ]
INFO: [ view_filter ] --START--
INFO: ContentReplace Behavior ::run [ RunTime:0.009001s ]
INFO: TokenBuild Behavior ::run [ RunTime:0.012001s ]
INFO: WriteHtmlCache Behavior ::run [ RunTime:0.008000s ]
INFO: ShowRuntime Behavior ::run [ RunTime:0.019001s ]
INFO: [ view_filter ] --END-- [ RunTime:0.066004s ]
INFO: [ view_end ] --START--
INFO: ShowPageTrace Behavior ::run [ RunTime:0.010001s ]
INFO: [ view_end ] --END-- [ RunTime:0.015001s ]

[ 2014-08-08T01:01:38+08:00 ] 127.0.0.1 /php_demo/shizhan/10/10wish/index.php/Njb/Index
INFO: [ route_check ] --START--
INFO: CheckRoute Behavior ::run [ RunTime:0.006000s ]
INFO: [ route_check ] --END-- [ RunTime:0.012001s ]
INFO: [ app_begin ] --START--
INFO: ReadHtmlCache Behavior ::run [ RunTime:0.009001s ]
INFO: [ app_begin ] --END-- [ RunTime:0.015001s ]
SQL: SELECT l.name,COALESCE(a.ucount,0) as yhs,COALESCE(c.ulcount,0) as dlyhs,COALESCE(c.logCount,0) as dlcs FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(ud.id) ucount FROM   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud     GROUP BY ud.locid  ) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>="2014-07-09 00:00:00" AND lo.login_time<(SELECT TIMESTAMP(DATE(SYSDATE())))   GROUP BY ud.locid) c ON l.id=c.locid WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.844048s ]
SQL: SELECT l.name,COALESCE(a.noticeCount,0) noticeCount,COALESCE(a.userCount,0) userCount FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(n.id) noticeCount,COUNT(DISTINCT ud.id) userCount FROM notice n,   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud   WHERE n.owner_id=ud.id AND n.publish_time>=(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-1)))    AND n.publish_time<(SELECT TIMESTAMP(DATE(SYSDATE()))) GROUP BY ud.locid) a  ON l.id=a.locid WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.004000s ]
SQL: SELECT l.name,COALESCE(a.asCount,0) a,COALESCE(b.adminCount,0) b,COALESCE(c.noAdminCount,0) c FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(t.id) asCount FROM assignment t,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE t.creator_id=ud.id AND t.create_time>=(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-1))) AND  t.create_time<(SELECT TIMESTAMP(DATE(SYSDATE())))  GROUP BY ud.locid) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) adminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud   WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='TechAdmin'   AND t.create_time>=(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-1))) AND  t.create_time<(SELECT TIMESTAMP(DATE(SYSDATE())))  GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) noAdminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='Technician'   AND t.create_time>=(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-1))) AND  t.create_time<(SELECT TIMESTAMP(DATE(SYSDATE())))  GROUP BY ud.locid ) c ON l.id=c.locid  WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.012001s ]
SQL: SELECT l.name,COALESCE(a.worklogCount,0) a,COALESCE(a.uCount,0) b,COALESCE(b.docCount,0) c,COALESCE(c.phoCount,0) d,COALESCE(d.audioCount,0) e FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(DISTINCT w.id) worklogCount,COUNT(DISTINCT w.owner_id) uCount FROM work_log w,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE w.owner_id=ud.id    AND w.create_time>=(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-1))) AND w.create_time<(SELECT TIMESTAMP(DATE(SYSDATE())))  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) docCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>=(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-1))) AND w.create_time<(SELECT TIMESTAMP(DATE(SYSDATE())))  AND i.media_type=1   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) phoCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>=(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-1))) AND w.create_time<(SELECT TIMESTAMP(DATE(SYSDATE())))  AND i.media_type=2   GROUP BY ud.locid ) c ON l.id=c.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) audioCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>=(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-1))) AND w.create_time<(SELECT TIMESTAMP(DATE(SYSDATE())))  AND i.media_type=3   GROUP BY ud.locid ) d ON l.id=d.locid   WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.036003s ]
SQL: SELECT l.name,COALESCE(a.photoCount,0) a,COALESCE(a.ucount,0) b,COALESCE(b.priseCount,0) c,COALESCE(c.comCount,0) d FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(i.id) photoCount,COUNT(DISTINCT ud.id) ucount FROM album m,album_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE m.owner_id=ud.id AND i.album_id=m.id   AND i.create_time>=(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-1))) AND i.create_time<(SELECT TIMESTAMP(DATE(SYSDATE())))  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,COUNT(uc.id) priseCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='AlbumItem'   AND uc.create_time>(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-1))) AND uc.create_time<(SELECT TIMESTAMP(DATE(SYSDATE())))   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(uc.id) comCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='SystemComment'   AND uc.create_time>=(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-1))) AND uc.create_time<(SELECT TIMESTAMP(DATE(SYSDATE())))  GROUP BY ud.locid) c ON l.id=c.locid  WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.013001s ]
SQL: SELECT a.rname a,l.name b,d.name c,a.age d FROM (SELECT u.id uid,u.real_name rname,u.location_id locid,u.dept_id depId,(2014-(SELECT SUBSTR(u.identify_value,7,4))+0) age FROM app_user u WHERE NOT EXISTS ( SELECT lo.user_id FROM login_log lo WHERE u.id=lo.user_id  ) AND u.id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422) )) a,location l,department d WHERE a.depId=d.id AND a.locid=l.id [ RunTime:2.185125s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) AND w.create_time>=(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-8))) AND w.create_time<(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-1))) GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) AND lo.login_time>=(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-8))) AND lo.login_time<(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-1))) GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.438025s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) AND w.create_time>=(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-8))) AND w.create_time<(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-1))) GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) AND lo.login_time>=(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-8))) AND lo.login_time<(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-1))) GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.369021s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) AND w.create_time>=(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-8))) AND w.create_time<(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-1))) GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) AND lo.login_time>=(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-8))) AND lo.login_time<(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-1))) GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.446026s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) AND w.create_time>=(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-8))) AND w.create_time<(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-1))) GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) AND lo.login_time>=(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-8))) AND lo.login_time<(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-1))) GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.437025s ]
SQL: SELECT l.name,COALESCE(a.ulcount,0) b FROM  location l LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>=(TIMESTAMP(ADDDATE(DATE(SYSDATE()),-(DAYOFWEEK(NOW())-2))))   GROUP BY ud.locid) a ON a.locid=l.id WHERE l.id IN (24521,24543,24561,28422) [ RunTime:0.104006s ]
INFO: [ view_parse ] --START--
INFO: ParseTemplate Behavior ::run [ RunTime:0.589033s ]
INFO: [ view_parse ] --END-- [ RunTime:0.594034s ]
INFO: [ view_filter ] --START--
INFO: ContentReplace Behavior ::run [ RunTime:0.007000s ]
INFO: TokenBuild Behavior ::run [ RunTime:0.010001s ]
INFO: WriteHtmlCache Behavior ::run [ RunTime:0.004000s ]
INFO: ShowRuntime Behavior ::run [ RunTime:0.012001s ]
INFO: [ view_filter ] --END-- [ RunTime:0.048002s ]
INFO: [ view_end ] --START--
INFO: ShowPageTrace Behavior ::run [ RunTime:0.013001s ]
INFO: [ view_end ] --END-- [ RunTime:0.019001s ]

[ 2014-08-08T01:03:08+08:00 ] 127.0.0.1 /php_demo/shizhan/10/10wish/index.php/Njb/Index
INFO: [ route_check ] --START--
INFO: CheckRoute Behavior ::run [ RunTime:0.008001s ]
INFO: [ route_check ] --END-- [ RunTime:0.013001s ]
INFO: [ app_begin ] --START--
INFO: ReadHtmlCache Behavior ::run [ RunTime:0.011001s ]
INFO: [ app_begin ] --END-- [ RunTime:0.016001s ]
SQL: SELECT l.name,COALESCE(a.ucount,0) as yhs,COALESCE(c.ulcount,0) as dlyhs,COALESCE(c.logCount,0) as dlcs FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(ud.id) ucount FROM   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud     GROUP BY ud.locid  ) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>="2014-07-09 00:00:00" AND lo.login_time<(SELECT TIMESTAMP(DATE(SYSDATE())))   GROUP BY ud.locid) c ON l.id=c.locid WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.917053s ]
SQL: SELECT l.name,COALESCE(a.noticeCount,0) noticeCount,COALESCE(a.userCount,0) userCount FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(n.id) noticeCount,COUNT(DISTINCT ud.id) userCount FROM notice n,   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud   WHERE n.owner_id=ud.id AND n.publish_time>="2014-07-09 00:00:00"    AND n.publish_time<(SELECT TIMESTAMP(DATE(SYSDATE()))) GROUP BY ud.locid) a  ON l.id=a.locid WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.005001s ]
SQL: SELECT l.name,COALESCE(a.asCount,0) a,COALESCE(b.adminCount,0) b,COALESCE(c.noAdminCount,0) c FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(t.id) asCount FROM assignment t,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE t.creator_id=ud.id AND t.create_time>="2014-07-09 00:00:00" AND  t.create_time<(SELECT TIMESTAMP(DATE(SYSDATE())))  GROUP BY ud.locid) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) adminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud   WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='TechAdmin'   AND t.create_time>="2014-07-09 00:00:00" AND  t.create_time<(SELECT TIMESTAMP(DATE(SYSDATE())))  GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) noAdminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='Technician'   AND t.create_time>="2014-07-09 00:00:00" AND  t.create_time<(SELECT TIMESTAMP(DATE(SYSDATE())))  GROUP BY ud.locid ) c ON l.id=c.locid  WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.018001s ]
SQL: SELECT l.name,COALESCE(a.worklogCount,0) a,COALESCE(a.uCount,0) b,COALESCE(b.docCount,0) c,COALESCE(c.phoCount,0) d,COALESCE(d.audioCount,0) e FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(DISTINCT w.id) worklogCount,COUNT(DISTINCT w.owner_id) uCount FROM work_log w,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE w.owner_id=ud.id    AND w.create_time>="2014-07-09 00:00:00" AND w.create_time<(SELECT TIMESTAMP(DATE(SYSDATE())))  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) docCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-07-09 00:00:00" AND w.create_time<(SELECT TIMESTAMP(DATE(SYSDATE())))  AND i.media_type=1   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) phoCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-07-09 00:00:00" AND w.create_time<(SELECT TIMESTAMP(DATE(SYSDATE())))  AND i.media_type=2   GROUP BY ud.locid ) c ON l.id=c.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) audioCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-07-09 00:00:00" AND w.create_time<(SELECT TIMESTAMP(DATE(SYSDATE())))  AND i.media_type=3   GROUP BY ud.locid ) d ON l.id=d.locid   WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.210012s ]
SQL: SELECT l.name,COALESCE(a.photoCount,0) a,COALESCE(a.ucount,0) b,COALESCE(b.priseCount,0) c,COALESCE(c.comCount,0) d FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(i.id) photoCount,COUNT(DISTINCT ud.id) ucount FROM album m,album_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE m.owner_id=ud.id AND i.album_id=m.id   AND i.create_time>="2014-07-09 00:00:00" AND i.create_time<(SELECT TIMESTAMP(DATE(SYSDATE())))  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,COUNT(uc.id) priseCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='AlbumItem'   AND uc.create_time>"2014-07-09 00:00:00" AND uc.create_time<(SELECT TIMESTAMP(DATE(SYSDATE())))   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(uc.id) comCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='SystemComment'   AND uc.create_time>="2014-07-09 00:00:00" AND uc.create_time<(SELECT TIMESTAMP(DATE(SYSDATE())))  GROUP BY ud.locid) c ON l.id=c.locid  WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.025002s ]
SQL: SELECT a.rname a,l.name b,d.name c,a.age d FROM (SELECT u.id uid,u.real_name rname,u.location_id locid,u.dept_id depId,(2014-(SELECT SUBSTR(u.identify_value,7,4))+0) age FROM app_user u WHERE NOT EXISTS ( SELECT lo.user_id FROM login_log lo WHERE u.id=lo.user_id  ) AND u.id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422) )) a,location l,department d WHERE a.depId=d.id AND a.locid=l.id [ RunTime:2.153123s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) AND w.create_time>=(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-8))) AND w.create_time<"2014-07-09 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) AND lo.login_time>=(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-8))) AND lo.login_time<"2014-07-09 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.367021s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) AND w.create_time>=(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-8))) AND w.create_time<"2014-07-09 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) AND lo.login_time>=(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-8))) AND lo.login_time<"2014-07-09 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.405023s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) AND w.create_time>=(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-8))) AND w.create_time<"2014-07-09 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) AND lo.login_time>=(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-8))) AND lo.login_time<"2014-07-09 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.368021s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) AND w.create_time>=(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-8))) AND w.create_time<"2014-07-09 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) AND lo.login_time>=(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-8))) AND lo.login_time<"2014-07-09 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.369021s ]
SQL: SELECT l.name,COALESCE(a.ulcount,0) b FROM  location l LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>=(TIMESTAMP(ADDDATE(DATE(SYSDATE()),-(DAYOFWEEK(NOW())-2))))   GROUP BY ud.locid) a ON a.locid=l.id WHERE l.id IN (24521,24543,24561,28422) [ RunTime:0.097006s ]
INFO: [ view_parse ] --START--
INFO: ParseTemplate Behavior ::run [ RunTime:0.518029s ]
INFO: [ view_parse ] --END-- [ RunTime:0.523029s ]
INFO: [ view_filter ] --START--
INFO: ContentReplace Behavior ::run [ RunTime:0.007000s ]
INFO: TokenBuild Behavior ::run [ RunTime:0.011001s ]
INFO: WriteHtmlCache Behavior ::run [ RunTime:0.004000s ]
INFO: ShowRuntime Behavior ::run [ RunTime:0.012000s ]
INFO: [ view_filter ] --END-- [ RunTime:0.048002s ]
INFO: [ view_end ] --START--
INFO: ShowPageTrace Behavior ::run [ RunTime:0.011001s ]
INFO: [ view_end ] --END-- [ RunTime:0.018001s ]

[ 2014-08-08T01:05:10+08:00 ] 127.0.0.1 /php_demo/shizhan/10/10wish/index.php/Njb/Index
INFO: [ route_check ] --START--
INFO: CheckRoute Behavior ::run [ RunTime:0.008001s ]
INFO: [ route_check ] --END-- [ RunTime:0.014001s ]
INFO: [ app_begin ] --START--
INFO: ReadHtmlCache Behavior ::run [ RunTime:0.012001s ]
INFO: [ app_begin ] --END-- [ RunTime:0.016001s ]
SQL: SELECT l.name,COALESCE(a.ucount,0) as yhs,COALESCE(c.ulcount,0) as dlyhs,COALESCE(c.logCount,0) as dlcs FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(ud.id) ucount FROM   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud     GROUP BY ud.locid  ) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>="2014-07-09 00:00:00" AND lo.login_time<"2014-08-08 00:00:00"   GROUP BY ud.locid) c ON l.id=c.locid WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.884051s ]
SQL: SELECT l.name,COALESCE(a.noticeCount,0) noticeCount,COALESCE(a.userCount,0) userCount FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(n.id) noticeCount,COUNT(DISTINCT ud.id) userCount FROM notice n,   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud   WHERE n.owner_id=ud.id AND n.publish_time>="2014-07-09 00:00:00"    AND n.publish_time<"2014-08-08 00:00:00" GROUP BY ud.locid) a  ON l.id=a.locid WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.005000s ]
SQL: SELECT l.name,COALESCE(a.asCount,0) a,COALESCE(b.adminCount,0) b,COALESCE(c.noAdminCount,0) c FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(t.id) asCount FROM assignment t,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE t.creator_id=ud.id AND t.create_time>="2014-07-09 00:00:00" AND  t.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) adminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud   WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='TechAdmin'   AND t.create_time>="2014-07-09 00:00:00" AND  t.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) noAdminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='Technician'   AND t.create_time>="2014-07-09 00:00:00" AND  t.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid ) c ON l.id=c.locid  WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.013001s ]
SQL: SELECT l.name,COALESCE(a.worklogCount,0) a,COALESCE(a.uCount,0) b,COALESCE(b.docCount,0) c,COALESCE(c.phoCount,0) d,COALESCE(d.audioCount,0) e FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(DISTINCT w.id) worklogCount,COUNT(DISTINCT w.owner_id) uCount FROM work_log w,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE w.owner_id=ud.id    AND w.create_time>="2014-07-09 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) docCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-07-09 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  AND i.media_type=1   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) phoCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-07-09 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  AND i.media_type=2   GROUP BY ud.locid ) c ON l.id=c.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) audioCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-07-09 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  AND i.media_type=3   GROUP BY ud.locid ) d ON l.id=d.locid   WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.077004s ]
SQL: SELECT l.name,COALESCE(a.photoCount,0) a,COALESCE(a.ucount,0) b,COALESCE(b.priseCount,0) c,COALESCE(c.comCount,0) d FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(i.id) photoCount,COUNT(DISTINCT ud.id) ucount FROM album m,album_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE m.owner_id=ud.id AND i.album_id=m.id   AND i.create_time>="2014-07-09 00:00:00" AND i.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,COUNT(uc.id) priseCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='AlbumItem'   AND uc.create_time>"2014-07-09 00:00:00" AND uc.create_time<"2014-08-08 00:00:00"   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(uc.id) comCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='SystemComment'   AND uc.create_time>="2014-07-09 00:00:00" AND uc.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) c ON l.id=c.locid  WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.013001s ]
SQL: SELECT a.rname a,l.name b,d.name c,a.age d FROM (SELECT u.id uid,u.real_name rname,u.location_id locid,u.dept_id depId,(2014-(SELECT SUBSTR(u.identify_value,7,4))+0) age FROM app_user u WHERE NOT EXISTS ( SELECT lo.user_id FROM login_log lo WHERE u.id=lo.user_id  ) AND u.id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422) )) a,location l,department d WHERE a.depId=d.id AND a.locid=l.id [ RunTime:2.171124s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) AND w.create_time>=(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-8))) AND w.create_time<"2014-07-09 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) AND lo.login_time>=(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-8))) AND lo.login_time<"2014-07-09 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.375022s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) AND w.create_time>=(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-8))) AND w.create_time<"2014-07-09 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) AND lo.login_time>=(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-8))) AND lo.login_time<"2014-07-09 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.369021s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) AND w.create_time>=(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-8))) AND w.create_time<"2014-07-09 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) AND lo.login_time>=(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-8))) AND lo.login_time<"2014-07-09 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.381021s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) AND w.create_time>=(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-8))) AND w.create_time<"2014-07-09 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) AND lo.login_time>=(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-8))) AND lo.login_time<"2014-07-09 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.362021s ]
SQL: SELECT l.name,COALESCE(a.ulcount,0) b FROM  location l LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>=(TIMESTAMP(ADDDATE(DATE(SYSDATE()),-(DAYOFWEEK(NOW())-2))))   GROUP BY ud.locid) a ON a.locid=l.id WHERE l.id IN (24521,24543,24561,28422) [ RunTime:0.097006s ]
INFO: [ view_parse ] --START--
INFO: ParseTemplate Behavior ::run [ RunTime:0.536030s ]
INFO: [ view_parse ] --END-- [ RunTime:0.541031s ]
INFO: [ view_filter ] --START--
INFO: ContentReplace Behavior ::run [ RunTime:0.009000s ]
INFO: TokenBuild Behavior ::run [ RunTime:0.009000s ]
INFO: WriteHtmlCache Behavior ::run [ RunTime:0.004000s ]
INFO: ShowRuntime Behavior ::run [ RunTime:0.014000s ]
INFO: [ view_filter ] --END-- [ RunTime:0.049003s ]
INFO: [ view_end ] --START--
INFO: ShowPageTrace Behavior ::run [ RunTime:0.030002s ]
INFO: [ view_end ] --END-- [ RunTime:0.035002s ]

[ 2014-08-08T01:08:04+08:00 ] 127.0.0.1 /php_demo/shizhan/10/10wish/index.php/Njb/Index/tongji
INFO: [ route_check ] --START--
INFO: CheckRoute Behavior ::run [ RunTime:0.008000s ]
INFO: [ route_check ] --END-- [ RunTime:0.012000s ]
INFO: [ app_begin ] --START--
INFO: ReadHtmlCache Behavior ::run [ RunTime:0.012001s ]
INFO: [ app_begin ] --END-- [ RunTime:0.017001s ]
SQL: SELECT l.name,COALESCE(a.ucount,0) as yhs,COALESCE(c.ulcount,0) as dlyhs,COALESCE(c.logCount,0) as dlcs FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(ud.id) ucount FROM   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud     GROUP BY ud.locid  ) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>="2014-07-09 00:00:00" AND lo.login_time<"2014-08-08 00:00:00"   GROUP BY ud.locid) c ON l.id=c.locid WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.825048s ]
SQL: SELECT l.name,COALESCE(a.noticeCount,0) noticeCount,COALESCE(a.userCount,0) userCount FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(n.id) noticeCount,COUNT(DISTINCT ud.id) userCount FROM notice n,   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud   WHERE n.owner_id=ud.id AND n.publish_time>="2014-07-09 00:00:00"    AND n.publish_time<"2014-08-08 00:00:00" GROUP BY ud.locid) a  ON l.id=a.locid WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.004001s ]
SQL: SELECT l.name,COALESCE(a.asCount,0) a,COALESCE(b.adminCount,0) b,COALESCE(c.noAdminCount,0) c FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(t.id) asCount FROM assignment t,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE t.creator_id=ud.id AND t.create_time>="2014-07-09 00:00:00" AND  t.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) adminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud   WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='TechAdmin'   AND t.create_time>="2014-07-09 00:00:00" AND  t.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) noAdminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='Technician'   AND t.create_time>="2014-07-09 00:00:00" AND  t.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid ) c ON l.id=c.locid  WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.015001s ]
SQL: SELECT l.name,COALESCE(a.worklogCount,0) a,COALESCE(a.uCount,0) b,COALESCE(b.docCount,0) c,COALESCE(c.phoCount,0) d,COALESCE(d.audioCount,0) e FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(DISTINCT w.id) worklogCount,COUNT(DISTINCT w.owner_id) uCount FROM work_log w,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE w.owner_id=ud.id    AND w.create_time>="2014-07-09 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) docCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-07-09 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  AND i.media_type=1   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) phoCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-07-09 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  AND i.media_type=2   GROUP BY ud.locid ) c ON l.id=c.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) audioCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-07-09 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  AND i.media_type=3   GROUP BY ud.locid ) d ON l.id=d.locid   WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.081005s ]
SQL: SELECT l.name,COALESCE(a.photoCount,0) a,COALESCE(a.ucount,0) b,COALESCE(b.priseCount,0) c,COALESCE(c.comCount,0) d FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(i.id) photoCount,COUNT(DISTINCT ud.id) ucount FROM album m,album_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE m.owner_id=ud.id AND i.album_id=m.id   AND i.create_time>="2014-07-09 00:00:00" AND i.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,COUNT(uc.id) priseCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='AlbumItem'   AND uc.create_time>"2014-07-09 00:00:00" AND uc.create_time<"2014-08-08 00:00:00"   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(uc.id) comCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='SystemComment'   AND uc.create_time>="2014-07-09 00:00:00" AND uc.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) c ON l.id=c.locid  WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.013001s ]
SQL: SELECT a.rname a,l.name b,d.name c,a.age d FROM (SELECT u.id uid,u.real_name rname,u.location_id locid,u.dept_id depId,(2014-(SELECT SUBSTR(u.identify_value,7,4))+0) age FROM app_user u WHERE NOT EXISTS ( SELECT lo.user_id FROM login_log lo WHERE u.id=lo.user_id  ) AND u.id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422) )) a,location l,department d WHERE a.depId=d.id AND a.locid=l.id [ RunTime:2.144122s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) AND w.create_time>=(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-8))) AND w.create_time<"2014-07-09 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) AND lo.login_time>=(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-8))) AND lo.login_time<"2014-07-09 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.369021s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) AND w.create_time>=(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-8))) AND w.create_time<"2014-07-09 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) AND lo.login_time>=(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-8))) AND lo.login_time<"2014-07-09 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.366020s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) AND w.create_time>=(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-8))) AND w.create_time<"2014-07-09 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) AND lo.login_time>=(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-8))) AND lo.login_time<"2014-07-09 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.415024s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) AND w.create_time>=(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-8))) AND w.create_time<"2014-07-09 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) AND lo.login_time>=(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-8))) AND lo.login_time<"2014-07-09 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.370021s ]
SQL: SELECT l.name,COALESCE(a.ulcount,0) b FROM  location l LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>=(TIMESTAMP(ADDDATE(DATE(SYSDATE()),-(DAYOFWEEK(NOW())-2))))   GROUP BY ud.locid) a ON a.locid=l.id WHERE l.id IN (24521,24543,24561,28422) [ RunTime:0.097006s ]
ERR: 模板不存在[./APP/Tpl/Njb/Index/tongji.html]

[ 2014-08-08T01:09:08+08:00 ] 127.0.0.1 /php_demo/shizhan/10/10wish/index.php/Njb/Index/tongji
INFO: [ route_check ] --START--
INFO: CheckRoute Behavior ::run [ RunTime:0.009000s ]
INFO: [ route_check ] --END-- [ RunTime:0.013001s ]
INFO: [ app_begin ] --START--
INFO: ReadHtmlCache Behavior ::run [ RunTime:0.010001s ]
INFO: [ app_begin ] --END-- [ RunTime:0.015001s ]
SQL: SELECT l.name,COALESCE(a.ucount,0) as yhs,COALESCE(c.ulcount,0) as dlyhs,COALESCE(c.logCount,0) as dlcs FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(ud.id) ucount FROM   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud     GROUP BY ud.locid  ) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>="2014-07-09 00:00:00" AND lo.login_time<"2014-08-08 00:00:00"   GROUP BY ud.locid) c ON l.id=c.locid WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.871050s ]
SQL: SELECT l.name,COALESCE(a.noticeCount,0) noticeCount,COALESCE(a.userCount,0) userCount FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(n.id) noticeCount,COUNT(DISTINCT ud.id) userCount FROM notice n,   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud   WHERE n.owner_id=ud.id AND n.publish_time>="2014-07-09 00:00:00"    AND n.publish_time<"2014-08-08 00:00:00" GROUP BY ud.locid) a  ON l.id=a.locid WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.006000s ]
SQL: SELECT l.name,COALESCE(a.asCount,0) a,COALESCE(b.adminCount,0) b,COALESCE(c.noAdminCount,0) c FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(t.id) asCount FROM assignment t,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE t.creator_id=ud.id AND t.create_time>="2014-07-09 00:00:00" AND  t.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) adminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud   WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='TechAdmin'   AND t.create_time>="2014-07-09 00:00:00" AND  t.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) noAdminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='Technician'   AND t.create_time>="2014-07-09 00:00:00" AND  t.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid ) c ON l.id=c.locid  WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.015000s ]
SQL: SELECT l.name,COALESCE(a.worklogCount,0) a,COALESCE(a.uCount,0) b,COALESCE(b.docCount,0) c,COALESCE(c.phoCount,0) d,COALESCE(d.audioCount,0) e FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(DISTINCT w.id) worklogCount,COUNT(DISTINCT w.owner_id) uCount FROM work_log w,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE w.owner_id=ud.id    AND w.create_time>="2014-07-09 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) docCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-07-09 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  AND i.media_type=1   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) phoCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-07-09 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  AND i.media_type=2   GROUP BY ud.locid ) c ON l.id=c.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) audioCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-07-09 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  AND i.media_type=3   GROUP BY ud.locid ) d ON l.id=d.locid   WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.101006s ]
SQL: SELECT l.name,COALESCE(a.photoCount,0) a,COALESCE(a.ucount,0) b,COALESCE(b.priseCount,0) c,COALESCE(c.comCount,0) d FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(i.id) photoCount,COUNT(DISTINCT ud.id) ucount FROM album m,album_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE m.owner_id=ud.id AND i.album_id=m.id   AND i.create_time>="2014-07-09 00:00:00" AND i.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,COUNT(uc.id) priseCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='AlbumItem'   AND uc.create_time>"2014-07-09 00:00:00" AND uc.create_time<"2014-08-08 00:00:00"   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(uc.id) comCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='SystemComment'   AND uc.create_time>="2014-07-09 00:00:00" AND uc.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) c ON l.id=c.locid  WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.014001s ]
SQL: SELECT a.rname a,l.name b,d.name c,a.age d FROM (SELECT u.id uid,u.real_name rname,u.location_id locid,u.dept_id depId,(2014-(SELECT SUBSTR(u.identify_value,7,4))+0) age FROM app_user u WHERE NOT EXISTS ( SELECT lo.user_id FROM login_log lo WHERE u.id=lo.user_id  ) AND u.id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422) )) a,location l,department d WHERE a.depId=d.id AND a.locid=l.id [ RunTime:2.151124s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) AND w.create_time>=(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-8))) AND w.create_time<"2014-07-09 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) AND lo.login_time>=(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-8))) AND lo.login_time<"2014-07-09 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.371021s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) AND w.create_time>=(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-8))) AND w.create_time<"2014-07-09 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) AND lo.login_time>=(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-8))) AND lo.login_time<"2014-07-09 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.359021s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) AND w.create_time>=(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-8))) AND w.create_time<"2014-07-09 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) AND lo.login_time>=(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-8))) AND lo.login_time<"2014-07-09 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.378022s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) AND w.create_time>=(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-8))) AND w.create_time<"2014-07-09 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) AND lo.login_time>=(SELECT TIMESTAMP(ADDDATE(DATE(SYSDATE()),-8))) AND lo.login_time<"2014-07-09 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.369021s ]
SQL: SELECT l.name,COALESCE(a.ulcount,0) b FROM  location l LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>=(TIMESTAMP(ADDDATE(DATE(SYSDATE()),-(DAYOFWEEK(NOW())-2))))   GROUP BY ud.locid) a ON a.locid=l.id WHERE l.id IN (24521,24543,24561,28422) [ RunTime:0.096005s ]
INFO: [ view_parse ] --START--
INFO: ParseTemplate Behavior ::run [ RunTime:0.738042s ]
INFO: [ view_parse ] --END-- [ RunTime:0.746043s ]
INFO: [ view_filter ] --START--
INFO: ContentReplace Behavior ::run [ RunTime:0.009001s ]
INFO: TokenBuild Behavior ::run [ RunTime:0.008001s ]
INFO: WriteHtmlCache Behavior ::run [ RunTime:0.004000s ]
INFO: ShowRuntime Behavior ::run [ RunTime:0.012001s ]
INFO: [ view_filter ] --END-- [ RunTime:0.050003s ]
INFO: [ view_end ] --START--
INFO: ShowPageTrace Behavior ::run [ RunTime:0.030001s ]
INFO: [ view_end ] --END-- [ RunTime:0.037002s ]

[ 2014-08-08T01:16:26+08:00 ] 127.0.0.1 /php_demo/shizhan/10/10wish/index.php/Njb/Index/tongji
INFO: [ route_check ] --START--
INFO: CheckRoute Behavior ::run [ RunTime:0.007000s ]
INFO: [ route_check ] --END-- [ RunTime:0.012001s ]
INFO: [ app_begin ] --START--
INFO: ReadHtmlCache Behavior ::run [ RunTime:0.009001s ]
INFO: [ app_begin ] --END-- [ RunTime:0.016001s ]
SQL: SELECT l.name,COALESCE(a.ucount,0) as yhs,COALESCE(c.ulcount,0) as dlyhs,COALESCE(c.logCount,0) as dlcs FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(ud.id) ucount FROM   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud     GROUP BY ud.locid  ) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>="2014-07-09 00:00:00" AND lo.login_time<"2014-08-08 00:00:00"   GROUP BY ud.locid) c ON l.id=c.locid WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.894051s ]
SQL: SELECT l.name,COALESCE(a.noticeCount,0) noticeCount,COALESCE(a.userCount,0) userCount FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(n.id) noticeCount,COUNT(DISTINCT ud.id) userCount FROM notice n,   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud   WHERE n.owner_id=ud.id AND n.publish_time>="2014-07-09 00:00:00"    AND n.publish_time<"2014-08-08 00:00:00" GROUP BY ud.locid) a  ON l.id=a.locid WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.004001s ]
SQL: SELECT l.name,COALESCE(a.asCount,0) a,COALESCE(b.adminCount,0) b,COALESCE(c.noAdminCount,0) c FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(t.id) asCount FROM assignment t,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE t.creator_id=ud.id AND t.create_time>="2014-07-09 00:00:00" AND  t.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) adminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud   WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='TechAdmin'   AND t.create_time>="2014-07-09 00:00:00" AND  t.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) noAdminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='Technician'   AND t.create_time>="2014-07-09 00:00:00" AND  t.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid ) c ON l.id=c.locid  WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.013001s ]
SQL: SELECT l.name,COALESCE(a.worklogCount,0) a,COALESCE(a.uCount,0) b,COALESCE(b.docCount,0) c,COALESCE(c.phoCount,0) d,COALESCE(d.audioCount,0) e FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(DISTINCT w.id) worklogCount,COUNT(DISTINCT w.owner_id) uCount FROM work_log w,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE w.owner_id=ud.id    AND w.create_time>="2014-07-09 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) docCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-07-09 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  AND i.media_type=1   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) phoCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-07-09 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  AND i.media_type=2   GROUP BY ud.locid ) c ON l.id=c.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) audioCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-07-09 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  AND i.media_type=3   GROUP BY ud.locid ) d ON l.id=d.locid   WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.077005s ]
SQL: SELECT l.name,COALESCE(a.photoCount,0) a,COALESCE(a.ucount,0) b,COALESCE(b.priseCount,0) c,COALESCE(c.comCount,0) d FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(i.id) photoCount,COUNT(DISTINCT ud.id) ucount FROM album m,album_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE m.owner_id=ud.id AND i.album_id=m.id   AND i.create_time>="2014-07-09 00:00:00" AND i.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,COUNT(uc.id) priseCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='AlbumItem'   AND uc.create_time>"2014-07-09 00:00:00" AND uc.create_time<"2014-08-08 00:00:00"   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(uc.id) comCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='SystemComment'   AND uc.create_time>="2014-07-09 00:00:00" AND uc.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) c ON l.id=c.locid  WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.015001s ]
SQL: SELECT a.rname a,l.name b,d.name c,a.age d FROM (SELECT u.id uid,u.real_name rname,u.location_id locid,u.dept_id depId,(2014-(SELECT SUBSTR(u.identify_value,7,4))+0) age FROM app_user u WHERE NOT EXISTS ( SELECT lo.user_id FROM login_log lo WHERE u.id=lo.user_id  ) AND u.id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422) )) a,location l,department d WHERE a.depId=d.id AND a.locid=l.id [ RunTime:2.157124s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) AND w.create_time>="2014-07-09 00:00:00" AND w.create_time<"2014-08-08 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) AND lo.login_time>="2014-07-09 00:00:00" AND lo.login_time<"2014-08-08 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.375021s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) AND w.create_time>="2014-07-09 00:00:00" AND w.create_time<"2014-08-08 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) AND lo.login_time>="2014-07-09 00:00:00" AND lo.login_time<"2014-08-08 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.376021s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) AND w.create_time>="2014-07-09 00:00:00" AND w.create_time<"2014-08-08 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) AND lo.login_time>="2014-07-09 00:00:00" AND lo.login_time<"2014-08-08 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.375021s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) AND w.create_time>="2014-07-09 00:00:00" AND w.create_time<"2014-08-08 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) AND lo.login_time>="2014-07-09 00:00:00" AND lo.login_time<"2014-08-08 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.371021s ]
SQL: SELECT l.name,COALESCE(a.ulcount,0) b FROM  location l LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>=(TIMESTAMP(ADDDATE(DATE(SYSDATE()),-(DAYOFWEEK(NOW())-2))))   GROUP BY ud.locid) a ON a.locid=l.id WHERE l.id IN (24521,24543,24561,28422) [ RunTime:0.097006s ]
INFO: [ view_parse ] --START--
INFO: ParseTemplate Behavior ::run [ RunTime:0.596034s ]
INFO: [ view_parse ] --END-- [ RunTime:0.602034s ]
INFO: [ view_filter ] --START--
INFO: ContentReplace Behavior ::run [ RunTime:0.007001s ]
INFO: TokenBuild Behavior ::run [ RunTime:0.009000s ]
INFO: WriteHtmlCache Behavior ::run [ RunTime:0.004000s ]
INFO: ShowRuntime Behavior ::run [ RunTime:0.014001s ]
INFO: [ view_filter ] --END-- [ RunTime:0.047003s ]
INFO: [ view_end ] --START--
INFO: ShowPageTrace Behavior ::run [ RunTime:0.012000s ]
INFO: [ view_end ] --END-- [ RunTime:0.020002s ]

[ 2014-08-08T01:18:51+08:00 ] 127.0.0.1 /php_demo/shizhan/10/10wish/index.php/Njb/Index/tongji
INFO: [ route_check ] --START--
INFO: CheckRoute Behavior ::run [ RunTime:0.008000s ]
INFO: [ route_check ] --END-- [ RunTime:0.012001s ]
INFO: [ app_begin ] --START--
INFO: ReadHtmlCache Behavior ::run [ RunTime:0.009000s ]
INFO: [ app_begin ] --END-- [ RunTime:0.014000s ]
SQL: SELECT l.name,COALESCE(a.ucount,0) as yhs,COALESCE(c.ulcount,0) as dlyhs,COALESCE(c.logCount,0) as dlcs FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(ud.id) ucount FROM   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud     GROUP BY ud.locid  ) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>="2014-07-09 00:00:00" AND lo.login_time<"2014-08-08 00:00:00"   GROUP BY ud.locid) c ON l.id=c.locid WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.821047s ]
SQL: SELECT l.name,COALESCE(a.noticeCount,0) noticeCount,COALESCE(a.userCount,0) userCount FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(n.id) noticeCount,COUNT(DISTINCT ud.id) userCount FROM notice n,   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud   WHERE n.owner_id=ud.id AND n.publish_time>="2014-07-09 00:00:00"    AND n.publish_time<"2014-08-08 00:00:00" GROUP BY ud.locid) a  ON l.id=a.locid WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.004000s ]
SQL: SELECT l.name,COALESCE(a.asCount,0) a,COALESCE(b.adminCount,0) b,COALESCE(c.noAdminCount,0) c FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(t.id) asCount FROM assignment t,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE t.creator_id=ud.id AND t.create_time>="2014-07-09 00:00:00" AND  t.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) adminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud   WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='TechAdmin'   AND t.create_time>="2014-07-09 00:00:00" AND  t.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) noAdminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='Technician'   AND t.create_time>="2014-07-09 00:00:00" AND  t.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid ) c ON l.id=c.locid  WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.014001s ]
SQL: SELECT l.name,COALESCE(a.worklogCount,0) a,COALESCE(a.uCount,0) b,COALESCE(b.docCount,0) c,COALESCE(c.phoCount,0) d,COALESCE(d.audioCount,0) e FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(DISTINCT w.id) worklogCount,COUNT(DISTINCT w.owner_id) uCount FROM work_log w,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE w.owner_id=ud.id    AND w.create_time>="2014-07-09 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) docCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-07-09 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  AND i.media_type=1   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) phoCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-07-09 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  AND i.media_type=2   GROUP BY ud.locid ) c ON l.id=c.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) audioCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-07-09 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  AND i.media_type=3   GROUP BY ud.locid ) d ON l.id=d.locid   WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.078004s ]
SQL: SELECT l.name,COALESCE(a.photoCount,0) a,COALESCE(a.ucount,0) b,COALESCE(b.priseCount,0) c,COALESCE(c.comCount,0) d FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(i.id) photoCount,COUNT(DISTINCT ud.id) ucount FROM album m,album_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE m.owner_id=ud.id AND i.album_id=m.id   AND i.create_time>="2014-07-09 00:00:00" AND i.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,COUNT(uc.id) priseCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='AlbumItem'   AND uc.create_time>"2014-07-09 00:00:00" AND uc.create_time<"2014-08-08 00:00:00"   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(uc.id) comCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='SystemComment'   AND uc.create_time>="2014-07-09 00:00:00" AND uc.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) c ON l.id=c.locid  WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.018001s ]
SQL: SELECT a.rname a,l.name b,d.name c,a.age d FROM (SELECT u.id uid,u.real_name rname,u.location_id locid,u.dept_id depId,(2014-(SELECT SUBSTR(u.identify_value,7,4))+0) age FROM app_user u WHERE NOT EXISTS ( SELECT lo.user_id FROM login_log lo WHERE u.id=lo.user_id  ) AND u.id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422) )) a,location l,department d WHERE a.depId=d.id AND a.locid=l.id [ RunTime:2.164124s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) AND w.create_time>="2014-07-09 00:00:00" AND w.create_time<"2014-08-08 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) AND lo.login_time>="2014-07-09 00:00:00" AND lo.login_time<"2014-08-08 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.383022s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) AND w.create_time>="2014-07-09 00:00:00" AND w.create_time<"2014-08-08 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) AND lo.login_time>="2014-07-09 00:00:00" AND lo.login_time<"2014-08-08 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.370021s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) AND w.create_time>="2014-07-09 00:00:00" AND w.create_time<"2014-08-08 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) AND lo.login_time>="2014-07-09 00:00:00" AND lo.login_time<"2014-08-08 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.391022s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) AND w.create_time>="2014-07-09 00:00:00" AND w.create_time<"2014-08-08 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) AND lo.login_time>="2014-07-09 00:00:00" AND lo.login_time<"2014-08-08 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.369021s ]
SQL: SELECT l.name,COALESCE(a.ulcount,0) b FROM  location l LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>=(TIMESTAMP(ADDDATE(DATE(SYSDATE()),-(DAYOFWEEK(NOW())-2))))   GROUP BY ud.locid) a ON a.locid=l.id WHERE l.id IN (24521,24543,24561,28422) [ RunTime:0.095006s ]
INFO: [ view_parse ] --START--
INFO: ParseTemplate Behavior ::run [ RunTime:0.535030s ]
INFO: [ view_parse ] --END-- [ RunTime:0.540030s ]
INFO: [ view_filter ] --START--
INFO: ContentReplace Behavior ::run [ RunTime:0.020001s ]
INFO: TokenBuild Behavior ::run [ RunTime:0.010001s ]
INFO: WriteHtmlCache Behavior ::run [ RunTime:0.005000s ]
INFO: ShowRuntime Behavior ::run [ RunTime:0.012001s ]
INFO: [ view_filter ] --END-- [ RunTime:0.060003s ]
INFO: [ view_end ] --START--
INFO: ShowPageTrace Behavior ::run [ RunTime:0.013000s ]
INFO: [ view_end ] --END-- [ RunTime:0.019001s ]

[ 2014-08-08T01:23:00+08:00 ] 127.0.0.1 /php_demo/shizhan/10/10wish/index.php/Njb/Index/tongji
INFO: [ route_check ] --START--
INFO: CheckRoute Behavior ::run [ RunTime:0.006000s ]
INFO: [ route_check ] --END-- [ RunTime:0.011000s ]
INFO: [ app_begin ] --START--
INFO: ReadHtmlCache Behavior ::run [ RunTime:0.010001s ]
INFO: [ app_begin ] --END-- [ RunTime:0.015001s ]
SQL: SELECT l.name,COALESCE(a.ucount,0) as yhs,COALESCE(c.ulcount,0) as dlyhs,COALESCE(c.logCount,0) as dlcs FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(ud.id) ucount FROM   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud     GROUP BY ud.locid  ) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>="2014-07-09 00:00:00" AND lo.login_time<"2014-08-08 00:00:00"   GROUP BY ud.locid) c ON l.id=c.locid WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.849048s ]
SQL: SELECT l.name,COALESCE(a.noticeCount,0) noticeCount,COALESCE(a.userCount,0) userCount FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(n.id) noticeCount,COUNT(DISTINCT ud.id) userCount FROM notice n,   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud   WHERE n.owner_id=ud.id AND n.publish_time>="2014-07-09 00:00:00"    AND n.publish_time<"2014-08-08 00:00:00" GROUP BY ud.locid) a  ON l.id=a.locid WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.004000s ]
SQL: SELECT l.name,COALESCE(a.asCount,0) a,COALESCE(b.adminCount,0) b,COALESCE(c.noAdminCount,0) c FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(t.id) asCount FROM assignment t,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE t.creator_id=ud.id AND t.create_time>="2014-07-09 00:00:00" AND  t.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) adminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud   WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='TechAdmin'   AND t.create_time>="2014-07-09 00:00:00" AND  t.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) noAdminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='Technician'   AND t.create_time>="2014-07-09 00:00:00" AND  t.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid ) c ON l.id=c.locid  WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.060003s ]
SQL: SELECT l.name,COALESCE(a.worklogCount,0) a,COALESCE(a.uCount,0) b,COALESCE(b.docCount,0) c,COALESCE(c.phoCount,0) d,COALESCE(d.audioCount,0) e FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(DISTINCT w.id) worklogCount,COUNT(DISTINCT w.owner_id) uCount FROM work_log w,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE w.owner_id=ud.id    AND w.create_time>="2014-07-09 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) docCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-07-09 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  AND i.media_type=1   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) phoCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-07-09 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  AND i.media_type=2   GROUP BY ud.locid ) c ON l.id=c.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) audioCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-07-09 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  AND i.media_type=3   GROUP BY ud.locid ) d ON l.id=d.locid   WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.083005s ]
SQL: SELECT l.name,COALESCE(a.photoCount,0) a,COALESCE(a.ucount,0) b,COALESCE(b.priseCount,0) c,COALESCE(c.comCount,0) d FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(i.id) photoCount,COUNT(DISTINCT ud.id) ucount FROM album m,album_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE m.owner_id=ud.id AND i.album_id=m.id   AND i.create_time>="2014-07-09 00:00:00" AND i.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,COUNT(uc.id) priseCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='AlbumItem'   AND uc.create_time>"2014-07-09 00:00:00" AND uc.create_time<"2014-08-08 00:00:00"   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(uc.id) comCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='SystemComment'   AND uc.create_time>="2014-07-09 00:00:00" AND uc.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) c ON l.id=c.locid  WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.014000s ]
SQL: SELECT a.rname a,l.name b,d.name c,a.age d FROM (SELECT u.id uid,u.real_name rname,u.location_id locid,u.dept_id depId,(2014-(SELECT SUBSTR(u.identify_value,7,4))+0) age FROM app_user u WHERE NOT EXISTS ( SELECT lo.user_id FROM login_log lo WHERE u.id=lo.user_id  ) AND u.id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422) )) a,location l,department d WHERE a.depId=d.id AND a.locid=l.id [ RunTime:2.170124s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) AND w.create_time>="2014-07-09 00:00:00" AND w.create_time<"2014-08-08 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) AND lo.login_time>="2014-07-09 00:00:00" AND lo.login_time<"2014-08-08 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.393022s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) AND w.create_time>="2014-07-09 00:00:00" AND w.create_time<"2014-08-08 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) AND lo.login_time>="2014-07-09 00:00:00" AND lo.login_time<"2014-08-08 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.375021s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) AND w.create_time>="2014-07-09 00:00:00" AND w.create_time<"2014-08-08 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) AND lo.login_time>="2014-07-09 00:00:00" AND lo.login_time<"2014-08-08 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.388022s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) AND w.create_time>="2014-07-09 00:00:00" AND w.create_time<"2014-08-08 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) AND lo.login_time>="2014-07-09 00:00:00" AND lo.login_time<"2014-08-08 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.373022s ]
SQL: SELECT l.name,COALESCE(a.ulcount,0) b FROM  location l LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>=(TIMESTAMP(ADDDATE(DATE(SYSDATE()),-(DAYOFWEEK(NOW())-2))))   GROUP BY ud.locid) a ON a.locid=l.id WHERE l.id IN (24521,24543,24561,28422) [ RunTime:0.097006s ]
INFO: [ view_parse ] --START--
INFO: ParseTemplate Behavior ::run [ RunTime:0.536030s ]
INFO: [ view_parse ] --END-- [ RunTime:0.541031s ]
INFO: [ view_filter ] --START--
INFO: ContentReplace Behavior ::run [ RunTime:0.007001s ]
INFO: TokenBuild Behavior ::run [ RunTime:0.010000s ]
INFO: WriteHtmlCache Behavior ::run [ RunTime:0.006001s ]
INFO: ShowRuntime Behavior ::run [ RunTime:0.017001s ]
INFO: [ view_filter ] --END-- [ RunTime:0.056003s ]
INFO: [ view_end ] --START--
INFO: ShowPageTrace Behavior ::run [ RunTime:0.011000s ]
INFO: [ view_end ] --END-- [ RunTime:0.017001s ]

[ 2014-08-08T01:23:08+08:00 ] 127.0.0.1 /php_demo/shizhan/10/10wish/index.php/Njb/Index/index
INFO: [ route_check ] --START--
INFO: CheckRoute Behavior ::run [ RunTime:0.007000s ]
INFO: [ route_check ] --END-- [ RunTime:0.013001s ]
INFO: [ app_begin ] --START--
INFO: ReadHtmlCache Behavior ::run [ RunTime:0.008000s ]
INFO: [ app_begin ] --END-- [ RunTime:0.014000s ]

[ 2014-08-08T01:23:28+08:00 ] 127.0.0.1 /php_demo/shizhan/10/10wish/index.php/Njb/Index/index
INFO: [ route_check ] --START--
INFO: CheckRoute Behavior ::run [ RunTime:0.007000s ]
INFO: [ route_check ] --END-- [ RunTime:0.012001s ]
INFO: [ app_begin ] --START--
INFO: ReadHtmlCache Behavior ::run [ RunTime:0.008001s ]
INFO: [ app_begin ] --END-- [ RunTime:0.014001s ]
INFO: [ view_parse ] --START--
INFO: ParseTemplate Behavior ::run [ RunTime:0.185011s ]
INFO: [ view_parse ] --END-- [ RunTime:0.189011s ]
INFO: [ view_filter ] --START--
INFO: ContentReplace Behavior ::run [ RunTime:0.009000s ]
INFO: TokenBuild Behavior ::run [ RunTime:0.009000s ]
INFO: WriteHtmlCache Behavior ::run [ RunTime:0.005000s ]
INFO: ShowRuntime Behavior ::run [ RunTime:0.012001s ]
INFO: [ view_filter ] --END-- [ RunTime:0.063004s ]
INFO: [ view_end ] --START--
INFO: ShowPageTrace Behavior ::run [ RunTime:0.009001s ]
INFO: [ view_end ] --END-- [ RunTime:0.013001s ]

[ 2014-08-08T08:49:49+08:00 ] 127.0.0.1 /php_demo/shizhan/10/10wish/index.php/Njb/Index/index
INFO: [ route_check ] --START--
INFO: CheckRoute Behavior ::run [ RunTime:0.010001s ]
INFO: [ route_check ] --END-- [ RunTime:0.018001s ]
INFO: [ app_begin ] --START--
INFO: ReadHtmlCache Behavior ::run [ RunTime:0.013001s ]
INFO: [ app_begin ] --END-- [ RunTime:0.017001s ]
INFO: [ view_parse ] --START--
INFO: ParseTemplate Behavior ::run [ RunTime:0.258015s ]
INFO: [ view_parse ] --END-- [ RunTime:0.263015s ]
INFO: [ view_filter ] --START--
INFO: ContentReplace Behavior ::run [ RunTime:0.014001s ]
INFO: TokenBuild Behavior ::run [ RunTime:0.011001s ]
INFO: WriteHtmlCache Behavior ::run [ RunTime:0.006000s ]
INFO: ShowRuntime Behavior ::run [ RunTime:0.015000s ]
INFO: [ view_filter ] --END-- [ RunTime:0.061004s ]
INFO: [ view_end ] --START--
INFO: ShowPageTrace Behavior ::run [ RunTime:0.010001s ]
INFO: [ view_end ] --END-- [ RunTime:0.014001s ]

[ 2014-08-08T08:52:17+08:00 ] 127.0.0.1 /php_demo/shizhan/10/10wish/index.php/Njb/Index/index
INFO: [ route_check ] --START--
INFO: CheckRoute Behavior ::run [ RunTime:0.008000s ]
INFO: [ route_check ] --END-- [ RunTime:0.012000s ]
INFO: [ app_begin ] --START--
INFO: ReadHtmlCache Behavior ::run [ RunTime:0.008001s ]
INFO: [ app_begin ] --END-- [ RunTime:0.013001s ]
INFO: [ view_parse ] --START--
INFO: ParseTemplate Behavior ::run [ RunTime:0.081005s ]
INFO: [ view_parse ] --END-- [ RunTime:0.085005s ]
INFO: [ view_filter ] --START--
INFO: ContentReplace Behavior ::run [ RunTime:0.006001s ]
INFO: TokenBuild Behavior ::run [ RunTime:0.008000s ]
INFO: WriteHtmlCache Behavior ::run [ RunTime:0.005000s ]
INFO: ShowRuntime Behavior ::run [ RunTime:0.013001s ]
INFO: [ view_filter ] --END-- [ RunTime:0.046003s ]
INFO: [ view_end ] --START--
INFO: ShowPageTrace Behavior ::run [ RunTime:0.009001s ]
INFO: [ view_end ] --END-- [ RunTime:0.014001s ]

[ 2014-08-08T08:52:27+08:00 ] 127.0.0.1 /php_demo/shizhan/10/10wish/index.php/Njb/Index/tongji?checkbox1=checkbox
INFO: [ route_check ] --START--
INFO: CheckRoute Behavior ::run [ RunTime:0.007001s ]
INFO: [ route_check ] --END-- [ RunTime:0.011001s ]
INFO: [ app_begin ] --START--
INFO: ReadHtmlCache Behavior ::run [ RunTime:0.009000s ]
INFO: [ app_begin ] --END-- [ RunTime:0.013000s ]
SQL: SELECT l.name,COALESCE(a.ucount,0) as yhs,COALESCE(c.ulcount,0) as dlyhs,COALESCE(c.logCount,0) as dlcs FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(ud.id) ucount FROM   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud     GROUP BY ud.locid  ) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>="2014-07-09 00:00:00" AND lo.login_time<"2014-08-08 00:00:00"   GROUP BY ud.locid) c ON l.id=c.locid WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.835047s ]
SQL: SELECT l.name,COALESCE(a.noticeCount,0) noticeCount,COALESCE(a.userCount,0) userCount FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(n.id) noticeCount,COUNT(DISTINCT ud.id) userCount FROM notice n,   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud   WHERE n.owner_id=ud.id AND n.publish_time>="2014-07-09 00:00:00"    AND n.publish_time<"2014-08-08 00:00:00" GROUP BY ud.locid) a  ON l.id=a.locid WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.004000s ]
SQL: SELECT l.name,COALESCE(a.asCount,0) a,COALESCE(b.adminCount,0) b,COALESCE(c.noAdminCount,0) c FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(t.id) asCount FROM assignment t,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE t.creator_id=ud.id AND t.create_time>="2014-07-09 00:00:00" AND  t.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) adminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud   WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='TechAdmin'   AND t.create_time>="2014-07-09 00:00:00" AND  t.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) noAdminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='Technician'   AND t.create_time>="2014-07-09 00:00:00" AND  t.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid ) c ON l.id=c.locid  WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.033001s ]
SQL: SELECT l.name,COALESCE(a.worklogCount,0) a,COALESCE(a.uCount,0) b,COALESCE(b.docCount,0) c,COALESCE(c.phoCount,0) d,COALESCE(d.audioCount,0) e FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(DISTINCT w.id) worklogCount,COUNT(DISTINCT w.owner_id) uCount FROM work_log w,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE w.owner_id=ud.id    AND w.create_time>="2014-07-09 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) docCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-07-09 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  AND i.media_type=1   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) phoCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-07-09 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  AND i.media_type=2   GROUP BY ud.locid ) c ON l.id=c.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) audioCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-07-09 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  AND i.media_type=3   GROUP BY ud.locid ) d ON l.id=d.locid   WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.072004s ]
SQL: SELECT l.name,COALESCE(a.photoCount,0) a,COALESCE(a.ucount,0) b,COALESCE(b.priseCount,0) c,COALESCE(c.comCount,0) d FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(i.id) photoCount,COUNT(DISTINCT ud.id) ucount FROM album m,album_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE m.owner_id=ud.id AND i.album_id=m.id   AND i.create_time>="2014-07-09 00:00:00" AND i.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,COUNT(uc.id) priseCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='AlbumItem'   AND uc.create_time>"2014-07-09 00:00:00" AND uc.create_time<"2014-08-08 00:00:00"   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(uc.id) comCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='SystemComment'   AND uc.create_time>="2014-07-09 00:00:00" AND uc.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) c ON l.id=c.locid  WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.043003s ]
SQL: SELECT a.rname a,l.name b,d.name c,a.age d FROM (SELECT u.id uid,u.real_name rname,u.location_id locid,u.dept_id depId,(2014-(SELECT SUBSTR(u.identify_value,7,4))+0) age FROM app_user u WHERE NOT EXISTS ( SELECT lo.user_id FROM login_log lo WHERE u.id=lo.user_id  ) AND u.id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422) )) a,location l,department d WHERE a.depId=d.id AND a.locid=l.id [ RunTime:2.049118s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) AND w.create_time>="2014-07-09 00:00:00" AND w.create_time<"2014-08-08 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) AND lo.login_time>="2014-07-09 00:00:00" AND lo.login_time<"2014-08-08 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.361021s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) AND w.create_time>="2014-07-09 00:00:00" AND w.create_time<"2014-08-08 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) AND lo.login_time>="2014-07-09 00:00:00" AND lo.login_time<"2014-08-08 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.352021s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) AND w.create_time>="2014-07-09 00:00:00" AND w.create_time<"2014-08-08 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) AND lo.login_time>="2014-07-09 00:00:00" AND lo.login_time<"2014-08-08 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.417024s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) AND w.create_time>="2014-07-09 00:00:00" AND w.create_time<"2014-08-08 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) AND lo.login_time>="2014-07-09 00:00:00" AND lo.login_time<"2014-08-08 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.421024s ]
SQL: SELECT l.name,COALESCE(a.ulcount,0) b FROM  location l LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>=(TIMESTAMP(ADDDATE(DATE(SYSDATE()),-(DAYOFWEEK(NOW())-2))))   GROUP BY ud.locid) a ON a.locid=l.id WHERE l.id IN (24521,24543,24561,28422) [ RunTime:0.097006s ]
INFO: [ view_parse ] --START--
INFO: ParseTemplate Behavior ::run [ RunTime:0.548031s ]
INFO: [ view_parse ] --END-- [ RunTime:0.553032s ]
INFO: [ view_filter ] --START--
INFO: ContentReplace Behavior ::run [ RunTime:0.007001s ]
INFO: TokenBuild Behavior ::run [ RunTime:0.012001s ]
INFO: WriteHtmlCache Behavior ::run [ RunTime:0.005000s ]
INFO: ShowRuntime Behavior ::run [ RunTime:0.012001s ]
INFO: [ view_filter ] --END-- [ RunTime:0.047003s ]
INFO: [ view_end ] --START--
INFO: ShowPageTrace Behavior ::run [ RunTime:0.009000s ]
INFO: [ view_end ] --END-- [ RunTime:0.014001s ]

[ 2014-08-08T08:53:37+08:00 ] 127.0.0.1 /php_demo/shizhan/10/10wish/index.php/Njb/Index/index
INFO: [ route_check ] --START--
INFO: CheckRoute Behavior ::run [ RunTime:0.010000s ]
INFO: [ route_check ] --END-- [ RunTime:0.015001s ]
INFO: [ app_begin ] --START--
INFO: ReadHtmlCache Behavior ::run [ RunTime:0.010001s ]
INFO: [ app_begin ] --END-- [ RunTime:0.015001s ]
INFO: [ view_parse ] --START--
INFO: ParseTemplate Behavior ::run [ RunTime:0.087005s ]
INFO: [ view_parse ] --END-- [ RunTime:0.093005s ]
INFO: [ view_filter ] --START--
INFO: ContentReplace Behavior ::run [ RunTime:0.012001s ]
INFO: TokenBuild Behavior ::run [ RunTime:0.014001s ]
INFO: WriteHtmlCache Behavior ::run [ RunTime:0.006001s ]
INFO: ShowRuntime Behavior ::run [ RunTime:0.013001s ]
INFO: [ view_filter ] --END-- [ RunTime:0.061004s ]
INFO: [ view_end ] --START--
INFO: ShowPageTrace Behavior ::run [ RunTime:0.009001s ]
INFO: [ view_end ] --END-- [ RunTime:0.015001s ]

[ 2014-08-08T08:53:46+08:00 ] 127.0.0.1 /php_demo/shizhan/10/10wish/index.php/Njb/Index/tongji?checkbox1=checkbox
INFO: [ route_check ] --START--
INFO: CheckRoute Behavior ::run [ RunTime:0.008001s ]
INFO: [ route_check ] --END-- [ RunTime:0.013001s ]
INFO: [ app_begin ] --START--
INFO: ReadHtmlCache Behavior ::run [ RunTime:0.010001s ]
INFO: [ app_begin ] --END-- [ RunTime:0.016001s ]
SQL: SELECT l.name,COALESCE(a.ucount,0) as yhs,COALESCE(c.ulcount,0) as dlyhs,COALESCE(c.logCount,0) as dlcs FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(ud.id) ucount FROM   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud     GROUP BY ud.locid  ) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>="2014-07-09 00:00:00" AND lo.login_time<"2014-08-08 00:00:00"   GROUP BY ud.locid) c ON l.id=c.locid WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.880051s ]
SQL: SELECT l.name,COALESCE(a.noticeCount,0) noticeCount,COALESCE(a.userCount,0) userCount FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(n.id) noticeCount,COUNT(DISTINCT ud.id) userCount FROM notice n,   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud   WHERE n.owner_id=ud.id AND n.publish_time>="2014-07-09 00:00:00"    AND n.publish_time<"2014-08-08 00:00:00" GROUP BY ud.locid) a  ON l.id=a.locid WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.004001s ]
SQL: SELECT l.name,COALESCE(a.asCount,0) a,COALESCE(b.adminCount,0) b,COALESCE(c.noAdminCount,0) c FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(t.id) asCount FROM assignment t,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE t.creator_id=ud.id AND t.create_time>="2014-07-09 00:00:00" AND  t.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) adminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud   WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='TechAdmin'   AND t.create_time>="2014-07-09 00:00:00" AND  t.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) noAdminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='Technician'   AND t.create_time>="2014-07-09 00:00:00" AND  t.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid ) c ON l.id=c.locid  WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.015001s ]
SQL: SELECT l.name,COALESCE(a.worklogCount,0) a,COALESCE(a.uCount,0) b,COALESCE(b.docCount,0) c,COALESCE(c.phoCount,0) d,COALESCE(d.audioCount,0) e FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(DISTINCT w.id) worklogCount,COUNT(DISTINCT w.owner_id) uCount FROM work_log w,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE w.owner_id=ud.id    AND w.create_time>="2014-07-09 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) docCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-07-09 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  AND i.media_type=1   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) phoCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-07-09 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  AND i.media_type=2   GROUP BY ud.locid ) c ON l.id=c.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) audioCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-07-09 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  AND i.media_type=3   GROUP BY ud.locid ) d ON l.id=d.locid   WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.082004s ]
SQL: SELECT l.name,COALESCE(a.photoCount,0) a,COALESCE(a.ucount,0) b,COALESCE(b.priseCount,0) c,COALESCE(c.comCount,0) d FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(i.id) photoCount,COUNT(DISTINCT ud.id) ucount FROM album m,album_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE m.owner_id=ud.id AND i.album_id=m.id   AND i.create_time>="2014-07-09 00:00:00" AND i.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,COUNT(uc.id) priseCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='AlbumItem'   AND uc.create_time>"2014-07-09 00:00:00" AND uc.create_time<"2014-08-08 00:00:00"   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(uc.id) comCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='SystemComment'   AND uc.create_time>="2014-07-09 00:00:00" AND uc.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) c ON l.id=c.locid  WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.015001s ]
SQL: SELECT a.rname a,l.name b,d.name c,a.age d FROM (SELECT u.id uid,u.real_name rname,u.location_id locid,u.dept_id depId,(2014-(SELECT SUBSTR(u.identify_value,7,4))+0) age FROM app_user u WHERE NOT EXISTS ( SELECT lo.user_id FROM login_log lo WHERE u.id=lo.user_id  ) AND u.id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422) )) a,location l,department d WHERE a.depId=d.id AND a.locid=l.id [ RunTime:2.565147s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) AND w.create_time>="2014-07-09 00:00:00" AND w.create_time<"2014-08-08 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) AND lo.login_time>="2014-07-09 00:00:00" AND lo.login_time<"2014-08-08 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.427024s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) AND w.create_time>="2014-07-09 00:00:00" AND w.create_time<"2014-08-08 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) AND lo.login_time>="2014-07-09 00:00:00" AND lo.login_time<"2014-08-08 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.400022s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) AND w.create_time>="2014-07-09 00:00:00" AND w.create_time<"2014-08-08 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) AND lo.login_time>="2014-07-09 00:00:00" AND lo.login_time<"2014-08-08 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.418024s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) AND w.create_time>="2014-07-09 00:00:00" AND w.create_time<"2014-08-08 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) AND lo.login_time>="2014-07-09 00:00:00" AND lo.login_time<"2014-08-08 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.431025s ]
SQL: SELECT l.name,COALESCE(a.ulcount,0) b FROM  location l LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>=(TIMESTAMP(ADDDATE(DATE(SYSDATE()),-(DAYOFWEEK(NOW())-2))))   GROUP BY ud.locid) a ON a.locid=l.id WHERE l.id IN (24521,24543,24561,28422) [ RunTime:0.107006s ]
INFO: [ view_parse ] --START--
INFO: ParseTemplate Behavior ::run [ RunTime:0.567032s ]
INFO: [ view_parse ] --END-- [ RunTime:0.573032s ]
INFO: [ view_filter ] --START--
INFO: ContentReplace Behavior ::run [ RunTime:0.010000s ]
INFO: TokenBuild Behavior ::run [ RunTime:0.010000s ]
INFO: WriteHtmlCache Behavior ::run [ RunTime:0.005001s ]
INFO: ShowRuntime Behavior ::run [ RunTime:0.013001s ]
INFO: [ view_filter ] --END-- [ RunTime:0.054003s ]
INFO: [ view_end ] --START--
INFO: ShowPageTrace Behavior ::run [ RunTime:0.010001s ]
INFO: [ view_end ] --END-- [ RunTime:0.016001s ]

[ 2014-08-08T08:57:19+08:00 ] 127.0.0.1 /php_demo/shizhan/10/10wish/index.php/Njb/Index/index
INFO: [ route_check ] --START--
INFO: CheckRoute Behavior ::run [ RunTime:0.007000s ]
INFO: [ route_check ] --END-- [ RunTime:0.011001s ]
INFO: [ app_begin ] --START--
INFO: ReadHtmlCache Behavior ::run [ RunTime:0.008000s ]
INFO: [ app_begin ] --END-- [ RunTime:0.012001s ]
INFO: [ view_parse ] --START--
INFO: ParseTemplate Behavior ::run [ RunTime:0.083005s ]
INFO: [ view_parse ] --END-- [ RunTime:0.088005s ]
INFO: [ view_filter ] --START--
INFO: ContentReplace Behavior ::run [ RunTime:0.007000s ]
INFO: TokenBuild Behavior ::run [ RunTime:0.012000s ]
INFO: WriteHtmlCache Behavior ::run [ RunTime:0.004001s ]
INFO: ShowRuntime Behavior ::run [ RunTime:0.011000s ]
INFO: [ view_filter ] --END-- [ RunTime:0.047003s ]
INFO: [ view_end ] --START--
INFO: ShowPageTrace Behavior ::run [ RunTime:0.008001s ]
INFO: [ view_end ] --END-- [ RunTime:0.013001s ]

[ 2014-08-08T08:57:21+08:00 ] 127.0.0.1 /php_demo/shizhan/10/10wish/index.php/Njb/Index/index
INFO: [ route_check ] --START--
INFO: CheckRoute Behavior ::run [ RunTime:0.006000s ]
INFO: [ route_check ] --END-- [ RunTime:0.012001s ]
INFO: [ app_begin ] --START--
INFO: ReadHtmlCache Behavior ::run [ RunTime:0.013000s ]
INFO: [ app_begin ] --END-- [ RunTime:0.018001s ]
INFO: [ view_parse ] --START--
INFO: ParseTemplate Behavior ::run [ RunTime:0.081005s ]
INFO: [ view_parse ] --END-- [ RunTime:0.086005s ]
INFO: [ view_filter ] --START--
INFO: ContentReplace Behavior ::run [ RunTime:0.008001s ]
INFO: TokenBuild Behavior ::run [ RunTime:0.010000s ]
INFO: WriteHtmlCache Behavior ::run [ RunTime:0.006000s ]
INFO: ShowRuntime Behavior ::run [ RunTime:0.013001s ]
INFO: [ view_filter ] --END-- [ RunTime:0.048003s ]
INFO: [ view_end ] --START--
INFO: ShowPageTrace Behavior ::run [ RunTime:0.008001s ]
INFO: [ view_end ] --END-- [ RunTime:0.013001s ]

[ 2014-08-08T08:57:28+08:00 ] 127.0.0.1 /php_demo/shizhan/10/10wish/index.php/Njb/Index/tongji?checkbox=checkbox
INFO: [ route_check ] --START--
INFO: CheckRoute Behavior ::run [ RunTime:0.008000s ]
INFO: [ route_check ] --END-- [ RunTime:0.012000s ]
INFO: [ app_begin ] --START--
INFO: ReadHtmlCache Behavior ::run [ RunTime:0.009001s ]
INFO: [ app_begin ] --END-- [ RunTime:0.014001s ]
SQL: SELECT l.name,COALESCE(a.ucount,0) as yhs,COALESCE(c.ulcount,0) as dlyhs,COALESCE(c.logCount,0) as dlcs FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(ud.id) ucount FROM   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud     GROUP BY ud.locid  ) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>="2014-07-09 00:00:00" AND lo.login_time<"2014-08-08 00:00:00"   GROUP BY ud.locid) c ON l.id=c.locid WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.831048s ]
SQL: SELECT l.name,COALESCE(a.noticeCount,0) noticeCount,COALESCE(a.userCount,0) userCount FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(n.id) noticeCount,COUNT(DISTINCT ud.id) userCount FROM notice n,   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud   WHERE n.owner_id=ud.id AND n.publish_time>="2014-07-09 00:00:00"    AND n.publish_time<"2014-08-08 00:00:00" GROUP BY ud.locid) a  ON l.id=a.locid WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.004001s ]
SQL: SELECT l.name,COALESCE(a.asCount,0) a,COALESCE(b.adminCount,0) b,COALESCE(c.noAdminCount,0) c FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(t.id) asCount FROM assignment t,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE t.creator_id=ud.id AND t.create_time>="2014-07-09 00:00:00" AND  t.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) adminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud   WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='TechAdmin'   AND t.create_time>="2014-07-09 00:00:00" AND  t.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) noAdminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='Technician'   AND t.create_time>="2014-07-09 00:00:00" AND  t.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid ) c ON l.id=c.locid  WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.013001s ]
SQL: SELECT l.name,COALESCE(a.worklogCount,0) a,COALESCE(a.uCount,0) b,COALESCE(b.docCount,0) c,COALESCE(c.phoCount,0) d,COALESCE(d.audioCount,0) e FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(DISTINCT w.id) worklogCount,COUNT(DISTINCT w.owner_id) uCount FROM work_log w,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE w.owner_id=ud.id    AND w.create_time>="2014-07-09 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) docCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-07-09 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  AND i.media_type=1   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) phoCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-07-09 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  AND i.media_type=2   GROUP BY ud.locid ) c ON l.id=c.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) audioCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-07-09 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  AND i.media_type=3   GROUP BY ud.locid ) d ON l.id=d.locid   WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.071005s ]
SQL: SELECT l.name,COALESCE(a.photoCount,0) a,COALESCE(a.ucount,0) b,COALESCE(b.priseCount,0) c,COALESCE(c.comCount,0) d FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(i.id) photoCount,COUNT(DISTINCT ud.id) ucount FROM album m,album_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE m.owner_id=ud.id AND i.album_id=m.id   AND i.create_time>="2014-07-09 00:00:00" AND i.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,COUNT(uc.id) priseCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='AlbumItem'   AND uc.create_time>"2014-07-09 00:00:00" AND uc.create_time<"2014-08-08 00:00:00"   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(uc.id) comCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='SystemComment'   AND uc.create_time>="2014-07-09 00:00:00" AND uc.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) c ON l.id=c.locid  WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.015001s ]
SQL: SELECT a.rname a,l.name b,d.name c,a.age d FROM (SELECT u.id uid,u.real_name rname,u.location_id locid,u.dept_id depId,(2014-(SELECT SUBSTR(u.identify_value,7,4))+0) age FROM app_user u WHERE NOT EXISTS ( SELECT lo.user_id FROM login_log lo WHERE u.id=lo.user_id  ) AND u.id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422) )) a,location l,department d WHERE a.depId=d.id AND a.locid=l.id [ RunTime:2.078119s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) AND w.create_time>="2014-07-09 00:00:00" AND w.create_time<"2014-08-08 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) AND lo.login_time>="2014-07-09 00:00:00" AND lo.login_time<"2014-08-08 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.369021s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) AND w.create_time>="2014-07-09 00:00:00" AND w.create_time<"2014-08-08 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) AND lo.login_time>="2014-07-09 00:00:00" AND lo.login_time<"2014-08-08 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.346020s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) AND w.create_time>="2014-07-09 00:00:00" AND w.create_time<"2014-08-08 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) AND lo.login_time>="2014-07-09 00:00:00" AND lo.login_time<"2014-08-08 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.358021s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) AND w.create_time>="2014-07-09 00:00:00" AND w.create_time<"2014-08-08 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) AND lo.login_time>="2014-07-09 00:00:00" AND lo.login_time<"2014-08-08 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.352020s ]
SQL: SELECT l.name,COALESCE(a.ulcount,0) b FROM  location l LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>=(TIMESTAMP(ADDDATE(DATE(SYSDATE()),-(DAYOFWEEK(NOW())-2))))   GROUP BY ud.locid) a ON a.locid=l.id WHERE l.id IN (24521,24543,24561,28422) [ RunTime:0.092005s ]
INFO: [ view_parse ] --START--
INFO: ParseTemplate Behavior ::run [ RunTime:0.565032s ]
INFO: [ view_parse ] --END-- [ RunTime:0.570032s ]
INFO: [ view_filter ] --START--
INFO: ContentReplace Behavior ::run [ RunTime:0.007000s ]
INFO: TokenBuild Behavior ::run [ RunTime:0.009001s ]
INFO: WriteHtmlCache Behavior ::run [ RunTime:0.004000s ]
INFO: ShowRuntime Behavior ::run [ RunTime:0.012001s ]
INFO: [ view_filter ] --END-- [ RunTime:0.047003s ]
INFO: [ view_end ] --START--
INFO: ShowPageTrace Behavior ::run [ RunTime:0.013000s ]
INFO: [ view_end ] --END-- [ RunTime:0.020002s ]

[ 2014-08-08T08:58:48+08:00 ] 127.0.0.1 /php_demo/shizhan/10/10wish/index.php/Njb/Index/tongji?checkbox=checkbox
INFO: [ route_check ] --START--
INFO: CheckRoute Behavior ::run [ RunTime:0.007001s ]
INFO: [ route_check ] --END-- [ RunTime:0.012001s ]
INFO: [ app_begin ] --START--
INFO: ReadHtmlCache Behavior ::run [ RunTime:0.008000s ]
INFO: [ app_begin ] --END-- [ RunTime:0.013001s ]
SQL: SELECT l.name,COALESCE(a.ucount,0) as yhs,COALESCE(c.ulcount,0) as dlyhs,COALESCE(c.logCount,0) as dlcs FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(ud.id) ucount FROM   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud     GROUP BY ud.locid  ) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>="2014-07-09 00:00:00" AND lo.login_time<"2014-08-08 00:00:00"   GROUP BY ud.locid) c ON l.id=c.locid WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.783045s ]
SQL: SELECT l.name,COALESCE(a.noticeCount,0) noticeCount,COALESCE(a.userCount,0) userCount FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(n.id) noticeCount,COUNT(DISTINCT ud.id) userCount FROM notice n,   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud   WHERE n.owner_id=ud.id AND n.publish_time>="2014-07-09 00:00:00"    AND n.publish_time<"2014-08-08 00:00:00" GROUP BY ud.locid) a  ON l.id=a.locid WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.003000s ]
SQL: SELECT l.name,COALESCE(a.asCount,0) a,COALESCE(b.adminCount,0) b,COALESCE(c.noAdminCount,0) c FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(t.id) asCount FROM assignment t,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE t.creator_id=ud.id AND t.create_time>="2014-07-09 00:00:00" AND  t.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) adminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud   WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='TechAdmin'   AND t.create_time>="2014-07-09 00:00:00" AND  t.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) noAdminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='Technician'   AND t.create_time>="2014-07-09 00:00:00" AND  t.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid ) c ON l.id=c.locid  WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.012001s ]
SQL: SELECT l.name,COALESCE(a.worklogCount,0) a,COALESCE(a.uCount,0) b,COALESCE(b.docCount,0) c,COALESCE(c.phoCount,0) d,COALESCE(d.audioCount,0) e FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(DISTINCT w.id) worklogCount,COUNT(DISTINCT w.owner_id) uCount FROM work_log w,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE w.owner_id=ud.id    AND w.create_time>="2014-07-09 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) docCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-07-09 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  AND i.media_type=1   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) phoCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-07-09 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  AND i.media_type=2   GROUP BY ud.locid ) c ON l.id=c.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) audioCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-07-09 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  AND i.media_type=3   GROUP BY ud.locid ) d ON l.id=d.locid   WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.084005s ]
SQL: SELECT l.name,COALESCE(a.photoCount,0) a,COALESCE(a.ucount,0) b,COALESCE(b.priseCount,0) c,COALESCE(c.comCount,0) d FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(i.id) photoCount,COUNT(DISTINCT ud.id) ucount FROM album m,album_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE m.owner_id=ud.id AND i.album_id=m.id   AND i.create_time>="2014-07-09 00:00:00" AND i.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,COUNT(uc.id) priseCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='AlbumItem'   AND uc.create_time>"2014-07-09 00:00:00" AND uc.create_time<"2014-08-08 00:00:00"   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(uc.id) comCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='SystemComment'   AND uc.create_time>="2014-07-09 00:00:00" AND uc.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) c ON l.id=c.locid  WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.013000s ]
SQL: SELECT a.rname a,l.name b,d.name c,a.age d FROM (SELECT u.id uid,u.real_name rname,u.location_id locid,u.dept_id depId,(2014-(SELECT SUBSTR(u.identify_value,7,4))+0) age FROM app_user u WHERE NOT EXISTS ( SELECT lo.user_id FROM login_log lo WHERE u.id=lo.user_id  ) AND u.id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422) )) a,location l,department d WHERE a.depId=d.id AND a.locid=l.id [ RunTime:2.029116s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) AND w.create_time>="2014-07-09 00:00:00" AND w.create_time<"2014-08-08 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) AND lo.login_time>="2014-07-09 00:00:00" AND lo.login_time<"2014-08-08 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.362020s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) AND w.create_time>="2014-07-09 00:00:00" AND w.create_time<"2014-08-08 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) AND lo.login_time>="2014-07-09 00:00:00" AND lo.login_time<"2014-08-08 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.349020s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) AND w.create_time>="2014-07-09 00:00:00" AND w.create_time<"2014-08-08 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) AND lo.login_time>="2014-07-09 00:00:00" AND lo.login_time<"2014-08-08 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.368021s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) AND w.create_time>="2014-07-09 00:00:00" AND w.create_time<"2014-08-08 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) AND lo.login_time>="2014-07-09 00:00:00" AND lo.login_time<"2014-08-08 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.353020s ]
SQL: SELECT l.name,COALESCE(a.ulcount,0) b FROM  location l LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>=(TIMESTAMP(ADDDATE(DATE(SYSDATE()),-(DAYOFWEEK(NOW())-2))))   GROUP BY ud.locid) a ON a.locid=l.id WHERE l.id IN (24521,24543,24561,28422) [ RunTime:0.094006s ]
INFO: [ view_parse ] --START--
INFO: ParseTemplate Behavior ::run [ RunTime:0.510029s ]
INFO: [ view_parse ] --END-- [ RunTime:0.515030s ]
INFO: [ view_filter ] --START--
INFO: ContentReplace Behavior ::run [ RunTime:0.006001s ]
INFO: TokenBuild Behavior ::run [ RunTime:0.009000s ]
INFO: WriteHtmlCache Behavior ::run [ RunTime:0.005001s ]
INFO: ShowRuntime Behavior ::run [ RunTime:0.012000s ]
INFO: [ view_filter ] --END-- [ RunTime:0.044003s ]
INFO: [ view_end ] --START--
INFO: ShowPageTrace Behavior ::run [ RunTime:0.010001s ]
INFO: [ view_end ] --END-- [ RunTime:0.017001s ]

[ 2014-08-08T08:58:57+08:00 ] 127.0.0.1 /php_demo/shizhan/10/10wish/index.php/Njb/Index/index
INFO: [ route_check ] --START--
INFO: CheckRoute Behavior ::run [ RunTime:0.007000s ]
INFO: [ route_check ] --END-- [ RunTime:0.013001s ]
INFO: [ app_begin ] --START--
INFO: ReadHtmlCache Behavior ::run [ RunTime:0.008000s ]
INFO: [ app_begin ] --END-- [ RunTime:0.013001s ]
INFO: [ view_parse ] --START--
INFO: ParseTemplate Behavior ::run [ RunTime:0.084005s ]
INFO: [ view_parse ] --END-- [ RunTime:0.089005s ]
INFO: [ view_filter ] --START--
INFO: ContentReplace Behavior ::run [ RunTime:0.008001s ]
INFO: TokenBuild Behavior ::run [ RunTime:0.010001s ]
INFO: WriteHtmlCache Behavior ::run [ RunTime:0.005000s ]
INFO: ShowRuntime Behavior ::run [ RunTime:0.011001s ]
INFO: [ view_filter ] --END-- [ RunTime:0.050003s ]
INFO: [ view_end ] --START--
INFO: ShowPageTrace Behavior ::run [ RunTime:0.008001s ]
INFO: [ view_end ] --END-- [ RunTime:0.014001s ]

[ 2014-08-08T08:59:10+08:00 ] 127.0.0.1 /php_demo/shizhan/10/10wish/index.php/Njb/Index/tongji?checkbox=24521
INFO: [ route_check ] --START--
INFO: CheckRoute Behavior ::run [ RunTime:0.006000s ]
INFO: [ route_check ] --END-- [ RunTime:0.010000s ]
INFO: [ app_begin ] --START--
INFO: ReadHtmlCache Behavior ::run [ RunTime:0.010000s ]
INFO: [ app_begin ] --END-- [ RunTime:0.014001s ]
SQL: SELECT l.name,COALESCE(a.ucount,0) as yhs,COALESCE(c.ulcount,0) as dlyhs,COALESCE(c.logCount,0) as dlcs FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(ud.id) ucount FROM   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud     GROUP BY ud.locid  ) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>="2014-07-09 00:00:00" AND lo.login_time<"2014-08-08 00:00:00"   GROUP BY ud.locid) c ON l.id=c.locid WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.773044s ]
SQL: SELECT l.name,COALESCE(a.noticeCount,0) noticeCount,COALESCE(a.userCount,0) userCount FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(n.id) noticeCount,COUNT(DISTINCT ud.id) userCount FROM notice n,   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud   WHERE n.owner_id=ud.id AND n.publish_time>="2014-07-09 00:00:00"    AND n.publish_time<"2014-08-08 00:00:00" GROUP BY ud.locid) a  ON l.id=a.locid WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.003000s ]
SQL: SELECT l.name,COALESCE(a.asCount,0) a,COALESCE(b.adminCount,0) b,COALESCE(c.noAdminCount,0) c FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(t.id) asCount FROM assignment t,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE t.creator_id=ud.id AND t.create_time>="2014-07-09 00:00:00" AND  t.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) adminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud   WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='TechAdmin'   AND t.create_time>="2014-07-09 00:00:00" AND  t.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) noAdminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='Technician'   AND t.create_time>="2014-07-09 00:00:00" AND  t.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid ) c ON l.id=c.locid  WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.012001s ]
SQL: SELECT l.name,COALESCE(a.worklogCount,0) a,COALESCE(a.uCount,0) b,COALESCE(b.docCount,0) c,COALESCE(c.phoCount,0) d,COALESCE(d.audioCount,0) e FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(DISTINCT w.id) worklogCount,COUNT(DISTINCT w.owner_id) uCount FROM work_log w,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE w.owner_id=ud.id    AND w.create_time>="2014-07-09 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) docCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-07-09 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  AND i.media_type=1   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) phoCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-07-09 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  AND i.media_type=2   GROUP BY ud.locid ) c ON l.id=c.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) audioCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-07-09 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  AND i.media_type=3   GROUP BY ud.locid ) d ON l.id=d.locid   WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.072004s ]
SQL: SELECT l.name,COALESCE(a.photoCount,0) a,COALESCE(a.ucount,0) b,COALESCE(b.priseCount,0) c,COALESCE(c.comCount,0) d FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(i.id) photoCount,COUNT(DISTINCT ud.id) ucount FROM album m,album_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE m.owner_id=ud.id AND i.album_id=m.id   AND i.create_time>="2014-07-09 00:00:00" AND i.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,COUNT(uc.id) priseCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='AlbumItem'   AND uc.create_time>"2014-07-09 00:00:00" AND uc.create_time<"2014-08-08 00:00:00"   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(uc.id) comCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='SystemComment'   AND uc.create_time>="2014-07-09 00:00:00" AND uc.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) c ON l.id=c.locid  WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.013001s ]
SQL: SELECT a.rname a,l.name b,d.name c,a.age d FROM (SELECT u.id uid,u.real_name rname,u.location_id locid,u.dept_id depId,(2014-(SELECT SUBSTR(u.identify_value,7,4))+0) age FROM app_user u WHERE NOT EXISTS ( SELECT lo.user_id FROM login_log lo WHERE u.id=lo.user_id  ) AND u.id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422) )) a,location l,department d WHERE a.depId=d.id AND a.locid=l.id [ RunTime:2.004115s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) AND w.create_time>="2014-07-09 00:00:00" AND w.create_time<"2014-08-08 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) AND lo.login_time>="2014-07-09 00:00:00" AND lo.login_time<"2014-08-08 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.355021s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) AND w.create_time>="2014-07-09 00:00:00" AND w.create_time<"2014-08-08 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) AND lo.login_time>="2014-07-09 00:00:00" AND lo.login_time<"2014-08-08 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.345020s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) AND w.create_time>="2014-07-09 00:00:00" AND w.create_time<"2014-08-08 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) AND lo.login_time>="2014-07-09 00:00:00" AND lo.login_time<"2014-08-08 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.355021s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) AND w.create_time>="2014-07-09 00:00:00" AND w.create_time<"2014-08-08 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) AND lo.login_time>="2014-07-09 00:00:00" AND lo.login_time<"2014-08-08 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.349020s ]
SQL: SELECT l.name,COALESCE(a.ulcount,0) b FROM  location l LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>=(TIMESTAMP(ADDDATE(DATE(SYSDATE()),-(DAYOFWEEK(NOW())-2))))   GROUP BY ud.locid) a ON a.locid=l.id WHERE l.id IN (24521,24543,24561,28422) [ RunTime:0.090005s ]
INFO: [ view_parse ] --START--
INFO: ParseTemplate Behavior ::run [ RunTime:0.522029s ]
INFO: [ view_parse ] --END-- [ RunTime:0.527031s ]
INFO: [ view_filter ] --START--
INFO: ContentReplace Behavior ::run [ RunTime:0.010001s ]
INFO: TokenBuild Behavior ::run [ RunTime:0.010000s ]
INFO: WriteHtmlCache Behavior ::run [ RunTime:0.004000s ]
INFO: ShowRuntime Behavior ::run [ RunTime:0.011001s ]
INFO: [ view_filter ] --END-- [ RunTime:0.050003s ]
INFO: [ view_end ] --START--
INFO: ShowPageTrace Behavior ::run [ RunTime:0.015001s ]
INFO: [ view_end ] --END-- [ RunTime:0.022001s ]

[ 2014-08-08T08:59:43+08:00 ] 127.0.0.1 /php_demo/shizhan/10/10wish/index.php/Njb/Index/tongji?checkbox=24521&checkbox=24543
INFO: [ route_check ] --START--
INFO: CheckRoute Behavior ::run [ RunTime:0.006001s ]
INFO: [ route_check ] --END-- [ RunTime:0.013001s ]
INFO: [ app_begin ] --START--
INFO: ReadHtmlCache Behavior ::run [ RunTime:0.008000s ]
INFO: [ app_begin ] --END-- [ RunTime:0.013000s ]
SQL: SELECT l.name,COALESCE(a.ucount,0) as yhs,COALESCE(c.ulcount,0) as dlyhs,COALESCE(c.logCount,0) as dlcs FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(ud.id) ucount FROM   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud     GROUP BY ud.locid  ) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>="2014-07-09 00:00:00" AND lo.login_time<"2014-08-08 00:00:00"   GROUP BY ud.locid) c ON l.id=c.locid WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.783045s ]
SQL: SELECT l.name,COALESCE(a.noticeCount,0) noticeCount,COALESCE(a.userCount,0) userCount FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(n.id) noticeCount,COUNT(DISTINCT ud.id) userCount FROM notice n,   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud   WHERE n.owner_id=ud.id AND n.publish_time>="2014-07-09 00:00:00"    AND n.publish_time<"2014-08-08 00:00:00" GROUP BY ud.locid) a  ON l.id=a.locid WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.004001s ]
SQL: SELECT l.name,COALESCE(a.asCount,0) a,COALESCE(b.adminCount,0) b,COALESCE(c.noAdminCount,0) c FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(t.id) asCount FROM assignment t,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE t.creator_id=ud.id AND t.create_time>="2014-07-09 00:00:00" AND  t.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) adminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud   WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='TechAdmin'   AND t.create_time>="2014-07-09 00:00:00" AND  t.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) noAdminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='Technician'   AND t.create_time>="2014-07-09 00:00:00" AND  t.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid ) c ON l.id=c.locid  WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.012001s ]
SQL: SELECT l.name,COALESCE(a.worklogCount,0) a,COALESCE(a.uCount,0) b,COALESCE(b.docCount,0) c,COALESCE(c.phoCount,0) d,COALESCE(d.audioCount,0) e FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(DISTINCT w.id) worklogCount,COUNT(DISTINCT w.owner_id) uCount FROM work_log w,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE w.owner_id=ud.id    AND w.create_time>="2014-07-09 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) docCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-07-09 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  AND i.media_type=1   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) phoCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-07-09 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  AND i.media_type=2   GROUP BY ud.locid ) c ON l.id=c.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) audioCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-07-09 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  AND i.media_type=3   GROUP BY ud.locid ) d ON l.id=d.locid   WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.071004s ]
SQL: SELECT l.name,COALESCE(a.photoCount,0) a,COALESCE(a.ucount,0) b,COALESCE(b.priseCount,0) c,COALESCE(c.comCount,0) d FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(i.id) photoCount,COUNT(DISTINCT ud.id) ucount FROM album m,album_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE m.owner_id=ud.id AND i.album_id=m.id   AND i.create_time>="2014-07-09 00:00:00" AND i.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,COUNT(uc.id) priseCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='AlbumItem'   AND uc.create_time>"2014-07-09 00:00:00" AND uc.create_time<"2014-08-08 00:00:00"   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(uc.id) comCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='SystemComment'   AND uc.create_time>="2014-07-09 00:00:00" AND uc.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) c ON l.id=c.locid  WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.013000s ]
SQL: SELECT a.rname a,l.name b,d.name c,a.age d FROM (SELECT u.id uid,u.real_name rname,u.location_id locid,u.dept_id depId,(2014-(SELECT SUBSTR(u.identify_value,7,4))+0) age FROM app_user u WHERE NOT EXISTS ( SELECT lo.user_id FROM login_log lo WHERE u.id=lo.user_id  ) AND u.id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422) )) a,location l,department d WHERE a.depId=d.id AND a.locid=l.id [ RunTime:1.999114s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) AND w.create_time>="2014-07-09 00:00:00" AND w.create_time<"2014-08-08 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) AND lo.login_time>="2014-07-09 00:00:00" AND lo.login_time<"2014-08-08 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.360020s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) AND w.create_time>="2014-07-09 00:00:00" AND w.create_time<"2014-08-08 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) AND lo.login_time>="2014-07-09 00:00:00" AND lo.login_time<"2014-08-08 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.348020s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) AND w.create_time>="2014-07-09 00:00:00" AND w.create_time<"2014-08-08 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) AND lo.login_time>="2014-07-09 00:00:00" AND lo.login_time<"2014-08-08 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.354021s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) AND w.create_time>="2014-07-09 00:00:00" AND w.create_time<"2014-08-08 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) AND lo.login_time>="2014-07-09 00:00:00" AND lo.login_time<"2014-08-08 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.358021s ]
SQL: SELECT l.name,COALESCE(a.ulcount,0) b FROM  location l LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>=(TIMESTAMP(ADDDATE(DATE(SYSDATE()),-(DAYOFWEEK(NOW())-2))))   GROUP BY ud.locid) a ON a.locid=l.id WHERE l.id IN (24521,24543,24561,28422) [ RunTime:0.090005s ]
INFO: [ view_parse ] --START--
INFO: ParseTemplate Behavior ::run [ RunTime:0.497028s ]
INFO: [ view_parse ] --END-- [ RunTime:0.502029s ]
INFO: [ view_filter ] --START--
INFO: ContentReplace Behavior ::run [ RunTime:0.007000s ]
INFO: TokenBuild Behavior ::run [ RunTime:0.008000s ]
INFO: WriteHtmlCache Behavior ::run [ RunTime:0.005000s ]
INFO: ShowRuntime Behavior ::run [ RunTime:0.011000s ]
INFO: [ view_filter ] --END-- [ RunTime:0.045002s ]
INFO: [ view_end ] --START--
INFO: ShowPageTrace Behavior ::run [ RunTime:0.031002s ]
INFO: [ view_end ] --END-- [ RunTime:0.042002s ]

[ 2014-08-08T11:11:02+08:00 ] 127.0.0.1 /php_demo/shizhan/10/10wish/index.php/Njb/Index/tongji?checkbox=24521&checkbox=24543
INFO: [ route_check ] --START--
INFO: CheckRoute Behavior ::run [ RunTime:0.048003s ]
INFO: [ route_check ] --END-- [ RunTime:0.056003s ]
INFO: [ app_begin ] --START--
INFO: ReadHtmlCache Behavior ::run [ RunTime:0.009000s ]
INFO: [ app_begin ] --END-- [ RunTime:0.014000s ]
SQL: SELECT l.name,COALESCE(a.ucount,0) as yhs,COALESCE(c.ulcount,0) as dlyhs,COALESCE(c.logCount,0) as dlcs FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(ud.id) ucount FROM   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud     GROUP BY ud.locid  ) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>="2014-07-09 00:00:00" AND lo.login_time<"2014-08-08 00:00:00"   GROUP BY ud.locid) c ON l.id=c.locid WHERE l.id IN(24521,24543,24561,28422) [ RunTime:1.740100s ]
SQL: SELECT l.name,COALESCE(a.noticeCount,0) noticeCount,COALESCE(a.userCount,0) userCount FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(n.id) noticeCount,COUNT(DISTINCT ud.id) userCount FROM notice n,   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud   WHERE n.owner_id=ud.id AND n.publish_time>="2014-07-09 00:00:00"    AND n.publish_time<"2014-08-08 00:00:00" GROUP BY ud.locid) a  ON l.id=a.locid WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.113006s ]
SQL: SELECT l.name,COALESCE(a.asCount,0) a,COALESCE(b.adminCount,0) b,COALESCE(c.noAdminCount,0) c FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(t.id) asCount FROM assignment t,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE t.creator_id=ud.id AND t.create_time>="2014-07-09 00:00:00" AND  t.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) adminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud   WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='TechAdmin'   AND t.create_time>="2014-07-09 00:00:00" AND  t.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) noAdminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='Technician'   AND t.create_time>="2014-07-09 00:00:00" AND  t.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid ) c ON l.id=c.locid  WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.212012s ]
SQL: SELECT l.name,COALESCE(a.worklogCount,0) a,COALESCE(a.uCount,0) b,COALESCE(b.docCount,0) c,COALESCE(c.phoCount,0) d,COALESCE(d.audioCount,0) e FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(DISTINCT w.id) worklogCount,COUNT(DISTINCT w.owner_id) uCount FROM work_log w,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE w.owner_id=ud.id    AND w.create_time>="2014-07-09 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) docCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-07-09 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  AND i.media_type=1   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) phoCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-07-09 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  AND i.media_type=2   GROUP BY ud.locid ) c ON l.id=c.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) audioCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-07-09 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  AND i.media_type=3   GROUP BY ud.locid ) d ON l.id=d.locid   WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.492029s ]
SQL: SELECT l.name,COALESCE(a.photoCount,0) a,COALESCE(a.ucount,0) b,COALESCE(b.priseCount,0) c,COALESCE(c.comCount,0) d FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(i.id) photoCount,COUNT(DISTINCT ud.id) ucount FROM album m,album_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE m.owner_id=ud.id AND i.album_id=m.id   AND i.create_time>="2014-07-09 00:00:00" AND i.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,COUNT(uc.id) priseCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='AlbumItem'   AND uc.create_time>"2014-07-09 00:00:00" AND uc.create_time<"2014-08-08 00:00:00"   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(uc.id) comCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='SystemComment'   AND uc.create_time>="2014-07-09 00:00:00" AND uc.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) c ON l.id=c.locid  WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.137008s ]
SQL: SELECT a.rname a,l.name b,d.name c,a.age d FROM (SELECT u.id uid,u.real_name rname,u.location_id locid,u.dept_id depId,(2014-(SELECT SUBSTR(u.identify_value,7,4))+0) age FROM app_user u WHERE NOT EXISTS ( SELECT lo.user_id FROM login_log lo WHERE u.id=lo.user_id  ) AND u.id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422) )) a,location l,department d WHERE a.depId=d.id AND a.locid=l.id [ RunTime:4.672267s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) AND w.create_time>="2014-07-09 00:00:00" AND w.create_time<"2014-08-08 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) AND lo.login_time>="2014-07-09 00:00:00" AND lo.login_time<"2014-08-08 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.882051s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) AND w.create_time>="2014-07-09 00:00:00" AND w.create_time<"2014-08-08 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) AND lo.login_time>="2014-07-09 00:00:00" AND lo.login_time<"2014-08-08 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.636037s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) AND w.create_time>="2014-07-09 00:00:00" AND w.create_time<"2014-08-08 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) AND lo.login_time>="2014-07-09 00:00:00" AND lo.login_time<"2014-08-08 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.639036s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) AND w.create_time>="2014-07-09 00:00:00" AND w.create_time<"2014-08-08 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) AND lo.login_time>="2014-07-09 00:00:00" AND lo.login_time<"2014-08-08 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.680039s ]
SQL: SELECT l.name,COALESCE(a.ulcount,0) b FROM  location l LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>=(TIMESTAMP(ADDDATE(DATE(SYSDATE()),-(DAYOFWEEK(NOW())-2))))   GROUP BY ud.locid) a ON a.locid=l.id WHERE l.id IN (24521,24543,24561,28422) [ RunTime:0.351020s ]
INFO: [ view_parse ] --START--
INFO: ParseTemplate Behavior ::run [ RunTime:2.653152s ]
INFO: [ view_parse ] --END-- [ RunTime:2.662152s ]
INFO: [ view_filter ] --START--
INFO: ContentReplace Behavior ::run [ RunTime:0.035002s ]
INFO: TokenBuild Behavior ::run [ RunTime:0.018001s ]
INFO: WriteHtmlCache Behavior ::run [ RunTime:0.009001s ]
INFO: ShowRuntime Behavior ::run [ RunTime:0.036002s ]
INFO: [ view_filter ] --END-- [ RunTime:0.125007s ]
INFO: [ view_end ] --START--
INFO: ShowPageTrace Behavior ::run [ RunTime:0.023001s ]
INFO: [ view_end ] --END-- [ RunTime:0.031002s ]

me,COALESCE(a.photoCount,0) a,COALESCE(a.ucount,0) b,COALESCE(b.priseCount,0) c,COALESCE(c.comCount,0) d FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(i.id) photoCount,COUNT(DISTINCT ud.id) ucount FROM album m,album_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE m.owner_id=ud.id AND i.album_id=m.id   AND i.create_time>="2014-07-09 00:00:00" AND i.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,COUNT(uc.id) priseCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='AlbumItem'   AND uc.create_time>"2014-07-09 00:00:00" AND uc.create_time<"2014-08-08 00:00:00"   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(uc.id) comCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='SystemComment'   AND uc.create_time>="2014-07-09 00:00:00" AND uc.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) c ON l.id=c.locid  WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.069004s ]
SQL: SELECT a.rname a,l.name b,d.name c,a.age d FROM (SELECT u.id uid,u.real_name rname,u.location_id locid,u.dept_id depId,(2014-(SELECT SUBSTR(u.identify_value,7,4))+0) age FROM app_user u WHERE NOT EXISTS ( SELECT lo.user_id FROM login_log lo WHERE u.id=lo.user_id  ) AND u.id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422) )) a,location l,department d WHERE a.depId=d.id AND a.locid=l.id [ RunTime:4.705269s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) AND w.create_time>="2014-07-09 00:00:00" AND w.create_time<"2014-08-08 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) AND lo.login_time>="2014-07-09 00:00:00" AND lo.login_time<"2014-08-08 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.847049s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) AND w.create_time>="2014-07-09 00:00:00" AND w.create_time<"2014-08-08 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) AND lo.login_time>="2014-07-09 00:00:00" AND lo.login_time<"2014-08-08 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.651038s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) AND w.create_time>="2014-07-09 00:00:00" AND w.create_time<"2014-08-08 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) AND lo.login_time>="2014-07-09 00:00:00" AND lo.login_time<"2014-08-08 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.641037s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) AND w.create_time>="2014-07-09 00:00:00" AND w.create_time<"2014-08-08 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) AND lo.login_time>="2014-07-09 00:00:00" AND lo.login_time<"2014-08-08 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.652037s ]
SQL: SELECT l.name,COALESCE(a.ulcount,0) b FROM  location l LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>=(TIMESTAMP(ADDDATE(DATE(SYSDATE()),-(DAYOFWEEK(NOW())-2))))   GROUP BY ud.locid) a ON a.locid=l.id WHERE l.id IN (24521,24543,24561,28422) [ RunTime:0.413024s ]
INFO: [ view_parse ] --START--
INFO: ParseTemplate Behavior ::run [ RunTime:2.594149s ]
INFO: [ view_parse ] --END-- [ RunTime:2.602149s ]
INFO: [ view_filter ] --START--
INFO: ContentReplace Behavior ::run [ RunTime:0.030001s ]
INFO: TokenBuild Behavior ::run [ RunTime:0.015001s ]
INFO: WriteHtmlCache Behavior ::run [ RunTime:0.010001s ]
INFO: ShowRuntime Behavior ::run [ RunTime:0.022001s ]
INFO: [ view_filter ] --END-- [ RunTime:0.105006s ]
INFO: [ view_end ] --START--
INFO: ShowPageTrace Behavior ::run [ RunTime:0.022001s ]
INFO: [ view_end ] --END-- [ RunTime:0.030002s ]

[ 2014-08-08T11:16:35+08:00 ] 127.0.0.1 /php_demo/shizhan/10/10wish/index.php/Njb/Index/tongji?checkbox=24521&checkbox=24543
INFO: [ route_check ] --START--
INFO: CheckRoute Behavior ::run [ RunTime:0.007000s ]
INFO: [ route_check ] --END-- [ RunTime:0.012000s ]
INFO: [ app_begin ] --START--
INFO: ReadHtmlCache Behavior ::run [ RunTime:0.009001s ]
INFO: [ app_begin ] --END-- [ RunTime:0.013001s ]
SQL: SELECT l.name,COALESCE(a.ucount,0) as yhs,COALESCE(c.ulcount,0) as dlyhs,COALESCE(c.logCount,0) as dlcs FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(ud.id) ucount FROM   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud     GROUP BY ud.locid  ) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>="2014-07-09 00:00:00" AND lo.login_time<"2014-08-08 00:00:00"   GROUP BY ud.locid) c ON l.id=c.locid WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.933053s ]
SQL: SELECT l.name,COALESCE(a.noticeCount,0) noticeCount,COALESCE(a.userCount,0) userCount FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(n.id) noticeCount,COUNT(DISTINCT ud.id) userCount FROM notice n,   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud   WHERE n.owner_id=ud.id AND n.publish_time>="2014-07-09 00:00:00"    AND n.publish_time<"2014-08-08 00:00:00" GROUP BY ud.locid) a  ON l.id=a.locid WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.004000s ]
SQL: SELECT l.name,COALESCE(a.asCount,0) a,COALESCE(b.adminCount,0) b,COALESCE(c.noAdminCount,0) c FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(t.id) asCount FROM assignment t,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE t.creator_id=ud.id AND t.create_time>="2014-07-09 00:00:00" AND  t.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) adminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud   WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='TechAdmin'   AND t.create_time>="2014-07-09 00:00:00" AND  t.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) noAdminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='Technician'   AND t.create_time>="2014-07-09 00:00:00" AND  t.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid ) c ON l.id=c.locid  WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.038002s ]
SQL: SELECT l.name,COALESCE(a.worklogCount,0) a,COALESCE(a.uCount,0) b,COALESCE(b.docCount,0) c,COALESCE(c.phoCount,0) d,COALESCE(d.audioCount,0) e FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(DISTINCT w.id) worklogCount,COUNT(DISTINCT w.owner_id) uCount FROM work_log w,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE w.owner_id=ud.id    AND w.create_time>="2014-07-09 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) docCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-07-09 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  AND i.media_type=1   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) phoCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-07-09 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  AND i.media_type=2   GROUP BY ud.locid ) c ON l.id=c.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) audioCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-07-09 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  AND i.media_type=3   GROUP BY ud.locid ) d ON l.id=d.locid   WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.078005s ]
SQL: SELECT l.name,COALESCE(a.photoCount,0) a,COALESCE(a.ucount,0) b,COALESCE(b.priseCount,0) c,COALESCE(c.comCount,0) d FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(i.id) photoCount,COUNT(DISTINCT ud.id) ucount FROM album m,album_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE m.owner_id=ud.id AND i.album_id=m.id   AND i.create_time>="2014-07-09 00:00:00" AND i.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,COUNT(uc.id) priseCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='AlbumItem'   AND uc.create_time>"2014-07-09 00:00:00" AND uc.create_time<"2014-08-08 00:00:00"   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(uc.id) comCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='SystemComment'   AND uc.create_time>="2014-07-09 00:00:00" AND uc.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) c ON l.id=c.locid  WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.029002s ]
SQL: SELECT a.rname a,l.name b,d.name c,a.age d FROM (SELECT u.id uid,u.real_name rname,u.location_id locid,u.dept_id depId,(2014-(SELECT SUBSTR(u.identify_value,7,4))+0) age FROM app_user u WHERE NOT EXISTS ( SELECT lo.user_id FROM login_log lo WHERE u.id=lo.user_id  ) AND u.id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422) )) a,location l,department d WHERE a.depId=d.id AND a.locid=l.id [ RunTime:2.191126s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) AND w.create_time>="2014-07-09 00:00:00" AND w.create_time<"2014-08-08 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) AND lo.login_time>="2014-07-09 00:00:00" AND lo.login_time<"2014-08-08 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.389022s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) AND w.create_time>="2014-07-09 00:00:00" AND w.create_time<"2014-08-08 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) AND lo.login_time>="2014-07-09 00:00:00" AND lo.login_time<"2014-08-08 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.368021s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) AND w.create_time>="2014-07-09 00:00:00" AND w.create_time<"2014-08-08 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) AND lo.login_time>="2014-07-09 00:00:00" AND lo.login_time<"2014-08-08 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.388022s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) AND w.create_time>="2014-07-09 00:00:00" AND w.create_time<"2014-08-08 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) AND lo.login_time>="2014-07-09 00:00:00" AND lo.login_time<"2014-08-08 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.378022s ]
SQL: SELECT l.name,COALESCE(a.ulcount,0) b FROM  location l LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>=(TIMESTAMP(ADDDATE(DATE(SYSDATE()),-(DAYOFWEEK(NOW())-2))))   GROUP BY ud.locid) a ON a.locid=l.id WHERE l.id IN (24521,24543,24561,28422) [ RunTime:0.128008s ]
INFO: [ view_parse ] --START--
INFO: ParseTemplate Behavior ::run [ RunTime:0.554031s ]
INFO: [ view_parse ] --END-- [ RunTime:0.560032s ]
INFO: [ view_filter ] --START--
INFO: ContentReplace Behavior ::run [ RunTime:0.007000s ]
INFO: TokenBuild Behavior ::run [ RunTime:0.008001s ]
INFO: WriteHtmlCache Behavior ::run [ RunTime:0.006000s ]
INFO: ShowRuntime Behavior ::run [ RunTime:0.016001s ]
INFO: [ view_filter ] --END-- [ RunTime:0.055003s ]
INFO: [ view_end ] --START--
INFO: ShowPageTrace Behavior ::run [ RunTime:0.009001s ]
INFO: [ view_end ] --END-- [ RunTime:0.015001s ]

[ 2014-08-08T11:20:49+08:00 ] 127.0.0.1 /php_demo/shizhan/10/10wish/index.php/Njb/Index/tongji?checkbox=24521&checkbox=24543
INFO: [ route_check ] --START--
INFO: CheckRoute Behavior ::run [ RunTime:0.007000s ]
INFO: [ route_check ] --END-- [ RunTime:0.012000s ]
INFO: [ app_begin ] --START--
INFO: ReadHtmlCache Behavior ::run [ RunTime:0.008001s ]
INFO: [ app_begin ] --END-- [ RunTime:0.013001s ]
SQL: SELECT l.name,COALESCE(a.ucount,0) as yhs,COALESCE(c.ulcount,0) as dlyhs,COALESCE(c.logCount,0) as dlcs FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(ud.id) ucount FROM   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud     GROUP BY ud.locid  ) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>="2014-08-07 00:00:00" AND lo.login_time<"2014-08-08 00:00:00"   GROUP BY ud.locid) c ON l.id=c.locid WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.043003s ]
SQL: SELECT l.name,COALESCE(a.noticeCount,0) noticeCount,COALESCE(a.userCount,0) userCount FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(n.id) noticeCount,COUNT(DISTINCT ud.id) userCount FROM notice n,   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud   WHERE n.owner_id=ud.id AND n.publish_time>="2014-08-07 00:00:00"    AND n.publish_time<"2014-08-08 00:00:00" GROUP BY ud.locid) a  ON l.id=a.locid WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.004000s ]
SQL: SELECT l.name,COALESCE(a.asCount,0) a,COALESCE(b.adminCount,0) b,COALESCE(c.noAdminCount,0) c FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(t.id) asCount FROM assignment t,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE t.creator_id=ud.id AND t.create_time>="2014-08-07 00:00:00" AND  t.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) adminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud   WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='TechAdmin'   AND t.create_time>="2014-08-07 00:00:00" AND  t.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) noAdminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='Technician'   AND t.create_time>="2014-08-07 00:00:00" AND  t.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid ) c ON l.id=c.locid  WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.011000s ]
SQL: SELECT l.name,COALESCE(a.worklogCount,0) a,COALESCE(a.uCount,0) b,COALESCE(b.docCount,0) c,COALESCE(c.phoCount,0) d,COALESCE(d.audioCount,0) e FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(DISTINCT w.id) worklogCount,COUNT(DISTINCT w.owner_id) uCount FROM work_log w,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE w.owner_id=ud.id    AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) docCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  AND i.media_type=1   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) phoCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  AND i.media_type=2   GROUP BY ud.locid ) c ON l.id=c.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) audioCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  AND i.media_type=3   GROUP BY ud.locid ) d ON l.id=d.locid   WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.037002s ]
SQL: SELECT l.name,COALESCE(a.photoCount,0) a,COALESCE(a.ucount,0) b,COALESCE(b.priseCount,0) c,COALESCE(c.comCount,0) d FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(i.id) photoCount,COUNT(DISTINCT ud.id) ucount FROM album m,album_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE m.owner_id=ud.id AND i.album_id=m.id   AND i.create_time>="2014-08-07 00:00:00" AND i.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,COUNT(uc.id) priseCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='AlbumItem'   AND uc.create_time>"2014-08-07 00:00:00" AND uc.create_time<"2014-08-08 00:00:00"   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(uc.id) comCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='SystemComment'   AND uc.create_time>="2014-08-07 00:00:00" AND uc.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) c ON l.id=c.locid  WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.014000s ]
SQL: SELECT a.rname a,l.name b,d.name c,a.age d FROM (SELECT u.id uid,u.real_name rname,u.location_id locid,u.dept_id depId,(2014-(SELECT SUBSTR(u.identify_value,7,4))+0) age FROM app_user u WHERE NOT EXISTS ( SELECT lo.user_id FROM login_log lo WHERE u.id=lo.user_id  ) AND u.id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422) )) a,location l,department d WHERE a.depId=d.id AND a.locid=l.id [ RunTime:2.159123s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) AND lo.login_time>="2014-08-07 00:00:00" AND lo.login_time<"2014-08-08 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.380022s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) AND lo.login_time>="2014-08-07 00:00:00" AND lo.login_time<"2014-08-08 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.363021s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) AND lo.login_time>="2014-08-07 00:00:00" AND lo.login_time<"2014-08-08 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.380021s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) AND lo.login_time>="2014-08-07 00:00:00" AND lo.login_time<"2014-08-08 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.387022s ]
SQL: SELECT l.name,COALESCE(a.ulcount,0) b FROM  location l LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>=(TIMESTAMP(ADDDATE(DATE(SYSDATE()),-(DAYOFWEEK(NOW())-2))))   GROUP BY ud.locid) a ON a.locid=l.id WHERE l.id IN (24521,24543,24561,28422) [ RunTime:0.129008s ]
INFO: [ view_parse ] --START--
INFO: ParseTemplate Behavior ::run [ RunTime:0.529030s ]
INFO: [ view_parse ] --END-- [ RunTime:0.534030s ]
INFO: [ view_filter ] --START--
INFO: ContentReplace Behavior ::run [ RunTime:0.007001s ]
INFO: TokenBuild Behavior ::run [ RunTime:0.009000s ]
INFO: WriteHtmlCache Behavior ::run [ RunTime:0.008000s ]
INFO: ShowRuntime Behavior ::run [ RunTime:0.012001s ]
INFO: [ view_filter ] --END-- [ RunTime:0.052003s ]
INFO: [ view_end ] --START--
INFO: ShowPageTrace Behavior ::run [ RunTime:0.008000s ]
INFO: [ view_end ] --END-- [ RunTime:0.015001s ]

[ 2014-08-08T11:48:13+08:00 ] 127.0.0.1 /php_demo/shizhan/10/10wish/index.php/Njb/Index/tongji?checkbox=24521&checkbox=24543
INFO: [ route_check ] --START--
INFO: CheckRoute Behavior ::run [ RunTime:0.007000s ]
INFO: [ route_check ] --END-- [ RunTime:0.013000s ]
INFO: [ app_begin ] --START--
INFO: ReadHtmlCache Behavior ::run [ RunTime:0.009000s ]
INFO: [ app_begin ] --END-- [ RunTime:0.013001s ]
SQL: SELECT l.name,COALESCE(a.ucount,0) as yhs,COALESCE(c.ulcount,0) as dlyhs,COALESCE(c.logCount,0) as dlcs FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(ud.id) ucount FROM   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud     GROUP BY ud.locid  ) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>="2014-08-07 00:00:00" AND lo.login_time<"2014-08-08 00:00:00"   GROUP BY ud.locid) c ON l.id=c.locid WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.040003s ]
SQL: SELECT l.name,COALESCE(a.noticeCount,0) noticeCount,COALESCE(a.userCount,0) userCount FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(n.id) noticeCount,COUNT(DISTINCT ud.id) userCount FROM notice n,   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud   WHERE n.owner_id=ud.id AND n.publish_time>="2014-08-07 00:00:00"    AND n.publish_time<"2014-08-08 00:00:00" GROUP BY ud.locid) a  ON l.id=a.locid WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.004000s ]
SQL: SELECT l.name,COALESCE(a.asCount,0) a,COALESCE(b.adminCount,0) b,COALESCE(c.noAdminCount,0) c FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(t.id) asCount FROM assignment t,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE t.creator_id=ud.id AND t.create_time>="2014-08-07 00:00:00" AND  t.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) adminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud   WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='TechAdmin'   AND t.create_time>="2014-08-07 00:00:00" AND  t.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) noAdminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='Technician'   AND t.create_time>="2014-08-07 00:00:00" AND  t.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid ) c ON l.id=c.locid  WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.010001s ]
SQL: SELECT l.name,COALESCE(a.worklogCount,0) a,COALESCE(a.uCount,0) b,COALESCE(b.docCount,0) c,COALESCE(c.phoCount,0) d,COALESCE(d.audioCount,0) e FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(DISTINCT w.id) worklogCount,COUNT(DISTINCT w.owner_id) uCount FROM work_log w,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE w.owner_id=ud.id    AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) docCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  AND i.media_type=1   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) phoCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  AND i.media_type=2   GROUP BY ud.locid ) c ON l.id=c.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) audioCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  AND i.media_type=3   GROUP BY ud.locid ) d ON l.id=d.locid   WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.031002s ]
SQL: SELECT l.name,COALESCE(a.photoCount,0) a,COALESCE(a.ucount,0) b,COALESCE(b.priseCount,0) c,COALESCE(c.comCount,0) d FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(i.id) photoCount,COUNT(DISTINCT ud.id) ucount FROM album m,album_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE m.owner_id=ud.id AND i.album_id=m.id   AND i.create_time>="2014-08-07 00:00:00" AND i.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,COUNT(uc.id) priseCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='AlbumItem'   AND uc.create_time>"2014-08-07 00:00:00" AND uc.create_time<"2014-08-08 00:00:00"   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(uc.id) comCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='SystemComment'   AND uc.create_time>="2014-08-07 00:00:00" AND uc.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) c ON l.id=c.locid  WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.013001s ]
SQL: SELECT a.rname a,l.name b,d.name c,a.age d FROM (SELECT u.id uid,u.real_name rname,u.location_id locid,u.dept_id depId,(2014-(SELECT SUBSTR(u.identify_value,7,4))+0) age FROM app_user u WHERE NOT EXISTS ( SELECT lo.user_id FROM login_log lo WHERE u.id=lo.user_id  ) AND u.id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422) )) a,location l,department d WHERE a.depId=d.id AND a.locid=l.id [ RunTime:2.110121s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) AND lo.login_time>="2014-08-07 00:00:00" AND lo.login_time<"2014-08-08 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.368021s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) AND lo.login_time>="2014-08-07 00:00:00" AND lo.login_time<"2014-08-08 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.358021s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) AND lo.login_time>="2014-08-07 00:00:00" AND lo.login_time<"2014-08-08 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.392022s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) AND lo.login_time>="2014-08-07 00:00:00" AND lo.login_time<"2014-08-08 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.370021s ]
SQL: SELECT l.name,COALESCE(a.ulcount,0) b FROM  location l LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>=(TIMESTAMP(ADDDATE(DATE(SYSDATE()),-(DAYOFWEEK(NOW())-2))))   GROUP BY ud.locid) a ON a.locid=l.id WHERE l.id IN (24521,24543,24561,28422) [ RunTime:0.127008s ]
INFO: [ view_parse ] --START--
INFO: ParseTemplate Behavior ::run [ RunTime:0.565032s ]
INFO: [ view_parse ] --END-- [ RunTime:0.569033s ]
INFO: [ view_filter ] --START--
INFO: ContentReplace Behavior ::run [ RunTime:0.010001s ]
INFO: TokenBuild Behavior ::run [ RunTime:0.013001s ]
INFO: WriteHtmlCache Behavior ::run [ RunTime:0.007000s ]
INFO: ShowRuntime Behavior ::run [ RunTime:0.015001s ]
INFO: [ view_filter ] --END-- [ RunTime:0.061004s ]
INFO: [ view_end ] --START--
INFO: ShowPageTrace Behavior ::run [ RunTime:0.007001s ]
INFO: [ view_end ] --END-- [ RunTime:0.013001s ]

[ 2014-08-08T11:49:56+08:00 ] 127.0.0.1 /php_demo/shizhan/10/10wish/index.php/Njb/Index/tongji?checkbox=24521&checkbox=24543
INFO: [ route_check ] --START--
INFO: CheckRoute Behavior ::run [ RunTime:0.006001s ]
INFO: [ route_check ] --END-- [ RunTime:0.011001s ]
INFO: [ app_begin ] --START--
INFO: ReadHtmlCache Behavior ::run [ RunTime:0.008000s ]
INFO: [ app_begin ] --END-- [ RunTime:0.014001s ]
SQL: SELECT l.name,COALESCE(a.ucount,0) as yhs,COALESCE(c.ulcount,0) as dlyhs,COALESCE(c.logCount,0) as dlcs FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(ud.id) ucount FROM   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud     GROUP BY ud.locid  ) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>="2014-08-07 00:00:00" AND lo.login_time<"2014-08-08 00:00:00"   GROUP BY ud.locid) c ON l.id=c.locid WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.042002s ]
SQL: SELECT l.name,COALESCE(a.noticeCount,0) noticeCount,COALESCE(a.userCount,0) userCount FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(n.id) noticeCount,COUNT(DISTINCT ud.id) userCount FROM notice n,   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud   WHERE n.owner_id=ud.id AND n.publish_time>="2014-08-07 00:00:00"    AND n.publish_time<"2014-08-08 00:00:00" GROUP BY ud.locid) a  ON l.id=a.locid WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.004000s ]
SQL: SELECT l.name,COALESCE(a.asCount,0) a,COALESCE(b.adminCount,0) b,COALESCE(c.noAdminCount,0) c FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(t.id) asCount FROM assignment t,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE t.creator_id=ud.id AND t.create_time>="2014-08-07 00:00:00" AND  t.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) adminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud   WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='TechAdmin'   AND t.create_time>="2014-08-07 00:00:00" AND  t.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) noAdminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='Technician'   AND t.create_time>="2014-08-07 00:00:00" AND  t.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid ) c ON l.id=c.locid  WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.010000s ]
SQL: SELECT l.name,COALESCE(a.worklogCount,0) a,COALESCE(a.uCount,0) b,COALESCE(b.docCount,0) c,COALESCE(c.phoCount,0) d,COALESCE(d.audioCount,0) e FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(DISTINCT w.id) worklogCount,COUNT(DISTINCT w.owner_id) uCount FROM work_log w,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE w.owner_id=ud.id    AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) docCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  AND i.media_type=1   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) phoCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  AND i.media_type=2   GROUP BY ud.locid ) c ON l.id=c.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) audioCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  AND i.media_type=3   GROUP BY ud.locid ) d ON l.id=d.locid   WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.037002s ]
SQL: SELECT l.name,COALESCE(a.photoCount,0) a,COALESCE(a.ucount,0) b,COALESCE(b.priseCount,0) c,COALESCE(c.comCount,0) d FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(i.id) photoCount,COUNT(DISTINCT ud.id) ucount FROM album m,album_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE m.owner_id=ud.id AND i.album_id=m.id   AND i.create_time>="2014-08-07 00:00:00" AND i.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,COUNT(uc.id) priseCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='AlbumItem'   AND uc.create_time>"2014-08-07 00:00:00" AND uc.create_time<"2014-08-08 00:00:00"   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(uc.id) comCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='SystemComment'   AND uc.create_time>="2014-08-07 00:00:00" AND uc.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) c ON l.id=c.locid  WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.013001s ]
SQL: SELECT a.rname a,l.name b,d.name c,a.age d FROM (SELECT u.id uid,u.real_name rname,u.location_id locid,u.dept_id depId,(2014-(SELECT SUBSTR(u.identify_value,7,4))+0) age FROM app_user u WHERE NOT EXISTS ( SELECT lo.user_id FROM login_log lo WHERE u.id=lo.user_id  ) AND u.id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422) )) a,location l,department d WHERE a.depId=d.id AND a.locid=l.id [ RunTime:2.167124s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) AND lo.login_time>="2014-08-07 00:00:00" AND lo.login_time<"2014-08-08 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.373021s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) AND lo.login_time>="2014-08-07 00:00:00" AND lo.login_time<"2014-08-08 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.368021s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) AND lo.login_time>="2014-08-07 00:00:00" AND lo.login_time<"2014-08-08 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.390023s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) AND lo.login_time>="2014-08-07 00:00:00" AND lo.login_time<"2014-08-08 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.387022s ]
SQL: SELECT l.name,COALESCE(a.ulcount,0) b FROM  location l LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>=(TIMESTAMP(ADDDATE(DATE(SYSDATE()),-(DAYOFWEEK(NOW())-2))))   GROUP BY ud.locid) a ON a.locid=l.id WHERE l.id IN (24521,24543,24561,28422) [ RunTime:0.132007s ]
INFO: [ view_parse ] --START--
INFO: ParseTemplate Behavior ::run [ RunTime:0.524030s ]
INFO: [ view_parse ] --END-- [ RunTime:0.530030s ]
INFO: [ view_filter ] --START--
INFO: ContentReplace Behavior ::run [ RunTime:0.009000s ]
INFO: TokenBuild Behavior ::run [ RunTime:0.013001s ]
INFO: WriteHtmlCache Behavior ::run [ RunTime:0.008001s ]
INFO: ShowRuntime Behavior ::run [ RunTime:0.014001s ]
INFO: [ view_filter ] --END-- [ RunTime:0.060003s ]
INFO: [ view_end ] --START--
INFO: ShowPageTrace Behavior ::run [ RunTime:0.011000s ]
INFO: [ view_end ] --END-- [ RunTime:0.019002s ]

[ 2014-08-08T11:50:07+08:00 ] 127.0.0.1 /php_demo/shizhan/10/10wish/index.php/Njb/Index/tongji?checkbox=24521&checkbox=24543
INFO: [ route_check ] --START--
INFO: CheckRoute Behavior ::run [ RunTime:0.010001s ]
INFO: [ route_check ] --END-- [ RunTime:0.019001s ]
INFO: [ app_begin ] --START--
INFO: ReadHtmlCache Behavior ::run [ RunTime:0.016001s ]
INFO: [ app_begin ] --END-- [ RunTime:0.022001s ]
SQL: SELECT l.name,COALESCE(a.ucount,0) as yhs,COALESCE(c.ulcount,0) as dlyhs,COALESCE(c.logCount,0) as dlcs FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(ud.id) ucount FROM   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud     GROUP BY ud.locid  ) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>="2014-08-07 00:00:00" AND lo.login_time<"2014-08-08 00:00:00"   GROUP BY ud.locid) c ON l.id=c.locid WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.058003s ]
SQL: SELECT l.name,COALESCE(a.noticeCount,0) noticeCount,COALESCE(a.userCount,0) userCount FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(n.id) noticeCount,COUNT(DISTINCT ud.id) userCount FROM notice n,   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud   WHERE n.owner_id=ud.id AND n.publish_time>="2014-08-07 00:00:00"    AND n.publish_time<"2014-08-08 00:00:00" GROUP BY ud.locid) a  ON l.id=a.locid WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.005001s ]
SQL: SELECT l.name,COALESCE(a.asCount,0) a,COALESCE(b.adminCount,0) b,COALESCE(c.noAdminCount,0) c FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(t.id) asCount FROM assignment t,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE t.creator_id=ud.id AND t.create_time>="2014-08-07 00:00:00" AND  t.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) adminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud   WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='TechAdmin'   AND t.create_time>="2014-08-07 00:00:00" AND  t.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) noAdminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='Technician'   AND t.create_time>="2014-08-07 00:00:00" AND  t.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid ) c ON l.id=c.locid  WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.011001s ]
SQL: SELECT l.name,COALESCE(a.worklogCount,0) a,COALESCE(a.uCount,0) b,COALESCE(b.docCount,0) c,COALESCE(c.phoCount,0) d,COALESCE(d.audioCount,0) e FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(DISTINCT w.id) worklogCount,COUNT(DISTINCT w.owner_id) uCount FROM work_log w,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE w.owner_id=ud.id    AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) docCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  AND i.media_type=1   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) phoCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  AND i.media_type=2   GROUP BY ud.locid ) c ON l.id=c.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) audioCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  AND i.media_type=3   GROUP BY ud.locid ) d ON l.id=d.locid   WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.037002s ]
SQL: SELECT l.name,COALESCE(a.photoCount,0) a,COALESCE(a.ucount,0) b,COALESCE(b.priseCount,0) c,COALESCE(c.comCount,0) d FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(i.id) photoCount,COUNT(DISTINCT ud.id) ucount FROM album m,album_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE m.owner_id=ud.id AND i.album_id=m.id   AND i.create_time>="2014-08-07 00:00:00" AND i.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,COUNT(uc.id) priseCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='AlbumItem'   AND uc.create_time>"2014-08-07 00:00:00" AND uc.create_time<"2014-08-08 00:00:00"   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(uc.id) comCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='SystemComment'   AND uc.create_time>="2014-08-07 00:00:00" AND uc.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) c ON l.id=c.locid  WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.014001s ]
SQL: SELECT a.rname a,l.name b,d.name c,a.age d FROM (SELECT u.id uid,u.real_name rname,u.location_id locid,u.dept_id depId,(2014-(SELECT SUBSTR(u.identify_value,7,4))+0) age FROM app_user u WHERE NOT EXISTS ( SELECT lo.user_id FROM login_log lo WHERE u.id=lo.user_id  ) AND u.id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422) )) a,location l,department d WHERE a.depId=d.id AND a.locid=l.id [ RunTime:2.254129s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) AND lo.login_time>="2014-08-07 00:00:00" AND lo.login_time<"2014-08-08 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.385022s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) AND lo.login_time>="2014-08-07 00:00:00" AND lo.login_time<"2014-08-08 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.376021s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) AND lo.login_time>="2014-08-07 00:00:00" AND lo.login_time<"2014-08-08 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.380022s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) AND lo.login_time>="2014-08-07 00:00:00" AND lo.login_time<"2014-08-08 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.384022s ]
SQL: SELECT l.name,COALESCE(a.ulcount,0) b FROM  location l LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>=(TIMESTAMP(ADDDATE(DATE(SYSDATE()),-(DAYOFWEEK(NOW())-2))))   GROUP BY ud.locid) a ON a.locid=l.id WHERE l.id IN (24521,24543,24561,28422) [ RunTime:0.129008s ]
INFO: [ view_parse ] --START--
INFO: ParseTemplate Behavior ::run [ RunTime:0.517029s ]
INFO: [ view_parse ] --END-- [ RunTime:0.522029s ]
INFO: [ view_filter ] --START--
INFO: ContentReplace Behavior ::run [ RunTime:0.013001s ]
INFO: TokenBuild Behavior ::run [ RunTime:0.014001s ]
INFO: WriteHtmlCache Behavior ::run [ RunTime:0.005000s ]
INFO: ShowRuntime Behavior ::run [ RunTime:0.012001s ]
INFO: [ view_filter ] --END-- [ RunTime:0.064003s ]
INFO: [ view_end ] --START--
INFO: ShowPageTrace Behavior ::run [ RunTime:0.009000s ]
INFO: [ view_end ] --END-- [ RunTime:0.013000s ]

[ 2014-08-08T11:52:03+08:00 ] 127.0.0.1 /php_demo/shizhan/10/10wish/index.php/Njb/Index/tongji?checkbox=24521&checkbox=24543
INFO: [ route_check ] --START--
INFO: CheckRoute Behavior ::run [ RunTime:0.009001s ]
INFO: [ route_check ] --END-- [ RunTime:0.015001s ]
INFO: [ app_begin ] --START--
INFO: ReadHtmlCache Behavior ::run [ RunTime:0.008000s ]
INFO: [ app_begin ] --END-- [ RunTime:0.015001s ]
SQL: SELECT l.name,COALESCE(a.ucount,0) as yhs,COALESCE(c.ulcount,0) as dlyhs,COALESCE(c.logCount,0) as dlcs FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(ud.id) ucount FROM   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud     GROUP BY ud.locid  ) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>="2014-08-07 00:00:00" AND lo.login_time<"2014-08-08 00:00:00"   GROUP BY ud.locid) c ON l.id=c.locid WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.041002s ]
SQL: SELECT l.name,COALESCE(a.noticeCount,0) noticeCount,COALESCE(a.userCount,0) userCount FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(n.id) noticeCount,COUNT(DISTINCT ud.id) userCount FROM notice n,   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud   WHERE n.owner_id=ud.id AND n.publish_time>="2014-08-07 00:00:00"    AND n.publish_time<"2014-08-08 00:00:00" GROUP BY ud.locid) a  ON l.id=a.locid WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.005000s ]
SQL: SELECT l.name,COALESCE(a.asCount,0) a,COALESCE(b.adminCount,0) b,COALESCE(c.noAdminCount,0) c FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(t.id) asCount FROM assignment t,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE t.creator_id=ud.id AND t.create_time>="2014-08-07 00:00:00" AND  t.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) adminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud   WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='TechAdmin'   AND t.create_time>="2014-08-07 00:00:00" AND  t.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) noAdminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='Technician'   AND t.create_time>="2014-08-07 00:00:00" AND  t.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid ) c ON l.id=c.locid  WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.010000s ]
SQL: SELECT l.name,COALESCE(a.worklogCount,0) a,COALESCE(a.uCount,0) b,COALESCE(b.docCount,0) c,COALESCE(c.phoCount,0) d,COALESCE(d.audioCount,0) e FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(DISTINCT w.id) worklogCount,COUNT(DISTINCT w.owner_id) uCount FROM work_log w,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE w.owner_id=ud.id    AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) docCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  AND i.media_type=1   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) phoCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  AND i.media_type=2   GROUP BY ud.locid ) c ON l.id=c.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) audioCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  AND i.media_type=3   GROUP BY ud.locid ) d ON l.id=d.locid   WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.031001s ]
SQL: SELECT l.name,COALESCE(a.photoCount,0) a,COALESCE(a.ucount,0) b,COALESCE(b.priseCount,0) c,COALESCE(c.comCount,0) d FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(i.id) photoCount,COUNT(DISTINCT ud.id) ucount FROM album m,album_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE m.owner_id=ud.id AND i.album_id=m.id   AND i.create_time>="2014-08-07 00:00:00" AND i.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,COUNT(uc.id) priseCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='AlbumItem'   AND uc.create_time>"2014-08-07 00:00:00" AND uc.create_time<"2014-08-08 00:00:00"   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(uc.id) comCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='SystemComment'   AND uc.create_time>="2014-08-07 00:00:00" AND uc.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) c ON l.id=c.locid  WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.013001s ]
SQL: SELECT a.rname a,l.name b,d.name c,a.age d FROM (SELECT u.id uid,u.real_name rname,u.location_id locid,u.dept_id depId,(2014-(SELECT SUBSTR(u.identify_value,7,4))+0) age FROM app_user u WHERE NOT EXISTS ( SELECT lo.user_id FROM login_log lo WHERE u.id=lo.user_id  ) AND u.id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422) )) a,location l,department d WHERE a.depId=d.id AND a.locid=l.id [ RunTime:2.374136s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) AND lo.login_time>="2014-08-07 00:00:00" AND lo.login_time<"2014-08-08 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.365021s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) AND lo.login_time>="2014-08-07 00:00:00" AND lo.login_time<"2014-08-08 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.366021s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) AND lo.login_time>="2014-08-07 00:00:00" AND lo.login_time<"2014-08-08 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.463027s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) AND lo.login_time>="2014-08-07 00:00:00" AND lo.login_time<"2014-08-08 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.459026s ]
SQL: SELECT l.name,COALESCE(a.ulcount,0) b FROM  location l LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>=(TIMESTAMP(ADDDATE(DATE(SYSDATE()),-(DAYOFWEEK(NOW())-2))))   GROUP BY ud.locid) a ON a.locid=l.id WHERE l.id IN (24521,24543,24561,28422) [ RunTime:0.151009s ]
INFO: [ view_parse ] --START--
INFO: ParseTemplate Behavior ::run [ RunTime:0.592033s ]
INFO: [ view_parse ] --END-- [ RunTime:0.598035s ]
INFO: [ view_filter ] --START--
INFO: ContentReplace Behavior ::run [ RunTime:0.007000s ]
INFO: TokenBuild Behavior ::run [ RunTime:0.013000s ]
INFO: WriteHtmlCache Behavior ::run [ RunTime:0.004000s ]
INFO: ShowRuntime Behavior ::run [ RunTime:0.016001s ]
INFO: [ view_filter ] --END-- [ RunTime:0.059003s ]
INFO: [ view_end ] --START--
INFO: ShowPageTrace Behavior ::run [ RunTime:0.010000s ]
INFO: [ view_end ] --END-- [ RunTime:0.015001s ]

[ 2014-08-08T11:52:06+08:00 ] 127.0.0.1 /php_demo/shizhan/10/10wish/index.php/Njb/Index/tongji?checkbox=24521&checkbox=24543
INFO: [ route_check ] --START--
INFO: CheckRoute Behavior ::run [ RunTime:0.007001s ]
INFO: [ route_check ] --END-- [ RunTime:0.014001s ]
INFO: [ app_begin ] --START--
INFO: ReadHtmlCache Behavior ::run [ RunTime:0.011001s ]
INFO: [ app_begin ] --END-- [ RunTime:0.017001s ]
SQL: SELECT l.name,COALESCE(a.ucount,0) as yhs,COALESCE(c.ulcount,0) as dlyhs,COALESCE(c.logCount,0) as dlcs FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(ud.id) ucount FROM   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud     GROUP BY ud.locid  ) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>="2014-08-07 00:00:00" AND lo.login_time<"2014-08-08 00:00:00"   GROUP BY ud.locid) c ON l.id=c.locid WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.047003s ]
SQL: SELECT l.name,COALESCE(a.noticeCount,0) noticeCount,COALESCE(a.userCount,0) userCount FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(n.id) noticeCount,COUNT(DISTINCT ud.id) userCount FROM notice n,   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud   WHERE n.owner_id=ud.id AND n.publish_time>="2014-08-07 00:00:00"    AND n.publish_time<"2014-08-08 00:00:00" GROUP BY ud.locid) a  ON l.id=a.locid WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.005000s ]
SQL: SELECT l.name,COALESCE(a.asCount,0) a,COALESCE(b.adminCount,0) b,COALESCE(c.noAdminCount,0) c FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(t.id) asCount FROM assignment t,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE t.creator_id=ud.id AND t.create_time>="2014-08-07 00:00:00" AND  t.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) adminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud   WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='TechAdmin'   AND t.create_time>="2014-08-07 00:00:00" AND  t.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) noAdminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='Technician'   AND t.create_time>="2014-08-07 00:00:00" AND  t.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid ) c ON l.id=c.locid  WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.013001s ]
SQL: SELECT l.name,COALESCE(a.worklogCount,0) a,COALESCE(a.uCount,0) b,COALESCE(b.docCount,0) c,COALESCE(c.phoCount,0) d,COALESCE(d.audioCount,0) e FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(DISTINCT w.id) worklogCount,COUNT(DISTINCT w.owner_id) uCount FROM work_log w,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE w.owner_id=ud.id    AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) docCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  AND i.media_type=1   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) phoCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  AND i.media_type=2   GROUP BY ud.locid ) c ON l.id=c.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) audioCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  AND i.media_type=3   GROUP BY ud.locid ) d ON l.id=d.locid   WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.066003s ]
SQL: SELECT l.name,COALESCE(a.photoCount,0) a,COALESCE(a.ucount,0) b,COALESCE(b.priseCount,0) c,COALESCE(c.comCount,0) d FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(i.id) photoCount,COUNT(DISTINCT ud.id) ucount FROM album m,album_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE m.owner_id=ud.id AND i.album_id=m.id   AND i.create_time>="2014-08-07 00:00:00" AND i.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,COUNT(uc.id) priseCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='AlbumItem'   AND uc.create_time>"2014-08-07 00:00:00" AND uc.create_time<"2014-08-08 00:00:00"   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(uc.id) comCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='SystemComment'   AND uc.create_time>="2014-08-07 00:00:00" AND uc.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) c ON l.id=c.locid  WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.013001s ]
SQL: SELECT a.rname a,l.name b,d.name c,a.age d FROM (SELECT u.id uid,u.real_name rname,u.location_id locid,u.dept_id depId,(2014-(SELECT SUBSTR(u.identify_value,7,4))+0) age FROM app_user u WHERE NOT EXISTS ( SELECT lo.user_id FROM login_log lo WHERE u.id=lo.user_id  ) AND u.id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422) )) a,location l,department d WHERE a.depId=d.id AND a.locid=l.id [ RunTime:2.523145s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) AND lo.login_time>="2014-08-07 00:00:00" AND lo.login_time<"2014-08-08 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.471027s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) AND lo.login_time>="2014-08-07 00:00:00" AND lo.login_time<"2014-08-08 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.382022s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) AND lo.login_time>="2014-08-07 00:00:00" AND lo.login_time<"2014-08-08 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.385022s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) AND lo.login_time>="2014-08-07 00:00:00" AND lo.login_time<"2014-08-08 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.373021s ]
SQL: SELECT l.name,COALESCE(a.ulcount,0) b FROM  location l LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>=(TIMESTAMP(ADDDATE(DATE(SYSDATE()),-(DAYOFWEEK(NOW())-2))))   GROUP BY ud.locid) a ON a.locid=l.id WHERE l.id IN (24521,24543,24561,28422) [ RunTime:0.129007s ]
INFO: [ view_parse ] --START--
INFO: ParseTemplate Behavior ::run [ RunTime:0.522030s ]
INFO: [ view_parse ] --END-- [ RunTime:0.526030s ]
INFO: [ view_filter ] --START--
INFO: ContentReplace Behavior ::run [ RunTime:0.007000s ]
INFO: TokenBuild Behavior ::run [ RunTime:0.012000s ]
INFO: WriteHtmlCache Behavior ::run [ RunTime:0.007000s ]
INFO: ShowRuntime Behavior ::run [ RunTime:0.018001s ]
INFO: [ view_filter ] --END-- [ RunTime:0.062003s ]
INFO: [ view_end ] --START--
INFO: ShowPageTrace Behavior ::run [ RunTime:0.015001s ]
INFO: [ view_end ] --END-- [ RunTime:0.023001s ]

[ 2014-08-08T11:52:29+08:00 ] 127.0.0.1 /php_demo/shizhan/10/10wish/index.php/Njb/Index/tongji?checkbox=24521&checkbox=24543
INFO: [ route_check ] --START--
INFO: CheckRoute Behavior ::run [ RunTime:0.008001s ]
INFO: [ route_check ] --END-- [ RunTime:0.013001s ]
INFO: [ app_begin ] --START--
INFO: ReadHtmlCache Behavior ::run [ RunTime:0.010000s ]
INFO: [ app_begin ] --END-- [ RunTime:0.014001s ]
SQL: SELECT l.name,COALESCE(a.ucount,0) as yhs,COALESCE(c.ulcount,0) as dlyhs,COALESCE(c.logCount,0) as dlcs FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(ud.id) ucount FROM   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud     GROUP BY ud.locid  ) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>="2014-08-07 00:00:00" AND lo.login_time<"2014-08-08 00:00:00"   GROUP BY ud.locid) c ON l.id=c.locid WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.042002s ]
SQL: SELECT l.name,COALESCE(a.noticeCount,0) noticeCount,COALESCE(a.userCount,0) userCount FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(n.id) noticeCount,COUNT(DISTINCT ud.id) userCount FROM notice n,   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud   WHERE n.owner_id=ud.id AND n.publish_time>="2014-08-07 00:00:00"    AND n.publish_time<"2014-08-08 00:00:00" GROUP BY ud.locid) a  ON l.id=a.locid WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.004000s ]
SQL: SELECT l.name,COALESCE(a.asCount,0) a,COALESCE(b.adminCount,0) b,COALESCE(c.noAdminCount,0) c FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(t.id) asCount FROM assignment t,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE t.creator_id=ud.id AND t.create_time>="2014-08-07 00:00:00" AND  t.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) adminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud   WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='TechAdmin'   AND t.create_time>="2014-08-07 00:00:00" AND  t.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) noAdminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='Technician'   AND t.create_time>="2014-08-07 00:00:00" AND  t.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid ) c ON l.id=c.locid  WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.012001s ]
SQL: SELECT l.name,COALESCE(a.worklogCount,0) a,COALESCE(a.uCount,0) b,COALESCE(b.docCount,0) c,COALESCE(c.phoCount,0) d,COALESCE(d.audioCount,0) e FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(DISTINCT w.id) worklogCount,COUNT(DISTINCT w.owner_id) uCount FROM work_log w,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE w.owner_id=ud.id    AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) docCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  AND i.media_type=1   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) phoCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  AND i.media_type=2   GROUP BY ud.locid ) c ON l.id=c.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) audioCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  AND i.media_type=3   GROUP BY ud.locid ) d ON l.id=d.locid   WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.082004s ]
SQL: SELECT l.name,COALESCE(a.photoCount,0) a,COALESCE(a.ucount,0) b,COALESCE(b.priseCount,0) c,COALESCE(c.comCount,0) d FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(i.id) photoCount,COUNT(DISTINCT ud.id) ucount FROM album m,album_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE m.owner_id=ud.id AND i.album_id=m.id   AND i.create_time>="2014-08-07 00:00:00" AND i.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,COUNT(uc.id) priseCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='AlbumItem'   AND uc.create_time>"2014-08-07 00:00:00" AND uc.create_time<"2014-08-08 00:00:00"   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(uc.id) comCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='SystemComment'   AND uc.create_time>="2014-08-07 00:00:00" AND uc.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) c ON l.id=c.locid  WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.014001s ]
SQL: SELECT a.rname a,l.name b,d.name c,a.age d FROM (SELECT u.id uid,u.real_name rname,u.location_id locid,u.dept_id depId,(2014-(SELECT SUBSTR(u.identify_value,7,4))+0) age FROM app_user u WHERE NOT EXISTS ( SELECT lo.user_id FROM login_log lo WHERE u.id=lo.user_id  ) AND u.id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422) )) a,location l,department d WHERE a.depId=d.id AND a.locid=l.id [ RunTime:2.139122s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) AND lo.login_time>="2014-08-07 00:00:00" AND lo.login_time<"2014-08-08 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.521030s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) AND lo.login_time>="2014-08-07 00:00:00" AND lo.login_time<"2014-08-08 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.403023s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) AND lo.login_time>="2014-08-07 00:00:00" AND lo.login_time<"2014-08-08 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.365021s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) AND lo.login_time>="2014-08-07 00:00:00" AND lo.login_time<"2014-08-08 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.361021s ]
SQL: SELECT l.name,COALESCE(a.ulcount,0) b FROM  location l LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>=(TIMESTAMP(ADDDATE(DATE(SYSDATE()),-(DAYOFWEEK(NOW())-2))))   GROUP BY ud.locid) a ON a.locid=l.id WHERE l.id IN (24521,24543,24561,28422) [ RunTime:0.124007s ]
INFO: [ view_parse ] --START--
INFO: ParseTemplate Behavior ::run [ RunTime:0.557032s ]
INFO: [ view_parse ] --END-- [ RunTime:0.563032s ]
INFO: [ view_filter ] --START--
INFO: ContentReplace Behavior ::run [ RunTime:0.011000s ]
INFO: TokenBuild Behavior ::run [ RunTime:0.016001s ]
INFO: WriteHtmlCache Behavior ::run [ RunTime:0.005000s ]
INFO: ShowRuntime Behavior ::run [ RunTime:0.016000s ]
INFO: [ view_filter ] --END-- [ RunTime:0.069004s ]
INFO: [ view_end ] --START--
INFO: ShowPageTrace Behavior ::run [ RunTime:0.009001s ]
INFO: [ view_end ] --END-- [ RunTime:0.016001s ]

[ 2014-08-08T11:52:34+08:00 ] 127.0.0.1 /php_demo/shizhan/10/10wish/index.php/Njb/Index/tongji?checkbox=24521&checkbox=24543
INFO: [ route_check ] --START--
INFO: CheckRoute Behavior ::run [ RunTime:0.008001s ]
INFO: [ route_check ] --END-- [ RunTime:0.012001s ]
INFO: [ app_begin ] --START--
INFO: ReadHtmlCache Behavior ::run [ RunTime:0.009001s ]
INFO: [ app_begin ] --END-- [ RunTime:0.015001s ]
SQL: SELECT l.name,COALESCE(a.ucount,0) as yhs,COALESCE(c.ulcount,0) as dlyhs,COALESCE(c.logCount,0) as dlcs FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(ud.id) ucount FROM   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud     GROUP BY ud.locid  ) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>="2014-08-07 00:00:00" AND lo.login_time<"2014-08-08 00:00:00"   GROUP BY ud.locid) c ON l.id=c.locid WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.050003s ]
SQL: SELECT l.name,COALESCE(a.noticeCount,0) noticeCount,COALESCE(a.userCount,0) userCount FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(n.id) noticeCount,COUNT(DISTINCT ud.id) userCount FROM notice n,   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud   WHERE n.owner_id=ud.id AND n.publish_time>="2014-08-07 00:00:00"    AND n.publish_time<"2014-08-08 00:00:00" GROUP BY ud.locid) a  ON l.id=a.locid WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.006000s ]
SQL: SELECT l.name,COALESCE(a.asCount,0) a,COALESCE(b.adminCount,0) b,COALESCE(c.noAdminCount,0) c FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(t.id) asCount FROM assignment t,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE t.creator_id=ud.id AND t.create_time>="2014-08-07 00:00:00" AND  t.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) adminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud   WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='TechAdmin'   AND t.create_time>="2014-08-07 00:00:00" AND  t.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) noAdminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='Technician'   AND t.create_time>="2014-08-07 00:00:00" AND  t.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid ) c ON l.id=c.locid  WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.012001s ]
SQL: SELECT l.name,COALESCE(a.worklogCount,0) a,COALESCE(a.uCount,0) b,COALESCE(b.docCount,0) c,COALESCE(c.phoCount,0) d,COALESCE(d.audioCount,0) e FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(DISTINCT w.id) worklogCount,COUNT(DISTINCT w.owner_id) uCount FROM work_log w,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE w.owner_id=ud.id    AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) docCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  AND i.media_type=1   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) phoCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  AND i.media_type=2   GROUP BY ud.locid ) c ON l.id=c.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) audioCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  AND i.media_type=3   GROUP BY ud.locid ) d ON l.id=d.locid   WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.045002s ]
SQL: SELECT l.name,COALESCE(a.photoCount,0) a,COALESCE(a.ucount,0) b,COALESCE(b.priseCount,0) c,COALESCE(c.comCount,0) d FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(i.id) photoCount,COUNT(DISTINCT ud.id) ucount FROM album m,album_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE m.owner_id=ud.id AND i.album_id=m.id   AND i.create_time>="2014-08-07 00:00:00" AND i.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,COUNT(uc.id) priseCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='AlbumItem'   AND uc.create_time>"2014-08-07 00:00:00" AND uc.create_time<"2014-08-08 00:00:00"   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(uc.id) comCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='SystemComment'   AND uc.create_time>="2014-08-07 00:00:00" AND uc.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) c ON l.id=c.locid  WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.013000s ]
SQL: SELECT a.rname a,l.name b,d.name c,a.age d FROM (SELECT u.id uid,u.real_name rname,u.location_id locid,u.dept_id depId,(2014-(SELECT SUBSTR(u.identify_value,7,4))+0) age FROM app_user u WHERE NOT EXISTS ( SELECT lo.user_id FROM login_log lo WHERE u.id=lo.user_id  ) AND u.id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422) )) a,location l,department d WHERE a.depId=d.id AND a.locid=l.id [ RunTime:2.453140s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) AND lo.login_time>="2014-08-07 00:00:00" AND lo.login_time<"2014-08-08 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.387022s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) AND lo.login_time>="2014-08-07 00:00:00" AND lo.login_time<"2014-08-08 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.358021s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) AND lo.login_time>="2014-08-07 00:00:00" AND lo.login_time<"2014-08-08 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.378022s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) AND lo.login_time>="2014-08-07 00:00:00" AND lo.login_time<"2014-08-08 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.395023s ]
SQL: SELECT l.name,COALESCE(a.ulcount,0) b FROM  location l LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>=(TIMESTAMP(ADDDATE(DATE(SYSDATE()),-(DAYOFWEEK(NOW())-2))))   GROUP BY ud.locid) a ON a.locid=l.id WHERE l.id IN (24521,24543,24561,28422) [ RunTime:0.127008s ]
INFO: [ view_parse ] --START--
INFO: ParseTemplate Behavior ::run [ RunTime:0.612035s ]
INFO: [ view_parse ] --END-- [ RunTime:0.617036s ]
INFO: [ view_filter ] --START--
INFO: ContentReplace Behavior ::run [ RunTime:0.008001s ]
INFO: TokenBuild Behavior ::run [ RunTime:0.009000s ]
INFO: WriteHtmlCache Behavior ::run [ RunTime:0.004001s ]
INFO: ShowRuntime Behavior ::run [ RunTime:0.013001s ]
INFO: [ view_filter ] --END-- [ RunTime:0.047003s ]
INFO: [ view_end ] --START--
INFO: ShowPageTrace Behavior ::run [ RunTime:0.009001s ]
INFO: [ view_end ] --END-- [ RunTime:0.013001s ]

[ 2014-08-08T11:52:35+08:00 ] 127.0.0.1 /php_demo/shizhan/10/10wish/index.php/Njb/Index/index
INFO: [ route_check ] --START--
INFO: CheckRoute Behavior ::run [ RunTime:0.009000s ]
INFO: [ route_check ] --END-- [ RunTime:0.044002s ]
INFO: [ app_begin ] --START--
INFO: ReadHtmlCache Behavior ::run [ RunTime:0.012000s ]
INFO: [ app_begin ] --END-- [ RunTime:0.047002s ]
INFO: [ view_parse ] --START--
INFO: ParseTemplate Behavior ::run [ RunTime:0.133007s ]
INFO: [ view_parse ] --END-- [ RunTime:0.138008s ]
INFO: [ view_filter ] --START--
INFO: ContentReplace Behavior ::run [ RunTime:0.041002s ]
INFO: TokenBuild Behavior ::run [ RunTime:0.014001s ]
INFO: WriteHtmlCache Behavior ::run [ RunTime:0.005001s ]
INFO: ShowRuntime Behavior ::run [ RunTime:0.041003s ]
INFO: [ view_filter ] --END-- [ RunTime:0.180010s ]
INFO: [ view_end ] --START--
INFO: ShowPageTrace Behavior ::run [ RunTime:0.009000s ]
INFO: [ view_end ] --END-- [ RunTime:0.020001s ]

[ 2014-08-08T11:52:45+08:00 ] 127.0.0.1 /php_demo/shizhan/10/10wish/index.php/Njb/Index/tongji?checkbox1=24521&checkbox2=24543
INFO: [ route_check ] --START--
INFO: CheckRoute Behavior ::run [ RunTime:0.007000s ]
INFO: [ route_check ] --END-- [ RunTime:0.012000s ]
INFO: [ app_begin ] --START--
INFO: ReadHtmlCache Behavior ::run [ RunTime:0.008001s ]
INFO: [ app_begin ] --END-- [ RunTime:0.013001s ]
SQL: SELECT l.name,COALESCE(a.ucount,0) as yhs,COALESCE(c.ulcount,0) as dlyhs,COALESCE(c.logCount,0) as dlcs FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(ud.id) ucount FROM   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud     GROUP BY ud.locid  ) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>="2014-08-07 00:00:00" AND lo.login_time<"2014-08-08 00:00:00"   GROUP BY ud.locid) c ON l.id=c.locid WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.041002s ]
SQL: SELECT l.name,COALESCE(a.noticeCount,0) noticeCount,COALESCE(a.userCount,0) userCount FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(n.id) noticeCount,COUNT(DISTINCT ud.id) userCount FROM notice n,   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud   WHERE n.owner_id=ud.id AND n.publish_time>="2014-08-07 00:00:00"    AND n.publish_time<"2014-08-08 00:00:00" GROUP BY ud.locid) a  ON l.id=a.locid WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.005000s ]
SQL: SELECT l.name,COALESCE(a.asCount,0) a,COALESCE(b.adminCount,0) b,COALESCE(c.noAdminCount,0) c FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(t.id) asCount FROM assignment t,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE t.creator_id=ud.id AND t.create_time>="2014-08-07 00:00:00" AND  t.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) adminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud   WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='TechAdmin'   AND t.create_time>="2014-08-07 00:00:00" AND  t.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) noAdminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='Technician'   AND t.create_time>="2014-08-07 00:00:00" AND  t.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid ) c ON l.id=c.locid  WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.011000s ]
SQL: SELECT l.name,COALESCE(a.worklogCount,0) a,COALESCE(a.uCount,0) b,COALESCE(b.docCount,0) c,COALESCE(c.phoCount,0) d,COALESCE(d.audioCount,0) e FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(DISTINCT w.id) worklogCount,COUNT(DISTINCT w.owner_id) uCount FROM work_log w,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE w.owner_id=ud.id    AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) docCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  AND i.media_type=1   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) phoCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  AND i.media_type=2   GROUP BY ud.locid ) c ON l.id=c.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) audioCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  AND i.media_type=3   GROUP BY ud.locid ) d ON l.id=d.locid   WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.032002s ]
SQL: SELECT l.name,COALESCE(a.photoCount,0) a,COALESCE(a.ucount,0) b,COALESCE(b.priseCount,0) c,COALESCE(c.comCount,0) d FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(i.id) photoCount,COUNT(DISTINCT ud.id) ucount FROM album m,album_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE m.owner_id=ud.id AND i.album_id=m.id   AND i.create_time>="2014-08-07 00:00:00" AND i.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,COUNT(uc.id) priseCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='AlbumItem'   AND uc.create_time>"2014-08-07 00:00:00" AND uc.create_time<"2014-08-08 00:00:00"   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(uc.id) comCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='SystemComment'   AND uc.create_time>="2014-08-07 00:00:00" AND uc.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) c ON l.id=c.locid  WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.011001s ]
SQL: SELECT a.rname a,l.name b,d.name c,a.age d FROM (SELECT u.id uid,u.real_name rname,u.location_id locid,u.dept_id depId,(2014-(SELECT SUBSTR(u.identify_value,7,4))+0) age FROM app_user u WHERE NOT EXISTS ( SELECT lo.user_id FROM login_log lo WHERE u.id=lo.user_id  ) AND u.id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422) )) a,location l,department d WHERE a.depId=d.id AND a.locid=l.id [ RunTime:2.099120s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) AND lo.login_time>="2014-08-07 00:00:00" AND lo.login_time<"2014-08-08 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.370021s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) AND lo.login_time>="2014-08-07 00:00:00" AND lo.login_time<"2014-08-08 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.370022s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) AND lo.login_time>="2014-08-07 00:00:00" AND lo.login_time<"2014-08-08 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.367021s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) AND lo.login_time>="2014-08-07 00:00:00" AND lo.login_time<"2014-08-08 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.366021s ]
SQL: SELECT l.name,COALESCE(a.ulcount,0) b FROM  location l LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>=(TIMESTAMP(ADDDATE(DATE(SYSDATE()),-(DAYOFWEEK(NOW())-2))))   GROUP BY ud.locid) a ON a.locid=l.id WHERE l.id IN (24521,24543,24561,28422) [ RunTime:0.127007s ]
INFO: [ view_parse ] --START--
INFO: ParseTemplate Behavior ::run [ RunTime:0.509029s ]
INFO: [ view_parse ] --END-- [ RunTime:0.514029s ]
INFO: [ view_filter ] --START--
INFO: ContentReplace Behavior ::run [ RunTime:0.006000s ]
INFO: TokenBuild Behavior ::run [ RunTime:0.008001s ]
INFO: WriteHtmlCache Behavior ::run [ RunTime:0.004000s ]
INFO: ShowRuntime Behavior ::run [ RunTime:0.013001s ]
INFO: [ view_filter ] --END-- [ RunTime:0.047002s ]
INFO: [ view_end ] --START--
INFO: ShowPageTrace Behavior ::run [ RunTime:0.014001s ]
INFO: [ view_end ] --END-- [ RunTime:0.023001s ]

[ 2014-08-08T11:53:46+08:00 ] 127.0.0.1 /php_demo/shizhan/10/10wish/index.php/Njb/Index/tongji?checkbox1=24521&checkbox2=24543
INFO: [ route_check ] --START--
INFO: CheckRoute Behavior ::run [ RunTime:0.006000s ]
INFO: [ route_check ] --END-- [ RunTime:0.010001s ]
INFO: [ app_begin ] --START--
INFO: ReadHtmlCache Behavior ::run [ RunTime:0.009001s ]
INFO: [ app_begin ] --END-- [ RunTime:0.013001s ]
SQL: SELECT l.name,COALESCE(a.ucount,0) as yhs,COALESCE(c.ulcount,0) as dlyhs,COALESCE(c.logCount,0) as dlcs FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(ud.id) ucount FROM   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud     GROUP BY ud.locid  ) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>="2014-08-07 00:00:00" AND lo.login_time<"2014-08-08 00:00:00"   GROUP BY ud.locid) c ON l.id=c.locid WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.041002s ]
SQL: SELECT l.name,COALESCE(a.noticeCount,0) noticeCount,COALESCE(a.userCount,0) userCount FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(n.id) noticeCount,COUNT(DISTINCT ud.id) userCount FROM notice n,   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud   WHERE n.owner_id=ud.id AND n.publish_time>="2014-08-07 00:00:00"    AND n.publish_time<"2014-08-08 00:00:00" GROUP BY ud.locid) a  ON l.id=a.locid WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.004001s ]
SQL: SELECT l.name,COALESCE(a.asCount,0) a,COALESCE(b.adminCount,0) b,COALESCE(c.noAdminCount,0) c FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(t.id) asCount FROM assignment t,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE t.creator_id=ud.id AND t.create_time>="2014-08-07 00:00:00" AND  t.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) adminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud   WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='TechAdmin'   AND t.create_time>="2014-08-07 00:00:00" AND  t.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) noAdminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='Technician'   AND t.create_time>="2014-08-07 00:00:00" AND  t.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid ) c ON l.id=c.locid  WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.009001s ]
SQL: SELECT l.name,COALESCE(a.worklogCount,0) a,COALESCE(a.uCount,0) b,COALESCE(b.docCount,0) c,COALESCE(c.phoCount,0) d,COALESCE(d.audioCount,0) e FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(DISTINCT w.id) worklogCount,COUNT(DISTINCT w.owner_id) uCount FROM work_log w,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE w.owner_id=ud.id    AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) docCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  AND i.media_type=1   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) phoCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  AND i.media_type=2   GROUP BY ud.locid ) c ON l.id=c.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) audioCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  AND i.media_type=3   GROUP BY ud.locid ) d ON l.id=d.locid   WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.032002s ]
SQL: SELECT l.name,COALESCE(a.photoCount,0) a,COALESCE(a.ucount,0) b,COALESCE(b.priseCount,0) c,COALESCE(c.comCount,0) d FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(i.id) photoCount,COUNT(DISTINCT ud.id) ucount FROM album m,album_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE m.owner_id=ud.id AND i.album_id=m.id   AND i.create_time>="2014-08-07 00:00:00" AND i.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,COUNT(uc.id) priseCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='AlbumItem'   AND uc.create_time>"2014-08-07 00:00:00" AND uc.create_time<"2014-08-08 00:00:00"   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(uc.id) comCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='SystemComment'   AND uc.create_time>="2014-08-07 00:00:00" AND uc.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) c ON l.id=c.locid  WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.012001s ]
SQL: SELECT a.rname a,l.name b,d.name c,a.age d FROM (SELECT u.id uid,u.real_name rname,u.location_id locid,u.dept_id depId,(2014-(SELECT SUBSTR(u.identify_value,7,4))+0) age FROM app_user u WHERE NOT EXISTS ( SELECT lo.user_id FROM login_log lo WHERE u.id=lo.user_id  ) AND u.id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422) )) a,location l,department d WHERE a.depId=d.id AND a.locid=l.id [ RunTime:2.111120s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) AND lo.login_time>="2014-08-07 00:00:00" AND lo.login_time<"2014-08-08 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.368021s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) AND lo.login_time>="2014-08-07 00:00:00" AND lo.login_time<"2014-08-08 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.361021s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) AND lo.login_time>="2014-08-07 00:00:00" AND lo.login_time<"2014-08-08 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.384021s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) AND lo.login_time>="2014-08-07 00:00:00" AND lo.login_time<"2014-08-08 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.376022s ]
SQL: SELECT l.name,COALESCE(a.ulcount,0) b FROM  location l LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>=(TIMESTAMP(ADDDATE(DATE(SYSDATE()),-(DAYOFWEEK(NOW())-2))))   GROUP BY ud.locid) a ON a.locid=l.id WHERE l.id IN (24521,24543,24561,28422) [ RunTime:0.133008s ]
INFO: [ view_parse ] --START--
INFO: ParseTemplate Behavior ::run [ RunTime:0.511029s ]
INFO: [ view_parse ] --END-- [ RunTime:0.516030s ]
INFO: [ view_filter ] --START--
INFO: ContentReplace Behavior ::run [ RunTime:0.008001s ]
INFO: TokenBuild Behavior ::run [ RunTime:0.011001s ]
INFO: WriteHtmlCache Behavior ::run [ RunTime:0.005000s ]
INFO: ShowRuntime Behavior ::run [ RunTime:0.016001s ]
INFO: [ view_filter ] --END-- [ RunTime:0.057003s ]
INFO: [ view_end ] --START--
INFO: ShowPageTrace Behavior ::run [ RunTime:0.013001s ]
INFO: [ view_end ] --END-- [ RunTime:0.022001s ]

[ 2014-08-08T11:53:51+08:00 ] 127.0.0.1 /php_demo/shizhan/10/10wish/index.php/Njb/Index/index
INFO: [ route_check ] --START--
INFO: CheckRoute Behavior ::run [ RunTime:0.008000s ]
INFO: [ route_check ] --END-- [ RunTime:0.012000s ]
INFO: [ app_begin ] --START--
INFO: ReadHtmlCache Behavior ::run [ RunTime:0.008001s ]
INFO: [ app_begin ] --END-- [ RunTime:0.014001s ]
INFO: [ view_parse ] --START--
INFO: ParseTemplate Behavior ::run [ RunTime:0.084005s ]
INFO: [ view_parse ] --END-- [ RunTime:0.089005s ]
INFO: [ view_filter ] --START--
INFO: ContentReplace Behavior ::run [ RunTime:0.007000s ]
INFO: TokenBuild Behavior ::run [ RunTime:0.008001s ]
INFO: WriteHtmlCache Behavior ::run [ RunTime:0.008000s ]
INFO: ShowRuntime Behavior ::run [ RunTime:0.013000s ]
INFO: [ view_filter ] --END-- [ RunTime:0.049002s ]
INFO: [ view_end ] --START--
INFO: ShowPageTrace Behavior ::run [ RunTime:0.008000s ]
INFO: [ view_end ] --END-- [ RunTime:0.013000s ]

[ 2014-08-08T11:54:00+08:00 ] 127.0.0.1 /php_demo/shizhan/10/10wish/index.php/Njb/Index/tongji?checkbox%5B%5D=24521&checkbox%5B%5D=24543
INFO: [ route_check ] --START--
INFO: CheckRoute Behavior ::run [ RunTime:0.006001s ]
INFO: [ route_check ] --END-- [ RunTime:0.010001s ]
INFO: [ app_begin ] --START--
INFO: ReadHtmlCache Behavior ::run [ RunTime:0.010000s ]
INFO: [ app_begin ] --END-- [ RunTime:0.016001s ]
SQL: SELECT l.name,COALESCE(a.ucount,0) as yhs,COALESCE(c.ulcount,0) as dlyhs,COALESCE(c.logCount,0) as dlcs FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(ud.id) ucount FROM   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud     GROUP BY ud.locid  ) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>="2014-08-07 00:00:00" AND lo.login_time<"2014-08-08 00:00:00"   GROUP BY ud.locid) c ON l.id=c.locid WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.040003s ]
SQL: SELECT l.name,COALESCE(a.noticeCount,0) noticeCount,COALESCE(a.userCount,0) userCount FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(n.id) noticeCount,COUNT(DISTINCT ud.id) userCount FROM notice n,   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud   WHERE n.owner_id=ud.id AND n.publish_time>="2014-08-07 00:00:00"    AND n.publish_time<"2014-08-08 00:00:00" GROUP BY ud.locid) a  ON l.id=a.locid WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.005000s ]
SQL: SELECT l.name,COALESCE(a.asCount,0) a,COALESCE(b.adminCount,0) b,COALESCE(c.noAdminCount,0) c FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(t.id) asCount FROM assignment t,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE t.creator_id=ud.id AND t.create_time>="2014-08-07 00:00:00" AND  t.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) adminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud   WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='TechAdmin'   AND t.create_time>="2014-08-07 00:00:00" AND  t.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) noAdminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='Technician'   AND t.create_time>="2014-08-07 00:00:00" AND  t.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid ) c ON l.id=c.locid  WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.010000s ]
SQL: SELECT l.name,COALESCE(a.worklogCount,0) a,COALESCE(a.uCount,0) b,COALESCE(b.docCount,0) c,COALESCE(c.phoCount,0) d,COALESCE(d.audioCount,0) e FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(DISTINCT w.id) worklogCount,COUNT(DISTINCT w.owner_id) uCount FROM work_log w,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE w.owner_id=ud.id    AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) docCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  AND i.media_type=1   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) phoCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  AND i.media_type=2   GROUP BY ud.locid ) c ON l.id=c.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) audioCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  AND i.media_type=3   GROUP BY ud.locid ) d ON l.id=d.locid   WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.036002s ]
SQL: SELECT l.name,COALESCE(a.photoCount,0) a,COALESCE(a.ucount,0) b,COALESCE(b.priseCount,0) c,COALESCE(c.comCount,0) d FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(i.id) photoCount,COUNT(DISTINCT ud.id) ucount FROM album m,album_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE m.owner_id=ud.id AND i.album_id=m.id   AND i.create_time>="2014-08-07 00:00:00" AND i.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,COUNT(uc.id) priseCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='AlbumItem'   AND uc.create_time>"2014-08-07 00:00:00" AND uc.create_time<"2014-08-08 00:00:00"   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(uc.id) comCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='SystemComment'   AND uc.create_time>="2014-08-07 00:00:00" AND uc.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) c ON l.id=c.locid  WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.013001s ]
SQL: SELECT a.rname a,l.name b,d.name c,a.age d FROM (SELECT u.id uid,u.real_name rname,u.location_id locid,u.dept_id depId,(2014-(SELECT SUBSTR(u.identify_value,7,4))+0) age FROM app_user u WHERE NOT EXISTS ( SELECT lo.user_id FROM login_log lo WHERE u.id=lo.user_id  ) AND u.id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422) )) a,location l,department d WHERE a.depId=d.id AND a.locid=l.id [ RunTime:2.110120s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) AND lo.login_time>="2014-08-07 00:00:00" AND lo.login_time<"2014-08-08 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.368021s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) AND lo.login_time>="2014-08-07 00:00:00" AND lo.login_time<"2014-08-08 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.373022s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) AND lo.login_time>="2014-08-07 00:00:00" AND lo.login_time<"2014-08-08 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.444025s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) AND lo.login_time>="2014-08-07 00:00:00" AND lo.login_time<"2014-08-08 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.491028s ]
SQL: SELECT l.name,COALESCE(a.ulcount,0) b FROM  location l LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>=(TIMESTAMP(ADDDATE(DATE(SYSDATE()),-(DAYOFWEEK(NOW())-2))))   GROUP BY ud.locid) a ON a.locid=l.id WHERE l.id IN (24521,24543,24561,28422) [ RunTime:0.159009s ]
INFO: [ view_parse ] --START--
INFO: ParseTemplate Behavior ::run [ RunTime:0.532030s ]
INFO: [ view_parse ] --END-- [ RunTime:0.537030s ]
INFO: [ view_filter ] --START--
INFO: ContentReplace Behavior ::run [ RunTime:0.012001s ]
INFO: TokenBuild Behavior ::run [ RunTime:0.012001s ]
INFO: WriteHtmlCache Behavior ::run [ RunTime:0.004000s ]
INFO: ShowRuntime Behavior ::run [ RunTime:0.017001s ]
INFO: [ view_filter ] --END-- [ RunTime:0.063003s ]
INFO: [ view_end ] --START--
INFO: ShowPageTrace Behavior ::run [ RunTime:0.016001s ]
INFO: [ view_end ] --END-- [ RunTime:0.022001s ]

[ 2014-08-08T11:57:50+08:00 ] 127.0.0.1 /php_demo/shizhan/10/10wish/index.php/Njb/Index/tongji?checkbox%5B%5D=24521&checkbox%5B%5D=24543
INFO: [ route_check ] --START--
INFO: CheckRoute Behavior ::run [ RunTime:0.006000s ]
INFO: [ route_check ] --END-- [ RunTime:0.011000s ]
INFO: [ app_begin ] --START--
INFO: ReadHtmlCache Behavior ::run [ RunTime:0.010001s ]
INFO: [ app_begin ] --END-- [ RunTime:0.016001s ]
NOTIC: [8] Undefined variable: district_num D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 19 行.
NOTIC: [2] Invalid argument supplied for foreach() D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 19 行.
NOTIC: [8] Array to string conversion D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 24 行.
NOTIC: [8] Array to string conversion D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 24 行.
NOTIC: [8] Array to string conversion D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 24 行.
NOTIC: [8] Array to string conversion D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 24 行.
NOTIC: [8] Array to string conversion D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 24 行.
NOTIC: [8] Array to string conversion D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 25 行.
NOTIC: [8] Array to string conversion D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 25 行.
NOTIC: [8] Array to string conversion D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 25 行.
NOTIC: [8] Array to string conversion D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 26 行.
NOTIC: [8] Array to string conversion D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 26 行.
NOTIC: [8] Array to string conversion D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 26 行.
NOTIC: [8] Array to string conversion D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 26 行.
NOTIC: [8] Array to string conversion D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 26 行.
NOTIC: [8] Array to string conversion D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 26 行.
NOTIC: [8] Array to string conversion D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 26 行.
NOTIC: [8] Array to string conversion D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 27 行.
NOTIC: [8] Array to string conversion D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 27 行.
NOTIC: [8] Array to string conversion D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 27 行.
NOTIC: [8] Array to string conversion D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 27 行.
NOTIC: [8] Array to string conversion D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 27 行.
NOTIC: [8] Array to string conversion D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 27 行.
NOTIC: [8] Array to string conversion D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 27 行.
NOTIC: [8] Array to string conversion D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 27 行.
NOTIC: [8] Array to string conversion D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 27 行.
NOTIC: [8] Array to string conversion D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 28 行.
NOTIC: [8] Array to string conversion D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 28 行.
NOTIC: [8] Array to string conversion D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 28 行.
NOTIC: [8] Array to string conversion D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 28 行.
NOTIC: [8] Array to string conversion D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 28 行.
NOTIC: [8] Array to string conversion D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 28 行.
NOTIC: [8] Array to string conversion D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 28 行.
NOTIC: [8] Array to string conversion D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 29 行.
NOTIC: [8] Array to string conversion D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 29 行.
NOTIC: [8] Array to string conversion D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 34 行.
NOTIC: [8] Array to string conversion D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 34 行.
NOTIC: [8] Array to string conversion D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 34 行.
NOTIC: [8] Array to string conversion D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 35 行.
NOTIC: [8] Array to string conversion D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 35 行.
NOTIC: [8] Array to string conversion D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 35 行.
SQL: SELECT l.name,COALESCE(a.ucount,0) as yhs,COALESCE(c.ulcount,0) as dlyhs,COALESCE(c.logCount,0) as dlcs FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(ud.id) ucount FROM   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(Array)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(Array)) ud     GROUP BY ud.locid  ) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(Array)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(Array)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>="2014-08-07 00:00:00" AND lo.login_time<"2014-08-08 00:00:00"   GROUP BY ud.locid) c ON l.id=c.locid WHERE l.id IN(Array) [ RunTime:0.002000s ]
ERR: 1054:Unknown column 'Array' in 'where clause'
 [ SQL语句 ] : SELECT l.name,COALESCE(a.ucount,0) as yhs,COALESCE(c.ulcount,0) as dlyhs,COALESCE(c.logCount,0) as dlcs FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(ud.id) ucount FROM   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(Array)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(Array)) ud     GROUP BY ud.locid  ) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(Array)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(Array)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>="2014-08-07 00:00:00" AND lo.login_time<"2014-08-08 00:00:00"   GROUP BY ud.locid) c ON l.id=c.locid WHERE l.id IN(Array)
SQL: SELECT l.name,COALESCE(a.noticeCount,0) noticeCount,COALESCE(a.userCount,0) userCount FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(n.id) noticeCount,COUNT(DISTINCT ud.id) userCount FROM notice n,   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(Array)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(Array)) ud   WHERE n.owner_id=ud.id AND n.publish_time>="2014-08-07 00:00:00"    AND n.publish_time<"2014-08-08 00:00:00" GROUP BY ud.locid) a  ON l.id=a.locid WHERE l.id IN(Array) [ RunTime:0.001000s ]
ERR: 1054:Unknown column 'Array' in 'where clause'
 [ SQL语句 ] : SELECT l.name,COALESCE(a.noticeCount,0) noticeCount,COALESCE(a.userCount,0) userCount FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(n.id) noticeCount,COUNT(DISTINCT ud.id) userCount FROM notice n,   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(Array)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(Array)) ud   WHERE n.owner_id=ud.id AND n.publish_time>="2014-08-07 00:00:00"    AND n.publish_time<"2014-08-08 00:00:00" GROUP BY ud.locid) a  ON l.id=a.locid WHERE l.id IN(Array)
SQL: SELECT l.name,COALESCE(a.asCount,0) a,COALESCE(b.adminCount,0) b,COALESCE(c.noAdminCount,0) c FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(t.id) asCount FROM assignment t,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(Array)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(Array)) ud  WHERE t.creator_id=ud.id AND t.create_time>="2014-08-07 00:00:00" AND  t.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) adminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(Array)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(Array)) ud   WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='TechAdmin'   AND t.create_time>="2014-08-07 00:00:00" AND  t.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) noAdminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(Array)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(Array)) ud  WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='Technician'   AND t.create_time>="2014-08-07 00:00:00" AND  t.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid ) c ON l.id=c.locid  WHERE l.id IN(Array) [ RunTime:0.002001s ]
ERR: 1054:Unknown column 'Array' in 'where clause'
 [ SQL语句 ] : SELECT l.name,COALESCE(a.asCount,0) a,COALESCE(b.adminCount,0) b,COALESCE(c.noAdminCount,0) c FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(t.id) asCount FROM assignment t,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(Array)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(Array)) ud  WHERE t.creator_id=ud.id AND t.create_time>="2014-08-07 00:00:00" AND  t.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) adminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(Array)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(Array)) ud   WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='TechAdmin'   AND t.create_time>="2014-08-07 00:00:00" AND  t.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) noAdminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(Array)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(Array)) ud  WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='Technician'   AND t.create_time>="2014-08-07 00:00:00" AND  t.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid ) c ON l.id=c.locid  WHERE l.id IN(Array)
SQL: SELECT l.name,COALESCE(a.worklogCount,0) a,COALESCE(a.uCount,0) b,COALESCE(b.docCount,0) c,COALESCE(c.phoCount,0) d,COALESCE(d.audioCount,0) e FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(DISTINCT w.id) worklogCount,COUNT(DISTINCT w.owner_id) uCount FROM work_log w,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(Array)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(Array)) ud  WHERE w.owner_id=ud.id    AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) docCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(Array)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(Array)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  AND i.media_type=1   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) phoCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(Array)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(Array)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  AND i.media_type=2   GROUP BY ud.locid ) c ON l.id=c.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) audioCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(Array)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(Array)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  AND i.media_type=3   GROUP BY ud.locid ) d ON l.id=d.locid   WHERE l.id IN(Array) [ RunTime:0.002000s ]
ERR: 1054:Unknown column 'Array' in 'where clause'
 [ SQL语句 ] : SELECT l.name,COALESCE(a.worklogCount,0) a,COALESCE(a.uCount,0) b,COALESCE(b.docCount,0) c,COALESCE(c.phoCount,0) d,COALESCE(d.audioCount,0) e FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(DISTINCT w.id) worklogCount,COUNT(DISTINCT w.owner_id) uCount FROM work_log w,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(Array)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(Array)) ud  WHERE w.owner_id=ud.id    AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) docCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(Array)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(Array)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  AND i.media_type=1   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) phoCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(Array)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(Array)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  AND i.media_type=2   GROUP BY ud.locid ) c ON l.id=c.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) audioCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(Array)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(Array)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  AND i.media_type=3   GROUP BY ud.locid ) d ON l.id=d.locid   WHERE l.id IN(Array)
SQL: SELECT l.name,COALESCE(a.photoCount,0) a,COALESCE(a.ucount,0) b,COALESCE(b.priseCount,0) c,COALESCE(c.comCount,0) d FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(i.id) photoCount,COUNT(DISTINCT ud.id) ucount FROM album m,album_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(Array)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(Array)) ud  WHERE m.owner_id=ud.id AND i.album_id=m.id   AND i.create_time>="2014-08-07 00:00:00" AND i.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,COUNT(uc.id) priseCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(Array)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(Array)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='AlbumItem'   AND uc.create_time>"2014-08-07 00:00:00" AND uc.create_time<"2014-08-08 00:00:00"   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(uc.id) comCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(Array)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(Array)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='SystemComment'   AND uc.create_time>="2014-08-07 00:00:00" AND uc.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) c ON l.id=c.locid  WHERE l.id IN(Array) [ RunTime:0.001000s ]
ERR: 1054:Unknown column 'Array' in 'where clause'
 [ SQL语句 ] : SELECT l.name,COALESCE(a.photoCount,0) a,COALESCE(a.ucount,0) b,COALESCE(b.priseCount,0) c,COALESCE(c.comCount,0) d FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(i.id) photoCount,COUNT(DISTINCT ud.id) ucount FROM album m,album_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(Array)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(Array)) ud  WHERE m.owner_id=ud.id AND i.album_id=m.id   AND i.create_time>="2014-08-07 00:00:00" AND i.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,COUNT(uc.id) priseCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(Array)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(Array)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='AlbumItem'   AND uc.create_time>"2014-08-07 00:00:00" AND uc.create_time<"2014-08-08 00:00:00"   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(uc.id) comCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(Array)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(Array)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='SystemComment'   AND uc.create_time>="2014-08-07 00:00:00" AND uc.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) c ON l.id=c.locid  WHERE l.id IN(Array)
SQL: SELECT a.rname a,l.name b,d.name c,a.age d FROM (SELECT u.id uid,u.real_name rname,u.location_id locid,u.dept_id depId,(2014-(SELECT SUBSTR(u.identify_value,7,4))+0) age FROM app_user u WHERE NOT EXISTS ( SELECT lo.user_id FROM login_log lo WHERE u.id=lo.user_id  ) AND u.id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(Array)   UNION ALL SELECT u.id FROM app_user u WHERE u.location_id IN(Array) )) a,location l,department d WHERE a.depId=d.id AND a.locid=l.id [ RunTime:0.002000s ]
ERR: 1054:Unknown column 'Array' in 'where clause'
 [ SQL语句 ] : SELECT a.rname a,l.name b,d.name c,a.age d FROM (SELECT u.id uid,u.real_name rname,u.location_id locid,u.dept_id depId,(2014-(SELECT SUBSTR(u.identify_value,7,4))+0) age FROM app_user u WHERE NOT EXISTS ( SELECT lo.user_id FROM login_log lo WHERE u.id=lo.user_id  ) AND u.id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(Array)   UNION ALL SELECT u.id FROM app_user u WHERE u.location_id IN(Array) )) a,location l,department d WHERE a.depId=d.id AND a.locid=l.id
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) AND lo.login_time>="2014-08-07 00:00:00" AND lo.login_time<"2014-08-08 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.392023s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) AND lo.login_time>="2014-08-07 00:00:00" AND lo.login_time<"2014-08-08 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.410024s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) AND lo.login_time>="2014-08-07 00:00:00" AND lo.login_time<"2014-08-08 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.464027s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) AND lo.login_time>="2014-08-07 00:00:00" AND lo.login_time<"2014-08-08 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.457026s ]
SQL: SELECT l.name,COALESCE(a.ulcount,0) b FROM  location l LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(Array)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(Array)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>=(TIMESTAMP(ADDDATE(DATE(SYSDATE()),-(DAYOFWEEK(NOW())-2))))   GROUP BY ud.locid) a ON a.locid=l.id WHERE l.id IN (Array) [ RunTime:0.002000s ]
ERR: 1054:Unknown column 'Array' in 'where clause'
 [ SQL语句 ] : SELECT l.name,COALESCE(a.ulcount,0) b FROM  location l LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(Array)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(Array)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>=(TIMESTAMP(ADDDATE(DATE(SYSDATE()),-(DAYOFWEEK(NOW())-2))))   GROUP BY ud.locid) a ON a.locid=l.id WHERE l.id IN (Array)
INFO: [ view_parse ] --START--
INFO: ParseTemplate Behavior ::run [ RunTime:0.536031s ]
INFO: [ view_parse ] --END-- [ RunTime:0.542031s ]
INFO: [ view_filter ] --START--
INFO: ContentReplace Behavior ::run [ RunTime:0.010001s ]
INFO: TokenBuild Behavior ::run [ RunTime:0.010001s ]
INFO: WriteHtmlCache Behavior ::run [ RunTime:0.004000s ]
INFO: ShowRuntime Behavior ::run [ RunTime:0.013001s ]
INFO: [ view_filter ] --END-- [ RunTime:0.054003s ]
INFO: [ view_end ] --START--
INFO: ShowPageTrace Behavior ::run [ RunTime:0.009000s ]
INFO: [ view_end ] --END-- [ RunTime:0.013000s ]

[ 2014-08-08T11:57:58+08:00 ] 127.0.0.1 /php_demo/shizhan/10/10wish/index.php/Njb/Index/tongji?checkbox%5B%5D=24521&checkbox%5B%5D=24543
INFO: [ route_check ] --START--
INFO: CheckRoute Behavior ::run [ RunTime:0.007000s ]
INFO: [ route_check ] --END-- [ RunTime:0.011000s ]
INFO: [ app_begin ] --START--
INFO: ReadHtmlCache Behavior ::run [ RunTime:0.008001s ]
INFO: [ app_begin ] --END-- [ RunTime:0.013001s ]
NOTIC: [8] Undefined variable: district_num D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 19 行.
NOTIC: [2] Invalid argument supplied for foreach() D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 19 行.
NOTIC: [8] Array to string conversion D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 24 行.
NOTIC: [8] Array to string conversion D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 24 行.
NOTIC: [8] Array to string conversion D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 24 行.
NOTIC: [8] Array to string conversion D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 24 行.
NOTIC: [8] Array to string conversion D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 24 行.
NOTIC: [8] Array to string conversion D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 25 行.
NOTIC: [8] Array to string conversion D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 25 行.
NOTIC: [8] Array to string conversion D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 25 行.
NOTIC: [8] Array to string conversion D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 26 行.
NOTIC: [8] Array to string conversion D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 26 行.
NOTIC: [8] Array to string conversion D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 26 行.
NOTIC: [8] Array to string conversion D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 26 行.
NOTIC: [8] Array to string conversion D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 26 行.
NOTIC: [8] Array to string conversion D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 26 行.
NOTIC: [8] Array to string conversion D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 26 行.
NOTIC: [8] Array to string conversion D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 27 行.
NOTIC: [8] Array to string conversion D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 27 行.
NOTIC: [8] Array to string conversion D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 27 行.
NOTIC: [8] Array to string conversion D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 27 行.
NOTIC: [8] Array to string conversion D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 27 行.
NOTIC: [8] Array to string conversion D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 27 行.
NOTIC: [8] Array to string conversion D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 27 行.
NOTIC: [8] Array to string conversion D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 27 行.
NOTIC: [8] Array to string conversion D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 27 行.
NOTIC: [8] Array to string conversion D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 28 行.
NOTIC: [8] Array to string conversion D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 28 行.
NOTIC: [8] Array to string conversion D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 28 行.
NOTIC: [8] Array to string conversion D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 28 行.
NOTIC: [8] Array to string conversion D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 28 行.
NOTIC: [8] Array to string conversion D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 28 行.
NOTIC: [8] Array to string conversion D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 28 行.
NOTIC: [8] Array to string conversion D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 29 行.
NOTIC: [8] Array to string conversion D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 29 行.
NOTIC: [8] Array to string conversion D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 34 行.
NOTIC: [8] Array to string conversion D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 34 行.
NOTIC: [8] Array to string conversion D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 34 行.
NOTIC: [8] Array to string conversion D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 35 行.
NOTIC: [8] Array to string conversion D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 35 行.
NOTIC: [8] Array to string conversion D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 35 行.
SQL: SELECT l.name,COALESCE(a.ucount,0) as yhs,COALESCE(c.ulcount,0) as dlyhs,COALESCE(c.logCount,0) as dlcs FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(ud.id) ucount FROM   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(Array)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(Array)) ud     GROUP BY ud.locid  ) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(Array)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(Array)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>="2014-08-07 00:00:00" AND lo.login_time<"2014-08-08 00:00:00"   GROUP BY ud.locid) c ON l.id=c.locid WHERE l.id IN(Array) [ RunTime:0.002000s ]
ERR: 1054:Unknown column 'Array' in 'where clause'
 [ SQL语句 ] : SELECT l.name,COALESCE(a.ucount,0) as yhs,COALESCE(c.ulcount,0) as dlyhs,COALESCE(c.logCount,0) as dlcs FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(ud.id) ucount FROM   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(Array)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(Array)) ud     GROUP BY ud.locid  ) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(Array)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(Array)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>="2014-08-07 00:00:00" AND lo.login_time<"2014-08-08 00:00:00"   GROUP BY ud.locid) c ON l.id=c.locid WHERE l.id IN(Array)
SQL: SELECT l.name,COALESCE(a.noticeCount,0) noticeCount,COALESCE(a.userCount,0) userCount FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(n.id) noticeCount,COUNT(DISTINCT ud.id) userCount FROM notice n,   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(Array)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(Array)) ud   WHERE n.owner_id=ud.id AND n.publish_time>="2014-08-07 00:00:00"    AND n.publish_time<"2014-08-08 00:00:00" GROUP BY ud.locid) a  ON l.id=a.locid WHERE l.id IN(Array) [ RunTime:0.001000s ]
ERR: 1054:Unknown column 'Array' in 'where clause'
 [ SQL语句 ] : SELECT l.name,COALESCE(a.noticeCount,0) noticeCount,COALESCE(a.userCount,0) userCount FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(n.id) noticeCount,COUNT(DISTINCT ud.id) userCount FROM notice n,   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(Array)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(Array)) ud   WHERE n.owner_id=ud.id AND n.publish_time>="2014-08-07 00:00:00"    AND n.publish_time<"2014-08-08 00:00:00" GROUP BY ud.locid) a  ON l.id=a.locid WHERE l.id IN(Array)
SQL: SELECT l.name,COALESCE(a.asCount,0) a,COALESCE(b.adminCount,0) b,COALESCE(c.noAdminCount,0) c FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(t.id) asCount FROM assignment t,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(Array)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(Array)) ud  WHERE t.creator_id=ud.id AND t.create_time>="2014-08-07 00:00:00" AND  t.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) adminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(Array)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(Array)) ud   WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='TechAdmin'   AND t.create_time>="2014-08-07 00:00:00" AND  t.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) noAdminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(Array)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(Array)) ud  WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='Technician'   AND t.create_time>="2014-08-07 00:00:00" AND  t.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid ) c ON l.id=c.locid  WHERE l.id IN(Array) [ RunTime:0.002000s ]
ERR: 1054:Unknown column 'Array' in 'where clause'
 [ SQL语句 ] : SELECT l.name,COALESCE(a.asCount,0) a,COALESCE(b.adminCount,0) b,COALESCE(c.noAdminCount,0) c FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(t.id) asCount FROM assignment t,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(Array)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(Array)) ud  WHERE t.creator_id=ud.id AND t.create_time>="2014-08-07 00:00:00" AND  t.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) adminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(Array)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(Array)) ud   WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='TechAdmin'   AND t.create_time>="2014-08-07 00:00:00" AND  t.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) noAdminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(Array)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(Array)) ud  WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='Technician'   AND t.create_time>="2014-08-07 00:00:00" AND  t.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid ) c ON l.id=c.locid  WHERE l.id IN(Array)
SQL: SELECT l.name,COALESCE(a.worklogCount,0) a,COALESCE(a.uCount,0) b,COALESCE(b.docCount,0) c,COALESCE(c.phoCount,0) d,COALESCE(d.audioCount,0) e FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(DISTINCT w.id) worklogCount,COUNT(DISTINCT w.owner_id) uCount FROM work_log w,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(Array)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(Array)) ud  WHERE w.owner_id=ud.id    AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) docCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(Array)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(Array)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  AND i.media_type=1   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) phoCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(Array)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(Array)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  AND i.media_type=2   GROUP BY ud.locid ) c ON l.id=c.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) audioCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(Array)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(Array)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  AND i.media_type=3   GROUP BY ud.locid ) d ON l.id=d.locid   WHERE l.id IN(Array) [ RunTime:0.002000s ]
ERR: 1054:Unknown column 'Array' in 'where clause'
 [ SQL语句 ] : SELECT l.name,COALESCE(a.worklogCount,0) a,COALESCE(a.uCount,0) b,COALESCE(b.docCount,0) c,COALESCE(c.phoCount,0) d,COALESCE(d.audioCount,0) e FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(DISTINCT w.id) worklogCount,COUNT(DISTINCT w.owner_id) uCount FROM work_log w,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(Array)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(Array)) ud  WHERE w.owner_id=ud.id    AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) docCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(Array)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(Array)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  AND i.media_type=1   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) phoCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(Array)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(Array)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  AND i.media_type=2   GROUP BY ud.locid ) c ON l.id=c.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) audioCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(Array)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(Array)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  AND i.media_type=3   GROUP BY ud.locid ) d ON l.id=d.locid   WHERE l.id IN(Array)
SQL: SELECT l.name,COALESCE(a.photoCount,0) a,COALESCE(a.ucount,0) b,COALESCE(b.priseCount,0) c,COALESCE(c.comCount,0) d FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(i.id) photoCount,COUNT(DISTINCT ud.id) ucount FROM album m,album_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(Array)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(Array)) ud  WHERE m.owner_id=ud.id AND i.album_id=m.id   AND i.create_time>="2014-08-07 00:00:00" AND i.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,COUNT(uc.id) priseCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(Array)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(Array)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='AlbumItem'   AND uc.create_time>"2014-08-07 00:00:00" AND uc.create_time<"2014-08-08 00:00:00"   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(uc.id) comCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(Array)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(Array)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='SystemComment'   AND uc.create_time>="2014-08-07 00:00:00" AND uc.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) c ON l.id=c.locid  WHERE l.id IN(Array) [ RunTime:0.002000s ]
ERR: 1054:Unknown column 'Array' in 'where clause'
 [ SQL语句 ] : SELECT l.name,COALESCE(a.photoCount,0) a,COALESCE(a.ucount,0) b,COALESCE(b.priseCount,0) c,COALESCE(c.comCount,0) d FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(i.id) photoCount,COUNT(DISTINCT ud.id) ucount FROM album m,album_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(Array)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(Array)) ud  WHERE m.owner_id=ud.id AND i.album_id=m.id   AND i.create_time>="2014-08-07 00:00:00" AND i.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,COUNT(uc.id) priseCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(Array)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(Array)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='AlbumItem'   AND uc.create_time>"2014-08-07 00:00:00" AND uc.create_time<"2014-08-08 00:00:00"   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(uc.id) comCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(Array)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(Array)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='SystemComment'   AND uc.create_time>="2014-08-07 00:00:00" AND uc.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) c ON l.id=c.locid  WHERE l.id IN(Array)
SQL: SELECT a.rname a,l.name b,d.name c,a.age d FROM (SELECT u.id uid,u.real_name rname,u.location_id locid,u.dept_id depId,(2014-(SELECT SUBSTR(u.identify_value,7,4))+0) age FROM app_user u WHERE NOT EXISTS ( SELECT lo.user_id FROM login_log lo WHERE u.id=lo.user_id  ) AND u.id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(Array)   UNION ALL SELECT u.id FROM app_user u WHERE u.location_id IN(Array) )) a,location l,department d WHERE a.depId=d.id AND a.locid=l.id [ RunTime:0.001000s ]
ERR: 1054:Unknown column 'Array' in 'where clause'
 [ SQL语句 ] : SELECT a.rname a,l.name b,d.name c,a.age d FROM (SELECT u.id uid,u.real_name rname,u.location_id locid,u.dept_id depId,(2014-(SELECT SUBSTR(u.identify_value,7,4))+0) age FROM app_user u WHERE NOT EXISTS ( SELECT lo.user_id FROM login_log lo WHERE u.id=lo.user_id  ) AND u.id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(Array)   UNION ALL SELECT u.id FROM app_user u WHERE u.location_id IN(Array) )) a,location l,department d WHERE a.depId=d.id AND a.locid=l.id
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) AND lo.login_time>="2014-08-07 00:00:00" AND lo.login_time<"2014-08-08 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.369021s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) AND lo.login_time>="2014-08-07 00:00:00" AND lo.login_time<"2014-08-08 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.364021s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) AND lo.login_time>="2014-08-07 00:00:00" AND lo.login_time<"2014-08-08 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.374022s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) AND lo.login_time>="2014-08-07 00:00:00" AND lo.login_time<"2014-08-08 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.371021s ]
SQL: SELECT l.name,COALESCE(a.ulcount,0) b FROM  location l LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(Array)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(Array)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>=(TIMESTAMP(ADDDATE(DATE(SYSDATE()),-(DAYOFWEEK(NOW())-2))))   GROUP BY ud.locid) a ON a.locid=l.id WHERE l.id IN (Array) [ RunTime:0.002000s ]
ERR: 1054:Unknown column 'Array' in 'where clause'
 [ SQL语句 ] : SELECT l.name,COALESCE(a.ulcount,0) b FROM  location l LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(Array)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(Array)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>=(TIMESTAMP(ADDDATE(DATE(SYSDATE()),-(DAYOFWEEK(NOW())-2))))   GROUP BY ud.locid) a ON a.locid=l.id WHERE l.id IN (Array)
INFO: [ view_parse ] --START--
INFO: ParseTemplate Behavior ::run [ RunTime:0.514029s ]
INFO: [ view_parse ] --END-- [ RunTime:0.520030s ]
INFO: [ view_filter ] --START--
INFO: ContentReplace Behavior ::run [ RunTime:0.007000s ]
INFO: TokenBuild Behavior ::run [ RunTime:0.014000s ]
INFO: WriteHtmlCache Behavior ::run [ RunTime:0.005000s ]
INFO: ShowRuntime Behavior ::run [ RunTime:0.015001s ]
INFO: [ view_filter ] --END-- [ RunTime:0.057003s ]
INFO: [ view_end ] --START--
INFO: ShowPageTrace Behavior ::run [ RunTime:0.008000s ]
INFO: [ view_end ] --END-- [ RunTime:0.013001s ]

[ 2014-08-08T11:58:21+08:00 ] 127.0.0.1 /php_demo/shizhan/10/10wish/index.php/Njb/Index/tongji?checkbox%5B%5D=24521&checkbox%5B%5D=24543
INFO: [ route_check ] --START--
INFO: CheckRoute Behavior ::run [ RunTime:0.008001s ]
INFO: [ route_check ] --END-- [ RunTime:0.013001s ]
INFO: [ app_begin ] --START--
INFO: ReadHtmlCache Behavior ::run [ RunTime:0.010001s ]
INFO: [ app_begin ] --END-- [ RunTime:0.015001s ]
NOTIC: [8] Undefined variable: district_num D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 18 行.
NOTIC: [2] Invalid argument supplied for foreach() D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 18 行.
NOTIC: [8] Array to string conversion D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 24 行.
NOTIC: [8] Array to string conversion D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 24 行.
NOTIC: [8] Array to string conversion D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 24 行.
NOTIC: [8] Array to string conversion D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 24 行.
NOTIC: [8] Array to string conversion D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 24 行.
NOTIC: [8] Array to string conversion D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 25 行.
NOTIC: [8] Array to string conversion D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 25 行.
NOTIC: [8] Array to string conversion D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 25 行.
NOTIC: [8] Array to string conversion D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 26 行.
NOTIC: [8] Array to string conversion D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 26 行.
NOTIC: [8] Array to string conversion D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 26 行.
NOTIC: [8] Array to string conversion D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 26 行.
NOTIC: [8] Array to string conversion D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 26 行.
NOTIC: [8] Array to string conversion D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 26 行.
NOTIC: [8] Array to string conversion D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 26 行.
NOTIC: [8] Array to string conversion D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 27 行.
NOTIC: [8] Array to string conversion D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 27 行.
NOTIC: [8] Array to string conversion D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 27 行.
NOTIC: [8] Array to string conversion D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 27 行.
NOTIC: [8] Array to string conversion D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 27 行.
NOTIC: [8] Array to string conversion D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 27 行.
NOTIC: [8] Array to string conversion D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 27 行.
NOTIC: [8] Array to string conversion D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 27 行.
NOTIC: [8] Array to string conversion D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 27 行.
NOTIC: [8] Array to string conversion D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 28 行.
NOTIC: [8] Array to string conversion D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 28 行.
NOTIC: [8] Array to string conversion D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 28 行.
NOTIC: [8] Array to string conversion D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 28 行.
NOTIC: [8] Array to string conversion D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 28 行.
NOTIC: [8] Array to string conversion D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 28 行.
NOTIC: [8] Array to string conversion D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 28 行.
NOTIC: [8] Array to string conversion D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 29 行.
NOTIC: [8] Array to string conversion D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 29 行.
NOTIC: [8] Array to string conversion D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 34 行.
NOTIC: [8] Array to string conversion D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 34 行.
NOTIC: [8] Array to string conversion D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 34 行.
NOTIC: [8] Array to string conversion D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 35 行.
NOTIC: [8] Array to string conversion D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 35 行.
NOTIC: [8] Array to string conversion D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 35 行.
SQL: SELECT l.name,COALESCE(a.ucount,0) as yhs,COALESCE(c.ulcount,0) as dlyhs,COALESCE(c.logCount,0) as dlcs FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(ud.id) ucount FROM   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(Array)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(Array)) ud     GROUP BY ud.locid  ) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(Array)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(Array)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>="2014-08-07 00:00:00" AND lo.login_time<"2014-08-08 00:00:00"   GROUP BY ud.locid) c ON l.id=c.locid WHERE l.id IN(Array) [ RunTime:0.001000s ]
ERR: 1054:Unknown column 'Array' in 'where clause'
 [ SQL语句 ] : SELECT l.name,COALESCE(a.ucount,0) as yhs,COALESCE(c.ulcount,0) as dlyhs,COALESCE(c.logCount,0) as dlcs FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(ud.id) ucount FROM   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(Array)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(Array)) ud     GROUP BY ud.locid  ) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(Array)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(Array)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>="2014-08-07 00:00:00" AND lo.login_time<"2014-08-08 00:00:00"   GROUP BY ud.locid) c ON l.id=c.locid WHERE l.id IN(Array)
SQL: SELECT l.name,COALESCE(a.noticeCount,0) noticeCount,COALESCE(a.userCount,0) userCount FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(n.id) noticeCount,COUNT(DISTINCT ud.id) userCount FROM notice n,   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(Array)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(Array)) ud   WHERE n.owner_id=ud.id AND n.publish_time>="2014-08-07 00:00:00"    AND n.publish_time<"2014-08-08 00:00:00" GROUP BY ud.locid) a  ON l.id=a.locid WHERE l.id IN(Array) [ RunTime:0.002000s ]
ERR: 1054:Unknown column 'Array' in 'where clause'
 [ SQL语句 ] : SELECT l.name,COALESCE(a.noticeCount,0) noticeCount,COALESCE(a.userCount,0) userCount FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(n.id) noticeCount,COUNT(DISTINCT ud.id) userCount FROM notice n,   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(Array)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(Array)) ud   WHERE n.owner_id=ud.id AND n.publish_time>="2014-08-07 00:00:00"    AND n.publish_time<"2014-08-08 00:00:00" GROUP BY ud.locid) a  ON l.id=a.locid WHERE l.id IN(Array)
SQL: SELECT l.name,COALESCE(a.asCount,0) a,COALESCE(b.adminCount,0) b,COALESCE(c.noAdminCount,0) c FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(t.id) asCount FROM assignment t,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(Array)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(Array)) ud  WHERE t.creator_id=ud.id AND t.create_time>="2014-08-07 00:00:00" AND  t.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) adminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(Array)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(Array)) ud   WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='TechAdmin'   AND t.create_time>="2014-08-07 00:00:00" AND  t.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) noAdminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(Array)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(Array)) ud  WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='Technician'   AND t.create_time>="2014-08-07 00:00:00" AND  t.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid ) c ON l.id=c.locid  WHERE l.id IN(Array) [ RunTime:0.002000s ]
ERR: 1054:Unknown column 'Array' in 'where clause'
 [ SQL语句 ] : SELECT l.name,COALESCE(a.asCount,0) a,COALESCE(b.adminCount,0) b,COALESCE(c.noAdminCount,0) c FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(t.id) asCount FROM assignment t,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(Array)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(Array)) ud  WHERE t.creator_id=ud.id AND t.create_time>="2014-08-07 00:00:00" AND  t.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) adminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(Array)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(Array)) ud   WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='TechAdmin'   AND t.create_time>="2014-08-07 00:00:00" AND  t.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) noAdminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(Array)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(Array)) ud  WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='Technician'   AND t.create_time>="2014-08-07 00:00:00" AND  t.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid ) c ON l.id=c.locid  WHERE l.id IN(Array)
SQL: SELECT l.name,COALESCE(a.worklogCount,0) a,COALESCE(a.uCount,0) b,COALESCE(b.docCount,0) c,COALESCE(c.phoCount,0) d,COALESCE(d.audioCount,0) e FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(DISTINCT w.id) worklogCount,COUNT(DISTINCT w.owner_id) uCount FROM work_log w,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(Array)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(Array)) ud  WHERE w.owner_id=ud.id    AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) docCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(Array)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(Array)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  AND i.media_type=1   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) phoCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(Array)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(Array)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  AND i.media_type=2   GROUP BY ud.locid ) c ON l.id=c.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) audioCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(Array)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(Array)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  AND i.media_type=3   GROUP BY ud.locid ) d ON l.id=d.locid   WHERE l.id IN(Array) [ RunTime:0.002000s ]
ERR: 1054:Unknown column 'Array' in 'where clause'
 [ SQL语句 ] : SELECT l.name,COALESCE(a.worklogCount,0) a,COALESCE(a.uCount,0) b,COALESCE(b.docCount,0) c,COALESCE(c.phoCount,0) d,COALESCE(d.audioCount,0) e FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(DISTINCT w.id) worklogCount,COUNT(DISTINCT w.owner_id) uCount FROM work_log w,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(Array)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(Array)) ud  WHERE w.owner_id=ud.id    AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) docCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(Array)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(Array)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  AND i.media_type=1   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) phoCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(Array)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(Array)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  AND i.media_type=2   GROUP BY ud.locid ) c ON l.id=c.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) audioCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(Array)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(Array)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  AND i.media_type=3   GROUP BY ud.locid ) d ON l.id=d.locid   WHERE l.id IN(Array)
SQL: SELECT l.name,COALESCE(a.photoCount,0) a,COALESCE(a.ucount,0) b,COALESCE(b.priseCount,0) c,COALESCE(c.comCount,0) d FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(i.id) photoCount,COUNT(DISTINCT ud.id) ucount FROM album m,album_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(Array)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(Array)) ud  WHERE m.owner_id=ud.id AND i.album_id=m.id   AND i.create_time>="2014-08-07 00:00:00" AND i.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,COUNT(uc.id) priseCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(Array)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(Array)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='AlbumItem'   AND uc.create_time>"2014-08-07 00:00:00" AND uc.create_time<"2014-08-08 00:00:00"   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(uc.id) comCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(Array)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(Array)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='SystemComment'   AND uc.create_time>="2014-08-07 00:00:00" AND uc.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) c ON l.id=c.locid  WHERE l.id IN(Array) [ RunTime:0.002000s ]
ERR: 1054:Unknown column 'Array' in 'where clause'
 [ SQL语句 ] : SELECT l.name,COALESCE(a.photoCount,0) a,COALESCE(a.ucount,0) b,COALESCE(b.priseCount,0) c,COALESCE(c.comCount,0) d FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(i.id) photoCount,COUNT(DISTINCT ud.id) ucount FROM album m,album_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(Array)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(Array)) ud  WHERE m.owner_id=ud.id AND i.album_id=m.id   AND i.create_time>="2014-08-07 00:00:00" AND i.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,COUNT(uc.id) priseCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(Array)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(Array)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='AlbumItem'   AND uc.create_time>"2014-08-07 00:00:00" AND uc.create_time<"2014-08-08 00:00:00"   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(uc.id) comCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(Array)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(Array)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='SystemComment'   AND uc.create_time>="2014-08-07 00:00:00" AND uc.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) c ON l.id=c.locid  WHERE l.id IN(Array)
SQL: SELECT a.rname a,l.name b,d.name c,a.age d FROM (SELECT u.id uid,u.real_name rname,u.location_id locid,u.dept_id depId,(2014-(SELECT SUBSTR(u.identify_value,7,4))+0) age FROM app_user u WHERE NOT EXISTS ( SELECT lo.user_id FROM login_log lo WHERE u.id=lo.user_id  ) AND u.id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(Array)   UNION ALL SELECT u.id FROM app_user u WHERE u.location_id IN(Array) )) a,location l,department d WHERE a.depId=d.id AND a.locid=l.id [ RunTime:0.001000s ]
ERR: 1054:Unknown column 'Array' in 'where clause'
 [ SQL语句 ] : SELECT a.rname a,l.name b,d.name c,a.age d FROM (SELECT u.id uid,u.real_name rname,u.location_id locid,u.dept_id depId,(2014-(SELECT SUBSTR(u.identify_value,7,4))+0) age FROM app_user u WHERE NOT EXISTS ( SELECT lo.user_id FROM login_log lo WHERE u.id=lo.user_id  ) AND u.id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(Array)   UNION ALL SELECT u.id FROM app_user u WHERE u.location_id IN(Array) )) a,location l,department d WHERE a.depId=d.id AND a.locid=l.id
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) AND lo.login_time>="2014-08-07 00:00:00" AND lo.login_time<"2014-08-08 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.470027s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) AND lo.login_time>="2014-08-07 00:00:00" AND lo.login_time<"2014-08-08 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.389022s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) AND lo.login_time>="2014-08-07 00:00:00" AND lo.login_time<"2014-08-08 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.374022s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) AND lo.login_time>="2014-08-07 00:00:00" AND lo.login_time<"2014-08-08 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.407024s ]
SQL: SELECT l.name,COALESCE(a.ulcount,0) b FROM  location l LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(Array)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(Array)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>=(TIMESTAMP(ADDDATE(DATE(SYSDATE()),-(DAYOFWEEK(NOW())-2))))   GROUP BY ud.locid) a ON a.locid=l.id WHERE l.id IN (Array) [ RunTime:0.001000s ]
ERR: 1054:Unknown column 'Array' in 'where clause'
 [ SQL语句 ] : SELECT l.name,COALESCE(a.ulcount,0) b FROM  location l LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(Array)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(Array)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>=(TIMESTAMP(ADDDATE(DATE(SYSDATE()),-(DAYOFWEEK(NOW())-2))))   GROUP BY ud.locid) a ON a.locid=l.id WHERE l.id IN (Array)
INFO: [ view_parse ] --START--
INFO: ParseTemplate Behavior ::run [ RunTime:0.536031s ]
INFO: [ view_parse ] --END-- [ RunTime:0.540031s ]
INFO: [ view_filter ] --START--
INFO: ContentReplace Behavior ::run [ RunTime:0.009001s ]
INFO: TokenBuild Behavior ::run [ RunTime:0.012001s ]
INFO: WriteHtmlCache Behavior ::run [ RunTime:0.006000s ]
INFO: ShowRuntime Behavior ::run [ RunTime:0.014000s ]
INFO: [ view_filter ] --END-- [ RunTime:0.059004s ]
INFO: [ view_end ] --START--
INFO: ShowPageTrace Behavior ::run [ RunTime:0.009001s ]
INFO: [ view_end ] --END-- [ RunTime:0.013001s ]

[ 2014-08-08T11:58:26+08:00 ] 127.0.0.1 /php_demo/shizhan/10/10wish/index.php/Njb/Index/tongji?checkbox%5B%5D=24521&checkbox%5B%5D=24543
INFO: [ route_check ] --START--
INFO: CheckRoute Behavior ::run [ RunTime:0.011001s ]
INFO: [ route_check ] --END-- [ RunTime:0.016001s ]
INFO: [ app_begin ] --START--
INFO: ReadHtmlCache Behavior ::run [ RunTime:0.012001s ]
INFO: [ app_begin ] --END-- [ RunTime:0.019001s ]
NOTIC: [8] Undefined variable: district_num D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 18 行.
NOTIC: [2] Invalid argument supplied for foreach() D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 18 行.
NOTIC: [8] Array to string conversion D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 24 行.
NOTIC: [8] Array to string conversion D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 24 行.
NOTIC: [8] Array to string conversion D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 24 行.
NOTIC: [8] Array to string conversion D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 24 行.
NOTIC: [8] Array to string conversion D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 24 行.
NOTIC: [8] Array to string conversion D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 25 行.
NOTIC: [8] Array to string conversion D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 25 行.
NOTIC: [8] Array to string conversion D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 25 行.
NOTIC: [8] Array to string conversion D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 26 行.
NOTIC: [8] Array to string conversion D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 26 行.
NOTIC: [8] Array to string conversion D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 26 行.
NOTIC: [8] Array to string conversion D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 26 行.
NOTIC: [8] Array to string conversion D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 26 行.
NOTIC: [8] Array to string conversion D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 26 行.
NOTIC: [8] Array to string conversion D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 26 行.
NOTIC: [8] Array to string conversion D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 27 行.
NOTIC: [8] Array to string conversion D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 27 行.
NOTIC: [8] Array to string conversion D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 27 行.
NOTIC: [8] Array to string conversion D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 27 行.
NOTIC: [8] Array to string conversion D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 27 行.
NOTIC: [8] Array to string conversion D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 27 行.
NOTIC: [8] Array to string conversion D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 27 行.
NOTIC: [8] Array to string conversion D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 27 行.
NOTIC: [8] Array to string conversion D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 27 行.
NOTIC: [8] Array to string conversion D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 28 行.
NOTIC: [8] Array to string conversion D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 28 行.
NOTIC: [8] Array to string conversion D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 28 行.
NOTIC: [8] Array to string conversion D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 28 行.
NOTIC: [8] Array to string conversion D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 28 行.
NOTIC: [8] Array to string conversion D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 28 行.
NOTIC: [8] Array to string conversion D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 28 行.
NOTIC: [8] Array to string conversion D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 29 行.
NOTIC: [8] Array to string conversion D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 29 行.
NOTIC: [8] Array to string conversion D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 34 行.
NOTIC: [8] Array to string conversion D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 34 行.
NOTIC: [8] Array to string conversion D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 34 行.
NOTIC: [8] Array to string conversion D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 35 行.
NOTIC: [8] Array to string conversion D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 35 行.
NOTIC: [8] Array to string conversion D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 35 行.
SQL: SELECT l.name,COALESCE(a.ucount,0) as yhs,COALESCE(c.ulcount,0) as dlyhs,COALESCE(c.logCount,0) as dlcs FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(ud.id) ucount FROM   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(Array)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(Array)) ud     GROUP BY ud.locid  ) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(Array)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(Array)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>="2014-08-07 00:00:00" AND lo.login_time<"2014-08-08 00:00:00"   GROUP BY ud.locid) c ON l.id=c.locid WHERE l.id IN(Array) [ RunTime:0.001000s ]
ERR: 1054:Unknown column 'Array' in 'where clause'
 [ SQL语句 ] : SELECT l.name,COALESCE(a.ucount,0) as yhs,COALESCE(c.ulcount,0) as dlyhs,COALESCE(c.logCount,0) as dlcs FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(ud.id) ucount FROM   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(Array)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(Array)) ud     GROUP BY ud.locid  ) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(Array)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(Array)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>="2014-08-07 00:00:00" AND lo.login_time<"2014-08-08 00:00:00"   GROUP BY ud.locid) c ON l.id=c.locid WHERE l.id IN(Array)
SQL: SELECT l.name,COALESCE(a.noticeCount,0) noticeCount,COALESCE(a.userCount,0) userCount FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(n.id) noticeCount,COUNT(DISTINCT ud.id) userCount FROM notice n,   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(Array)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(Array)) ud   WHERE n.owner_id=ud.id AND n.publish_time>="2014-08-07 00:00:00"    AND n.publish_time<"2014-08-08 00:00:00" GROUP BY ud.locid) a  ON l.id=a.locid WHERE l.id IN(Array) [ RunTime:0.002000s ]
ERR: 1054:Unknown column 'Array' in 'where clause'
 [ SQL语句 ] : SELECT l.name,COALESCE(a.noticeCount,0) noticeCount,COALESCE(a.userCount,0) userCount FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(n.id) noticeCount,COUNT(DISTINCT ud.id) userCount FROM notice n,   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(Array)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(Array)) ud   WHERE n.owner_id=ud.id AND n.publish_time>="2014-08-07 00:00:00"    AND n.publish_time<"2014-08-08 00:00:00" GROUP BY ud.locid) a  ON l.id=a.locid WHERE l.id IN(Array)
SQL: SELECT l.name,COALESCE(a.asCount,0) a,COALESCE(b.adminCount,0) b,COALESCE(c.noAdminCount,0) c FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(t.id) asCount FROM assignment t,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(Array)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(Array)) ud  WHERE t.creator_id=ud.id AND t.create_time>="2014-08-07 00:00:00" AND  t.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) adminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(Array)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(Array)) ud   WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='TechAdmin'   AND t.create_time>="2014-08-07 00:00:00" AND  t.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) noAdminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(Array)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(Array)) ud  WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='Technician'   AND t.create_time>="2014-08-07 00:00:00" AND  t.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid ) c ON l.id=c.locid  WHERE l.id IN(Array) [ RunTime:0.002000s ]
ERR: 1054:Unknown column 'Array' in 'where clause'
 [ SQL语句 ] : SELECT l.name,COALESCE(a.asCount,0) a,COALESCE(b.adminCount,0) b,COALESCE(c.noAdminCount,0) c FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(t.id) asCount FROM assignment t,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(Array)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(Array)) ud  WHERE t.creator_id=ud.id AND t.create_time>="2014-08-07 00:00:00" AND  t.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) adminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(Array)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(Array)) ud   WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='TechAdmin'   AND t.create_time>="2014-08-07 00:00:00" AND  t.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) noAdminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(Array)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(Array)) ud  WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='Technician'   AND t.create_time>="2014-08-07 00:00:00" AND  t.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid ) c ON l.id=c.locid  WHERE l.id IN(Array)
SQL: SELECT l.name,COALESCE(a.worklogCount,0) a,COALESCE(a.uCount,0) b,COALESCE(b.docCount,0) c,COALESCE(c.phoCount,0) d,COALESCE(d.audioCount,0) e FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(DISTINCT w.id) worklogCount,COUNT(DISTINCT w.owner_id) uCount FROM work_log w,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(Array)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(Array)) ud  WHERE w.owner_id=ud.id    AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) docCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(Array)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(Array)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  AND i.media_type=1   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) phoCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(Array)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(Array)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  AND i.media_type=2   GROUP BY ud.locid ) c ON l.id=c.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) audioCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(Array)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(Array)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  AND i.media_type=3   GROUP BY ud.locid ) d ON l.id=d.locid   WHERE l.id IN(Array) [ RunTime:0.002000s ]
ERR: 1054:Unknown column 'Array' in 'where clause'
 [ SQL语句 ] : SELECT l.name,COALESCE(a.worklogCount,0) a,COALESCE(a.uCount,0) b,COALESCE(b.docCount,0) c,COALESCE(c.phoCount,0) d,COALESCE(d.audioCount,0) e FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(DISTINCT w.id) worklogCount,COUNT(DISTINCT w.owner_id) uCount FROM work_log w,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(Array)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(Array)) ud  WHERE w.owner_id=ud.id    AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) docCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(Array)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(Array)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  AND i.media_type=1   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) phoCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(Array)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(Array)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  AND i.media_type=2   GROUP BY ud.locid ) c ON l.id=c.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) audioCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(Array)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(Array)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  AND i.media_type=3   GROUP BY ud.locid ) d ON l.id=d.locid   WHERE l.id IN(Array)
SQL: SELECT l.name,COALESCE(a.photoCount,0) a,COALESCE(a.ucount,0) b,COALESCE(b.priseCount,0) c,COALESCE(c.comCount,0) d FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(i.id) photoCount,COUNT(DISTINCT ud.id) ucount FROM album m,album_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(Array)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(Array)) ud  WHERE m.owner_id=ud.id AND i.album_id=m.id   AND i.create_time>="2014-08-07 00:00:00" AND i.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,COUNT(uc.id) priseCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(Array)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(Array)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='AlbumItem'   AND uc.create_time>"2014-08-07 00:00:00" AND uc.create_time<"2014-08-08 00:00:00"   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(uc.id) comCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(Array)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(Array)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='SystemComment'   AND uc.create_time>="2014-08-07 00:00:00" AND uc.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) c ON l.id=c.locid  WHERE l.id IN(Array) [ RunTime:0.002000s ]
ERR: 1054:Unknown column 'Array' in 'where clause'
 [ SQL语句 ] : SELECT l.name,COALESCE(a.photoCount,0) a,COALESCE(a.ucount,0) b,COALESCE(b.priseCount,0) c,COALESCE(c.comCount,0) d FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(i.id) photoCount,COUNT(DISTINCT ud.id) ucount FROM album m,album_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(Array)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(Array)) ud  WHERE m.owner_id=ud.id AND i.album_id=m.id   AND i.create_time>="2014-08-07 00:00:00" AND i.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,COUNT(uc.id) priseCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(Array)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(Array)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='AlbumItem'   AND uc.create_time>"2014-08-07 00:00:00" AND uc.create_time<"2014-08-08 00:00:00"   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(uc.id) comCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(Array)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(Array)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='SystemComment'   AND uc.create_time>="2014-08-07 00:00:00" AND uc.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) c ON l.id=c.locid  WHERE l.id IN(Array)
SQL: SELECT a.rname a,l.name b,d.name c,a.age d FROM (SELECT u.id uid,u.real_name rname,u.location_id locid,u.dept_id depId,(2014-(SELECT SUBSTR(u.identify_value,7,4))+0) age FROM app_user u WHERE NOT EXISTS ( SELECT lo.user_id FROM login_log lo WHERE u.id=lo.user_id  ) AND u.id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(Array)   UNION ALL SELECT u.id FROM app_user u WHERE u.location_id IN(Array) )) a,location l,department d WHERE a.depId=d.id AND a.locid=l.id [ RunTime:0.002000s ]
ERR: 1054:Unknown column 'Array' in 'where clause'
 [ SQL语句 ] : SELECT a.rname a,l.name b,d.name c,a.age d FROM (SELECT u.id uid,u.real_name rname,u.location_id locid,u.dept_id depId,(2014-(SELECT SUBSTR(u.identify_value,7,4))+0) age FROM app_user u WHERE NOT EXISTS ( SELECT lo.user_id FROM login_log lo WHERE u.id=lo.user_id  ) AND u.id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(Array)   UNION ALL SELECT u.id FROM app_user u WHERE u.location_id IN(Array) )) a,location l,department d WHERE a.depId=d.id AND a.locid=l.id
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) AND lo.login_time>="2014-08-07 00:00:00" AND lo.login_time<"2014-08-08 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.397023s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) AND lo.login_time>="2014-08-07 00:00:00" AND lo.login_time<"2014-08-08 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.369021s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) AND lo.login_time>="2014-08-07 00:00:00" AND lo.login_time<"2014-08-08 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.362021s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) AND lo.login_time>="2014-08-07 00:00:00" AND lo.login_time<"2014-08-08 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.371021s ]
SQL: SELECT l.name,COALESCE(a.ulcount,0) b FROM  location l LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(Array)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(Array)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>=(TIMESTAMP(ADDDATE(DATE(SYSDATE()),-(DAYOFWEEK(NOW())-2))))   GROUP BY ud.locid) a ON a.locid=l.id WHERE l.id IN (Array) [ RunTime:0.002000s ]
ERR: 1054:Unknown column 'Array' in 'where clause'
 [ SQL语句 ] : SELECT l.name,COALESCE(a.ulcount,0) b FROM  location l LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(Array)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(Array)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>=(TIMESTAMP(ADDDATE(DATE(SYSDATE()),-(DAYOFWEEK(NOW())-2))))   GROUP BY ud.locid) a ON a.locid=l.id WHERE l.id IN (Array)
INFO: [ view_parse ] --START--
INFO: ParseTemplate Behavior ::run [ RunTime:0.510029s ]
INFO: [ view_parse ] --END-- [ RunTime:0.515029s ]
INFO: [ view_filter ] --START--
INFO: ContentReplace Behavior ::run [ RunTime:0.007000s ]
INFO: TokenBuild Behavior ::run [ RunTime:0.009001s ]
INFO: WriteHtmlCache Behavior ::run [ RunTime:0.005000s ]
INFO: ShowRuntime Behavior ::run [ RunTime:0.011001s ]
INFO: [ view_filter ] --END-- [ RunTime:0.050003s ]
INFO: [ view_end ] --START--
INFO: ShowPageTrace Behavior ::run [ RunTime:0.008000s ]
INFO: [ view_end ] --END-- [ RunTime:0.012000s ]

[ 2014-08-08T11:59:10+08:00 ] 127.0.0.1 /php_demo/shizhan/10/10wish/index.php/Njb/Index/tongji?checkbox%5B%5D=24521&checkbox%5B%5D=24543
INFO: [ route_check ] --START--
INFO: CheckRoute Behavior ::run [ RunTime:0.007001s ]
INFO: [ route_check ] --END-- [ RunTime:0.011001s ]
INFO: [ app_begin ] --START--
INFO: ReadHtmlCache Behavior ::run [ RunTime:0.009000s ]
INFO: [ app_begin ] --END-- [ RunTime:0.014000s ]
NOTIC: [8] Undefined variable: district_num D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 18 行.
NOTIC: [2] Invalid argument supplied for foreach() D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 18 行.
SQL: SELECT l.name,COALESCE(a.ucount,0) as yhs,COALESCE(c.ulcount,0) as dlyhs,COALESCE(c.logCount,0) as dlcs FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(ud.id) ucount FROM   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud     GROUP BY ud.locid  ) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>="2014-08-07 00:00:00" AND lo.login_time<"2014-08-08 00:00:00"   GROUP BY ud.locid) c ON l.id=c.locid WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.042003s ]
SQL: SELECT l.name,COALESCE(a.noticeCount,0) noticeCount,COALESCE(a.userCount,0) userCount FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(n.id) noticeCount,COUNT(DISTINCT ud.id) userCount FROM notice n,   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud   WHERE n.owner_id=ud.id AND n.publish_time>="2014-08-07 00:00:00"    AND n.publish_time<"2014-08-08 00:00:00" GROUP BY ud.locid) a  ON l.id=a.locid WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.004000s ]
SQL: SELECT l.name,COALESCE(a.asCount,0) a,COALESCE(b.adminCount,0) b,COALESCE(c.noAdminCount,0) c FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(t.id) asCount FROM assignment t,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE t.creator_id=ud.id AND t.create_time>="2014-08-07 00:00:00" AND  t.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) adminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud   WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='TechAdmin'   AND t.create_time>="2014-08-07 00:00:00" AND  t.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) noAdminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='Technician'   AND t.create_time>="2014-08-07 00:00:00" AND  t.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid ) c ON l.id=c.locid  WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.012001s ]
SQL: SELECT l.name,COALESCE(a.worklogCount,0) a,COALESCE(a.uCount,0) b,COALESCE(b.docCount,0) c,COALESCE(c.phoCount,0) d,COALESCE(d.audioCount,0) e FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(DISTINCT w.id) worklogCount,COUNT(DISTINCT w.owner_id) uCount FROM work_log w,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE w.owner_id=ud.id    AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) docCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  AND i.media_type=1   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) phoCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  AND i.media_type=2   GROUP BY ud.locid ) c ON l.id=c.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) audioCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  AND i.media_type=3   GROUP BY ud.locid ) d ON l.id=d.locid   WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.034002s ]
SQL: SELECT l.name,COALESCE(a.photoCount,0) a,COALESCE(a.ucount,0) b,COALESCE(b.priseCount,0) c,COALESCE(c.comCount,0) d FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(i.id) photoCount,COUNT(DISTINCT ud.id) ucount FROM album m,album_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE m.owner_id=ud.id AND i.album_id=m.id   AND i.create_time>="2014-08-07 00:00:00" AND i.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,COUNT(uc.id) priseCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='AlbumItem'   AND uc.create_time>"2014-08-07 00:00:00" AND uc.create_time<"2014-08-08 00:00:00"   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(uc.id) comCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='SystemComment'   AND uc.create_time>="2014-08-07 00:00:00" AND uc.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) c ON l.id=c.locid  WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.014001s ]
SQL: SELECT a.rname a,l.name b,d.name c,a.age d FROM (SELECT u.id uid,u.real_name rname,u.location_id locid,u.dept_id depId,(2014-(SELECT SUBSTR(u.identify_value,7,4))+0) age FROM app_user u WHERE NOT EXISTS ( SELECT lo.user_id FROM login_log lo WHERE u.id=lo.user_id  ) AND u.id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422) )) a,location l,department d WHERE a.depId=d.id AND a.locid=l.id [ RunTime:2.245128s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) AND lo.login_time>="2014-08-07 00:00:00" AND lo.login_time<"2014-08-08 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.477027s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) AND lo.login_time>="2014-08-07 00:00:00" AND lo.login_time<"2014-08-08 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.410023s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) AND lo.login_time>="2014-08-07 00:00:00" AND lo.login_time<"2014-08-08 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.399022s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) AND lo.login_time>="2014-08-07 00:00:00" AND lo.login_time<"2014-08-08 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.375021s ]
SQL: SELECT l.name,COALESCE(a.ulcount,0) b FROM  location l LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>=(TIMESTAMP(ADDDATE(DATE(SYSDATE()),-(DAYOFWEEK(NOW())-2))))   GROUP BY ud.locid) a ON a.locid=l.id WHERE l.id IN (24521,24543,24561,28422) [ RunTime:0.129007s ]
INFO: [ view_parse ] --START--
INFO: ParseTemplate Behavior ::run [ RunTime:0.518030s ]
INFO: [ view_parse ] --END-- [ RunTime:0.525030s ]
INFO: [ view_filter ] --START--
INFO: ContentReplace Behavior ::run [ RunTime:0.010001s ]
INFO: TokenBuild Behavior ::run [ RunTime:0.010001s ]
INFO: WriteHtmlCache Behavior ::run [ RunTime:0.005000s ]
INFO: ShowRuntime Behavior ::run [ RunTime:0.013001s ]
INFO: [ view_filter ] --END-- [ RunTime:0.051003s ]
INFO: [ view_end ] --START--
INFO: ShowPageTrace Behavior ::run [ RunTime:0.012000s ]
INFO: [ view_end ] --END-- [ RunTime:0.018001s ]

[ 2014-08-08T13:16:12+08:00 ] 127.0.0.1 /php_demo/shizhan/10/10wish/index.php/Njb/Index/tongji?checkbox%5B%5D=24521&checkbox%5B%5D=24543
INFO: [ route_check ] --START--
INFO: CheckRoute Behavior ::run [ RunTime:0.008001s ]
INFO: [ route_check ] --END-- [ RunTime:0.013001s ]
INFO: [ app_begin ] --START--
INFO: ReadHtmlCache Behavior ::run [ RunTime:0.010000s ]
INFO: [ app_begin ] --END-- [ RunTime:0.015001s ]
SQL: SELECT l.name,COALESCE(a.ucount,0) as yhs,COALESCE(c.ulcount,0) as dlyhs,COALESCE(c.logCount,0) as dlcs FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(ud.id) ucount FROM   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud     GROUP BY ud.locid  ) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>="2014-08-07 00:00:00" AND lo.login_time<"2014-08-08 00:00:00"   GROUP BY ud.locid) c ON l.id=c.locid WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.084005s ]
SQL: SELECT l.name,COALESCE(a.noticeCount,0) noticeCount,COALESCE(a.userCount,0) userCount FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(n.id) noticeCount,COUNT(DISTINCT ud.id) userCount FROM notice n,   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud   WHERE n.owner_id=ud.id AND n.publish_time>="2014-08-07 00:00:00"    AND n.publish_time<"2014-08-08 00:00:00" GROUP BY ud.locid) a  ON l.id=a.locid WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.005000s ]
SQL: SELECT l.name,COALESCE(a.asCount,0) a,COALESCE(b.adminCount,0) b,COALESCE(c.noAdminCount,0) c FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(t.id) asCount FROM assignment t,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE t.creator_id=ud.id AND t.create_time>="2014-08-07 00:00:00" AND  t.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) adminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud   WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='TechAdmin'   AND t.create_time>="2014-08-07 00:00:00" AND  t.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) noAdminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='Technician'   AND t.create_time>="2014-08-07 00:00:00" AND  t.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid ) c ON l.id=c.locid  WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.132007s ]
SQL: SELECT l.name,COALESCE(a.worklogCount,0) a,COALESCE(a.uCount,0) b,COALESCE(b.docCount,0) c,COALESCE(c.phoCount,0) d,COALESCE(d.audioCount,0) e FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(DISTINCT w.id) worklogCount,COUNT(DISTINCT w.owner_id) uCount FROM work_log w,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE w.owner_id=ud.id    AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) docCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  AND i.media_type=1   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) phoCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  AND i.media_type=2   GROUP BY ud.locid ) c ON l.id=c.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) audioCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  AND i.media_type=3   GROUP BY ud.locid ) d ON l.id=d.locid   WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.034002s ]
SQL: SELECT l.name,COALESCE(a.photoCount,0) a,COALESCE(a.ucount,0) b,COALESCE(b.priseCount,0) c,COALESCE(c.comCount,0) d FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(i.id) photoCount,COUNT(DISTINCT ud.id) ucount FROM album m,album_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE m.owner_id=ud.id AND i.album_id=m.id   AND i.create_time>="2014-08-07 00:00:00" AND i.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,COUNT(uc.id) priseCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='AlbumItem'   AND uc.create_time>"2014-08-07 00:00:00" AND uc.create_time<"2014-08-08 00:00:00"   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(uc.id) comCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='SystemComment'   AND uc.create_time>="2014-08-07 00:00:00" AND uc.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) c ON l.id=c.locid  WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.013001s ]
SQL: SELECT a.rname a,l.name b,d.name c,a.age d FROM (SELECT u.id uid,u.real_name rname,u.location_id locid,u.dept_id depId,(2014-(SELECT SUBSTR(u.identify_value,7,4))+0) age FROM app_user u WHERE NOT EXISTS ( SELECT lo.user_id FROM login_log lo WHERE u.id=lo.user_id  ) AND u.id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422) )) a,location l,department d WHERE a.depId=d.id AND a.locid=l.id [ RunTime:2.172125s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) AND lo.login_time>="2014-08-07 00:00:00" AND lo.login_time<"2014-08-08 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.377022s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) AND lo.login_time>="2014-08-07 00:00:00" AND lo.login_time<"2014-08-08 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.369021s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) AND lo.login_time>="2014-08-07 00:00:00" AND lo.login_time<"2014-08-08 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.368021s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) AND lo.login_time>="2014-08-07 00:00:00" AND lo.login_time<"2014-08-08 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.380022s ]
SQL: SELECT l.name,COALESCE(a.ulcount,0) b FROM  location l LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>=(TIMESTAMP(ADDDATE(DATE(SYSDATE()),-(DAYOFWEEK(NOW())-2))))   GROUP BY ud.locid) a ON a.locid=l.id WHERE l.id IN (24521,24543,24561,28422) [ RunTime:0.162009s ]
INFO: [ view_parse ] --START--
INFO: ParseTemplate Behavior ::run [ RunTime:0.509029s ]
INFO: [ view_parse ] --END-- [ RunTime:0.513029s ]
INFO: [ view_filter ] --START--
INFO: ContentReplace Behavior ::run [ RunTime:0.006001s ]
INFO: TokenBuild Behavior ::run [ RunTime:0.008000s ]
INFO: WriteHtmlCache Behavior ::run [ RunTime:0.005001s ]
INFO: ShowRuntime Behavior ::run [ RunTime:0.014001s ]
INFO: [ view_filter ] --END-- [ RunTime:0.045003s ]
INFO: [ view_end ] --START--
INFO: ShowPageTrace Behavior ::run [ RunTime:0.031002s ]
INFO: [ view_end ] --END-- [ RunTime:0.056003s ]

[ 2014-08-08T13:17:01+08:00 ] 127.0.0.1 /php_demo/shizhan/10/10wish/index.php/Njb/Index/tongji?checkbox%5B%5D=24521&checkbox%5B%5D=24543
INFO: [ route_check ] --START--
INFO: CheckRoute Behavior ::run [ RunTime:0.008001s ]
INFO: [ route_check ] --END-- [ RunTime:0.015001s ]
INFO: [ app_begin ] --START--
INFO: ReadHtmlCache Behavior ::run [ RunTime:0.010001s ]
INFO: [ app_begin ] --END-- [ RunTime:0.017001s ]
SQL: SELECT l.name,COALESCE(a.ucount,0) as yhs,COALESCE(c.ulcount,0) as dlyhs,COALESCE(c.logCount,0) as dlcs FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(ud.id) ucount FROM   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud     GROUP BY ud.locid  ) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>="2014-08-07 00:00:00" AND lo.login_time<"2014-08-08 00:00:00"   GROUP BY ud.locid) c ON l.id=c.locid WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.049002s ]
SQL: SELECT l.name,COALESCE(a.noticeCount,0) noticeCount,COALESCE(a.userCount,0) userCount FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(n.id) noticeCount,COUNT(DISTINCT ud.id) userCount FROM notice n,   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud   WHERE n.owner_id=ud.id AND n.publish_time>="2014-08-07 00:00:00"    AND n.publish_time<"2014-08-08 00:00:00" GROUP BY ud.locid) a  ON l.id=a.locid WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.005000s ]
SQL: SELECT l.name,COALESCE(a.asCount,0) a,COALESCE(b.adminCount,0) b,COALESCE(c.noAdminCount,0) c FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(t.id) asCount FROM assignment t,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE t.creator_id=ud.id AND t.create_time>="2014-08-07 00:00:00" AND  t.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) adminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud   WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='TechAdmin'   AND t.create_time>="2014-08-07 00:00:00" AND  t.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) noAdminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='Technician'   AND t.create_time>="2014-08-07 00:00:00" AND  t.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid ) c ON l.id=c.locid  WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.014001s ]
SQL: SELECT l.name,COALESCE(a.worklogCount,0) a,COALESCE(a.uCount,0) b,COALESCE(b.docCount,0) c,COALESCE(c.phoCount,0) d,COALESCE(d.audioCount,0) e FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(DISTINCT w.id) worklogCount,COUNT(DISTINCT w.owner_id) uCount FROM work_log w,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE w.owner_id=ud.id    AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) docCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  AND i.media_type=1   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) phoCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  AND i.media_type=2   GROUP BY ud.locid ) c ON l.id=c.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) audioCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  AND i.media_type=3   GROUP BY ud.locid ) d ON l.id=d.locid   WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.032002s ]
SQL: SELECT l.name,COALESCE(a.photoCount,0) a,COALESCE(a.ucount,0) b,COALESCE(b.priseCount,0) c,COALESCE(c.comCount,0) d FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(i.id) photoCount,COUNT(DISTINCT ud.id) ucount FROM album m,album_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE m.owner_id=ud.id AND i.album_id=m.id   AND i.create_time>="2014-08-07 00:00:00" AND i.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,COUNT(uc.id) priseCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='AlbumItem'   AND uc.create_time>"2014-08-07 00:00:00" AND uc.create_time<"2014-08-08 00:00:00"   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(uc.id) comCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='SystemComment'   AND uc.create_time>="2014-08-07 00:00:00" AND uc.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) c ON l.id=c.locid  WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.012001s ]
SQL: SELECT a.rname a,l.name b,d.name c,a.age d FROM (SELECT u.id uid,u.real_name rname,u.location_id locid,u.dept_id depId,(2014-(SELECT SUBSTR(u.identify_value,7,4))+0) age FROM app_user u WHERE NOT EXISTS ( SELECT lo.user_id FROM login_log lo WHERE u.id=lo.user_id  ) AND u.id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422) )) a,location l,department d WHERE a.depId=d.id AND a.locid=l.id [ RunTime:2.163123s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) AND lo.login_time>="2014-08-07 00:00:00" AND lo.login_time<"2014-08-08 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.375021s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) AND lo.login_time>="2014-08-07 00:00:00" AND lo.login_time<"2014-08-08 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.361021s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) AND lo.login_time>="2014-08-07 00:00:00" AND lo.login_time<"2014-08-08 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.379022s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) AND lo.login_time>="2014-08-07 00:00:00" AND lo.login_time<"2014-08-08 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.391023s ]
SQL: SELECT l.name,COALESCE(a.ulcount,0) b FROM  location l LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>=(TIMESTAMP(ADDDATE(DATE(SYSDATE()),-(DAYOFWEEK(NOW())-2))))   GROUP BY ud.locid) a ON a.locid=l.id WHERE l.id IN (24521,24543,24561,28422) [ RunTime:0.127008s ]
INFO: [ view_parse ] --START--
INFO: ParseTemplate Behavior ::run [ RunTime:0.521030s ]
INFO: [ view_parse ] --END-- [ RunTime:0.526030s ]
INFO: [ view_filter ] --START--
INFO: ContentReplace Behavior ::run [ RunTime:0.010000s ]
INFO: TokenBuild Behavior ::run [ RunTime:0.009001s ]
INFO: WriteHtmlCache Behavior ::run [ RunTime:0.007001s ]
INFO: ShowRuntime Behavior ::run [ RunTime:0.014001s ]
INFO: [ view_filter ] --END-- [ RunTime:0.057003s ]
INFO: [ view_end ] --START--
INFO: ShowPageTrace Behavior ::run [ RunTime:0.010001s ]
INFO: [ view_end ] --END-- [ RunTime:0.016001s ]

[ 2014-08-08T13:19:34+08:00 ] 127.0.0.1 /php_demo/shizhan/10/10wish/index.php/Njb/Index/tongji?checkbox%5B%5D=24521&checkbox%5B%5D=24543
INFO: [ route_check ] --START--
INFO: CheckRoute Behavior ::run [ RunTime:0.006000s ]
INFO: [ route_check ] --END-- [ RunTime:0.013001s ]
INFO: [ app_begin ] --START--
INFO: ReadHtmlCache Behavior ::run [ RunTime:0.008001s ]
INFO: [ app_begin ] --END-- [ RunTime:0.013001s ]
NOTIC: [8] Use of undefined constant i - assumed 'i' D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 16 行.
NOTIC: [8] Undefined index: i D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 16 行.
NOTIC: [8] Use of undefined constant i - assumed 'i' D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 16 行.
NOTIC: [8] Undefined index: i D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 16 行.
SQL: SELECT l.name,COALESCE(a.ucount,0) as yhs,COALESCE(c.ulcount,0) as dlyhs,COALESCE(c.logCount,0) as dlcs FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(ud.id) ucount FROM   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud     GROUP BY ud.locid  ) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>="2014-08-07 00:00:00" AND lo.login_time<"2014-08-08 00:00:00"   GROUP BY ud.locid) c ON l.id=c.locid WHERE l.id IN(,,) [ RunTime:0.001000s ]
ERR: 1064:You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near ',)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location' at line 1
 [ SQL语句 ] : SELECT l.name,COALESCE(a.ucount,0) as yhs,COALESCE(c.ulcount,0) as dlyhs,COALESCE(c.logCount,0) as dlcs FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(ud.id) ucount FROM   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud     GROUP BY ud.locid  ) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>="2014-08-07 00:00:00" AND lo.login_time<"2014-08-08 00:00:00"   GROUP BY ud.locid) c ON l.id=c.locid WHERE l.id IN(,,)
SQL: SELECT l.name,COALESCE(a.noticeCount,0) noticeCount,COALESCE(a.userCount,0) userCount FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(n.id) noticeCount,COUNT(DISTINCT ud.id) userCount FROM notice n,   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud   WHERE n.owner_id=ud.id AND n.publish_time>="2014-08-07 00:00:00"    AND n.publish_time<"2014-08-08 00:00:00" GROUP BY ud.locid) a  ON l.id=a.locid WHERE l.id IN(,,) [ RunTime:0.001000s ]
ERR: 1064:You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near ',)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location' at line 1
 [ SQL语句 ] : SELECT l.name,COALESCE(a.noticeCount,0) noticeCount,COALESCE(a.userCount,0) userCount FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(n.id) noticeCount,COUNT(DISTINCT ud.id) userCount FROM notice n,   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud   WHERE n.owner_id=ud.id AND n.publish_time>="2014-08-07 00:00:00"    AND n.publish_time<"2014-08-08 00:00:00" GROUP BY ud.locid) a  ON l.id=a.locid WHERE l.id IN(,,)
SQL: SELECT l.name,COALESCE(a.asCount,0) a,COALESCE(b.adminCount,0) b,COALESCE(c.noAdminCount,0) c FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(t.id) asCount FROM assignment t,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud  WHERE t.creator_id=ud.id AND t.create_time>="2014-08-07 00:00:00" AND  t.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) adminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud   WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='TechAdmin'   AND t.create_time>="2014-08-07 00:00:00" AND  t.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) noAdminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud  WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='Technician'   AND t.create_time>="2014-08-07 00:00:00" AND  t.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid ) c ON l.id=c.locid  WHERE l.id IN(,,) [ RunTime:0.001000s ]
ERR: 1064:You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near ',)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_' at line 1
 [ SQL语句 ] : SELECT l.name,COALESCE(a.asCount,0) a,COALESCE(b.adminCount,0) b,COALESCE(c.noAdminCount,0) c FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(t.id) asCount FROM assignment t,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud  WHERE t.creator_id=ud.id AND t.create_time>="2014-08-07 00:00:00" AND  t.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) adminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud   WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='TechAdmin'   AND t.create_time>="2014-08-07 00:00:00" AND  t.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) noAdminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud  WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='Technician'   AND t.create_time>="2014-08-07 00:00:00" AND  t.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid ) c ON l.id=c.locid  WHERE l.id IN(,,)
SQL: SELECT l.name,COALESCE(a.worklogCount,0) a,COALESCE(a.uCount,0) b,COALESCE(b.docCount,0) c,COALESCE(c.phoCount,0) d,COALESCE(d.audioCount,0) e FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(DISTINCT w.id) worklogCount,COUNT(DISTINCT w.owner_id) uCount FROM work_log w,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud  WHERE w.owner_id=ud.id    AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) docCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  AND i.media_type=1   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) phoCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  AND i.media_type=2   GROUP BY ud.locid ) c ON l.id=c.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) audioCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  AND i.media_type=3   GROUP BY ud.locid ) d ON l.id=d.locid   WHERE l.id IN(,,) [ RunTime:0.001000s ]
ERR: 1064:You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near ',)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_' at line 1
 [ SQL语句 ] : SELECT l.name,COALESCE(a.worklogCount,0) a,COALESCE(a.uCount,0) b,COALESCE(b.docCount,0) c,COALESCE(c.phoCount,0) d,COALESCE(d.audioCount,0) e FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(DISTINCT w.id) worklogCount,COUNT(DISTINCT w.owner_id) uCount FROM work_log w,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud  WHERE w.owner_id=ud.id    AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) docCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  AND i.media_type=1   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) phoCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  AND i.media_type=2   GROUP BY ud.locid ) c ON l.id=c.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) audioCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  AND i.media_type=3   GROUP BY ud.locid ) d ON l.id=d.locid   WHERE l.id IN(,,)
SQL: SELECT l.name,COALESCE(a.photoCount,0) a,COALESCE(a.ucount,0) b,COALESCE(b.priseCount,0) c,COALESCE(c.comCount,0) d FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(i.id) photoCount,COUNT(DISTINCT ud.id) ucount FROM album m,album_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud  WHERE m.owner_id=ud.id AND i.album_id=m.id   AND i.create_time>="2014-08-07 00:00:00" AND i.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,COUNT(uc.id) priseCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='AlbumItem'   AND uc.create_time>"2014-08-07 00:00:00" AND uc.create_time<"2014-08-08 00:00:00"   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(uc.id) comCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='SystemComment'   AND uc.create_time>="2014-08-07 00:00:00" AND uc.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) c ON l.id=c.locid  WHERE l.id IN(,,) [ RunTime:0.001000s ]
ERR: 1064:You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near ',)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_i' at line 1
 [ SQL语句 ] : SELECT l.name,COALESCE(a.photoCount,0) a,COALESCE(a.ucount,0) b,COALESCE(b.priseCount,0) c,COALESCE(c.comCount,0) d FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(i.id) photoCount,COUNT(DISTINCT ud.id) ucount FROM album m,album_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud  WHERE m.owner_id=ud.id AND i.album_id=m.id   AND i.create_time>="2014-08-07 00:00:00" AND i.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,COUNT(uc.id) priseCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='AlbumItem'   AND uc.create_time>"2014-08-07 00:00:00" AND uc.create_time<"2014-08-08 00:00:00"   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(uc.id) comCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='SystemComment'   AND uc.create_time>="2014-08-07 00:00:00" AND uc.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) c ON l.id=c.locid  WHERE l.id IN(,,)
SQL: SELECT a.rname a,l.name b,d.name c,a.age d FROM (SELECT u.id uid,u.real_name rname,u.location_id locid,u.dept_id depId,(2014-(SELECT SUBSTR(u.identify_value,7,4))+0) age FROM app_user u WHERE NOT EXISTS ( SELECT lo.user_id FROM login_log lo WHERE u.id=lo.user_id  ) AND u.id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)   UNION ALL SELECT u.id FROM app_user u WHERE u.location_id IN(,,) )) a,location l,department d WHERE a.depId=d.id AND a.locid=l.id [ RunTime:0.001000s ]
ERR: 1064:You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near ',)   UNION ALL SELECT u.id FROM app_user u WHERE u.location_id IN(,,) )) a,locat' at line 1
 [ SQL语句 ] : SELECT a.rname a,l.name b,d.name c,a.age d FROM (SELECT u.id uid,u.real_name rname,u.location_id locid,u.dept_id depId,(2014-(SELECT SUBSTR(u.identify_value,7,4))+0) age FROM app_user u WHERE NOT EXISTS ( SELECT lo.user_id FROM login_log lo WHERE u.id=lo.user_id  ) AND u.id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)   UNION ALL SELECT u.id FROM app_user u WHERE u.location_id IN(,,) )) a,location l,department d WHERE a.depId=d.id AND a.locid=l.id
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) AND lo.login_time>="2014-08-07 00:00:00" AND lo.login_time<"2014-08-08 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.376021s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) AND lo.login_time>="2014-08-07 00:00:00" AND lo.login_time<"2014-08-08 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.371021s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) AND lo.login_time>="2014-08-07 00:00:00" AND lo.login_time<"2014-08-08 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.381021s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) AND lo.login_time>="2014-08-07 00:00:00" AND lo.login_time<"2014-08-08 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.374021s ]
SQL: SELECT l.name,COALESCE(a.ulcount,0) b FROM  location l LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>=(TIMESTAMP(ADDDATE(DATE(SYSDATE()),-(DAYOFWEEK(NOW())-2))))   GROUP BY ud.locid) a ON a.locid=l.id WHERE l.id IN (,,) [ RunTime:0.002000s ]
ERR: 1064:You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near ',)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_' at line 1
 [ SQL语句 ] : SELECT l.name,COALESCE(a.ulcount,0) b FROM  location l LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>=(TIMESTAMP(ADDDATE(DATE(SYSDATE()),-(DAYOFWEEK(NOW())-2))))   GROUP BY ud.locid) a ON a.locid=l.id WHERE l.id IN (,,)
INFO: [ view_parse ] --START--
INFO: ParseTemplate Behavior ::run [ RunTime:0.513029s ]
INFO: [ view_parse ] --END-- [ RunTime:0.518029s ]
INFO: [ view_filter ] --START--
INFO: ContentReplace Behavior ::run [ RunTime:0.010000s ]
INFO: TokenBuild Behavior ::run [ RunTime:0.010001s ]
INFO: WriteHtmlCache Behavior ::run [ RunTime:0.005001s ]
INFO: ShowRuntime Behavior ::run [ RunTime:0.013001s ]
INFO: [ view_filter ] --END-- [ RunTime:0.058003s ]
INFO: [ view_end ] --START--
INFO: ShowPageTrace Behavior ::run [ RunTime:0.007001s ]
INFO: [ view_end ] --END-- [ RunTime:0.013001s ]

[ 2014-08-08T13:20:32+08:00 ] 127.0.0.1 /php_demo/shizhan/10/10wish/index.php/Njb/Index/tongji?checkbox%5B%5D=24521&checkbox%5B%5D=24543
INFO: [ route_check ] --START--
INFO: CheckRoute Behavior ::run [ RunTime:0.006001s ]
INFO: [ route_check ] --END-- [ RunTime:0.012001s ]
INFO: [ app_begin ] --START--
INFO: ReadHtmlCache Behavior ::run [ RunTime:0.011000s ]
INFO: [ app_begin ] --END-- [ RunTime:0.020001s ]
NOTIC: [8] Use of undefined constant i - assumed 'i' D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 16 行.
NOTIC: [8] Undefined index: i D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 16 行.
NOTIC: [8] Use of undefined constant i - assumed 'i' D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 16 行.
NOTIC: [8] Undefined index: i D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 16 行.
SQL: SELECT l.name,COALESCE(a.ucount,0) as yhs,COALESCE(c.ulcount,0) as dlyhs,COALESCE(c.logCount,0) as dlcs FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(ud.id) ucount FROM   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud     GROUP BY ud.locid  ) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>="2014-08-07 00:00:00" AND lo.login_time<"2014-08-08 00:00:00"   GROUP BY ud.locid) c ON l.id=c.locid WHERE l.id IN(,,) [ RunTime:0.001000s ]
ERR: 1064:You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near ',)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location' at line 1
 [ SQL语句 ] : SELECT l.name,COALESCE(a.ucount,0) as yhs,COALESCE(c.ulcount,0) as dlyhs,COALESCE(c.logCount,0) as dlcs FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(ud.id) ucount FROM   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud     GROUP BY ud.locid  ) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>="2014-08-07 00:00:00" AND lo.login_time<"2014-08-08 00:00:00"   GROUP BY ud.locid) c ON l.id=c.locid WHERE l.id IN(,,)
SQL: SELECT l.name,COALESCE(a.noticeCount,0) noticeCount,COALESCE(a.userCount,0) userCount FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(n.id) noticeCount,COUNT(DISTINCT ud.id) userCount FROM notice n,   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud   WHERE n.owner_id=ud.id AND n.publish_time>="2014-08-07 00:00:00"    AND n.publish_time<"2014-08-08 00:00:00" GROUP BY ud.locid) a  ON l.id=a.locid WHERE l.id IN(,,) [ RunTime:0.002000s ]
ERR: 1064:You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near ',)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location' at line 1
 [ SQL语句 ] : SELECT l.name,COALESCE(a.noticeCount,0) noticeCount,COALESCE(a.userCount,0) userCount FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(n.id) noticeCount,COUNT(DISTINCT ud.id) userCount FROM notice n,   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud   WHERE n.owner_id=ud.id AND n.publish_time>="2014-08-07 00:00:00"    AND n.publish_time<"2014-08-08 00:00:00" GROUP BY ud.locid) a  ON l.id=a.locid WHERE l.id IN(,,)
SQL: SELECT l.name,COALESCE(a.asCount,0) a,COALESCE(b.adminCount,0) b,COALESCE(c.noAdminCount,0) c FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(t.id) asCount FROM assignment t,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud  WHERE t.creator_id=ud.id AND t.create_time>="2014-08-07 00:00:00" AND  t.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) adminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud   WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='TechAdmin'   AND t.create_time>="2014-08-07 00:00:00" AND  t.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) noAdminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud  WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='Technician'   AND t.create_time>="2014-08-07 00:00:00" AND  t.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid ) c ON l.id=c.locid  WHERE l.id IN(,,) [ RunTime:0.001000s ]
ERR: 1064:You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near ',)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_' at line 1
 [ SQL语句 ] : SELECT l.name,COALESCE(a.asCount,0) a,COALESCE(b.adminCount,0) b,COALESCE(c.noAdminCount,0) c FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(t.id) asCount FROM assignment t,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud  WHERE t.creator_id=ud.id AND t.create_time>="2014-08-07 00:00:00" AND  t.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) adminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud   WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='TechAdmin'   AND t.create_time>="2014-08-07 00:00:00" AND  t.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) noAdminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud  WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='Technician'   AND t.create_time>="2014-08-07 00:00:00" AND  t.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid ) c ON l.id=c.locid  WHERE l.id IN(,,)
SQL: SELECT l.name,COALESCE(a.worklogCount,0) a,COALESCE(a.uCount,0) b,COALESCE(b.docCount,0) c,COALESCE(c.phoCount,0) d,COALESCE(d.audioCount,0) e FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(DISTINCT w.id) worklogCount,COUNT(DISTINCT w.owner_id) uCount FROM work_log w,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud  WHERE w.owner_id=ud.id    AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) docCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  AND i.media_type=1   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) phoCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  AND i.media_type=2   GROUP BY ud.locid ) c ON l.id=c.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) audioCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  AND i.media_type=3   GROUP BY ud.locid ) d ON l.id=d.locid   WHERE l.id IN(,,) [ RunTime:0.001000s ]
ERR: 1064:You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near ',)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_' at line 1
 [ SQL语句 ] : SELECT l.name,COALESCE(a.worklogCount,0) a,COALESCE(a.uCount,0) b,COALESCE(b.docCount,0) c,COALESCE(c.phoCount,0) d,COALESCE(d.audioCount,0) e FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(DISTINCT w.id) worklogCount,COUNT(DISTINCT w.owner_id) uCount FROM work_log w,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud  WHERE w.owner_id=ud.id    AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) docCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  AND i.media_type=1   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) phoCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  AND i.media_type=2   GROUP BY ud.locid ) c ON l.id=c.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) audioCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  AND i.media_type=3   GROUP BY ud.locid ) d ON l.id=d.locid   WHERE l.id IN(,,)
SQL: SELECT l.name,COALESCE(a.photoCount,0) a,COALESCE(a.ucount,0) b,COALESCE(b.priseCount,0) c,COALESCE(c.comCount,0) d FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(i.id) photoCount,COUNT(DISTINCT ud.id) ucount FROM album m,album_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud  WHERE m.owner_id=ud.id AND i.album_id=m.id   AND i.create_time>="2014-08-07 00:00:00" AND i.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,COUNT(uc.id) priseCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='AlbumItem'   AND uc.create_time>"2014-08-07 00:00:00" AND uc.create_time<"2014-08-08 00:00:00"   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(uc.id) comCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='SystemComment'   AND uc.create_time>="2014-08-07 00:00:00" AND uc.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) c ON l.id=c.locid  WHERE l.id IN(,,) [ RunTime:0.002000s ]
ERR: 1064:You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near ',)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_i' at line 1
 [ SQL语句 ] : SELECT l.name,COALESCE(a.photoCount,0) a,COALESCE(a.ucount,0) b,COALESCE(b.priseCount,0) c,COALESCE(c.comCount,0) d FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(i.id) photoCount,COUNT(DISTINCT ud.id) ucount FROM album m,album_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud  WHERE m.owner_id=ud.id AND i.album_id=m.id   AND i.create_time>="2014-08-07 00:00:00" AND i.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,COUNT(uc.id) priseCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='AlbumItem'   AND uc.create_time>"2014-08-07 00:00:00" AND uc.create_time<"2014-08-08 00:00:00"   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(uc.id) comCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='SystemComment'   AND uc.create_time>="2014-08-07 00:00:00" AND uc.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) c ON l.id=c.locid  WHERE l.id IN(,,)
SQL: SELECT a.rname a,l.name b,d.name c,a.age d FROM (SELECT u.id uid,u.real_name rname,u.location_id locid,u.dept_id depId,(2014-(SELECT SUBSTR(u.identify_value,7,4))+0) age FROM app_user u WHERE NOT EXISTS ( SELECT lo.user_id FROM login_log lo WHERE u.id=lo.user_id  ) AND u.id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)   UNION ALL SELECT u.id FROM app_user u WHERE u.location_id IN(,,) )) a,location l,department d WHERE a.depId=d.id AND a.locid=l.id [ RunTime:0.001000s ]
ERR: 1064:You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near ',)   UNION ALL SELECT u.id FROM app_user u WHERE u.location_id IN(,,) )) a,locat' at line 1
 [ SQL语句 ] : SELECT a.rname a,l.name b,d.name c,a.age d FROM (SELECT u.id uid,u.real_name rname,u.location_id locid,u.dept_id depId,(2014-(SELECT SUBSTR(u.identify_value,7,4))+0) age FROM app_user u WHERE NOT EXISTS ( SELECT lo.user_id FROM login_log lo WHERE u.id=lo.user_id  ) AND u.id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)   UNION ALL SELECT u.id FROM app_user u WHERE u.location_id IN(,,) )) a,location l,department d WHERE a.depId=d.id AND a.locid=l.id
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) AND lo.login_time>="2014-08-07 00:00:00" AND lo.login_time<"2014-08-08 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.384022s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) AND lo.login_time>="2014-08-07 00:00:00" AND lo.login_time<"2014-08-08 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.370022s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) AND lo.login_time>="2014-08-07 00:00:00" AND lo.login_time<"2014-08-08 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.380022s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) AND lo.login_time>="2014-08-07 00:00:00" AND lo.login_time<"2014-08-08 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.377022s ]
SQL: SELECT l.name,COALESCE(a.ulcount,0) b FROM  location l LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>=(TIMESTAMP(ADDDATE(DATE(SYSDATE()),-(DAYOFWEEK(NOW())-2))))   GROUP BY ud.locid) a ON a.locid=l.id WHERE l.id IN (,,) [ RunTime:0.002001s ]
ERR: 1064:You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near ',)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_' at line 1
 [ SQL语句 ] : SELECT l.name,COALESCE(a.ulcount,0) b FROM  location l LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>=(TIMESTAMP(ADDDATE(DATE(SYSDATE()),-(DAYOFWEEK(NOW())-2))))   GROUP BY ud.locid) a ON a.locid=l.id WHERE l.id IN (,,)
INFO: [ view_parse ] --START--
INFO: ParseTemplate Behavior ::run [ RunTime:0.518030s ]
INFO: [ view_parse ] --END-- [ RunTime:0.522030s ]
INFO: [ view_filter ] --START--
INFO: ContentReplace Behavior ::run [ RunTime:0.010000s ]
INFO: TokenBuild Behavior ::run [ RunTime:0.010001s ]
INFO: WriteHtmlCache Behavior ::run [ RunTime:0.005001s ]
INFO: ShowRuntime Behavior ::run [ RunTime:0.020001s ]
INFO: [ view_filter ] --END-- [ RunTime:0.064004s ]
INFO: [ view_end ] --START--
INFO: ShowPageTrace Behavior ::run [ RunTime:0.008000s ]
INFO: [ view_end ] --END-- [ RunTime:0.012001s ]

[ 2014-08-08T13:21:15+08:00 ] 127.0.0.1 /php_demo/shizhan/10/10wish/index.php/Njb/Index/tongji?checkbox%5B%5D=24521&checkbox%5B%5D=24543
INFO: [ route_check ] --START--
INFO: CheckRoute Behavior ::run [ RunTime:0.008000s ]
INFO: [ route_check ] --END-- [ RunTime:0.012000s ]
INFO: [ app_begin ] --START--
INFO: ReadHtmlCache Behavior ::run [ RunTime:0.008001s ]
INFO: [ app_begin ] --END-- [ RunTime:0.013001s ]
NOTIC: [8] Use of undefined constant i - assumed 'i' D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 17 行.
NOTIC: [8] Undefined index: i D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 17 行.
NOTIC: [8] Use of undefined constant i - assumed 'i' D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 17 行.
NOTIC: [8] Undefined index: i D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 17 行.
SQL: SELECT l.name,COALESCE(a.ucount,0) as yhs,COALESCE(c.ulcount,0) as dlyhs,COALESCE(c.logCount,0) as dlcs FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(ud.id) ucount FROM   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud     GROUP BY ud.locid  ) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>="2014-08-07 00:00:00" AND lo.login_time<"2014-08-08 00:00:00"   GROUP BY ud.locid) c ON l.id=c.locid WHERE l.id IN(,,) [ RunTime:0.002000s ]
ERR: 1064:You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near ',)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location' at line 1
 [ SQL语句 ] : SELECT l.name,COALESCE(a.ucount,0) as yhs,COALESCE(c.ulcount,0) as dlyhs,COALESCE(c.logCount,0) as dlcs FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(ud.id) ucount FROM   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud     GROUP BY ud.locid  ) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>="2014-08-07 00:00:00" AND lo.login_time<"2014-08-08 00:00:00"   GROUP BY ud.locid) c ON l.id=c.locid WHERE l.id IN(,,)
SQL: SELECT l.name,COALESCE(a.noticeCount,0) noticeCount,COALESCE(a.userCount,0) userCount FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(n.id) noticeCount,COUNT(DISTINCT ud.id) userCount FROM notice n,   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud   WHERE n.owner_id=ud.id AND n.publish_time>="2014-08-07 00:00:00"    AND n.publish_time<"2014-08-08 00:00:00" GROUP BY ud.locid) a  ON l.id=a.locid WHERE l.id IN(,,) [ RunTime:0.001000s ]
ERR: 1064:You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near ',)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location' at line 1
 [ SQL语句 ] : SELECT l.name,COALESCE(a.noticeCount,0) noticeCount,COALESCE(a.userCount,0) userCount FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(n.id) noticeCount,COUNT(DISTINCT ud.id) userCount FROM notice n,   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud   WHERE n.owner_id=ud.id AND n.publish_time>="2014-08-07 00:00:00"    AND n.publish_time<"2014-08-08 00:00:00" GROUP BY ud.locid) a  ON l.id=a.locid WHERE l.id IN(,,)
SQL: SELECT l.name,COALESCE(a.asCount,0) a,COALESCE(b.adminCount,0) b,COALESCE(c.noAdminCount,0) c FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(t.id) asCount FROM assignment t,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud  WHERE t.creator_id=ud.id AND t.create_time>="2014-08-07 00:00:00" AND  t.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) adminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud   WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='TechAdmin'   AND t.create_time>="2014-08-07 00:00:00" AND  t.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) noAdminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud  WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='Technician'   AND t.create_time>="2014-08-07 00:00:00" AND  t.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid ) c ON l.id=c.locid  WHERE l.id IN(,,) [ RunTime:0.002000s ]
ERR: 1064:You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near ',)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_' at line 1
 [ SQL语句 ] : SELECT l.name,COALESCE(a.asCount,0) a,COALESCE(b.adminCount,0) b,COALESCE(c.noAdminCount,0) c FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(t.id) asCount FROM assignment t,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud  WHERE t.creator_id=ud.id AND t.create_time>="2014-08-07 00:00:00" AND  t.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) adminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud   WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='TechAdmin'   AND t.create_time>="2014-08-07 00:00:00" AND  t.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) noAdminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud  WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='Technician'   AND t.create_time>="2014-08-07 00:00:00" AND  t.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid ) c ON l.id=c.locid  WHERE l.id IN(,,)
SQL: SELECT l.name,COALESCE(a.worklogCount,0) a,COALESCE(a.uCount,0) b,COALESCE(b.docCount,0) c,COALESCE(c.phoCount,0) d,COALESCE(d.audioCount,0) e FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(DISTINCT w.id) worklogCount,COUNT(DISTINCT w.owner_id) uCount FROM work_log w,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud  WHERE w.owner_id=ud.id    AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) docCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  AND i.media_type=1   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) phoCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  AND i.media_type=2   GROUP BY ud.locid ) c ON l.id=c.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) audioCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  AND i.media_type=3   GROUP BY ud.locid ) d ON l.id=d.locid   WHERE l.id IN(,,) [ RunTime:0.001000s ]
ERR: 1064:You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near ',)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_' at line 1
 [ SQL语句 ] : SELECT l.name,COALESCE(a.worklogCount,0) a,COALESCE(a.uCount,0) b,COALESCE(b.docCount,0) c,COALESCE(c.phoCount,0) d,COALESCE(d.audioCount,0) e FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(DISTINCT w.id) worklogCount,COUNT(DISTINCT w.owner_id) uCount FROM work_log w,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud  WHERE w.owner_id=ud.id    AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) docCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  AND i.media_type=1   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) phoCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  AND i.media_type=2   GROUP BY ud.locid ) c ON l.id=c.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) audioCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  AND i.media_type=3   GROUP BY ud.locid ) d ON l.id=d.locid   WHERE l.id IN(,,)
SQL: SELECT l.name,COALESCE(a.photoCount,0) a,COALESCE(a.ucount,0) b,COALESCE(b.priseCount,0) c,COALESCE(c.comCount,0) d FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(i.id) photoCount,COUNT(DISTINCT ud.id) ucount FROM album m,album_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud  WHERE m.owner_id=ud.id AND i.album_id=m.id   AND i.create_time>="2014-08-07 00:00:00" AND i.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,COUNT(uc.id) priseCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='AlbumItem'   AND uc.create_time>"2014-08-07 00:00:00" AND uc.create_time<"2014-08-08 00:00:00"   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(uc.id) comCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='SystemComment'   AND uc.create_time>="2014-08-07 00:00:00" AND uc.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) c ON l.id=c.locid  WHERE l.id IN(,,) [ RunTime:0.002000s ]
ERR: 1064:You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near ',)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_i' at line 1
 [ SQL语句 ] : SELECT l.name,COALESCE(a.photoCount,0) a,COALESCE(a.ucount,0) b,COALESCE(b.priseCount,0) c,COALESCE(c.comCount,0) d FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(i.id) photoCount,COUNT(DISTINCT ud.id) ucount FROM album m,album_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud  WHERE m.owner_id=ud.id AND i.album_id=m.id   AND i.create_time>="2014-08-07 00:00:00" AND i.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,COUNT(uc.id) priseCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='AlbumItem'   AND uc.create_time>"2014-08-07 00:00:00" AND uc.create_time<"2014-08-08 00:00:00"   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(uc.id) comCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='SystemComment'   AND uc.create_time>="2014-08-07 00:00:00" AND uc.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) c ON l.id=c.locid  WHERE l.id IN(,,)
SQL: SELECT a.rname a,l.name b,d.name c,a.age d FROM (SELECT u.id uid,u.real_name rname,u.location_id locid,u.dept_id depId,(2014-(SELECT SUBSTR(u.identify_value,7,4))+0) age FROM app_user u WHERE NOT EXISTS ( SELECT lo.user_id FROM login_log lo WHERE u.id=lo.user_id  ) AND u.id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)   UNION ALL SELECT u.id FROM app_user u WHERE u.location_id IN(,,) )) a,location l,department d WHERE a.depId=d.id AND a.locid=l.id [ RunTime:0.001000s ]
ERR: 1064:You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near ',)   UNION ALL SELECT u.id FROM app_user u WHERE u.location_id IN(,,) )) a,locat' at line 1
 [ SQL语句 ] : SELECT a.rname a,l.name b,d.name c,a.age d FROM (SELECT u.id uid,u.real_name rname,u.location_id locid,u.dept_id depId,(2014-(SELECT SUBSTR(u.identify_value,7,4))+0) age FROM app_user u WHERE NOT EXISTS ( SELECT lo.user_id FROM login_log lo WHERE u.id=lo.user_id  ) AND u.id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)   UNION ALL SELECT u.id FROM app_user u WHERE u.location_id IN(,,) )) a,location l,department d WHERE a.depId=d.id AND a.locid=l.id
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) AND lo.login_time>="2014-08-07 00:00:00" AND lo.login_time<"2014-08-08 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.450025s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) AND lo.login_time>="2014-08-07 00:00:00" AND lo.login_time<"2014-08-08 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.483028s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) AND lo.login_time>="2014-08-07 00:00:00" AND lo.login_time<"2014-08-08 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.458026s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) AND lo.login_time>="2014-08-07 00:00:00" AND lo.login_time<"2014-08-08 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.386022s ]
SQL: SELECT l.name,COALESCE(a.ulcount,0) b FROM  location l LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>=(TIMESTAMP(ADDDATE(DATE(SYSDATE()),-(DAYOFWEEK(NOW())-2))))   GROUP BY ud.locid) a ON a.locid=l.id WHERE l.id IN (,,) [ RunTime:0.002001s ]
ERR: 1064:You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near ',)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_' at line 1
 [ SQL语句 ] : SELECT l.name,COALESCE(a.ulcount,0) b FROM  location l LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>=(TIMESTAMP(ADDDATE(DATE(SYSDATE()),-(DAYOFWEEK(NOW())-2))))   GROUP BY ud.locid) a ON a.locid=l.id WHERE l.id IN (,,)
INFO: [ view_parse ] --START--
INFO: ParseTemplate Behavior ::run [ RunTime:0.524030s ]
INFO: [ view_parse ] --END-- [ RunTime:0.529031s ]
INFO: [ view_filter ] --START--
INFO: ContentReplace Behavior ::run [ RunTime:0.009001s ]
INFO: TokenBuild Behavior ::run [ RunTime:0.009000s ]
INFO: WriteHtmlCache Behavior ::run [ RunTime:0.006001s ]
INFO: ShowRuntime Behavior ::run [ RunTime:0.014001s ]
INFO: [ view_filter ] --END-- [ RunTime:0.053003s ]
INFO: [ view_end ] --START--
INFO: ShowPageTrace Behavior ::run [ RunTime:0.008001s ]
INFO: [ view_end ] --END-- [ RunTime:0.012001s ]

[ 2014-08-08T13:21:51+08:00 ] 127.0.0.1 /php_demo/shizhan/10/10wish/index.php/Njb/Index/tongji?checkbox%5B%5D=24521&checkbox%5B%5D=24543
INFO: [ route_check ] --START--
INFO: CheckRoute Behavior ::run [ RunTime:0.008001s ]
INFO: [ route_check ] --END-- [ RunTime:0.012001s ]
INFO: [ app_begin ] --START--
INFO: ReadHtmlCache Behavior ::run [ RunTime:0.010000s ]
INFO: [ app_begin ] --END-- [ RunTime:0.017001s ]
NOTIC: [8] Use of undefined constant i - assumed 'i' D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 16 行.
NOTIC: [8] Undefined index: i D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 16 行.
NOTIC: [8] Use of undefined constant i - assumed 'i' D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 17 行.
NOTIC: [8] Undefined index: i D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 17 行.
NOTIC: [8] Use of undefined constant i - assumed 'i' D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 16 行.
NOTIC: [8] Undefined index: i D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 16 行.
NOTIC: [8] Use of undefined constant i - assumed 'i' D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 17 行.
NOTIC: [8] Undefined index: i D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 17 行.
SQL: SELECT l.name,COALESCE(a.ucount,0) as yhs,COALESCE(c.ulcount,0) as dlyhs,COALESCE(c.logCount,0) as dlcs FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(ud.id) ucount FROM   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud     GROUP BY ud.locid  ) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>="2014-08-07 00:00:00" AND lo.login_time<"2014-08-08 00:00:00"   GROUP BY ud.locid) c ON l.id=c.locid WHERE l.id IN(,,) [ RunTime:0.001000s ]
ERR: 1064:You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near ',)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location' at line 1
 [ SQL语句 ] : SELECT l.name,COALESCE(a.ucount,0) as yhs,COALESCE(c.ulcount,0) as dlyhs,COALESCE(c.logCount,0) as dlcs FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(ud.id) ucount FROM   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud     GROUP BY ud.locid  ) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>="2014-08-07 00:00:00" AND lo.login_time<"2014-08-08 00:00:00"   GROUP BY ud.locid) c ON l.id=c.locid WHERE l.id IN(,,)
SQL: SELECT l.name,COALESCE(a.noticeCount,0) noticeCount,COALESCE(a.userCount,0) userCount FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(n.id) noticeCount,COUNT(DISTINCT ud.id) userCount FROM notice n,   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud   WHERE n.owner_id=ud.id AND n.publish_time>="2014-08-07 00:00:00"    AND n.publish_time<"2014-08-08 00:00:00" GROUP BY ud.locid) a  ON l.id=a.locid WHERE l.id IN(,,) [ RunTime:0.002001s ]
ERR: 1064:You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near ',)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location' at line 1
 [ SQL语句 ] : SELECT l.name,COALESCE(a.noticeCount,0) noticeCount,COALESCE(a.userCount,0) userCount FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(n.id) noticeCount,COUNT(DISTINCT ud.id) userCount FROM notice n,   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud   WHERE n.owner_id=ud.id AND n.publish_time>="2014-08-07 00:00:00"    AND n.publish_time<"2014-08-08 00:00:00" GROUP BY ud.locid) a  ON l.id=a.locid WHERE l.id IN(,,)
SQL: SELECT l.name,COALESCE(a.asCount,0) a,COALESCE(b.adminCount,0) b,COALESCE(c.noAdminCount,0) c FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(t.id) asCount FROM assignment t,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud  WHERE t.creator_id=ud.id AND t.create_time>="2014-08-07 00:00:00" AND  t.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) adminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud   WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='TechAdmin'   AND t.create_time>="2014-08-07 00:00:00" AND  t.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) noAdminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud  WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='Technician'   AND t.create_time>="2014-08-07 00:00:00" AND  t.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid ) c ON l.id=c.locid  WHERE l.id IN(,,) [ RunTime:0.001000s ]
ERR: 1064:You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near ',)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_' at line 1
 [ SQL语句 ] : SELECT l.name,COALESCE(a.asCount,0) a,COALESCE(b.adminCount,0) b,COALESCE(c.noAdminCount,0) c FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(t.id) asCount FROM assignment t,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud  WHERE t.creator_id=ud.id AND t.create_time>="2014-08-07 00:00:00" AND  t.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) adminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud   WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='TechAdmin'   AND t.create_time>="2014-08-07 00:00:00" AND  t.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) noAdminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud  WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='Technician'   AND t.create_time>="2014-08-07 00:00:00" AND  t.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid ) c ON l.id=c.locid  WHERE l.id IN(,,)
SQL: SELECT l.name,COALESCE(a.worklogCount,0) a,COALESCE(a.uCount,0) b,COALESCE(b.docCount,0) c,COALESCE(c.phoCount,0) d,COALESCE(d.audioCount,0) e FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(DISTINCT w.id) worklogCount,COUNT(DISTINCT w.owner_id) uCount FROM work_log w,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud  WHERE w.owner_id=ud.id    AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) docCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  AND i.media_type=1   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) phoCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  AND i.media_type=2   GROUP BY ud.locid ) c ON l.id=c.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) audioCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  AND i.media_type=3   GROUP BY ud.locid ) d ON l.id=d.locid   WHERE l.id IN(,,) [ RunTime:0.003000s ]
ERR: 1064:You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near ',)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_' at line 1
 [ SQL语句 ] : SELECT l.name,COALESCE(a.worklogCount,0) a,COALESCE(a.uCount,0) b,COALESCE(b.docCount,0) c,COALESCE(c.phoCount,0) d,COALESCE(d.audioCount,0) e FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(DISTINCT w.id) worklogCount,COUNT(DISTINCT w.owner_id) uCount FROM work_log w,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud  WHERE w.owner_id=ud.id    AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) docCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  AND i.media_type=1   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) phoCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  AND i.media_type=2   GROUP BY ud.locid ) c ON l.id=c.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) audioCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  AND i.media_type=3   GROUP BY ud.locid ) d ON l.id=d.locid   WHERE l.id IN(,,)
SQL: SELECT l.name,COALESCE(a.photoCount,0) a,COALESCE(a.ucount,0) b,COALESCE(b.priseCount,0) c,COALESCE(c.comCount,0) d FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(i.id) photoCount,COUNT(DISTINCT ud.id) ucount FROM album m,album_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud  WHERE m.owner_id=ud.id AND i.album_id=m.id   AND i.create_time>="2014-08-07 00:00:00" AND i.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,COUNT(uc.id) priseCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='AlbumItem'   AND uc.create_time>"2014-08-07 00:00:00" AND uc.create_time<"2014-08-08 00:00:00"   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(uc.id) comCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='SystemComment'   AND uc.create_time>="2014-08-07 00:00:00" AND uc.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) c ON l.id=c.locid  WHERE l.id IN(,,) [ RunTime:0.001000s ]
ERR: 1064:You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near ',)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_i' at line 1
 [ SQL语句 ] : SELECT l.name,COALESCE(a.photoCount,0) a,COALESCE(a.ucount,0) b,COALESCE(b.priseCount,0) c,COALESCE(c.comCount,0) d FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(i.id) photoCount,COUNT(DISTINCT ud.id) ucount FROM album m,album_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud  WHERE m.owner_id=ud.id AND i.album_id=m.id   AND i.create_time>="2014-08-07 00:00:00" AND i.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,COUNT(uc.id) priseCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='AlbumItem'   AND uc.create_time>"2014-08-07 00:00:00" AND uc.create_time<"2014-08-08 00:00:00"   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(uc.id) comCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='SystemComment'   AND uc.create_time>="2014-08-07 00:00:00" AND uc.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) c ON l.id=c.locid  WHERE l.id IN(,,)
SQL: SELECT a.rname a,l.name b,d.name c,a.age d FROM (SELECT u.id uid,u.real_name rname,u.location_id locid,u.dept_id depId,(2014-(SELECT SUBSTR(u.identify_value,7,4))+0) age FROM app_user u WHERE NOT EXISTS ( SELECT lo.user_id FROM login_log lo WHERE u.id=lo.user_id  ) AND u.id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)   UNION ALL SELECT u.id FROM app_user u WHERE u.location_id IN(,,) )) a,location l,department d WHERE a.depId=d.id AND a.locid=l.id [ RunTime:0.001000s ]
ERR: 1064:You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near ',)   UNION ALL SELECT u.id FROM app_user u WHERE u.location_id IN(,,) )) a,locat' at line 1
 [ SQL语句 ] : SELECT a.rname a,l.name b,d.name c,a.age d FROM (SELECT u.id uid,u.real_name rname,u.location_id locid,u.dept_id depId,(2014-(SELECT SUBSTR(u.identify_value,7,4))+0) age FROM app_user u WHERE NOT EXISTS ( SELECT lo.user_id FROM login_log lo WHERE u.id=lo.user_id  ) AND u.id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)   UNION ALL SELECT u.id FROM app_user u WHERE u.location_id IN(,,) )) a,location l,department d WHERE a.depId=d.id AND a.locid=l.id
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) AND lo.login_time>="2014-08-07 00:00:00" AND lo.login_time<"2014-08-08 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.412024s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) AND lo.login_time>="2014-08-07 00:00:00" AND lo.login_time<"2014-08-08 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.377022s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) AND lo.login_time>="2014-08-07 00:00:00" AND lo.login_time<"2014-08-08 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.380022s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) AND lo.login_time>="2014-08-07 00:00:00" AND lo.login_time<"2014-08-08 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.375022s ]
SQL: SELECT l.name,COALESCE(a.ulcount,0) b FROM  location l LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>=(TIMESTAMP(ADDDATE(DATE(SYSDATE()),-(DAYOFWEEK(NOW())-2))))   GROUP BY ud.locid) a ON a.locid=l.id WHERE l.id IN (,,) [ RunTime:0.002001s ]
ERR: 1064:You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near ',)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_' at line 1
 [ SQL语句 ] : SELECT l.name,COALESCE(a.ulcount,0) b FROM  location l LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>=(TIMESTAMP(ADDDATE(DATE(SYSDATE()),-(DAYOFWEEK(NOW())-2))))   GROUP BY ud.locid) a ON a.locid=l.id WHERE l.id IN (,,)
INFO: [ view_parse ] --START--
INFO: ParseTemplate Behavior ::run [ RunTime:0.516030s ]
INFO: [ view_parse ] --END-- [ RunTime:0.522030s ]
INFO: [ view_filter ] --START--
INFO: ContentReplace Behavior ::run [ RunTime:0.006000s ]
INFO: TokenBuild Behavior ::run [ RunTime:0.008000s ]
INFO: WriteHtmlCache Behavior ::run [ RunTime:0.004000s ]
INFO: ShowRuntime Behavior ::run [ RunTime:0.014001s ]
INFO: [ view_filter ] --END-- [ RunTime:0.047003s ]
INFO: [ view_end ] --START--
INFO: ShowPageTrace Behavior ::run [ RunTime:0.008001s ]
INFO: [ view_end ] --END-- [ RunTime:0.013001s ]

[ 2014-08-08T13:22:23+08:00 ] 127.0.0.1 /php_demo/shizhan/10/10wish/index.php/Njb/Index/tongji?checkbox%5B%5D=24521&checkbox%5B%5D=24543
INFO: [ route_check ] --START--
INFO: CheckRoute Behavior ::run [ RunTime:0.008000s ]
INFO: [ route_check ] --END-- [ RunTime:0.013001s ]
INFO: [ app_begin ] --START--
INFO: ReadHtmlCache Behavior ::run [ RunTime:0.010001s ]
INFO: [ app_begin ] --END-- [ RunTime:0.014001s ]
NOTIC: [8] Use of undefined constant i - assumed 'i' D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 16 行.
NOTIC: [8] Array to string conversion D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 16 行.
NOTIC: [8] Use of undefined constant i - assumed 'i' D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 17 行.
NOTIC: [8] Undefined index: i D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 17 行.
NOTIC: [8] Use of undefined constant i - assumed 'i' D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 16 行.
NOTIC: [8] Array to string conversion D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 16 行.
NOTIC: [8] Use of undefined constant i - assumed 'i' D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 17 行.
NOTIC: [8] Undefined index: i D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 17 行.
SQL: SELECT l.name,COALESCE(a.ucount,0) as yhs,COALESCE(c.ulcount,0) as dlyhs,COALESCE(c.logCount,0) as dlcs FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(ud.id) ucount FROM   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud     GROUP BY ud.locid  ) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>="2014-08-07 00:00:00" AND lo.login_time<"2014-08-08 00:00:00"   GROUP BY ud.locid) c ON l.id=c.locid WHERE l.id IN(,,) [ RunTime:0.001000s ]
ERR: 1064:You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near ',)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location' at line 1
 [ SQL语句 ] : SELECT l.name,COALESCE(a.ucount,0) as yhs,COALESCE(c.ulcount,0) as dlyhs,COALESCE(c.logCount,0) as dlcs FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(ud.id) ucount FROM   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud     GROUP BY ud.locid  ) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>="2014-08-07 00:00:00" AND lo.login_time<"2014-08-08 00:00:00"   GROUP BY ud.locid) c ON l.id=c.locid WHERE l.id IN(,,)
SQL: SELECT l.name,COALESCE(a.noticeCount,0) noticeCount,COALESCE(a.userCount,0) userCount FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(n.id) noticeCount,COUNT(DISTINCT ud.id) userCount FROM notice n,   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud   WHERE n.owner_id=ud.id AND n.publish_time>="2014-08-07 00:00:00"    AND n.publish_time<"2014-08-08 00:00:00" GROUP BY ud.locid) a  ON l.id=a.locid WHERE l.id IN(,,) [ RunTime:0.001001s ]
ERR: 1064:You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near ',)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location' at line 1
 [ SQL语句 ] : SELECT l.name,COALESCE(a.noticeCount,0) noticeCount,COALESCE(a.userCount,0) userCount FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(n.id) noticeCount,COUNT(DISTINCT ud.id) userCount FROM notice n,   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud   WHERE n.owner_id=ud.id AND n.publish_time>="2014-08-07 00:00:00"    AND n.publish_time<"2014-08-08 00:00:00" GROUP BY ud.locid) a  ON l.id=a.locid WHERE l.id IN(,,)
SQL: SELECT l.name,COALESCE(a.asCount,0) a,COALESCE(b.adminCount,0) b,COALESCE(c.noAdminCount,0) c FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(t.id) asCount FROM assignment t,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud  WHERE t.creator_id=ud.id AND t.create_time>="2014-08-07 00:00:00" AND  t.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) adminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud   WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='TechAdmin'   AND t.create_time>="2014-08-07 00:00:00" AND  t.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) noAdminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud  WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='Technician'   AND t.create_time>="2014-08-07 00:00:00" AND  t.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid ) c ON l.id=c.locid  WHERE l.id IN(,,) [ RunTime:0.001000s ]
ERR: 1064:You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near ',)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_' at line 1
 [ SQL语句 ] : SELECT l.name,COALESCE(a.asCount,0) a,COALESCE(b.adminCount,0) b,COALESCE(c.noAdminCount,0) c FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(t.id) asCount FROM assignment t,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud  WHERE t.creator_id=ud.id AND t.create_time>="2014-08-07 00:00:00" AND  t.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) adminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud   WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='TechAdmin'   AND t.create_time>="2014-08-07 00:00:00" AND  t.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) noAdminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud  WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='Technician'   AND t.create_time>="2014-08-07 00:00:00" AND  t.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid ) c ON l.id=c.locid  WHERE l.id IN(,,)
SQL: SELECT l.name,COALESCE(a.worklogCount,0) a,COALESCE(a.uCount,0) b,COALESCE(b.docCount,0) c,COALESCE(c.phoCount,0) d,COALESCE(d.audioCount,0) e FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(DISTINCT w.id) worklogCount,COUNT(DISTINCT w.owner_id) uCount FROM work_log w,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud  WHERE w.owner_id=ud.id    AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) docCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  AND i.media_type=1   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) phoCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  AND i.media_type=2   GROUP BY ud.locid ) c ON l.id=c.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) audioCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  AND i.media_type=3   GROUP BY ud.locid ) d ON l.id=d.locid   WHERE l.id IN(,,) [ RunTime:0.001000s ]
ERR: 1064:You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near ',)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_' at line 1
 [ SQL语句 ] : SELECT l.name,COALESCE(a.worklogCount,0) a,COALESCE(a.uCount,0) b,COALESCE(b.docCount,0) c,COALESCE(c.phoCount,0) d,COALESCE(d.audioCount,0) e FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(DISTINCT w.id) worklogCount,COUNT(DISTINCT w.owner_id) uCount FROM work_log w,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud  WHERE w.owner_id=ud.id    AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) docCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  AND i.media_type=1   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) phoCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  AND i.media_type=2   GROUP BY ud.locid ) c ON l.id=c.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) audioCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  AND i.media_type=3   GROUP BY ud.locid ) d ON l.id=d.locid   WHERE l.id IN(,,)
SQL: SELECT l.name,COALESCE(a.photoCount,0) a,COALESCE(a.ucount,0) b,COALESCE(b.priseCount,0) c,COALESCE(c.comCount,0) d FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(i.id) photoCount,COUNT(DISTINCT ud.id) ucount FROM album m,album_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud  WHERE m.owner_id=ud.id AND i.album_id=m.id   AND i.create_time>="2014-08-07 00:00:00" AND i.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,COUNT(uc.id) priseCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='AlbumItem'   AND uc.create_time>"2014-08-07 00:00:00" AND uc.create_time<"2014-08-08 00:00:00"   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(uc.id) comCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='SystemComment'   AND uc.create_time>="2014-08-07 00:00:00" AND uc.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) c ON l.id=c.locid  WHERE l.id IN(,,) [ RunTime:0.001001s ]
ERR: 1064:You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near ',)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_i' at line 1
 [ SQL语句 ] : SELECT l.name,COALESCE(a.photoCount,0) a,COALESCE(a.ucount,0) b,COALESCE(b.priseCount,0) c,COALESCE(c.comCount,0) d FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(i.id) photoCount,COUNT(DISTINCT ud.id) ucount FROM album m,album_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud  WHERE m.owner_id=ud.id AND i.album_id=m.id   AND i.create_time>="2014-08-07 00:00:00" AND i.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,COUNT(uc.id) priseCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='AlbumItem'   AND uc.create_time>"2014-08-07 00:00:00" AND uc.create_time<"2014-08-08 00:00:00"   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(uc.id) comCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='SystemComment'   AND uc.create_time>="2014-08-07 00:00:00" AND uc.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) c ON l.id=c.locid  WHERE l.id IN(,,)
SQL: SELECT a.rname a,l.name b,d.name c,a.age d FROM (SELECT u.id uid,u.real_name rname,u.location_id locid,u.dept_id depId,(2014-(SELECT SUBSTR(u.identify_value,7,4))+0) age FROM app_user u WHERE NOT EXISTS ( SELECT lo.user_id FROM login_log lo WHERE u.id=lo.user_id  ) AND u.id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)   UNION ALL SELECT u.id FROM app_user u WHERE u.location_id IN(,,) )) a,location l,department d WHERE a.depId=d.id AND a.locid=l.id [ RunTime:0.002000s ]
ERR: 1064:You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near ',)   UNION ALL SELECT u.id FROM app_user u WHERE u.location_id IN(,,) )) a,locat' at line 1
 [ SQL语句 ] : SELECT a.rname a,l.name b,d.name c,a.age d FROM (SELECT u.id uid,u.real_name rname,u.location_id locid,u.dept_id depId,(2014-(SELECT SUBSTR(u.identify_value,7,4))+0) age FROM app_user u WHERE NOT EXISTS ( SELECT lo.user_id FROM login_log lo WHERE u.id=lo.user_id  ) AND u.id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)   UNION ALL SELECT u.id FROM app_user u WHERE u.location_id IN(,,) )) a,location l,department d WHERE a.depId=d.id AND a.locid=l.id
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) AND lo.login_time>="2014-08-07 00:00:00" AND lo.login_time<"2014-08-08 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.377021s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) AND lo.login_time>="2014-08-07 00:00:00" AND lo.login_time<"2014-08-08 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.359020s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) AND lo.login_time>="2014-08-07 00:00:00" AND lo.login_time<"2014-08-08 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.378021s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) AND lo.login_time>="2014-08-07 00:00:00" AND lo.login_time<"2014-08-08 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.376021s ]
SQL: SELECT l.name,COALESCE(a.ulcount,0) b FROM  location l LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>=(TIMESTAMP(ADDDATE(DATE(SYSDATE()),-(DAYOFWEEK(NOW())-2))))   GROUP BY ud.locid) a ON a.locid=l.id WHERE l.id IN (,,) [ RunTime:0.001000s ]
ERR: 1064:You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near ',)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_' at line 1
 [ SQL语句 ] : SELECT l.name,COALESCE(a.ulcount,0) b FROM  location l LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>=(TIMESTAMP(ADDDATE(DATE(SYSDATE()),-(DAYOFWEEK(NOW())-2))))   GROUP BY ud.locid) a ON a.locid=l.id WHERE l.id IN (,,)
INFO: [ view_parse ] --START--
INFO: ParseTemplate Behavior ::run [ RunTime:0.513029s ]
INFO: [ view_parse ] --END-- [ RunTime:0.518029s ]
INFO: [ view_filter ] --START--
INFO: ContentReplace Behavior ::run [ RunTime:0.007000s ]
INFO: TokenBuild Behavior ::run [ RunTime:0.010001s ]
INFO: WriteHtmlCache Behavior ::run [ RunTime:0.005000s ]
INFO: ShowRuntime Behavior ::run [ RunTime:0.012001s ]
INFO: [ view_filter ] --END-- [ RunTime:0.046002s ]
INFO: [ view_end ] --START--
INFO: ShowPageTrace Behavior ::run [ RunTime:0.008000s ]
INFO: [ view_end ] --END-- [ RunTime:0.013000s ]

[ 2014-08-08T13:22:40+08:00 ] 127.0.0.1 /php_demo/shizhan/10/10wish/index.php/Njb/Index/tongji?checkbox%5B%5D=24521&checkbox%5B%5D=24543
INFO: [ route_check ] --START--
INFO: CheckRoute Behavior ::run [ RunTime:0.010000s ]
INFO: [ route_check ] --END-- [ RunTime:0.016001s ]
INFO: [ app_begin ] --START--
INFO: ReadHtmlCache Behavior ::run [ RunTime:0.013001s ]
INFO: [ app_begin ] --END-- [ RunTime:0.022001s ]
NOTIC: [8] Use of undefined constant i - assumed 'i' D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 17 行.
NOTIC: [8] Undefined index: i D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 17 行.
NOTIC: [8] Use of undefined constant i - assumed 'i' D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 17 行.
NOTIC: [8] Undefined index: i D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 17 行.
SQL: SELECT l.name,COALESCE(a.ucount,0) as yhs,COALESCE(c.ulcount,0) as dlyhs,COALESCE(c.logCount,0) as dlcs FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(ud.id) ucount FROM   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud     GROUP BY ud.locid  ) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>="2014-08-07 00:00:00" AND lo.login_time<"2014-08-08 00:00:00"   GROUP BY ud.locid) c ON l.id=c.locid WHERE l.id IN(,,) [ RunTime:0.002000s ]
ERR: 1064:You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near ',)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location' at line 1
 [ SQL语句 ] : SELECT l.name,COALESCE(a.ucount,0) as yhs,COALESCE(c.ulcount,0) as dlyhs,COALESCE(c.logCount,0) as dlcs FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(ud.id) ucount FROM   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud     GROUP BY ud.locid  ) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>="2014-08-07 00:00:00" AND lo.login_time<"2014-08-08 00:00:00"   GROUP BY ud.locid) c ON l.id=c.locid WHERE l.id IN(,,)
SQL: SELECT l.name,COALESCE(a.noticeCount,0) noticeCount,COALESCE(a.userCount,0) userCount FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(n.id) noticeCount,COUNT(DISTINCT ud.id) userCount FROM notice n,   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud   WHERE n.owner_id=ud.id AND n.publish_time>="2014-08-07 00:00:00"    AND n.publish_time<"2014-08-08 00:00:00" GROUP BY ud.locid) a  ON l.id=a.locid WHERE l.id IN(,,) [ RunTime:0.002000s ]
ERR: 1064:You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near ',)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location' at line 1
 [ SQL语句 ] : SELECT l.name,COALESCE(a.noticeCount,0) noticeCount,COALESCE(a.userCount,0) userCount FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(n.id) noticeCount,COUNT(DISTINCT ud.id) userCount FROM notice n,   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud   WHERE n.owner_id=ud.id AND n.publish_time>="2014-08-07 00:00:00"    AND n.publish_time<"2014-08-08 00:00:00" GROUP BY ud.locid) a  ON l.id=a.locid WHERE l.id IN(,,)
SQL: SELECT l.name,COALESCE(a.asCount,0) a,COALESCE(b.adminCount,0) b,COALESCE(c.noAdminCount,0) c FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(t.id) asCount FROM assignment t,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud  WHERE t.creator_id=ud.id AND t.create_time>="2014-08-07 00:00:00" AND  t.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) adminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud   WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='TechAdmin'   AND t.create_time>="2014-08-07 00:00:00" AND  t.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) noAdminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud  WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='Technician'   AND t.create_time>="2014-08-07 00:00:00" AND  t.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid ) c ON l.id=c.locid  WHERE l.id IN(,,) [ RunTime:0.001000s ]
ERR: 1064:You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near ',)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_' at line 1
 [ SQL语句 ] : SELECT l.name,COALESCE(a.asCount,0) a,COALESCE(b.adminCount,0) b,COALESCE(c.noAdminCount,0) c FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(t.id) asCount FROM assignment t,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud  WHERE t.creator_id=ud.id AND t.create_time>="2014-08-07 00:00:00" AND  t.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) adminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud   WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='TechAdmin'   AND t.create_time>="2014-08-07 00:00:00" AND  t.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) noAdminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud  WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='Technician'   AND t.create_time>="2014-08-07 00:00:00" AND  t.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid ) c ON l.id=c.locid  WHERE l.id IN(,,)
SQL: SELECT l.name,COALESCE(a.worklogCount,0) a,COALESCE(a.uCount,0) b,COALESCE(b.docCount,0) c,COALESCE(c.phoCount,0) d,COALESCE(d.audioCount,0) e FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(DISTINCT w.id) worklogCount,COUNT(DISTINCT w.owner_id) uCount FROM work_log w,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud  WHERE w.owner_id=ud.id    AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) docCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  AND i.media_type=1   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) phoCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  AND i.media_type=2   GROUP BY ud.locid ) c ON l.id=c.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) audioCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  AND i.media_type=3   GROUP BY ud.locid ) d ON l.id=d.locid   WHERE l.id IN(,,) [ RunTime:0.002000s ]
ERR: 1064:You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near ',)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_' at line 1
 [ SQL语句 ] : SELECT l.name,COALESCE(a.worklogCount,0) a,COALESCE(a.uCount,0) b,COALESCE(b.docCount,0) c,COALESCE(c.phoCount,0) d,COALESCE(d.audioCount,0) e FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(DISTINCT w.id) worklogCount,COUNT(DISTINCT w.owner_id) uCount FROM work_log w,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud  WHERE w.owner_id=ud.id    AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) docCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  AND i.media_type=1   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) phoCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  AND i.media_type=2   GROUP BY ud.locid ) c ON l.id=c.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) audioCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  AND i.media_type=3   GROUP BY ud.locid ) d ON l.id=d.locid   WHERE l.id IN(,,)
SQL: SELECT l.name,COALESCE(a.photoCount,0) a,COALESCE(a.ucount,0) b,COALESCE(b.priseCount,0) c,COALESCE(c.comCount,0) d FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(i.id) photoCount,COUNT(DISTINCT ud.id) ucount FROM album m,album_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud  WHERE m.owner_id=ud.id AND i.album_id=m.id   AND i.create_time>="2014-08-07 00:00:00" AND i.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,COUNT(uc.id) priseCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='AlbumItem'   AND uc.create_time>"2014-08-07 00:00:00" AND uc.create_time<"2014-08-08 00:00:00"   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(uc.id) comCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='SystemComment'   AND uc.create_time>="2014-08-07 00:00:00" AND uc.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) c ON l.id=c.locid  WHERE l.id IN(,,) [ RunTime:0.001000s ]
ERR: 1064:You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near ',)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_i' at line 1
 [ SQL语句 ] : SELECT l.name,COALESCE(a.photoCount,0) a,COALESCE(a.ucount,0) b,COALESCE(b.priseCount,0) c,COALESCE(c.comCount,0) d FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(i.id) photoCount,COUNT(DISTINCT ud.id) ucount FROM album m,album_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud  WHERE m.owner_id=ud.id AND i.album_id=m.id   AND i.create_time>="2014-08-07 00:00:00" AND i.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,COUNT(uc.id) priseCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='AlbumItem'   AND uc.create_time>"2014-08-07 00:00:00" AND uc.create_time<"2014-08-08 00:00:00"   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(uc.id) comCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='SystemComment'   AND uc.create_time>="2014-08-07 00:00:00" AND uc.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) c ON l.id=c.locid  WHERE l.id IN(,,)
SQL: SELECT a.rname a,l.name b,d.name c,a.age d FROM (SELECT u.id uid,u.real_name rname,u.location_id locid,u.dept_id depId,(2014-(SELECT SUBSTR(u.identify_value,7,4))+0) age FROM app_user u WHERE NOT EXISTS ( SELECT lo.user_id FROM login_log lo WHERE u.id=lo.user_id  ) AND u.id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)   UNION ALL SELECT u.id FROM app_user u WHERE u.location_id IN(,,) )) a,location l,department d WHERE a.depId=d.id AND a.locid=l.id [ RunTime:0.001000s ]
ERR: 1064:You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near ',)   UNION ALL SELECT u.id FROM app_user u WHERE u.location_id IN(,,) )) a,locat' at line 1
 [ SQL语句 ] : SELECT a.rname a,l.name b,d.name c,a.age d FROM (SELECT u.id uid,u.real_name rname,u.location_id locid,u.dept_id depId,(2014-(SELECT SUBSTR(u.identify_value,7,4))+0) age FROM app_user u WHERE NOT EXISTS ( SELECT lo.user_id FROM login_log lo WHERE u.id=lo.user_id  ) AND u.id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)   UNION ALL SELECT u.id FROM app_user u WHERE u.location_id IN(,,) )) a,location l,department d WHERE a.depId=d.id AND a.locid=l.id
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) AND lo.login_time>="2014-08-07 00:00:00" AND lo.login_time<"2014-08-08 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.416024s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) AND lo.login_time>="2014-08-07 00:00:00" AND lo.login_time<"2014-08-08 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.363021s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) AND lo.login_time>="2014-08-07 00:00:00" AND lo.login_time<"2014-08-08 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.381021s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) AND lo.login_time>="2014-08-07 00:00:00" AND lo.login_time<"2014-08-08 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.369021s ]
SQL: SELECT l.name,COALESCE(a.ulcount,0) b FROM  location l LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>=(TIMESTAMP(ADDDATE(DATE(SYSDATE()),-(DAYOFWEEK(NOW())-2))))   GROUP BY ud.locid) a ON a.locid=l.id WHERE l.id IN (,,) [ RunTime:0.001000s ]
ERR: 1064:You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near ',)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_' at line 1
 [ SQL语句 ] : SELECT l.name,COALESCE(a.ulcount,0) b FROM  location l LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>=(TIMESTAMP(ADDDATE(DATE(SYSDATE()),-(DAYOFWEEK(NOW())-2))))   GROUP BY ud.locid) a ON a.locid=l.id WHERE l.id IN (,,)
INFO: [ view_parse ] --START--
INFO: ParseTemplate Behavior ::run [ RunTime:0.516029s ]
INFO: [ view_parse ] --END-- [ RunTime:0.523029s ]
INFO: [ view_filter ] --START--
INFO: ContentReplace Behavior ::run [ RunTime:0.011001s ]
INFO: TokenBuild Behavior ::run [ RunTime:0.013001s ]
INFO: WriteHtmlCache Behavior ::run [ RunTime:0.005000s ]
INFO: ShowRuntime Behavior ::run [ RunTime:0.016001s ]
INFO: [ view_filter ] --END-- [ RunTime:0.061003s ]
INFO: [ view_end ] --START--
INFO: ShowPageTrace Behavior ::run [ RunTime:0.010000s ]
INFO: [ view_end ] --END-- [ RunTime:0.015000s ]

[ 2014-08-08T13:23:00+08:00 ] 127.0.0.1 /php_demo/shizhan/10/10wish/index.php/Njb/Index/tongji?checkbox%5B%5D=24521&checkbox%5B%5D=24543
INFO: [ route_check ] --START--
INFO: CheckRoute Behavior ::run [ RunTime:0.007000s ]
INFO: [ route_check ] --END-- [ RunTime:0.012001s ]
INFO: [ app_begin ] --START--
INFO: ReadHtmlCache Behavior ::run [ RunTime:0.012001s ]
INFO: [ app_begin ] --END-- [ RunTime:0.018001s ]
NOTIC: [8] Use of undefined constant i - assumed 'i' D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 17 行.
NOTIC: [8] Undefined index: i D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 17 行.
NOTIC: [8] Use of undefined constant i - assumed 'i' D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 17 行.
NOTIC: [8] Undefined index: i D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 17 行.
SQL: SELECT l.name,COALESCE(a.ucount,0) as yhs,COALESCE(c.ulcount,0) as dlyhs,COALESCE(c.logCount,0) as dlcs FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(ud.id) ucount FROM   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud     GROUP BY ud.locid  ) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>="2014-08-07 00:00:00" AND lo.login_time<"2014-08-08 00:00:00"   GROUP BY ud.locid) c ON l.id=c.locid WHERE l.id IN(,,) [ RunTime:0.002000s ]
ERR: 1064:You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near ',)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location' at line 1
 [ SQL语句 ] : SELECT l.name,COALESCE(a.ucount,0) as yhs,COALESCE(c.ulcount,0) as dlyhs,COALESCE(c.logCount,0) as dlcs FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(ud.id) ucount FROM   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud     GROUP BY ud.locid  ) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>="2014-08-07 00:00:00" AND lo.login_time<"2014-08-08 00:00:00"   GROUP BY ud.locid) c ON l.id=c.locid WHERE l.id IN(,,)
SQL: SELECT l.name,COALESCE(a.noticeCount,0) noticeCount,COALESCE(a.userCount,0) userCount FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(n.id) noticeCount,COUNT(DISTINCT ud.id) userCount FROM notice n,   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud   WHERE n.owner_id=ud.id AND n.publish_time>="2014-08-07 00:00:00"    AND n.publish_time<"2014-08-08 00:00:00" GROUP BY ud.locid) a  ON l.id=a.locid WHERE l.id IN(,,) [ RunTime:0.002000s ]
ERR: 1064:You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near ',)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location' at line 1
 [ SQL语句 ] : SELECT l.name,COALESCE(a.noticeCount,0) noticeCount,COALESCE(a.userCount,0) userCount FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(n.id) noticeCount,COUNT(DISTINCT ud.id) userCount FROM notice n,   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud   WHERE n.owner_id=ud.id AND n.publish_time>="2014-08-07 00:00:00"    AND n.publish_time<"2014-08-08 00:00:00" GROUP BY ud.locid) a  ON l.id=a.locid WHERE l.id IN(,,)
SQL: SELECT l.name,COALESCE(a.asCount,0) a,COALESCE(b.adminCount,0) b,COALESCE(c.noAdminCount,0) c FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(t.id) asCount FROM assignment t,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud  WHERE t.creator_id=ud.id AND t.create_time>="2014-08-07 00:00:00" AND  t.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) adminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud   WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='TechAdmin'   AND t.create_time>="2014-08-07 00:00:00" AND  t.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) noAdminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud  WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='Technician'   AND t.create_time>="2014-08-07 00:00:00" AND  t.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid ) c ON l.id=c.locid  WHERE l.id IN(,,) [ RunTime:0.002000s ]
ERR: 1064:You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near ',)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_' at line 1
 [ SQL语句 ] : SELECT l.name,COALESCE(a.asCount,0) a,COALESCE(b.adminCount,0) b,COALESCE(c.noAdminCount,0) c FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(t.id) asCount FROM assignment t,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud  WHERE t.creator_id=ud.id AND t.create_time>="2014-08-07 00:00:00" AND  t.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) adminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud   WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='TechAdmin'   AND t.create_time>="2014-08-07 00:00:00" AND  t.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) noAdminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud  WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='Technician'   AND t.create_time>="2014-08-07 00:00:00" AND  t.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid ) c ON l.id=c.locid  WHERE l.id IN(,,)
SQL: SELECT l.name,COALESCE(a.worklogCount,0) a,COALESCE(a.uCount,0) b,COALESCE(b.docCount,0) c,COALESCE(c.phoCount,0) d,COALESCE(d.audioCount,0) e FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(DISTINCT w.id) worklogCount,COUNT(DISTINCT w.owner_id) uCount FROM work_log w,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud  WHERE w.owner_id=ud.id    AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) docCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  AND i.media_type=1   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) phoCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  AND i.media_type=2   GROUP BY ud.locid ) c ON l.id=c.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) audioCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  AND i.media_type=3   GROUP BY ud.locid ) d ON l.id=d.locid   WHERE l.id IN(,,) [ RunTime:0.001000s ]
ERR: 1064:You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near ',)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_' at line 1
 [ SQL语句 ] : SELECT l.name,COALESCE(a.worklogCount,0) a,COALESCE(a.uCount,0) b,COALESCE(b.docCount,0) c,COALESCE(c.phoCount,0) d,COALESCE(d.audioCount,0) e FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(DISTINCT w.id) worklogCount,COUNT(DISTINCT w.owner_id) uCount FROM work_log w,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud  WHERE w.owner_id=ud.id    AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) docCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  AND i.media_type=1   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) phoCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  AND i.media_type=2   GROUP BY ud.locid ) c ON l.id=c.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) audioCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  AND i.media_type=3   GROUP BY ud.locid ) d ON l.id=d.locid   WHERE l.id IN(,,)
SQL: SELECT l.name,COALESCE(a.photoCount,0) a,COALESCE(a.ucount,0) b,COALESCE(b.priseCount,0) c,COALESCE(c.comCount,0) d FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(i.id) photoCount,COUNT(DISTINCT ud.id) ucount FROM album m,album_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud  WHERE m.owner_id=ud.id AND i.album_id=m.id   AND i.create_time>="2014-08-07 00:00:00" AND i.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,COUNT(uc.id) priseCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='AlbumItem'   AND uc.create_time>"2014-08-07 00:00:00" AND uc.create_time<"2014-08-08 00:00:00"   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(uc.id) comCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='SystemComment'   AND uc.create_time>="2014-08-07 00:00:00" AND uc.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) c ON l.id=c.locid  WHERE l.id IN(,,) [ RunTime:0.002000s ]
ERR: 1064:You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near ',)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_i' at line 1
 [ SQL语句 ] : SELECT l.name,COALESCE(a.photoCount,0) a,COALESCE(a.ucount,0) b,COALESCE(b.priseCount,0) c,COALESCE(c.comCount,0) d FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(i.id) photoCount,COUNT(DISTINCT ud.id) ucount FROM album m,album_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud  WHERE m.owner_id=ud.id AND i.album_id=m.id   AND i.create_time>="2014-08-07 00:00:00" AND i.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,COUNT(uc.id) priseCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='AlbumItem'   AND uc.create_time>"2014-08-07 00:00:00" AND uc.create_time<"2014-08-08 00:00:00"   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(uc.id) comCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='SystemComment'   AND uc.create_time>="2014-08-07 00:00:00" AND uc.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) c ON l.id=c.locid  WHERE l.id IN(,,)
SQL: SELECT a.rname a,l.name b,d.name c,a.age d FROM (SELECT u.id uid,u.real_name rname,u.location_id locid,u.dept_id depId,(2014-(SELECT SUBSTR(u.identify_value,7,4))+0) age FROM app_user u WHERE NOT EXISTS ( SELECT lo.user_id FROM login_log lo WHERE u.id=lo.user_id  ) AND u.id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)   UNION ALL SELECT u.id FROM app_user u WHERE u.location_id IN(,,) )) a,location l,department d WHERE a.depId=d.id AND a.locid=l.id [ RunTime:0.002000s ]
ERR: 1064:You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near ',)   UNION ALL SELECT u.id FROM app_user u WHERE u.location_id IN(,,) )) a,locat' at line 1
 [ SQL语句 ] : SELECT a.rname a,l.name b,d.name c,a.age d FROM (SELECT u.id uid,u.real_name rname,u.location_id locid,u.dept_id depId,(2014-(SELECT SUBSTR(u.identify_value,7,4))+0) age FROM app_user u WHERE NOT EXISTS ( SELECT lo.user_id FROM login_log lo WHERE u.id=lo.user_id  ) AND u.id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)   UNION ALL SELECT u.id FROM app_user u WHERE u.location_id IN(,,) )) a,location l,department d WHERE a.depId=d.id AND a.locid=l.id
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) AND lo.login_time>="2014-08-07 00:00:00" AND lo.login_time<"2014-08-08 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.427024s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) AND lo.login_time>="2014-08-07 00:00:00" AND lo.login_time<"2014-08-08 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.366021s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) AND lo.login_time>="2014-08-07 00:00:00" AND lo.login_time<"2014-08-08 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.388022s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) AND lo.login_time>="2014-08-07 00:00:00" AND lo.login_time<"2014-08-08 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.367021s ]
SQL: SELECT l.name,COALESCE(a.ulcount,0) b FROM  location l LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>=(TIMESTAMP(ADDDATE(DATE(SYSDATE()),-(DAYOFWEEK(NOW())-2))))   GROUP BY ud.locid) a ON a.locid=l.id WHERE l.id IN (,,) [ RunTime:0.002001s ]
ERR: 1064:You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near ',)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_' at line 1
 [ SQL语句 ] : SELECT l.name,COALESCE(a.ulcount,0) b FROM  location l LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>=(TIMESTAMP(ADDDATE(DATE(SYSDATE()),-(DAYOFWEEK(NOW())-2))))   GROUP BY ud.locid) a ON a.locid=l.id WHERE l.id IN (,,)
INFO: [ view_parse ] --START--
INFO: ParseTemplate Behavior ::run [ RunTime:0.516030s ]
INFO: [ view_parse ] --END-- [ RunTime:0.522030s ]
INFO: [ view_filter ] --START--
INFO: ContentReplace Behavior ::run [ RunTime:0.011000s ]
INFO: TokenBuild Behavior ::run [ RunTime:0.012000s ]
INFO: WriteHtmlCache Behavior ::run [ RunTime:0.004001s ]
INFO: ShowRuntime Behavior ::run [ RunTime:0.012000s ]
INFO: [ view_filter ] --END-- [ RunTime:0.055003s ]
INFO: [ view_end ] --START--
INFO: ShowPageTrace Behavior ::run [ RunTime:0.010001s ]
INFO: [ view_end ] --END-- [ RunTime:0.016001s ]

[ 2014-08-08T13:24:59+08:00 ] 127.0.0.1 /php_demo/shizhan/10/10wish/index.php/Njb/Index/tongji?checkbox%5B%5D=24521&checkbox%5B%5D=24543
INFO: [ route_check ] --START--
INFO: CheckRoute Behavior ::run [ RunTime:0.006001s ]
INFO: [ route_check ] --END-- [ RunTime:0.011001s ]
INFO: [ app_begin ] --START--
INFO: ReadHtmlCache Behavior ::run [ RunTime:0.010000s ]
INFO: [ app_begin ] --END-- [ RunTime:0.016001s ]
NOTIC: [8] Use of undefined constant i - assumed 'i' D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 17 行.
NOTIC: [8] Undefined index: i D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 17 行.
NOTIC: [8] Use of undefined constant i - assumed 'i' D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 17 行.
NOTIC: [8] Undefined index: i D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 17 行.
SQL: SELECT l.name,COALESCE(a.ucount,0) as yhs,COALESCE(c.ulcount,0) as dlyhs,COALESCE(c.logCount,0) as dlcs FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(ud.id) ucount FROM   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud     GROUP BY ud.locid  ) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>="2014-08-07 00:00:00" AND lo.login_time<"2014-08-08 00:00:00"   GROUP BY ud.locid) c ON l.id=c.locid WHERE l.id IN(,,) [ RunTime:0.001000s ]
ERR: 1064:You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near ',)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location' at line 1
 [ SQL语句 ] : SELECT l.name,COALESCE(a.ucount,0) as yhs,COALESCE(c.ulcount,0) as dlyhs,COALESCE(c.logCount,0) as dlcs FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(ud.id) ucount FROM   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud     GROUP BY ud.locid  ) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>="2014-08-07 00:00:00" AND lo.login_time<"2014-08-08 00:00:00"   GROUP BY ud.locid) c ON l.id=c.locid WHERE l.id IN(,,)
SQL: SELECT l.name,COALESCE(a.noticeCount,0) noticeCount,COALESCE(a.userCount,0) userCount FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(n.id) noticeCount,COUNT(DISTINCT ud.id) userCount FROM notice n,   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud   WHERE n.owner_id=ud.id AND n.publish_time>="2014-08-07 00:00:00"    AND n.publish_time<"2014-08-08 00:00:00" GROUP BY ud.locid) a  ON l.id=a.locid WHERE l.id IN(,,) [ RunTime:0.001000s ]
ERR: 1064:You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near ',)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location' at line 1
 [ SQL语句 ] : SELECT l.name,COALESCE(a.noticeCount,0) noticeCount,COALESCE(a.userCount,0) userCount FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(n.id) noticeCount,COUNT(DISTINCT ud.id) userCount FROM notice n,   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud   WHERE n.owner_id=ud.id AND n.publish_time>="2014-08-07 00:00:00"    AND n.publish_time<"2014-08-08 00:00:00" GROUP BY ud.locid) a  ON l.id=a.locid WHERE l.id IN(,,)
SQL: SELECT l.name,COALESCE(a.asCount,0) a,COALESCE(b.adminCount,0) b,COALESCE(c.noAdminCount,0) c FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(t.id) asCount FROM assignment t,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud  WHERE t.creator_id=ud.id AND t.create_time>="2014-08-07 00:00:00" AND  t.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) adminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud   WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='TechAdmin'   AND t.create_time>="2014-08-07 00:00:00" AND  t.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) noAdminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud  WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='Technician'   AND t.create_time>="2014-08-07 00:00:00" AND  t.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid ) c ON l.id=c.locid  WHERE l.id IN(,,) [ RunTime:0.001000s ]
ERR: 1064:You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near ',)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_' at line 1
 [ SQL语句 ] : SELECT l.name,COALESCE(a.asCount,0) a,COALESCE(b.adminCount,0) b,COALESCE(c.noAdminCount,0) c FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(t.id) asCount FROM assignment t,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud  WHERE t.creator_id=ud.id AND t.create_time>="2014-08-07 00:00:00" AND  t.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) adminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud   WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='TechAdmin'   AND t.create_time>="2014-08-07 00:00:00" AND  t.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) noAdminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud  WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='Technician'   AND t.create_time>="2014-08-07 00:00:00" AND  t.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid ) c ON l.id=c.locid  WHERE l.id IN(,,)
SQL: SELECT l.name,COALESCE(a.worklogCount,0) a,COALESCE(a.uCount,0) b,COALESCE(b.docCount,0) c,COALESCE(c.phoCount,0) d,COALESCE(d.audioCount,0) e FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(DISTINCT w.id) worklogCount,COUNT(DISTINCT w.owner_id) uCount FROM work_log w,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud  WHERE w.owner_id=ud.id    AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) docCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  AND i.media_type=1   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) phoCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  AND i.media_type=2   GROUP BY ud.locid ) c ON l.id=c.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) audioCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  AND i.media_type=3   GROUP BY ud.locid ) d ON l.id=d.locid   WHERE l.id IN(,,) [ RunTime:0.001000s ]
ERR: 1064:You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near ',)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_' at line 1
 [ SQL语句 ] : SELECT l.name,COALESCE(a.worklogCount,0) a,COALESCE(a.uCount,0) b,COALESCE(b.docCount,0) c,COALESCE(c.phoCount,0) d,COALESCE(d.audioCount,0) e FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(DISTINCT w.id) worklogCount,COUNT(DISTINCT w.owner_id) uCount FROM work_log w,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud  WHERE w.owner_id=ud.id    AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) docCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  AND i.media_type=1   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) phoCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  AND i.media_type=2   GROUP BY ud.locid ) c ON l.id=c.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) audioCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  AND i.media_type=3   GROUP BY ud.locid ) d ON l.id=d.locid   WHERE l.id IN(,,)
SQL: SELECT l.name,COALESCE(a.photoCount,0) a,COALESCE(a.ucount,0) b,COALESCE(b.priseCount,0) c,COALESCE(c.comCount,0) d FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(i.id) photoCount,COUNT(DISTINCT ud.id) ucount FROM album m,album_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud  WHERE m.owner_id=ud.id AND i.album_id=m.id   AND i.create_time>="2014-08-07 00:00:00" AND i.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,COUNT(uc.id) priseCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='AlbumItem'   AND uc.create_time>"2014-08-07 00:00:00" AND uc.create_time<"2014-08-08 00:00:00"   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(uc.id) comCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='SystemComment'   AND uc.create_time>="2014-08-07 00:00:00" AND uc.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) c ON l.id=c.locid  WHERE l.id IN(,,) [ RunTime:0.001000s ]
ERR: 1064:You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near ',)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_i' at line 1
 [ SQL语句 ] : SELECT l.name,COALESCE(a.photoCount,0) a,COALESCE(a.ucount,0) b,COALESCE(b.priseCount,0) c,COALESCE(c.comCount,0) d FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(i.id) photoCount,COUNT(DISTINCT ud.id) ucount FROM album m,album_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud  WHERE m.owner_id=ud.id AND i.album_id=m.id   AND i.create_time>="2014-08-07 00:00:00" AND i.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,COUNT(uc.id) priseCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='AlbumItem'   AND uc.create_time>"2014-08-07 00:00:00" AND uc.create_time<"2014-08-08 00:00:00"   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(uc.id) comCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='SystemComment'   AND uc.create_time>="2014-08-07 00:00:00" AND uc.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) c ON l.id=c.locid  WHERE l.id IN(,,)
SQL: SELECT a.rname a,l.name b,d.name c,a.age d FROM (SELECT u.id uid,u.real_name rname,u.location_id locid,u.dept_id depId,(2014-(SELECT SUBSTR(u.identify_value,7,4))+0) age FROM app_user u WHERE NOT EXISTS ( SELECT lo.user_id FROM login_log lo WHERE u.id=lo.user_id  ) AND u.id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)   UNION ALL SELECT u.id FROM app_user u WHERE u.location_id IN(,,) )) a,location l,department d WHERE a.depId=d.id AND a.locid=l.id [ RunTime:0.001000s ]
ERR: 1064:You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near ',)   UNION ALL SELECT u.id FROM app_user u WHERE u.location_id IN(,,) )) a,locat' at line 1
 [ SQL语句 ] : SELECT a.rname a,l.name b,d.name c,a.age d FROM (SELECT u.id uid,u.real_name rname,u.location_id locid,u.dept_id depId,(2014-(SELECT SUBSTR(u.identify_value,7,4))+0) age FROM app_user u WHERE NOT EXISTS ( SELECT lo.user_id FROM login_log lo WHERE u.id=lo.user_id  ) AND u.id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)   UNION ALL SELECT u.id FROM app_user u WHERE u.location_id IN(,,) )) a,location l,department d WHERE a.depId=d.id AND a.locid=l.id
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) AND lo.login_time>="2014-08-07 00:00:00" AND lo.login_time<"2014-08-08 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.382022s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) AND lo.login_time>="2014-08-07 00:00:00" AND lo.login_time<"2014-08-08 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.360021s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) AND lo.login_time>="2014-08-07 00:00:00" AND lo.login_time<"2014-08-08 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.369021s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) AND lo.login_time>="2014-08-07 00:00:00" AND lo.login_time<"2014-08-08 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.379022s ]
SQL: SELECT l.name,COALESCE(a.ulcount,0) b FROM  location l LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>=(TIMESTAMP(ADDDATE(DATE(SYSDATE()),-(DAYOFWEEK(NOW())-2))))   GROUP BY ud.locid) a ON a.locid=l.id WHERE l.id IN (,,) [ RunTime:0.002000s ]
ERR: 1064:You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near ',)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_' at line 1
 [ SQL语句 ] : SELECT l.name,COALESCE(a.ulcount,0) b FROM  location l LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>=(TIMESTAMP(ADDDATE(DATE(SYSDATE()),-(DAYOFWEEK(NOW())-2))))   GROUP BY ud.locid) a ON a.locid=l.id WHERE l.id IN (,,)
INFO: [ view_parse ] --START--
INFO: ParseTemplate Behavior ::run [ RunTime:0.509029s ]
INFO: [ view_parse ] --END-- [ RunTime:0.515029s ]
INFO: [ view_filter ] --START--
INFO: ContentReplace Behavior ::run [ RunTime:0.007000s ]
INFO: TokenBuild Behavior ::run [ RunTime:0.009001s ]
INFO: WriteHtmlCache Behavior ::run [ RunTime:0.005000s ]
INFO: ShowRuntime Behavior ::run [ RunTime:0.015000s ]
INFO: [ view_filter ] --END-- [ RunTime:0.051003s ]
INFO: [ view_end ] --START--
INFO: ShowPageTrace Behavior ::run [ RunTime:0.008000s ]
INFO: [ view_end ] --END-- [ RunTime:0.013001s ]

[ 2014-08-08T13:26:34+08:00 ] 127.0.0.1 /php_demo/shizhan/10/10wish/index.php/Njb/Index/tongji?checkbox%5B%5D=24521&checkbox%5B%5D=24543
INFO: [ route_check ] --START--
INFO: CheckRoute Behavior ::run [ RunTime:0.007000s ]
INFO: [ route_check ] --END-- [ RunTime:0.011000s ]
INFO: [ app_begin ] --START--
INFO: ReadHtmlCache Behavior ::run [ RunTime:0.010001s ]
INFO: [ app_begin ] --END-- [ RunTime:0.014001s ]
NOTIC: [8] Use of undefined constant i - assumed 'i' D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 18 行.
NOTIC: [8] Undefined index: i D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 18 行.
NOTIC: [8] Use of undefined constant i - assumed 'i' D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 18 行.
NOTIC: [8] Undefined index: i D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 18 行.
SQL: SELECT l.name,COALESCE(a.ucount,0) as yhs,COALESCE(c.ulcount,0) as dlyhs,COALESCE(c.logCount,0) as dlcs FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(ud.id) ucount FROM   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud     GROUP BY ud.locid  ) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>="2014-08-07 00:00:00" AND lo.login_time<"2014-08-08 00:00:00"   GROUP BY ud.locid) c ON l.id=c.locid WHERE l.id IN(,,) [ RunTime:0.001000s ]
ERR: 1064:You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near ',)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location' at line 1
 [ SQL语句 ] : SELECT l.name,COALESCE(a.ucount,0) as yhs,COALESCE(c.ulcount,0) as dlyhs,COALESCE(c.logCount,0) as dlcs FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(ud.id) ucount FROM   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud     GROUP BY ud.locid  ) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>="2014-08-07 00:00:00" AND lo.login_time<"2014-08-08 00:00:00"   GROUP BY ud.locid) c ON l.id=c.locid WHERE l.id IN(,,)
SQL: SELECT l.name,COALESCE(a.noticeCount,0) noticeCount,COALESCE(a.userCount,0) userCount FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(n.id) noticeCount,COUNT(DISTINCT ud.id) userCount FROM notice n,   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud   WHERE n.owner_id=ud.id AND n.publish_time>="2014-08-07 00:00:00"    AND n.publish_time<"2014-08-08 00:00:00" GROUP BY ud.locid) a  ON l.id=a.locid WHERE l.id IN(,,) [ RunTime:0.001000s ]
ERR: 1064:You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near ',)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location' at line 1
 [ SQL语句 ] : SELECT l.name,COALESCE(a.noticeCount,0) noticeCount,COALESCE(a.userCount,0) userCount FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(n.id) noticeCount,COUNT(DISTINCT ud.id) userCount FROM notice n,   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud   WHERE n.owner_id=ud.id AND n.publish_time>="2014-08-07 00:00:00"    AND n.publish_time<"2014-08-08 00:00:00" GROUP BY ud.locid) a  ON l.id=a.locid WHERE l.id IN(,,)
SQL: SELECT l.name,COALESCE(a.asCount,0) a,COALESCE(b.adminCount,0) b,COALESCE(c.noAdminCount,0) c FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(t.id) asCount FROM assignment t,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud  WHERE t.creator_id=ud.id AND t.create_time>="2014-08-07 00:00:00" AND  t.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) adminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud   WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='TechAdmin'   AND t.create_time>="2014-08-07 00:00:00" AND  t.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) noAdminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud  WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='Technician'   AND t.create_time>="2014-08-07 00:00:00" AND  t.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid ) c ON l.id=c.locid  WHERE l.id IN(,,) [ RunTime:0.001000s ]
ERR: 1064:You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near ',)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_' at line 1
 [ SQL语句 ] : SELECT l.name,COALESCE(a.asCount,0) a,COALESCE(b.adminCount,0) b,COALESCE(c.noAdminCount,0) c FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(t.id) asCount FROM assignment t,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud  WHERE t.creator_id=ud.id AND t.create_time>="2014-08-07 00:00:00" AND  t.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) adminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud   WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='TechAdmin'   AND t.create_time>="2014-08-07 00:00:00" AND  t.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) noAdminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud  WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='Technician'   AND t.create_time>="2014-08-07 00:00:00" AND  t.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid ) c ON l.id=c.locid  WHERE l.id IN(,,)
SQL: SELECT l.name,COALESCE(a.worklogCount,0) a,COALESCE(a.uCount,0) b,COALESCE(b.docCount,0) c,COALESCE(c.phoCount,0) d,COALESCE(d.audioCount,0) e FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(DISTINCT w.id) worklogCount,COUNT(DISTINCT w.owner_id) uCount FROM work_log w,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud  WHERE w.owner_id=ud.id    AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) docCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  AND i.media_type=1   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) phoCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  AND i.media_type=2   GROUP BY ud.locid ) c ON l.id=c.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) audioCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  AND i.media_type=3   GROUP BY ud.locid ) d ON l.id=d.locid   WHERE l.id IN(,,) [ RunTime:0.002000s ]
ERR: 1064:You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near ',)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_' at line 1
 [ SQL语句 ] : SELECT l.name,COALESCE(a.worklogCount,0) a,COALESCE(a.uCount,0) b,COALESCE(b.docCount,0) c,COALESCE(c.phoCount,0) d,COALESCE(d.audioCount,0) e FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(DISTINCT w.id) worklogCount,COUNT(DISTINCT w.owner_id) uCount FROM work_log w,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud  WHERE w.owner_id=ud.id    AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) docCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  AND i.media_type=1   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) phoCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  AND i.media_type=2   GROUP BY ud.locid ) c ON l.id=c.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) audioCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  AND i.media_type=3   GROUP BY ud.locid ) d ON l.id=d.locid   WHERE l.id IN(,,)
SQL: SELECT l.name,COALESCE(a.photoCount,0) a,COALESCE(a.ucount,0) b,COALESCE(b.priseCount,0) c,COALESCE(c.comCount,0) d FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(i.id) photoCount,COUNT(DISTINCT ud.id) ucount FROM album m,album_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud  WHERE m.owner_id=ud.id AND i.album_id=m.id   AND i.create_time>="2014-08-07 00:00:00" AND i.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,COUNT(uc.id) priseCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='AlbumItem'   AND uc.create_time>"2014-08-07 00:00:00" AND uc.create_time<"2014-08-08 00:00:00"   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(uc.id) comCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='SystemComment'   AND uc.create_time>="2014-08-07 00:00:00" AND uc.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) c ON l.id=c.locid  WHERE l.id IN(,,) [ RunTime:0.002000s ]
ERR: 1064:You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near ',)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_i' at line 1
 [ SQL语句 ] : SELECT l.name,COALESCE(a.photoCount,0) a,COALESCE(a.ucount,0) b,COALESCE(b.priseCount,0) c,COALESCE(c.comCount,0) d FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(i.id) photoCount,COUNT(DISTINCT ud.id) ucount FROM album m,album_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud  WHERE m.owner_id=ud.id AND i.album_id=m.id   AND i.create_time>="2014-08-07 00:00:00" AND i.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,COUNT(uc.id) priseCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='AlbumItem'   AND uc.create_time>"2014-08-07 00:00:00" AND uc.create_time<"2014-08-08 00:00:00"   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(uc.id) comCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='SystemComment'   AND uc.create_time>="2014-08-07 00:00:00" AND uc.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) c ON l.id=c.locid  WHERE l.id IN(,,)
SQL: SELECT a.rname a,l.name b,d.name c,a.age d FROM (SELECT u.id uid,u.real_name rname,u.location_id locid,u.dept_id depId,(2014-(SELECT SUBSTR(u.identify_value,7,4))+0) age FROM app_user u WHERE NOT EXISTS ( SELECT lo.user_id FROM login_log lo WHERE u.id=lo.user_id  ) AND u.id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)   UNION ALL SELECT u.id FROM app_user u WHERE u.location_id IN(,,) )) a,location l,department d WHERE a.depId=d.id AND a.locid=l.id [ RunTime:0.001000s ]
ERR: 1064:You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near ',)   UNION ALL SELECT u.id FROM app_user u WHERE u.location_id IN(,,) )) a,locat' at line 1
 [ SQL语句 ] : SELECT a.rname a,l.name b,d.name c,a.age d FROM (SELECT u.id uid,u.real_name rname,u.location_id locid,u.dept_id depId,(2014-(SELECT SUBSTR(u.identify_value,7,4))+0) age FROM app_user u WHERE NOT EXISTS ( SELECT lo.user_id FROM login_log lo WHERE u.id=lo.user_id  ) AND u.id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)   UNION ALL SELECT u.id FROM app_user u WHERE u.location_id IN(,,) )) a,location l,department d WHERE a.depId=d.id AND a.locid=l.id
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) AND lo.login_time>="2014-08-07 00:00:00" AND lo.login_time<"2014-08-08 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.369022s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) AND lo.login_time>="2014-08-07 00:00:00" AND lo.login_time<"2014-08-08 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.361021s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) AND lo.login_time>="2014-08-07 00:00:00" AND lo.login_time<"2014-08-08 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.461027s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) AND lo.login_time>="2014-08-07 00:00:00" AND lo.login_time<"2014-08-08 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.458026s ]
SQL: SELECT l.name,COALESCE(a.ulcount,0) b FROM  location l LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>=(TIMESTAMP(ADDDATE(DATE(SYSDATE()),-(DAYOFWEEK(NOW())-2))))   GROUP BY ud.locid) a ON a.locid=l.id WHERE l.id IN (,,) [ RunTime:0.001000s ]
ERR: 1064:You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near ',)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_' at line 1
 [ SQL语句 ] : SELECT l.name,COALESCE(a.ulcount,0) b FROM  location l LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,,)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,,)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>=(TIMESTAMP(ADDDATE(DATE(SYSDATE()),-(DAYOFWEEK(NOW())-2))))   GROUP BY ud.locid) a ON a.locid=l.id WHERE l.id IN (,,)
INFO: [ view_parse ] --START--
INFO: ParseTemplate Behavior ::run [ RunTime:0.619035s ]
INFO: [ view_parse ] --END-- [ RunTime:0.626036s ]
INFO: [ view_filter ] --START--
INFO: ContentReplace Behavior ::run [ RunTime:0.010001s ]
INFO: TokenBuild Behavior ::run [ RunTime:0.016001s ]
INFO: WriteHtmlCache Behavior ::run [ RunTime:0.005000s ]
INFO: ShowRuntime Behavior ::run [ RunTime:0.012001s ]
INFO: [ view_filter ] --END-- [ RunTime:0.060003s ]
INFO: [ view_end ] --START--
INFO: ShowPageTrace Behavior ::run [ RunTime:0.007000s ]
INFO: [ view_end ] --END-- [ RunTime:0.014000s ]

[ 2014-08-08T13:26:51+08:00 ] 127.0.0.1 /php_demo/shizhan/10/10wish/index.php/Njb/Index/tongji?checkbox%5B%5D=24521&checkbox%5B%5D=24543
INFO: [ route_check ] --START--
INFO: CheckRoute Behavior ::run [ RunTime:0.008000s ]
INFO: [ route_check ] --END-- [ RunTime:0.014001s ]
INFO: [ app_begin ] --START--
INFO: ReadHtmlCache Behavior ::run [ RunTime:0.011001s ]
INFO: [ app_begin ] --END-- [ RunTime:0.015001s ]
SQL: SELECT l.name,COALESCE(a.ucount,0) as yhs,COALESCE(c.ulcount,0) as dlyhs,COALESCE(c.logCount,0) as dlcs FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(ud.id) ucount FROM   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,24521,24543)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,24521,24543)) ud     GROUP BY ud.locid  ) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,24521,24543)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,24521,24543)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>="2014-08-07 00:00:00" AND lo.login_time<"2014-08-08 00:00:00"   GROUP BY ud.locid) c ON l.id=c.locid WHERE l.id IN(,24521,24543) [ RunTime:0.001000s ]
ERR: 1064:You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near '24521,24543)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE ' at line 1
 [ SQL语句 ] : SELECT l.name,COALESCE(a.ucount,0) as yhs,COALESCE(c.ulcount,0) as dlyhs,COALESCE(c.logCount,0) as dlcs FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(ud.id) ucount FROM   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,24521,24543)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,24521,24543)) ud     GROUP BY ud.locid  ) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,24521,24543)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,24521,24543)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>="2014-08-07 00:00:00" AND lo.login_time<"2014-08-08 00:00:00"   GROUP BY ud.locid) c ON l.id=c.locid WHERE l.id IN(,24521,24543)
SQL: SELECT l.name,COALESCE(a.noticeCount,0) noticeCount,COALESCE(a.userCount,0) userCount FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(n.id) noticeCount,COUNT(DISTINCT ud.id) userCount FROM notice n,   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,24521,24543)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,24521,24543)) ud   WHERE n.owner_id=ud.id AND n.publish_time>="2014-08-07 00:00:00"    AND n.publish_time<"2014-08-08 00:00:00" GROUP BY ud.locid) a  ON l.id=a.locid WHERE l.id IN(,24521,24543) [ RunTime:0.001000s ]
ERR: 1064:You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near '24521,24543)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE ' at line 1
 [ SQL语句 ] : SELECT l.name,COALESCE(a.noticeCount,0) noticeCount,COALESCE(a.userCount,0) userCount FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(n.id) noticeCount,COUNT(DISTINCT ud.id) userCount FROM notice n,   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,24521,24543)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,24521,24543)) ud   WHERE n.owner_id=ud.id AND n.publish_time>="2014-08-07 00:00:00"    AND n.publish_time<"2014-08-08 00:00:00" GROUP BY ud.locid) a  ON l.id=a.locid WHERE l.id IN(,24521,24543)
SQL: SELECT l.name,COALESCE(a.asCount,0) a,COALESCE(b.adminCount,0) b,COALESCE(c.noAdminCount,0) c FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(t.id) asCount FROM assignment t,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,24521,24543)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,24521,24543)) ud  WHERE t.creator_id=ud.id AND t.create_time>="2014-08-07 00:00:00" AND  t.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) adminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,24521,24543)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,24521,24543)) ud   WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='TechAdmin'   AND t.create_time>="2014-08-07 00:00:00" AND  t.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) noAdminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,24521,24543)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,24521,24543)) ud  WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='Technician'   AND t.create_time>="2014-08-07 00:00:00" AND  t.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid ) c ON l.id=c.locid  WHERE l.id IN(,24521,24543) [ RunTime:0.002000s ]
ERR: 1064:You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near '24521,24543)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u' at line 1
 [ SQL语句 ] : SELECT l.name,COALESCE(a.asCount,0) a,COALESCE(b.adminCount,0) b,COALESCE(c.noAdminCount,0) c FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(t.id) asCount FROM assignment t,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,24521,24543)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,24521,24543)) ud  WHERE t.creator_id=ud.id AND t.create_time>="2014-08-07 00:00:00" AND  t.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) adminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,24521,24543)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,24521,24543)) ud   WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='TechAdmin'   AND t.create_time>="2014-08-07 00:00:00" AND  t.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) noAdminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,24521,24543)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,24521,24543)) ud  WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='Technician'   AND t.create_time>="2014-08-07 00:00:00" AND  t.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid ) c ON l.id=c.locid  WHERE l.id IN(,24521,24543)
SQL: SELECT l.name,COALESCE(a.worklogCount,0) a,COALESCE(a.uCount,0) b,COALESCE(b.docCount,0) c,COALESCE(c.phoCount,0) d,COALESCE(d.audioCount,0) e FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(DISTINCT w.id) worklogCount,COUNT(DISTINCT w.owner_id) uCount FROM work_log w,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,24521,24543)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,24521,24543)) ud  WHERE w.owner_id=ud.id    AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) docCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,24521,24543)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,24521,24543)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  AND i.media_type=1   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) phoCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,24521,24543)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,24521,24543)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  AND i.media_type=2   GROUP BY ud.locid ) c ON l.id=c.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) audioCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,24521,24543)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,24521,24543)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  AND i.media_type=3   GROUP BY ud.locid ) d ON l.id=d.locid   WHERE l.id IN(,24521,24543) [ RunTime:0.002000s ]
ERR: 1064:You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near '24521,24543)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u' at line 1
 [ SQL语句 ] : SELECT l.name,COALESCE(a.worklogCount,0) a,COALESCE(a.uCount,0) b,COALESCE(b.docCount,0) c,COALESCE(c.phoCount,0) d,COALESCE(d.audioCount,0) e FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(DISTINCT w.id) worklogCount,COUNT(DISTINCT w.owner_id) uCount FROM work_log w,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,24521,24543)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,24521,24543)) ud  WHERE w.owner_id=ud.id    AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) docCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,24521,24543)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,24521,24543)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  AND i.media_type=1   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) phoCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,24521,24543)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,24521,24543)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  AND i.media_type=2   GROUP BY ud.locid ) c ON l.id=c.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) audioCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,24521,24543)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,24521,24543)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  AND i.media_type=3   GROUP BY ud.locid ) d ON l.id=d.locid   WHERE l.id IN(,24521,24543)
SQL: SELECT l.name,COALESCE(a.photoCount,0) a,COALESCE(a.ucount,0) b,COALESCE(b.priseCount,0) c,COALESCE(c.comCount,0) d FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(i.id) photoCount,COUNT(DISTINCT ud.id) ucount FROM album m,album_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,24521,24543)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,24521,24543)) ud  WHERE m.owner_id=ud.id AND i.album_id=m.id   AND i.create_time>="2014-08-07 00:00:00" AND i.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,COUNT(uc.id) priseCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,24521,24543)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,24521,24543)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='AlbumItem'   AND uc.create_time>"2014-08-07 00:00:00" AND uc.create_time<"2014-08-08 00:00:00"   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(uc.id) comCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,24521,24543)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,24521,24543)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='SystemComment'   AND uc.create_time>="2014-08-07 00:00:00" AND uc.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) c ON l.id=c.locid  WHERE l.id IN(,24521,24543) [ RunTime:0.001000s ]
ERR: 1064:You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near '24521,24543)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.' at line 1
 [ SQL语句 ] : SELECT l.name,COALESCE(a.photoCount,0) a,COALESCE(a.ucount,0) b,COALESCE(b.priseCount,0) c,COALESCE(c.comCount,0) d FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(i.id) photoCount,COUNT(DISTINCT ud.id) ucount FROM album m,album_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,24521,24543)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,24521,24543)) ud  WHERE m.owner_id=ud.id AND i.album_id=m.id   AND i.create_time>="2014-08-07 00:00:00" AND i.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,COUNT(uc.id) priseCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,24521,24543)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,24521,24543)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='AlbumItem'   AND uc.create_time>"2014-08-07 00:00:00" AND uc.create_time<"2014-08-08 00:00:00"   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(uc.id) comCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,24521,24543)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,24521,24543)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='SystemComment'   AND uc.create_time>="2014-08-07 00:00:00" AND uc.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) c ON l.id=c.locid  WHERE l.id IN(,24521,24543)
SQL: SELECT a.rname a,l.name b,d.name c,a.age d FROM (SELECT u.id uid,u.real_name rname,u.location_id locid,u.dept_id depId,(2014-(SELECT SUBSTR(u.identify_value,7,4))+0) age FROM app_user u WHERE NOT EXISTS ( SELECT lo.user_id FROM login_log lo WHERE u.id=lo.user_id  ) AND u.id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,24521,24543)   UNION ALL SELECT u.id FROM app_user u WHERE u.location_id IN(,24521,24543) )) a,location l,department d WHERE a.depId=d.id AND a.locid=l.id [ RunTime:0.001000s ]
ERR: 1064:You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near '24521,24543)   UNION ALL SELECT u.id FROM app_user u WHERE u.location_id IN(,245' at line 1
 [ SQL语句 ] : SELECT a.rname a,l.name b,d.name c,a.age d FROM (SELECT u.id uid,u.real_name rname,u.location_id locid,u.dept_id depId,(2014-(SELECT SUBSTR(u.identify_value,7,4))+0) age FROM app_user u WHERE NOT EXISTS ( SELECT lo.user_id FROM login_log lo WHERE u.id=lo.user_id  ) AND u.id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,24521,24543)   UNION ALL SELECT u.id FROM app_user u WHERE u.location_id IN(,24521,24543) )) a,location l,department d WHERE a.depId=d.id AND a.locid=l.id
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) AND lo.login_time>="2014-08-07 00:00:00" AND lo.login_time<"2014-08-08 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.415024s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) AND lo.login_time>="2014-08-07 00:00:00" AND lo.login_time<"2014-08-08 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.389022s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) AND lo.login_time>="2014-08-07 00:00:00" AND lo.login_time<"2014-08-08 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.384022s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) AND lo.login_time>="2014-08-07 00:00:00" AND lo.login_time<"2014-08-08 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.371021s ]
SQL: SELECT l.name,COALESCE(a.ulcount,0) b FROM  location l LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,24521,24543)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,24521,24543)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>=(TIMESTAMP(ADDDATE(DATE(SYSDATE()),-(DAYOFWEEK(NOW())-2))))   GROUP BY ud.locid) a ON a.locid=l.id WHERE l.id IN (,24521,24543) [ RunTime:0.001000s ]
ERR: 1064:You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near '24521,24543)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u' at line 1
 [ SQL语句 ] : SELECT l.name,COALESCE(a.ulcount,0) b FROM  location l LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,24521,24543)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,24521,24543)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>=(TIMESTAMP(ADDDATE(DATE(SYSDATE()),-(DAYOFWEEK(NOW())-2))))   GROUP BY ud.locid) a ON a.locid=l.id WHERE l.id IN (,24521,24543)
INFO: [ view_parse ] --START--
INFO: ParseTemplate Behavior ::run [ RunTime:0.516029s ]
INFO: [ view_parse ] --END-- [ RunTime:0.521029s ]
INFO: [ view_filter ] --START--
INFO: ContentReplace Behavior ::run [ RunTime:0.006000s ]
INFO: TokenBuild Behavior ::run [ RunTime:0.009001s ]
INFO: WriteHtmlCache Behavior ::run [ RunTime:0.005000s ]
INFO: ShowRuntime Behavior ::run [ RunTime:0.012001s ]
INFO: [ view_filter ] --END-- [ RunTime:0.045002s ]
INFO: [ view_end ] --START--
INFO: ShowPageTrace Behavior ::run [ RunTime:0.008000s ]
INFO: [ view_end ] --END-- [ RunTime:0.012000s ]

[ 2014-08-08T13:29:32+08:00 ] 127.0.0.1 /php_demo/shizhan/10/10wish/index.php/Njb/Index/tongji?checkbox%5B%5D=24521&checkbox%5B%5D=24543
INFO: [ route_check ] --START--
INFO: CheckRoute Behavior ::run [ RunTime:0.006000s ]
INFO: [ route_check ] --END-- [ RunTime:0.012000s ]
INFO: [ app_begin ] --START--
INFO: ReadHtmlCache Behavior ::run [ RunTime:0.008001s ]
INFO: [ app_begin ] --END-- [ RunTime:0.013001s ]
SQL: SELECT l.name,COALESCE(a.ucount,0) as yhs,COALESCE(c.ulcount,0) as dlyhs,COALESCE(c.logCount,0) as dlcs FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(ud.id) ucount FROM   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543)) ud     GROUP BY ud.locid  ) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>="2014-08-07 00:00:00" AND lo.login_time<"2014-08-08 00:00:00"   GROUP BY ud.locid) c ON l.id=c.locid WHERE l.id IN(24521,24543) [ RunTime:0.027002s ]
SQL: SELECT l.name,COALESCE(a.noticeCount,0) noticeCount,COALESCE(a.userCount,0) userCount FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(n.id) noticeCount,COUNT(DISTINCT ud.id) userCount FROM notice n,   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543)) ud   WHERE n.owner_id=ud.id AND n.publish_time>="2014-08-07 00:00:00"    AND n.publish_time<"2014-08-08 00:00:00" GROUP BY ud.locid) a  ON l.id=a.locid WHERE l.id IN(24521,24543) [ RunTime:0.002000s ]
SQL: SELECT l.name,COALESCE(a.asCount,0) a,COALESCE(b.adminCount,0) b,COALESCE(c.noAdminCount,0) c FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(t.id) asCount FROM assignment t,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543)) ud  WHERE t.creator_id=ud.id AND t.create_time>="2014-08-07 00:00:00" AND  t.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) adminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543)) ud   WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='TechAdmin'   AND t.create_time>="2014-08-07 00:00:00" AND  t.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) noAdminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543)) ud  WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='Technician'   AND t.create_time>="2014-08-07 00:00:00" AND  t.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid ) c ON l.id=c.locid  WHERE l.id IN(24521,24543) [ RunTime:0.006000s ]
SQL: SELECT l.name,COALESCE(a.worklogCount,0) a,COALESCE(a.uCount,0) b,COALESCE(b.docCount,0) c,COALESCE(c.phoCount,0) d,COALESCE(d.audioCount,0) e FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(DISTINCT w.id) worklogCount,COUNT(DISTINCT w.owner_id) uCount FROM work_log w,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543)) ud  WHERE w.owner_id=ud.id    AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) docCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  AND i.media_type=1   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) phoCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  AND i.media_type=2   GROUP BY ud.locid ) c ON l.id=c.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) audioCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  AND i.media_type=3   GROUP BY ud.locid ) d ON l.id=d.locid   WHERE l.id IN(24521,24543) [ RunTime:0.021001s ]
SQL: SELECT l.name,COALESCE(a.photoCount,0) a,COALESCE(a.ucount,0) b,COALESCE(b.priseCount,0) c,COALESCE(c.comCount,0) d FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(i.id) photoCount,COUNT(DISTINCT ud.id) ucount FROM album m,album_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543)) ud  WHERE m.owner_id=ud.id AND i.album_id=m.id   AND i.create_time>="2014-08-07 00:00:00" AND i.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,COUNT(uc.id) priseCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='AlbumItem'   AND uc.create_time>"2014-08-07 00:00:00" AND uc.create_time<"2014-08-08 00:00:00"   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(uc.id) comCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='SystemComment'   AND uc.create_time>="2014-08-07 00:00:00" AND uc.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) c ON l.id=c.locid  WHERE l.id IN(24521,24543) [ RunTime:0.008001s ]
SQL: SELECT a.rname a,l.name b,d.name c,a.age d FROM (SELECT u.id uid,u.real_name rname,u.location_id locid,u.dept_id depId,(2014-(SELECT SUBSTR(u.identify_value,7,4))+0) age FROM app_user u WHERE NOT EXISTS ( SELECT lo.user_id FROM login_log lo WHERE u.id=lo.user_id  ) AND u.id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543)   UNION ALL SELECT u.id FROM app_user u WHERE u.location_id IN(24521,24543) )) a,location l,department d WHERE a.depId=d.id AND a.locid=l.id [ RunTime:2.129122s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) AND lo.login_time>="2014-08-07 00:00:00" AND lo.login_time<"2014-08-08 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.405023s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) AND lo.login_time>="2014-08-07 00:00:00" AND lo.login_time<"2014-08-08 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.381022s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) AND lo.login_time>="2014-08-07 00:00:00" AND lo.login_time<"2014-08-08 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.379021s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) AND lo.login_time>="2014-08-07 00:00:00" AND lo.login_time<"2014-08-08 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.381021s ]
SQL: SELECT l.name,COALESCE(a.ulcount,0) b FROM  location l LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>=(TIMESTAMP(ADDDATE(DATE(SYSDATE()),-(DAYOFWEEK(NOW())-2))))   GROUP BY ud.locid) a ON a.locid=l.id WHERE l.id IN (24521,24543) [ RunTime:0.073004s ]
INFO: [ view_parse ] --START--
INFO: ParseTemplate Behavior ::run [ RunTime:0.597034s ]
INFO: [ view_parse ] --END-- [ RunTime:0.601034s ]
INFO: [ view_filter ] --START--
INFO: ContentReplace Behavior ::run [ RunTime:0.009000s ]
INFO: TokenBuild Behavior ::run [ RunTime:0.010001s ]
INFO: WriteHtmlCache Behavior ::run [ RunTime:0.005000s ]
INFO: ShowRuntime Behavior ::run [ RunTime:0.013001s ]
INFO: [ view_filter ] --END-- [ RunTime:0.049003s ]
INFO: [ view_end ] --START--
INFO: ShowPageTrace Behavior ::run [ RunTime:0.010000s ]
INFO: [ view_end ] --END-- [ RunTime:0.017001s ]

[ 2014-08-08T13:54:20+08:00 ] 127.0.0.1 /php_demo/shizhan/10/10wish/index.php/Njb/Index/tongji?checkbox%5B%5D=24521&checkbox%5B%5D=24543
INFO: [ route_check ] --START--
INFO: CheckRoute Behavior ::run [ RunTime:0.007000s ]
INFO: [ route_check ] --END-- [ RunTime:0.012001s ]
INFO: [ app_begin ] --START--
INFO: ReadHtmlCache Behavior ::run [ RunTime:0.011001s ]
INFO: [ app_begin ] --END-- [ RunTime:0.017001s ]
SQL: SELECT l.name,COALESCE(a.ucount,0) as yhs,COALESCE(c.ulcount,0) as dlyhs,COALESCE(c.logCount,0) as dlcs FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(ud.id) ucount FROM   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543)) ud     GROUP BY ud.locid  ) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>="2014-08-07 00:00:00" AND lo.login_time<"2014-08-08 00:00:00"   GROUP BY ud.locid) c ON l.id=c.locid WHERE l.id IN(24521,24543) [ RunTime:0.028001s ]
SQL: SELECT l.name,COALESCE(a.noticeCount,0) noticeCount,COALESCE(a.userCount,0) userCount FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(n.id) noticeCount,COUNT(DISTINCT ud.id) userCount FROM notice n,   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543)) ud   WHERE n.owner_id=ud.id AND n.publish_time>="2014-08-07 00:00:00"    AND n.publish_time<"2014-08-08 00:00:00" GROUP BY ud.locid) a  ON l.id=a.locid WHERE l.id IN(24521,24543) [ RunTime:0.003000s ]
SQL: SELECT l.name,COALESCE(a.asCount,0) a,COALESCE(b.adminCount,0) b,COALESCE(c.noAdminCount,0) c FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(t.id) asCount FROM assignment t,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543)) ud  WHERE t.creator_id=ud.id AND t.create_time>="2014-08-07 00:00:00" AND  t.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) adminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543)) ud   WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='TechAdmin'   AND t.create_time>="2014-08-07 00:00:00" AND  t.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) noAdminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543)) ud  WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='Technician'   AND t.create_time>="2014-08-07 00:00:00" AND  t.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid ) c ON l.id=c.locid  WHERE l.id IN(24521,24543) [ RunTime:0.006001s ]
SQL: SELECT l.name,COALESCE(a.worklogCount,0) a,COALESCE(a.uCount,0) b,COALESCE(b.docCount,0) c,COALESCE(c.phoCount,0) d,COALESCE(d.audioCount,0) e FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(DISTINCT w.id) worklogCount,COUNT(DISTINCT w.owner_id) uCount FROM work_log w,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543)) ud  WHERE w.owner_id=ud.id    AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) docCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  AND i.media_type=1   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) phoCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  AND i.media_type=2   GROUP BY ud.locid ) c ON l.id=c.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) audioCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  AND i.media_type=3   GROUP BY ud.locid ) d ON l.id=d.locid   WHERE l.id IN(24521,24543) [ RunTime:0.019001s ]
SQL: SELECT l.name,COALESCE(a.photoCount,0) a,COALESCE(a.ucount,0) b,COALESCE(b.priseCount,0) c,COALESCE(c.comCount,0) d FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(i.id) photoCount,COUNT(DISTINCT ud.id) ucount FROM album m,album_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543)) ud  WHERE m.owner_id=ud.id AND i.album_id=m.id   AND i.create_time>="2014-08-07 00:00:00" AND i.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,COUNT(uc.id) priseCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='AlbumItem'   AND uc.create_time>"2014-08-07 00:00:00" AND uc.create_time<"2014-08-08 00:00:00"   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(uc.id) comCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='SystemComment'   AND uc.create_time>="2014-08-07 00:00:00" AND uc.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) c ON l.id=c.locid  WHERE l.id IN(24521,24543) [ RunTime:0.008001s ]
SQL: SELECT a.rname a,l.name b,d.name c,a.age d FROM (SELECT u.id uid,u.real_name rname,u.location_id locid,u.dept_id depId,(2014-(SELECT SUBSTR(u.identify_value,7,4))+0) age FROM app_user u WHERE NOT EXISTS ( SELECT lo.user_id FROM login_log lo WHERE u.id=lo.user_id  ) AND u.id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543)   UNION ALL SELECT u.id FROM app_user u WHERE u.location_id IN(24521,24543) )) a,location l,department d WHERE a.depId=d.id AND a.locid=l.id [ RunTime:2.177125s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) AND lo.login_time>="2014-08-07 00:00:00" AND lo.login_time<"2014-08-08 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.405024s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) AND lo.login_time>="2014-08-07 00:00:00" AND lo.login_time<"2014-08-08 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.388022s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) AND lo.login_time>="2014-08-07 00:00:00" AND lo.login_time<"2014-08-08 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.381021s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) AND lo.login_time>="2014-08-07 00:00:00" AND lo.login_time<"2014-08-08 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.383022s ]
SQL: SELECT l.name,COALESCE(a.ulcount,0) b FROM  location l LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>=(TIMESTAMP(ADDDATE(DATE(SYSDATE()),-(DAYOFWEEK(NOW())-2))))   GROUP BY ud.locid) a ON a.locid=l.id WHERE l.id IN (24521,24543) [ RunTime:0.076005s ]
INFO: [ view_parse ] --START--
INFO: ParseTemplate Behavior ::run [ RunTime:0.529030s ]
INFO: [ view_parse ] --END-- [ RunTime:0.534031s ]
INFO: [ view_filter ] --START--
INFO: ContentReplace Behavior ::run [ RunTime:0.008001s ]
INFO: TokenBuild Behavior ::run [ RunTime:0.010000s ]
INFO: WriteHtmlCache Behavior ::run [ RunTime:0.004000s ]
INFO: ShowRuntime Behavior ::run [ RunTime:0.012001s ]
INFO: [ view_filter ] --END-- [ RunTime:0.048003s ]
INFO: [ view_end ] --START--
INFO: ShowPageTrace Behavior ::run [ RunTime:0.009001s ]
INFO: [ view_end ] --END-- [ RunTime:0.013001s ]

[ 2014-08-08T13:57:24+08:00 ] 127.0.0.1 /php_demo/shizhan/10/10wish/index.php/Njb/Index/tongji?checkbox%5B%5D=24521&checkbox%5B%5D=24543
INFO: [ route_check ] --START--
INFO: CheckRoute Behavior ::run [ RunTime:0.007001s ]
INFO: [ route_check ] --END-- [ RunTime:0.012001s ]
INFO: [ app_begin ] --START--
INFO: ReadHtmlCache Behavior ::run [ RunTime:0.009000s ]
INFO: [ app_begin ] --END-- [ RunTime:0.013000s ]
NOTIC: [8] Undefined variable: district_nums D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 15 行.
SQL: SELECT l.name,COALESCE(a.ucount,0) as yhs,COALESCE(c.ulcount,0) as dlyhs,COALESCE(c.logCount,0) as dlcs FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(ud.id) ucount FROM   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,24543)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,24543)) ud     GROUP BY ud.locid  ) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,24543)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,24543)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>="2014-08-07 00:00:00" AND lo.login_time<"2014-08-08 00:00:00"   GROUP BY ud.locid) c ON l.id=c.locid WHERE l.id IN(,24543) [ RunTime:0.001000s ]
ERR: 1064:You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near '24543)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.loca' at line 1
 [ SQL语句 ] : SELECT l.name,COALESCE(a.ucount,0) as yhs,COALESCE(c.ulcount,0) as dlyhs,COALESCE(c.logCount,0) as dlcs FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(ud.id) ucount FROM   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,24543)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,24543)) ud     GROUP BY ud.locid  ) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,24543)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,24543)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>="2014-08-07 00:00:00" AND lo.login_time<"2014-08-08 00:00:00"   GROUP BY ud.locid) c ON l.id=c.locid WHERE l.id IN(,24543)
SQL: SELECT l.name,COALESCE(a.noticeCount,0) noticeCount,COALESCE(a.userCount,0) userCount FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(n.id) noticeCount,COUNT(DISTINCT ud.id) userCount FROM notice n,   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,24543)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,24543)) ud   WHERE n.owner_id=ud.id AND n.publish_time>="2014-08-07 00:00:00"    AND n.publish_time<"2014-08-08 00:00:00" GROUP BY ud.locid) a  ON l.id=a.locid WHERE l.id IN(,24543) [ RunTime:0.001000s ]
ERR: 1064:You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near '24543)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.loca' at line 1
 [ SQL语句 ] : SELECT l.name,COALESCE(a.noticeCount,0) noticeCount,COALESCE(a.userCount,0) userCount FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(n.id) noticeCount,COUNT(DISTINCT ud.id) userCount FROM notice n,   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,24543)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,24543)) ud   WHERE n.owner_id=ud.id AND n.publish_time>="2014-08-07 00:00:00"    AND n.publish_time<"2014-08-08 00:00:00" GROUP BY ud.locid) a  ON l.id=a.locid WHERE l.id IN(,24543)
SQL: SELECT l.name,COALESCE(a.asCount,0) a,COALESCE(b.adminCount,0) b,COALESCE(c.noAdminCount,0) c FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(t.id) asCount FROM assignment t,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,24543)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,24543)) ud  WHERE t.creator_id=ud.id AND t.create_time>="2014-08-07 00:00:00" AND  t.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) adminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,24543)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,24543)) ud   WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='TechAdmin'   AND t.create_time>="2014-08-07 00:00:00" AND  t.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) noAdminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,24543)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,24543)) ud  WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='Technician'   AND t.create_time>="2014-08-07 00:00:00" AND  t.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid ) c ON l.id=c.locid  WHERE l.id IN(,24543) [ RunTime:0.001000s ]
ERR: 1064:You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near '24543)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.locat' at line 1
 [ SQL语句 ] : SELECT l.name,COALESCE(a.asCount,0) a,COALESCE(b.adminCount,0) b,COALESCE(c.noAdminCount,0) c FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(t.id) asCount FROM assignment t,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,24543)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,24543)) ud  WHERE t.creator_id=ud.id AND t.create_time>="2014-08-07 00:00:00" AND  t.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) adminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,24543)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,24543)) ud   WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='TechAdmin'   AND t.create_time>="2014-08-07 00:00:00" AND  t.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) noAdminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,24543)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,24543)) ud  WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='Technician'   AND t.create_time>="2014-08-07 00:00:00" AND  t.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid ) c ON l.id=c.locid  WHERE l.id IN(,24543)
SQL: SELECT l.name,COALESCE(a.worklogCount,0) a,COALESCE(a.uCount,0) b,COALESCE(b.docCount,0) c,COALESCE(c.phoCount,0) d,COALESCE(d.audioCount,0) e FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(DISTINCT w.id) worklogCount,COUNT(DISTINCT w.owner_id) uCount FROM work_log w,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,24543)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,24543)) ud  WHERE w.owner_id=ud.id    AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) docCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,24543)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,24543)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  AND i.media_type=1   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) phoCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,24543)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,24543)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  AND i.media_type=2   GROUP BY ud.locid ) c ON l.id=c.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) audioCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,24543)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,24543)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  AND i.media_type=3   GROUP BY ud.locid ) d ON l.id=d.locid   WHERE l.id IN(,24543) [ RunTime:0.001000s ]
ERR: 1064:You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near '24543)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.locat' at line 1
 [ SQL语句 ] : SELECT l.name,COALESCE(a.worklogCount,0) a,COALESCE(a.uCount,0) b,COALESCE(b.docCount,0) c,COALESCE(c.phoCount,0) d,COALESCE(d.audioCount,0) e FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(DISTINCT w.id) worklogCount,COUNT(DISTINCT w.owner_id) uCount FROM work_log w,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,24543)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,24543)) ud  WHERE w.owner_id=ud.id    AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) docCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,24543)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,24543)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  AND i.media_type=1   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) phoCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,24543)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,24543)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  AND i.media_type=2   GROUP BY ud.locid ) c ON l.id=c.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) audioCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,24543)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,24543)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  AND i.media_type=3   GROUP BY ud.locid ) d ON l.id=d.locid   WHERE l.id IN(,24543)
SQL: SELECT l.name,COALESCE(a.photoCount,0) a,COALESCE(a.ucount,0) b,COALESCE(b.priseCount,0) c,COALESCE(c.comCount,0) d FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(i.id) photoCount,COUNT(DISTINCT ud.id) ucount FROM album m,album_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,24543)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,24543)) ud  WHERE m.owner_id=ud.id AND i.album_id=m.id   AND i.create_time>="2014-08-07 00:00:00" AND i.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,COUNT(uc.id) priseCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,24543)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,24543)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='AlbumItem'   AND uc.create_time>"2014-08-07 00:00:00" AND uc.create_time<"2014-08-08 00:00:00"   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(uc.id) comCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,24543)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,24543)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='SystemComment'   AND uc.create_time>="2014-08-07 00:00:00" AND uc.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) c ON l.id=c.locid  WHERE l.id IN(,24543) [ RunTime:0.001000s ]
ERR: 1064:You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near '24543)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.locati' at line 1
 [ SQL语句 ] : SELECT l.name,COALESCE(a.photoCount,0) a,COALESCE(a.ucount,0) b,COALESCE(b.priseCount,0) c,COALESCE(c.comCount,0) d FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(i.id) photoCount,COUNT(DISTINCT ud.id) ucount FROM album m,album_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,24543)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,24543)) ud  WHERE m.owner_id=ud.id AND i.album_id=m.id   AND i.create_time>="2014-08-07 00:00:00" AND i.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,COUNT(uc.id) priseCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,24543)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,24543)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='AlbumItem'   AND uc.create_time>"2014-08-07 00:00:00" AND uc.create_time<"2014-08-08 00:00:00"   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(uc.id) comCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,24543)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,24543)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='SystemComment'   AND uc.create_time>="2014-08-07 00:00:00" AND uc.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) c ON l.id=c.locid  WHERE l.id IN(,24543)
SQL: SELECT a.rname a,l.name b,d.name c,a.age d FROM (SELECT u.id uid,u.real_name rname,u.location_id locid,u.dept_id depId,(2014-(SELECT SUBSTR(u.identify_value,7,4))+0) age FROM app_user u WHERE NOT EXISTS ( SELECT lo.user_id FROM login_log lo WHERE u.id=lo.user_id  ) AND u.id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,24543)   UNION ALL SELECT u.id FROM app_user u WHERE u.location_id IN(,24543) )) a,location l,department d WHERE a.depId=d.id AND a.locid=l.id [ RunTime:0.001000s ]
ERR: 1064:You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near '24543)   UNION ALL SELECT u.id FROM app_user u WHERE u.location_id IN(,24543) ))' at line 1
 [ SQL语句 ] : SELECT a.rname a,l.name b,d.name c,a.age d FROM (SELECT u.id uid,u.real_name rname,u.location_id locid,u.dept_id depId,(2014-(SELECT SUBSTR(u.identify_value,7,4))+0) age FROM app_user u WHERE NOT EXISTS ( SELECT lo.user_id FROM login_log lo WHERE u.id=lo.user_id  ) AND u.id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,24543)   UNION ALL SELECT u.id FROM app_user u WHERE u.location_id IN(,24543) )) a,location l,department d WHERE a.depId=d.id AND a.locid=l.id
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) AND lo.login_time>="2014-08-07 00:00:00" AND lo.login_time<"2014-08-08 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.366021s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) AND lo.login_time>="2014-08-07 00:00:00" AND lo.login_time<"2014-08-08 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.414023s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) AND lo.login_time>="2014-08-07 00:00:00" AND lo.login_time<"2014-08-08 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.455026s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) AND lo.login_time>="2014-08-07 00:00:00" AND lo.login_time<"2014-08-08 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.488028s ]
SQL: SELECT l.name,COALESCE(a.ulcount,0) b FROM  location l LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,24543)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,24543)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>=(TIMESTAMP(ADDDATE(DATE(SYSDATE()),-(DAYOFWEEK(NOW())-2))))   GROUP BY ud.locid) a ON a.locid=l.id WHERE l.id IN (,24543) [ RunTime:0.001000s ]
ERR: 1064:You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near '24543)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.locat' at line 1
 [ SQL语句 ] : SELECT l.name,COALESCE(a.ulcount,0) b FROM  location l LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(,24543)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(,24543)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>=(TIMESTAMP(ADDDATE(DATE(SYSDATE()),-(DAYOFWEEK(NOW())-2))))   GROUP BY ud.locid) a ON a.locid=l.id WHERE l.id IN (,24543)
INFO: [ view_parse ] --START--
INFO: ParseTemplate Behavior ::run [ RunTime:0.525030s ]
INFO: [ view_parse ] --END-- [ RunTime:0.532031s ]
INFO: [ view_filter ] --START--
INFO: ContentReplace Behavior ::run [ RunTime:0.008001s ]
INFO: TokenBuild Behavior ::run [ RunTime:0.010001s ]
INFO: WriteHtmlCache Behavior ::run [ RunTime:0.006000s ]
INFO: ShowRuntime Behavior ::run [ RunTime:0.014001s ]
INFO: [ view_filter ] --END-- [ RunTime:0.051003s ]
INFO: [ view_end ] --START--
INFO: ShowPageTrace Behavior ::run [ RunTime:0.009000s ]
INFO: [ view_end ] --END-- [ RunTime:0.013000s ]

[ 2014-08-08T13:57:39+08:00 ] 127.0.0.1 /php_demo/shizhan/10/10wish/index.php/Njb/Index/tongji?checkbox%5B%5D=24521&checkbox%5B%5D=24543
INFO: [ route_check ] --START--
INFO: CheckRoute Behavior ::run [ RunTime:0.008001s ]
INFO: [ route_check ] --END-- [ RunTime:0.012001s ]
INFO: [ app_begin ] --START--
INFO: ReadHtmlCache Behavior ::run [ RunTime:0.010001s ]
INFO: [ app_begin ] --END-- [ RunTime:0.014001s ]
SQL: SELECT l.name,COALESCE(a.ucount,0) as yhs,COALESCE(c.ulcount,0) as dlyhs,COALESCE(c.logCount,0) as dlcs FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(ud.id) ucount FROM   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543)) ud     GROUP BY ud.locid  ) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>="2014-08-07 00:00:00" AND lo.login_time<"2014-08-08 00:00:00"   GROUP BY ud.locid) c ON l.id=c.locid WHERE l.id IN(24521,24543) [ RunTime:0.027002s ]
SQL: SELECT l.name,COALESCE(a.noticeCount,0) noticeCount,COALESCE(a.userCount,0) userCount FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(n.id) noticeCount,COUNT(DISTINCT ud.id) userCount FROM notice n,   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543)) ud   WHERE n.owner_id=ud.id AND n.publish_time>="2014-08-07 00:00:00"    AND n.publish_time<"2014-08-08 00:00:00" GROUP BY ud.locid) a  ON l.id=a.locid WHERE l.id IN(24521,24543) [ RunTime:0.003000s ]
SQL: SELECT l.name,COALESCE(a.asCount,0) a,COALESCE(b.adminCount,0) b,COALESCE(c.noAdminCount,0) c FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(t.id) asCount FROM assignment t,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543)) ud  WHERE t.creator_id=ud.id AND t.create_time>="2014-08-07 00:00:00" AND  t.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) adminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543)) ud   WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='TechAdmin'   AND t.create_time>="2014-08-07 00:00:00" AND  t.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) noAdminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543)) ud  WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='Technician'   AND t.create_time>="2014-08-07 00:00:00" AND  t.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid ) c ON l.id=c.locid  WHERE l.id IN(24521,24543) [ RunTime:0.006000s ]
SQL: SELECT l.name,COALESCE(a.worklogCount,0) a,COALESCE(a.uCount,0) b,COALESCE(b.docCount,0) c,COALESCE(c.phoCount,0) d,COALESCE(d.audioCount,0) e FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(DISTINCT w.id) worklogCount,COUNT(DISTINCT w.owner_id) uCount FROM work_log w,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543)) ud  WHERE w.owner_id=ud.id    AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) docCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  AND i.media_type=1   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) phoCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  AND i.media_type=2   GROUP BY ud.locid ) c ON l.id=c.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) audioCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  AND i.media_type=3   GROUP BY ud.locid ) d ON l.id=d.locid   WHERE l.id IN(24521,24543) [ RunTime:0.018001s ]
SQL: SELECT l.name,COALESCE(a.photoCount,0) a,COALESCE(a.ucount,0) b,COALESCE(b.priseCount,0) c,COALESCE(c.comCount,0) d FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(i.id) photoCount,COUNT(DISTINCT ud.id) ucount FROM album m,album_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543)) ud  WHERE m.owner_id=ud.id AND i.album_id=m.id   AND i.create_time>="2014-08-07 00:00:00" AND i.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,COUNT(uc.id) priseCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='AlbumItem'   AND uc.create_time>"2014-08-07 00:00:00" AND uc.create_time<"2014-08-08 00:00:00"   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(uc.id) comCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='SystemComment'   AND uc.create_time>="2014-08-07 00:00:00" AND uc.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) c ON l.id=c.locid  WHERE l.id IN(24521,24543) [ RunTime:0.008001s ]
SQL: SELECT a.rname a,l.name b,d.name c,a.age d FROM (SELECT u.id uid,u.real_name rname,u.location_id locid,u.dept_id depId,(2014-(SELECT SUBSTR(u.identify_value,7,4))+0) age FROM app_user u WHERE NOT EXISTS ( SELECT lo.user_id FROM login_log lo WHERE u.id=lo.user_id  ) AND u.id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543)   UNION ALL SELECT u.id FROM app_user u WHERE u.location_id IN(24521,24543) )) a,location l,department d WHERE a.depId=d.id AND a.locid=l.id [ RunTime:2.137122s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) AND lo.login_time>="2014-08-07 00:00:00" AND lo.login_time<"2014-08-08 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.365021s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) AND lo.login_time>="2014-08-07 00:00:00" AND lo.login_time<"2014-08-08 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.372021s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) AND lo.login_time>="2014-08-07 00:00:00" AND lo.login_time<"2014-08-08 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.429024s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) AND w.create_time>="2014-08-07 00:00:00" AND w.create_time<"2014-08-08 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) AND lo.login_time>="2014-08-07 00:00:00" AND lo.login_time<"2014-08-08 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.380022s ]
SQL: SELECT l.name,COALESCE(a.ulcount,0) b FROM  location l LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>=(TIMESTAMP(ADDDATE(DATE(SYSDATE()),-(DAYOFWEEK(NOW())-2))))   GROUP BY ud.locid) a ON a.locid=l.id WHERE l.id IN (24521,24543) [ RunTime:0.077005s ]
INFO: [ view_parse ] --START--
INFO: ParseTemplate Behavior ::run [ RunTime:0.516030s ]
INFO: [ view_parse ] --END-- [ RunTime:0.521030s ]
INFO: [ view_filter ] --START--
INFO: ContentReplace Behavior ::run [ RunTime:0.008001s ]
INFO: TokenBuild Behavior ::run [ RunTime:0.008001s ]
INFO: WriteHtmlCache Behavior ::run [ RunTime:0.005000s ]
INFO: ShowRuntime Behavior ::run [ RunTime:0.011001s ]
INFO: [ view_filter ] --END-- [ RunTime:0.046003s ]
INFO: [ view_end ] --START--
INFO: ShowPageTrace Behavior ::run [ RunTime:0.007000s ]
INFO: [ view_end ] --END-- [ RunTime:0.014001s ]

[ 2014-08-08T14:51:08+08:00 ] 127.0.0.1 /php_demo/shizhan/10/10wish/index.php/Njb/Index/index
INFO: [ route_check ] --START--
INFO: CheckRoute Behavior ::run [ RunTime:0.007000s ]
INFO: [ route_check ] --END-- [ RunTime:0.011001s ]
INFO: [ app_begin ] --START--
INFO: ReadHtmlCache Behavior ::run [ RunTime:0.009001s ]
INFO: [ app_begin ] --END-- [ RunTime:0.015001s ]
INFO: [ view_parse ] --START--
INFO: ParseTemplate Behavior ::run [ RunTime:0.136008s ]
INFO: [ view_parse ] --END-- [ RunTime:0.140008s ]
INFO: [ view_filter ] --START--
INFO: ContentReplace Behavior ::run [ RunTime:0.006000s ]
INFO: TokenBuild Behavior ::run [ RunTime:0.011001s ]
INFO: WriteHtmlCache Behavior ::run [ RunTime:0.004000s ]
INFO: ShowRuntime Behavior ::run [ RunTime:0.011001s ]
INFO: [ view_filter ] --END-- [ RunTime:0.045002s ]
INFO: [ view_end ] --START--
INFO: ShowPageTrace Behavior ::run [ RunTime:0.008000s ]
INFO: [ view_end ] --END-- [ RunTime:0.014001s ]

[ 2014-08-08T14:51:57+08:00 ] 127.0.0.1 /php_demo/shizhan/10/10wish/index.php/Njb/Index/index
INFO: [ route_check ] --START--
INFO: CheckRoute Behavior ::run [ RunTime:0.007001s ]
INFO: [ route_check ] --END-- [ RunTime:0.013001s ]
INFO: [ app_begin ] --START--
INFO: ReadHtmlCache Behavior ::run [ RunTime:0.009000s ]
INFO: [ app_begin ] --END-- [ RunTime:0.013000s ]
INFO: [ view_parse ] --START--
INFO: ParseTemplate Behavior ::run [ RunTime:0.098005s ]
INFO: [ view_parse ] --END-- [ RunTime:0.104006s ]
INFO: [ view_filter ] --START--
INFO: ContentReplace Behavior ::run [ RunTime:0.007000s ]
INFO: TokenBuild Behavior ::run [ RunTime:0.008000s ]
INFO: WriteHtmlCache Behavior ::run [ RunTime:0.004000s ]
INFO: ShowRuntime Behavior ::run [ RunTime:0.012000s ]
INFO: [ view_filter ] --END-- [ RunTime:0.045002s ]
INFO: [ view_end ] --START--
INFO: ShowPageTrace Behavior ::run [ RunTime:0.007000s ]
INFO: [ view_end ] --END-- [ RunTime:0.012000s ]

[ 2014-08-08T14:52:16+08:00 ] 127.0.0.1 /php_demo/shizhan/10/10wish/index.php/Njb/Index/tongji?checkbox%5B%5D=24521&date_begin=2014-08-07&date_end=2014-08-08
INFO: [ route_check ] --START--
INFO: CheckRoute Behavior ::run [ RunTime:0.007000s ]
INFO: [ route_check ] --END-- [ RunTime:0.011001s ]
INFO: [ app_begin ] --START--
INFO: ReadHtmlCache Behavior ::run [ RunTime:0.011001s ]
INFO: [ app_begin ] --END-- [ RunTime:0.015001s ]
NOTIC: [8] Undefined variable: data_begin D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 20 行.
NOTIC: [8] Undefined variable: data_end D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 21 行.
SQL: SELECT l.name,COALESCE(a.ucount,0) as yhs,COALESCE(c.ulcount,0) as dlyhs,COALESCE(c.logCount,0) as dlcs FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(ud.id) ucount FROM   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521)) ud     GROUP BY ud.locid  ) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>=" 00:00:00" AND lo.login_time<" 00:00:00"   GROUP BY ud.locid) c ON l.id=c.locid WHERE l.id IN(24521) [ RunTime:0.208012s ]
SQL: SELECT l.name,COALESCE(a.noticeCount,0) noticeCount,COALESCE(a.userCount,0) userCount FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(n.id) noticeCount,COUNT(DISTINCT ud.id) userCount FROM notice n,   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521)) ud   WHERE n.owner_id=ud.id AND n.publish_time>=" 00:00:00"    AND n.publish_time<" 00:00:00" GROUP BY ud.locid) a  ON l.id=a.locid WHERE l.id IN(24521) [ RunTime:0.003000s ]
SQL: SELECT l.name,COALESCE(a.asCount,0) a,COALESCE(b.adminCount,0) b,COALESCE(c.noAdminCount,0) c FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(t.id) asCount FROM assignment t,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521)) ud  WHERE t.creator_id=ud.id AND t.create_time>=" 00:00:00" AND  t.create_time<" 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) adminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521)) ud   WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='TechAdmin'   AND t.create_time>=" 00:00:00" AND  t.create_time<" 00:00:00"  GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) noAdminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521)) ud  WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='Technician'   AND t.create_time>=" 00:00:00" AND  t.create_time<" 00:00:00"  GROUP BY ud.locid ) c ON l.id=c.locid  WHERE l.id IN(24521) [ RunTime:0.020001s ]
SQL: SELECT l.name,COALESCE(a.worklogCount,0) a,COALESCE(a.uCount,0) b,COALESCE(b.docCount,0) c,COALESCE(c.phoCount,0) d,COALESCE(d.audioCount,0) e FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(DISTINCT w.id) worklogCount,COUNT(DISTINCT w.owner_id) uCount FROM work_log w,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521)) ud  WHERE w.owner_id=ud.id    AND w.create_time>=" 00:00:00" AND w.create_time<" 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) docCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>=" 00:00:00" AND w.create_time<" 00:00:00"  AND i.media_type=1   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) phoCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>=" 00:00:00" AND w.create_time<" 00:00:00"  AND i.media_type=2   GROUP BY ud.locid ) c ON l.id=c.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) audioCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>=" 00:00:00" AND w.create_time<" 00:00:00"  AND i.media_type=3   GROUP BY ud.locid ) d ON l.id=d.locid   WHERE l.id IN(24521) [ RunTime:0.011000s ]
SQL: SELECT l.name,COALESCE(a.photoCount,0) a,COALESCE(a.ucount,0) b,COALESCE(b.priseCount,0) c,COALESCE(c.comCount,0) d FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(i.id) photoCount,COUNT(DISTINCT ud.id) ucount FROM album m,album_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521)) ud  WHERE m.owner_id=ud.id AND i.album_id=m.id   AND i.create_time>=" 00:00:00" AND i.create_time<" 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,COUNT(uc.id) priseCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='AlbumItem'   AND uc.create_time>" 00:00:00" AND uc.create_time<" 00:00:00"   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(uc.id) comCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='SystemComment'   AND uc.create_time>=" 00:00:00" AND uc.create_time<" 00:00:00"  GROUP BY ud.locid) c ON l.id=c.locid  WHERE l.id IN(24521) [ RunTime:0.004000s ]
SQL: SELECT a.rname a,l.name b,d.name c,a.age d FROM (SELECT u.id uid,u.real_name rname,u.location_id locid,u.dept_id depId,(2014-(SELECT SUBSTR(u.identify_value,7,4))+0) age FROM app_user u WHERE NOT EXISTS ( SELECT lo.user_id FROM login_log lo WHERE u.id=lo.user_id  ) AND u.id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521)   UNION ALL SELECT u.id FROM app_user u WHERE u.location_id IN(24521) )) a,location l,department d WHERE a.depId=d.id AND a.locid=l.id [ RunTime:2.262129s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) AND w.create_time>=" 00:00:00" AND w.create_time<" 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) AND lo.login_time>=" 00:00:00" AND lo.login_time<" 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.441025s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) AND w.create_time>=" 00:00:00" AND w.create_time<" 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) AND lo.login_time>=" 00:00:00" AND lo.login_time<" 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.559032s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) AND w.create_time>=" 00:00:00" AND w.create_time<" 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) AND lo.login_time>=" 00:00:00" AND lo.login_time<" 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.371022s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) AND w.create_time>=" 00:00:00" AND w.create_time<" 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) AND lo.login_time>=" 00:00:00" AND lo.login_time<" 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.369021s ]
SQL: SELECT l.name,COALESCE(a.ulcount,0) b FROM  location l LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>=(TIMESTAMP(ADDDATE(DATE(SYSDATE()),-(DAYOFWEEK(NOW())-2))))   GROUP BY ud.locid) a ON a.locid=l.id WHERE l.id IN (24521) [ RunTime:0.045002s ]
INFO: [ view_parse ] --START--
INFO: ParseTemplate Behavior ::run [ RunTime:0.542031s ]
INFO: [ view_parse ] --END-- [ RunTime:0.546031s ]
INFO: [ view_filter ] --START--
INFO: ContentReplace Behavior ::run [ RunTime:0.007000s ]
INFO: TokenBuild Behavior ::run [ RunTime:0.008001s ]
INFO: WriteHtmlCache Behavior ::run [ RunTime:0.005000s ]
INFO: ShowRuntime Behavior ::run [ RunTime:0.012001s ]
INFO: [ view_filter ] --END-- [ RunTime:0.044002s ]
INFO: [ view_end ] --START--
INFO: ShowPageTrace Behavior ::run [ RunTime:0.009000s ]
INFO: [ view_end ] --END-- [ RunTime:0.014001s ]

[ 2014-08-08T14:52:51+08:00 ] 127.0.0.1 /php_demo/shizhan/10/10wish/index.php/Njb/Index/tongji?checkbox%5B%5D=24521&checkbox%5B%5D=24543&checkbox%5B%5D=24561&checkbox%5B%5D=28422&date_begin=2014-08-06&date_end=2014-08-08
INFO: [ route_check ] --START--
INFO: CheckRoute Behavior ::run [ RunTime:0.007001s ]
INFO: [ route_check ] --END-- [ RunTime:0.013001s ]
INFO: [ app_begin ] --START--
INFO: ReadHtmlCache Behavior ::run [ RunTime:0.009000s ]
INFO: [ app_begin ] --END-- [ RunTime:0.013001s ]
NOTIC: [8] Undefined variable: data_begin D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 20 行.
NOTIC: [8] Undefined variable: data_end D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 21 行.
SQL: SELECT l.name,COALESCE(a.ucount,0) as yhs,COALESCE(c.ulcount,0) as dlyhs,COALESCE(c.logCount,0) as dlcs FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(ud.id) ucount FROM   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud     GROUP BY ud.locid  ) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>=" 00:00:00" AND lo.login_time<" 00:00:00"   GROUP BY ud.locid) c ON l.id=c.locid WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.036002s ]
SQL: SELECT l.name,COALESCE(a.noticeCount,0) noticeCount,COALESCE(a.userCount,0) userCount FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(n.id) noticeCount,COUNT(DISTINCT ud.id) userCount FROM notice n,   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud   WHERE n.owner_id=ud.id AND n.publish_time>=" 00:00:00"    AND n.publish_time<" 00:00:00" GROUP BY ud.locid) a  ON l.id=a.locid WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.023002s ]
SQL: SELECT l.name,COALESCE(a.asCount,0) a,COALESCE(b.adminCount,0) b,COALESCE(c.noAdminCount,0) c FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(t.id) asCount FROM assignment t,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE t.creator_id=ud.id AND t.create_time>=" 00:00:00" AND  t.create_time<" 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) adminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud   WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='TechAdmin'   AND t.create_time>=" 00:00:00" AND  t.create_time<" 00:00:00"  GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) noAdminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='Technician'   AND t.create_time>=" 00:00:00" AND  t.create_time<" 00:00:00"  GROUP BY ud.locid ) c ON l.id=c.locid  WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.018001s ]
SQL: SELECT l.name,COALESCE(a.worklogCount,0) a,COALESCE(a.uCount,0) b,COALESCE(b.docCount,0) c,COALESCE(c.phoCount,0) d,COALESCE(d.audioCount,0) e FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(DISTINCT w.id) worklogCount,COUNT(DISTINCT w.owner_id) uCount FROM work_log w,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE w.owner_id=ud.id    AND w.create_time>=" 00:00:00" AND w.create_time<" 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) docCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>=" 00:00:00" AND w.create_time<" 00:00:00"  AND i.media_type=1   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) phoCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>=" 00:00:00" AND w.create_time<" 00:00:00"  AND i.media_type=2   GROUP BY ud.locid ) c ON l.id=c.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) audioCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>=" 00:00:00" AND w.create_time<" 00:00:00"  AND i.media_type=3   GROUP BY ud.locid ) d ON l.id=d.locid   WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.028001s ]
SQL: SELECT l.name,COALESCE(a.photoCount,0) a,COALESCE(a.ucount,0) b,COALESCE(b.priseCount,0) c,COALESCE(c.comCount,0) d FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(i.id) photoCount,COUNT(DISTINCT ud.id) ucount FROM album m,album_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE m.owner_id=ud.id AND i.album_id=m.id   AND i.create_time>=" 00:00:00" AND i.create_time<" 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,COUNT(uc.id) priseCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='AlbumItem'   AND uc.create_time>" 00:00:00" AND uc.create_time<" 00:00:00"   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(uc.id) comCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='SystemComment'   AND uc.create_time>=" 00:00:00" AND uc.create_time<" 00:00:00"  GROUP BY ud.locid) c ON l.id=c.locid  WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.021001s ]
SQL: SELECT a.rname a,l.name b,d.name c,a.age d FROM (SELECT u.id uid,u.real_name rname,u.location_id locid,u.dept_id depId,(2014-(SELECT SUBSTR(u.identify_value,7,4))+0) age FROM app_user u WHERE NOT EXISTS ( SELECT lo.user_id FROM login_log lo WHERE u.id=lo.user_id  ) AND u.id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422) )) a,location l,department d WHERE a.depId=d.id AND a.locid=l.id [ RunTime:2.135122s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) AND w.create_time>=" 00:00:00" AND w.create_time<" 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) AND lo.login_time>=" 00:00:00" AND lo.login_time<" 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.355020s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) AND w.create_time>=" 00:00:00" AND w.create_time<" 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) AND lo.login_time>=" 00:00:00" AND lo.login_time<" 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.361021s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) AND w.create_time>=" 00:00:00" AND w.create_time<" 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) AND lo.login_time>=" 00:00:00" AND lo.login_time<" 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.365021s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) AND w.create_time>=" 00:00:00" AND w.create_time<" 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) AND lo.login_time>=" 00:00:00" AND lo.login_time<" 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.364021s ]
SQL: SELECT l.name,COALESCE(a.ulcount,0) b FROM  location l LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>=(TIMESTAMP(ADDDATE(DATE(SYSDATE()),-(DAYOFWEEK(NOW())-2))))   GROUP BY ud.locid) a ON a.locid=l.id WHERE l.id IN (24521,24543,24561,28422) [ RunTime:0.143008s ]
INFO: [ view_parse ] --START--
INFO: ParseTemplate Behavior ::run [ RunTime:0.526030s ]
INFO: [ view_parse ] --END-- [ RunTime:0.530030s ]
INFO: [ view_filter ] --START--
INFO: ContentReplace Behavior ::run [ RunTime:0.008000s ]
INFO: TokenBuild Behavior ::run [ RunTime:0.015001s ]
INFO: WriteHtmlCache Behavior ::run [ RunTime:0.004001s ]
INFO: ShowRuntime Behavior ::run [ RunTime:0.011000s ]
INFO: [ view_filter ] --END-- [ RunTime:0.056004s ]
INFO: [ view_end ] --START--
INFO: ShowPageTrace Behavior ::run [ RunTime:0.030002s ]
INFO: [ view_end ] --END-- [ RunTime:0.043002s ]

[ 2014-08-08T14:54:03+08:00 ] 127.0.0.1 /php_demo/shizhan/10/10wish/index.php/Njb/Index/tongji?checkbox%5B%5D=24521&checkbox%5B%5D=24543&checkbox%5B%5D=24561&checkbox%5B%5D=28422&date_begin=2014-08-06&date_end=2014-08-08
INFO: [ route_check ] --START--
INFO: CheckRoute Behavior ::run [ RunTime:0.010000s ]
INFO: [ route_check ] --END-- [ RunTime:0.016001s ]
INFO: [ app_begin ] --START--
INFO: ReadHtmlCache Behavior ::run [ RunTime:0.008000s ]
INFO: [ app_begin ] --END-- [ RunTime:0.015000s ]
NOTIC: [8] Undefined variable: data_begin D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 22 行.
NOTIC: [8] Undefined variable: data_end D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 23 行.
SQL: SELECT l.name,COALESCE(a.ucount,0) as yhs,COALESCE(c.ulcount,0) as dlyhs,COALESCE(c.logCount,0) as dlcs FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(ud.id) ucount FROM   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud     GROUP BY ud.locid  ) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>=" 00:00:00" AND lo.login_time<" 00:00:00"   GROUP BY ud.locid) c ON l.id=c.locid WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.015001s ]
SQL: SELECT l.name,COALESCE(a.noticeCount,0) noticeCount,COALESCE(a.userCount,0) userCount FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(n.id) noticeCount,COUNT(DISTINCT ud.id) userCount FROM notice n,   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud   WHERE n.owner_id=ud.id AND n.publish_time>=" 00:00:00"    AND n.publish_time<" 00:00:00" GROUP BY ud.locid) a  ON l.id=a.locid WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.004001s ]
SQL: SELECT l.name,COALESCE(a.asCount,0) a,COALESCE(b.adminCount,0) b,COALESCE(c.noAdminCount,0) c FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(t.id) asCount FROM assignment t,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE t.creator_id=ud.id AND t.create_time>=" 00:00:00" AND  t.create_time<" 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) adminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud   WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='TechAdmin'   AND t.create_time>=" 00:00:00" AND  t.create_time<" 00:00:00"  GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) noAdminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='Technician'   AND t.create_time>=" 00:00:00" AND  t.create_time<" 00:00:00"  GROUP BY ud.locid ) c ON l.id=c.locid  WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.011001s ]
SQL: SELECT l.name,COALESCE(a.worklogCount,0) a,COALESCE(a.uCount,0) b,COALESCE(b.docCount,0) c,COALESCE(c.phoCount,0) d,COALESCE(d.audioCount,0) e FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(DISTINCT w.id) worklogCount,COUNT(DISTINCT w.owner_id) uCount FROM work_log w,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE w.owner_id=ud.id    AND w.create_time>=" 00:00:00" AND w.create_time<" 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) docCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>=" 00:00:00" AND w.create_time<" 00:00:00"  AND i.media_type=1   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) phoCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>=" 00:00:00" AND w.create_time<" 00:00:00"  AND i.media_type=2   GROUP BY ud.locid ) c ON l.id=c.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) audioCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>=" 00:00:00" AND w.create_time<" 00:00:00"  AND i.media_type=3   GROUP BY ud.locid ) d ON l.id=d.locid   WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.031002s ]
SQL: SELECT l.name,COALESCE(a.photoCount,0) a,COALESCE(a.ucount,0) b,COALESCE(b.priseCount,0) c,COALESCE(c.comCount,0) d FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(i.id) photoCount,COUNT(DISTINCT ud.id) ucount FROM album m,album_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE m.owner_id=ud.id AND i.album_id=m.id   AND i.create_time>=" 00:00:00" AND i.create_time<" 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,COUNT(uc.id) priseCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='AlbumItem'   AND uc.create_time>" 00:00:00" AND uc.create_time<" 00:00:00"   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(uc.id) comCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='SystemComment'   AND uc.create_time>=" 00:00:00" AND uc.create_time<" 00:00:00"  GROUP BY ud.locid) c ON l.id=c.locid  WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.012001s ]
SQL: SELECT a.rname a,l.name b,d.name c,a.age d FROM (SELECT u.id uid,u.real_name rname,u.location_id locid,u.dept_id depId,(2014-(SELECT SUBSTR(u.identify_value,7,4))+0) age FROM app_user u WHERE NOT EXISTS ( SELECT lo.user_id FROM login_log lo WHERE u.id=lo.user_id  ) AND u.id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422) )) a,location l,department d WHERE a.depId=d.id AND a.locid=l.id [ RunTime:2.213126s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) AND w.create_time>=" 00:00:00" AND w.create_time<" 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) AND lo.login_time>=" 00:00:00" AND lo.login_time<" 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.374021s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) AND w.create_time>=" 00:00:00" AND w.create_time<" 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) AND lo.login_time>=" 00:00:00" AND lo.login_time<" 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.365021s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) AND w.create_time>=" 00:00:00" AND w.create_time<" 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) AND lo.login_time>=" 00:00:00" AND lo.login_time<" 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.390023s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) AND w.create_time>=" 00:00:00" AND w.create_time<" 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) AND lo.login_time>=" 00:00:00" AND lo.login_time<" 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.367021s ]
SQL: SELECT l.name,COALESCE(a.ulcount,0) b FROM  location l LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>=(TIMESTAMP(ADDDATE(DATE(SYSDATE()),-(DAYOFWEEK(NOW())-2))))   GROUP BY ud.locid) a ON a.locid=l.id WHERE l.id IN (24521,24543,24561,28422) [ RunTime:0.132007s ]
INFO: [ view_parse ] --START--
INFO: ParseTemplate Behavior ::run [ RunTime:0.538031s ]
INFO: [ view_parse ] --END-- [ RunTime:0.543031s ]
INFO: [ view_filter ] --START--
INFO: ContentReplace Behavior ::run [ RunTime:0.007001s ]
INFO: TokenBuild Behavior ::run [ RunTime:0.011000s ]
INFO: WriteHtmlCache Behavior ::run [ RunTime:0.005000s ]
INFO: ShowRuntime Behavior ::run [ RunTime:0.013001s ]
INFO: [ view_filter ] --END-- [ RunTime:0.046003s ]
INFO: [ view_end ] --START--
INFO: ShowPageTrace Behavior ::run [ RunTime:0.010001s ]
INFO: [ view_end ] --END-- [ RunTime:0.015001s ]

[ 2014-08-08T14:54:49+08:00 ] 127.0.0.1 /php_demo/shizhan/10/10wish/index.php/Njb/Index/tongji?checkbox%5B%5D=24521&checkbox%5B%5D=24543&checkbox%5B%5D=24561&checkbox%5B%5D=28422&date_begin=2014-08-06&date_end=2014-08-08
INFO: [ route_check ] --START--
INFO: CheckRoute Behavior ::run [ RunTime:0.011001s ]
INFO: [ route_check ] --END-- [ RunTime:0.018001s ]
INFO: [ app_begin ] --START--
INFO: ReadHtmlCache Behavior ::run [ RunTime:0.012001s ]
INFO: [ app_begin ] --END-- [ RunTime:0.017001s ]
NOTIC: [8] Undefined variable: data_begin D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 20 行.
NOTIC: [8] Undefined variable: data_end D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 21 行.
SQL: SELECT l.name,COALESCE(a.ucount,0) as yhs,COALESCE(c.ulcount,0) as dlyhs,COALESCE(c.logCount,0) as dlcs FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(ud.id) ucount FROM   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud     GROUP BY ud.locid  ) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>=" 00:00:00" AND lo.login_time<" 00:00:00"   GROUP BY ud.locid) c ON l.id=c.locid WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.017001s ]
SQL: SELECT l.name,COALESCE(a.noticeCount,0) noticeCount,COALESCE(a.userCount,0) userCount FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(n.id) noticeCount,COUNT(DISTINCT ud.id) userCount FROM notice n,   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud   WHERE n.owner_id=ud.id AND n.publish_time>=" 00:00:00"    AND n.publish_time<" 00:00:00" GROUP BY ud.locid) a  ON l.id=a.locid WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.005001s ]
SQL: SELECT l.name,COALESCE(a.asCount,0) a,COALESCE(b.adminCount,0) b,COALESCE(c.noAdminCount,0) c FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(t.id) asCount FROM assignment t,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE t.creator_id=ud.id AND t.create_time>=" 00:00:00" AND  t.create_time<" 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) adminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud   WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='TechAdmin'   AND t.create_time>=" 00:00:00" AND  t.create_time<" 00:00:00"  GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) noAdminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='Technician'   AND t.create_time>=" 00:00:00" AND  t.create_time<" 00:00:00"  GROUP BY ud.locid ) c ON l.id=c.locid  WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.015001s ]
SQL: SELECT l.name,COALESCE(a.worklogCount,0) a,COALESCE(a.uCount,0) b,COALESCE(b.docCount,0) c,COALESCE(c.phoCount,0) d,COALESCE(d.audioCount,0) e FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(DISTINCT w.id) worklogCount,COUNT(DISTINCT w.owner_id) uCount FROM work_log w,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE w.owner_id=ud.id    AND w.create_time>=" 00:00:00" AND w.create_time<" 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) docCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>=" 00:00:00" AND w.create_time<" 00:00:00"  AND i.media_type=1   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) phoCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>=" 00:00:00" AND w.create_time<" 00:00:00"  AND i.media_type=2   GROUP BY ud.locid ) c ON l.id=c.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) audioCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>=" 00:00:00" AND w.create_time<" 00:00:00"  AND i.media_type=3   GROUP BY ud.locid ) d ON l.id=d.locid   WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.031001s ]
SQL: SELECT l.name,COALESCE(a.photoCount,0) a,COALESCE(a.ucount,0) b,COALESCE(b.priseCount,0) c,COALESCE(c.comCount,0) d FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(i.id) photoCount,COUNT(DISTINCT ud.id) ucount FROM album m,album_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE m.owner_id=ud.id AND i.album_id=m.id   AND i.create_time>=" 00:00:00" AND i.create_time<" 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,COUNT(uc.id) priseCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='AlbumItem'   AND uc.create_time>" 00:00:00" AND uc.create_time<" 00:00:00"   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(uc.id) comCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='SystemComment'   AND uc.create_time>=" 00:00:00" AND uc.create_time<" 00:00:00"  GROUP BY ud.locid) c ON l.id=c.locid  WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.014001s ]
SQL: SELECT a.rname a,l.name b,d.name c,a.age d FROM (SELECT u.id uid,u.real_name rname,u.location_id locid,u.dept_id depId,(2014-(SELECT SUBSTR(u.identify_value,7,4))+0) age FROM app_user u WHERE NOT EXISTS ( SELECT lo.user_id FROM login_log lo WHERE u.id=lo.user_id  ) AND u.id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422) )) a,location l,department d WHERE a.depId=d.id AND a.locid=l.id [ RunTime:2.211127s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) AND w.create_time>=" 00:00:00" AND w.create_time<" 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) AND lo.login_time>=" 00:00:00" AND lo.login_time<" 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.385022s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) AND w.create_time>=" 00:00:00" AND w.create_time<" 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) AND lo.login_time>=" 00:00:00" AND lo.login_time<" 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.376021s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) AND w.create_time>=" 00:00:00" AND w.create_time<" 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) AND lo.login_time>=" 00:00:00" AND lo.login_time<" 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.382021s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) AND w.create_time>=" 00:00:00" AND w.create_time<" 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) AND lo.login_time>=" 00:00:00" AND lo.login_time<" 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.400023s ]
SQL: SELECT l.name,COALESCE(a.ulcount,0) b FROM  location l LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>=(TIMESTAMP(ADDDATE(DATE(SYSDATE()),-(DAYOFWEEK(NOW())-2))))   GROUP BY ud.locid) a ON a.locid=l.id WHERE l.id IN (24521,24543,24561,28422) [ RunTime:0.131008s ]
INFO: [ view_parse ] --START--
INFO: ParseTemplate Behavior ::run [ RunTime:0.555031s ]
INFO: [ view_parse ] --END-- [ RunTime:0.561032s ]
INFO: [ view_filter ] --START--
INFO: ContentReplace Behavior ::run [ RunTime:0.012001s ]
INFO: TokenBuild Behavior ::run [ RunTime:0.010001s ]
INFO: WriteHtmlCache Behavior ::run [ RunTime:0.005000s ]
INFO: ShowRuntime Behavior ::run [ RunTime:0.011001s ]
INFO: [ view_filter ] --END-- [ RunTime:0.055003s ]
INFO: [ view_end ] --START--
INFO: ShowPageTrace Behavior ::run [ RunTime:0.013000s ]
INFO: [ view_end ] --END-- [ RunTime:0.021002s ]

[ 2014-08-08T14:55:15+08:00 ] 127.0.0.1 /php_demo/shizhan/10/10wish/index.php/Njb/Index/tongji?checkbox%5B%5D=24521&checkbox%5B%5D=24543&checkbox%5B%5D=24561&checkbox%5B%5D=28422&date_begin=2014-08-06&date_end=2014-08-08
INFO: [ route_check ] --START--
INFO: CheckRoute Behavior ::run [ RunTime:0.007000s ]
INFO: [ route_check ] --END-- [ RunTime:0.011000s ]
INFO: [ app_begin ] --START--
INFO: ReadHtmlCache Behavior ::run [ RunTime:0.009001s ]
INFO: [ app_begin ] --END-- [ RunTime:0.013001s ]
SQL: SELECT l.name,COALESCE(a.ucount,0) as yhs,COALESCE(c.ulcount,0) as dlyhs,COALESCE(c.logCount,0) as dlcs FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(ud.id) ucount FROM   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud     GROUP BY ud.locid  ) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>="2014-08-06 00:00:00" AND lo.login_time<"2014-08-08 00:00:00"   GROUP BY ud.locid) c ON l.id=c.locid WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.063004s ]
SQL: SELECT l.name,COALESCE(a.noticeCount,0) noticeCount,COALESCE(a.userCount,0) userCount FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(n.id) noticeCount,COUNT(DISTINCT ud.id) userCount FROM notice n,   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud   WHERE n.owner_id=ud.id AND n.publish_time>="2014-08-06 00:00:00"    AND n.publish_time<"2014-08-08 00:00:00" GROUP BY ud.locid) a  ON l.id=a.locid WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.004000s ]
SQL: SELECT l.name,COALESCE(a.asCount,0) a,COALESCE(b.adminCount,0) b,COALESCE(c.noAdminCount,0) c FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(t.id) asCount FROM assignment t,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE t.creator_id=ud.id AND t.create_time>="2014-08-06 00:00:00" AND  t.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) adminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud   WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='TechAdmin'   AND t.create_time>="2014-08-06 00:00:00" AND  t.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) noAdminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='Technician'   AND t.create_time>="2014-08-06 00:00:00" AND  t.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid ) c ON l.id=c.locid  WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.080004s ]
SQL: SELECT l.name,COALESCE(a.worklogCount,0) a,COALESCE(a.uCount,0) b,COALESCE(b.docCount,0) c,COALESCE(c.phoCount,0) d,COALESCE(d.audioCount,0) e FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(DISTINCT w.id) worklogCount,COUNT(DISTINCT w.owner_id) uCount FROM work_log w,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE w.owner_id=ud.id    AND w.create_time>="2014-08-06 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) docCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-06 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  AND i.media_type=1   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) phoCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-06 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  AND i.media_type=2   GROUP BY ud.locid ) c ON l.id=c.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) audioCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-06 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  AND i.media_type=3   GROUP BY ud.locid ) d ON l.id=d.locid   WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.070004s ]
SQL: SELECT l.name,COALESCE(a.photoCount,0) a,COALESCE(a.ucount,0) b,COALESCE(b.priseCount,0) c,COALESCE(c.comCount,0) d FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(i.id) photoCount,COUNT(DISTINCT ud.id) ucount FROM album m,album_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE m.owner_id=ud.id AND i.album_id=m.id   AND i.create_time>="2014-08-06 00:00:00" AND i.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,COUNT(uc.id) priseCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='AlbumItem'   AND uc.create_time>"2014-08-06 00:00:00" AND uc.create_time<"2014-08-08 00:00:00"   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(uc.id) comCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='SystemComment'   AND uc.create_time>="2014-08-06 00:00:00" AND uc.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) c ON l.id=c.locid  WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.013001s ]
SQL: SELECT a.rname a,l.name b,d.name c,a.age d FROM (SELECT u.id uid,u.real_name rname,u.location_id locid,u.dept_id depId,(2014-(SELECT SUBSTR(u.identify_value,7,4))+0) age FROM app_user u WHERE NOT EXISTS ( SELECT lo.user_id FROM login_log lo WHERE u.id=lo.user_id  ) AND u.id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422) )) a,location l,department d WHERE a.depId=d.id AND a.locid=l.id [ RunTime:2.190125s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) AND w.create_time>="2014-08-06 00:00:00" AND w.create_time<"2014-08-08 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) AND lo.login_time>="2014-08-06 00:00:00" AND lo.login_time<"2014-08-08 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.381022s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) AND w.create_time>="2014-08-06 00:00:00" AND w.create_time<"2014-08-08 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) AND lo.login_time>="2014-08-06 00:00:00" AND lo.login_time<"2014-08-08 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.405023s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) AND w.create_time>="2014-08-06 00:00:00" AND w.create_time<"2014-08-08 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) AND lo.login_time>="2014-08-06 00:00:00" AND lo.login_time<"2014-08-08 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.376021s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) AND w.create_time>="2014-08-06 00:00:00" AND w.create_time<"2014-08-08 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) AND lo.login_time>="2014-08-06 00:00:00" AND lo.login_time<"2014-08-08 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.388022s ]
SQL: SELECT l.name,COALESCE(a.ulcount,0) b FROM  location l LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>=(TIMESTAMP(ADDDATE(DATE(SYSDATE()),-(DAYOFWEEK(NOW())-2))))   GROUP BY ud.locid) a ON a.locid=l.id WHERE l.id IN (24521,24543,24561,28422) [ RunTime:0.127008s ]
INFO: [ view_parse ] --START--
INFO: ParseTemplate Behavior ::run [ RunTime:0.520029s ]
INFO: [ view_parse ] --END-- [ RunTime:0.525030s ]
INFO: [ view_filter ] --START--
INFO: ContentReplace Behavior ::run [ RunTime:0.010000s ]
INFO: TokenBuild Behavior ::run [ RunTime:0.011000s ]
INFO: WriteHtmlCache Behavior ::run [ RunTime:0.006001s ]
INFO: ShowRuntime Behavior ::run [ RunTime:0.018001s ]
INFO: [ view_filter ] --END-- [ RunTime:0.064003s ]
INFO: [ view_end ] --START--
INFO: ShowPageTrace Behavior ::run [ RunTime:0.010001s ]
INFO: [ view_end ] --END-- [ RunTime:0.019001s ]

[ 2014-08-08T15:13:57+08:00 ] 127.0.0.1 /php_demo/shizhan/10/10wish/index.php/Njb/Index/tongji?checkbox%5B%5D=24521&checkbox%5B%5D=24543&checkbox%5B%5D=24561&checkbox%5B%5D=28422&date_begin=2014-08-06&date_end=2014-08-08
INFO: [ route_check ] --START--
INFO: CheckRoute Behavior ::run [ RunTime:0.006000s ]
INFO: [ route_check ] --END-- [ RunTime:0.012000s ]
INFO: [ app_begin ] --START--
INFO: ReadHtmlCache Behavior ::run [ RunTime:0.008001s ]
INFO: [ app_begin ] --END-- [ RunTime:0.014001s ]
SQL: SELECT l.name,COALESCE(a.ucount,0) as yhs,COALESCE(c.ulcount,0) as dlyhs,COALESCE(c.logCount,0) as dlcs FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(ud.id) ucount FROM   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud     GROUP BY ud.locid  ) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>="2014-08-06 00:00:00" AND lo.login_time<"2014-08-08 00:00:00"   GROUP BY ud.locid) c ON l.id=c.locid WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.064004s ]
SQL: SELECT l.name,COALESCE(a.noticeCount,0) noticeCount,COALESCE(a.userCount,0) userCount FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(n.id) noticeCount,COUNT(DISTINCT ud.id) userCount FROM notice n,   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud   WHERE n.owner_id=ud.id AND n.publish_time>="2014-08-06 00:00:00"    AND n.publish_time<"2014-08-08 00:00:00" GROUP BY ud.locid) a  ON l.id=a.locid WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.004000s ]
SQL: SELECT l.name,COALESCE(a.asCount,0) a,COALESCE(b.adminCount,0) b,COALESCE(c.noAdminCount,0) c FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(t.id) asCount FROM assignment t,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE t.creator_id=ud.id AND t.create_time>="2014-08-06 00:00:00" AND  t.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) adminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud   WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='TechAdmin'   AND t.create_time>="2014-08-06 00:00:00" AND  t.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) noAdminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='Technician'   AND t.create_time>="2014-08-06 00:00:00" AND  t.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid ) c ON l.id=c.locid  WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.011000s ]
SQL: SELECT l.name,COALESCE(a.worklogCount,0) a,COALESCE(a.uCount,0) b,COALESCE(b.docCount,0) c,COALESCE(c.phoCount,0) d,COALESCE(d.audioCount,0) e FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(DISTINCT w.id) worklogCount,COUNT(DISTINCT w.owner_id) uCount FROM work_log w,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE w.owner_id=ud.id    AND w.create_time>="2014-08-06 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) docCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-06 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  AND i.media_type=1   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) phoCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-06 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  AND i.media_type=2   GROUP BY ud.locid ) c ON l.id=c.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) audioCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-06 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  AND i.media_type=3   GROUP BY ud.locid ) d ON l.id=d.locid   WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.037002s ]
SQL: SELECT l.name,COALESCE(a.photoCount,0) a,COALESCE(a.ucount,0) b,COALESCE(b.priseCount,0) c,COALESCE(c.comCount,0) d FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(i.id) photoCount,COUNT(DISTINCT ud.id) ucount FROM album m,album_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE m.owner_id=ud.id AND i.album_id=m.id   AND i.create_time>="2014-08-06 00:00:00" AND i.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,COUNT(uc.id) priseCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='AlbumItem'   AND uc.create_time>"2014-08-06 00:00:00" AND uc.create_time<"2014-08-08 00:00:00"   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(uc.id) comCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='SystemComment'   AND uc.create_time>="2014-08-06 00:00:00" AND uc.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) c ON l.id=c.locid  WHERE l.id IN(24521,24543,24561,28422) [ RunTime:0.015000s ]
SQL: SELECT a.rname a,l.name b,d.name c,a.age d FROM (SELECT u.id uid,u.real_name rname,u.location_id locid,u.dept_id depId,(2014-(SELECT SUBSTR(u.identify_value,7,4))+0) age FROM app_user u WHERE NOT EXISTS ( SELECT lo.user_id FROM login_log lo WHERE u.id=lo.user_id  ) AND u.id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422) )) a,location l,department d WHERE a.depId=d.id AND a.locid=l.id [ RunTime:2.104120s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) AND w.create_time>="2014-08-06 00:00:00" AND w.create_time<"2014-08-08 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) AND lo.login_time>="2014-08-06 00:00:00" AND lo.login_time<"2014-08-08 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.383022s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) AND w.create_time>="2014-08-06 00:00:00" AND w.create_time<"2014-08-08 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) AND lo.login_time>="2014-08-06 00:00:00" AND lo.login_time<"2014-08-08 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.357021s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) AND w.create_time>="2014-08-06 00:00:00" AND w.create_time<"2014-08-08 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) AND lo.login_time>="2014-08-06 00:00:00" AND lo.login_time<"2014-08-08 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.371021s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) AND w.create_time>="2014-08-06 00:00:00" AND w.create_time<"2014-08-08 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) AND lo.login_time>="2014-08-06 00:00:00" AND lo.login_time<"2014-08-08 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.371021s ]
SQL: SELECT l.name,COALESCE(a.ulcount,0) b FROM  location l LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561,28422)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>=(TIMESTAMP(ADDDATE(DATE(SYSDATE()),-(DAYOFWEEK(NOW())-2))))   GROUP BY ud.locid) a ON a.locid=l.id WHERE l.id IN (24521,24543,24561,28422) [ RunTime:0.127008s ]
INFO: [ view_parse ] --START--
INFO: ParseTemplate Behavior ::run [ RunTime:0.522030s ]
INFO: [ view_parse ] --END-- [ RunTime:0.527030s ]
INFO: [ view_filter ] --START--
INFO: ContentReplace Behavior ::run [ RunTime:0.008000s ]
INFO: TokenBuild Behavior ::run [ RunTime:0.009001s ]
INFO: WriteHtmlCache Behavior ::run [ RunTime:0.005000s ]
INFO: ShowRuntime Behavior ::run [ RunTime:0.014000s ]
INFO: [ view_filter ] --END-- [ RunTime:0.050003s ]
INFO: [ view_end ] --START--
INFO: ShowPageTrace Behavior ::run [ RunTime:0.008001s ]
INFO: [ view_end ] --END-- [ RunTime:0.013001s ]

[ 2014-08-08T15:14:12+08:00 ] 127.0.0.1 /php_demo/shizhan/10/10wish/index.php/Njb/Index/tongji?checkbox%5B%5D=24521&checkbox%5B%5D=28422&date_begin=2014-08-06&date_end=2014-08-08
INFO: [ route_check ] --START--
INFO: CheckRoute Behavior ::run [ RunTime:0.006001s ]
INFO: [ route_check ] --END-- [ RunTime:0.011001s ]
INFO: [ app_begin ] --START--
INFO: ReadHtmlCache Behavior ::run [ RunTime:0.008000s ]
INFO: [ app_begin ] --END-- [ RunTime:0.013000s ]
SQL: SELECT l.name,COALESCE(a.ucount,0) as yhs,COALESCE(c.ulcount,0) as dlyhs,COALESCE(c.logCount,0) as dlcs FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(ud.id) ucount FROM   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,28422)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,28422)) ud     GROUP BY ud.locid  ) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,28422)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>="2014-08-06 00:00:00" AND lo.login_time<"2014-08-08 00:00:00"   GROUP BY ud.locid) c ON l.id=c.locid WHERE l.id IN(24521,28422) [ RunTime:0.039002s ]
SQL: SELECT l.name,COALESCE(a.noticeCount,0) noticeCount,COALESCE(a.userCount,0) userCount FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(n.id) noticeCount,COUNT(DISTINCT ud.id) userCount FROM notice n,   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,28422)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,28422)) ud   WHERE n.owner_id=ud.id AND n.publish_time>="2014-08-06 00:00:00"    AND n.publish_time<"2014-08-08 00:00:00" GROUP BY ud.locid) a  ON l.id=a.locid WHERE l.id IN(24521,28422) [ RunTime:0.003000s ]
SQL: SELECT l.name,COALESCE(a.asCount,0) a,COALESCE(b.adminCount,0) b,COALESCE(c.noAdminCount,0) c FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(t.id) asCount FROM assignment t,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,28422)) ud  WHERE t.creator_id=ud.id AND t.create_time>="2014-08-06 00:00:00" AND  t.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) adminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,28422)) ud   WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='TechAdmin'   AND t.create_time>="2014-08-06 00:00:00" AND  t.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) noAdminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,28422)) ud  WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='Technician'   AND t.create_time>="2014-08-06 00:00:00" AND  t.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid ) c ON l.id=c.locid  WHERE l.id IN(24521,28422) [ RunTime:0.006001s ]
SQL: SELECT l.name,COALESCE(a.worklogCount,0) a,COALESCE(a.uCount,0) b,COALESCE(b.docCount,0) c,COALESCE(c.phoCount,0) d,COALESCE(d.audioCount,0) e FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(DISTINCT w.id) worklogCount,COUNT(DISTINCT w.owner_id) uCount FROM work_log w,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,28422)) ud  WHERE w.owner_id=ud.id    AND w.create_time>="2014-08-06 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) docCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,28422)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-06 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  AND i.media_type=1   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) phoCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,28422)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-06 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  AND i.media_type=2   GROUP BY ud.locid ) c ON l.id=c.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) audioCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,28422)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-06 00:00:00" AND w.create_time<"2014-08-08 00:00:00"  AND i.media_type=3   GROUP BY ud.locid ) d ON l.id=d.locid   WHERE l.id IN(24521,28422) [ RunTime:0.016001s ]
SQL: SELECT l.name,COALESCE(a.photoCount,0) a,COALESCE(a.ucount,0) b,COALESCE(b.priseCount,0) c,COALESCE(c.comCount,0) d FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(i.id) photoCount,COUNT(DISTINCT ud.id) ucount FROM album m,album_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,28422)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,28422)) ud  WHERE m.owner_id=ud.id AND i.album_id=m.id   AND i.create_time>="2014-08-06 00:00:00" AND i.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,COUNT(uc.id) priseCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,28422)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,28422)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='AlbumItem'   AND uc.create_time>"2014-08-06 00:00:00" AND uc.create_time<"2014-08-08 00:00:00"   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(uc.id) comCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,28422)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,28422)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='SystemComment'   AND uc.create_time>="2014-08-06 00:00:00" AND uc.create_time<"2014-08-08 00:00:00"  GROUP BY ud.locid) c ON l.id=c.locid  WHERE l.id IN(24521,28422) [ RunTime:0.008001s ]
SQL: SELECT a.rname a,l.name b,d.name c,a.age d FROM (SELECT u.id uid,u.real_name rname,u.location_id locid,u.dept_id depId,(2014-(SELECT SUBSTR(u.identify_value,7,4))+0) age FROM app_user u WHERE NOT EXISTS ( SELECT lo.user_id FROM login_log lo WHERE u.id=lo.user_id  ) AND u.id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,28422)   UNION ALL SELECT u.id FROM app_user u WHERE u.location_id IN(24521,28422) )) a,location l,department d WHERE a.depId=d.id AND a.locid=l.id [ RunTime:2.088120s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) AND w.create_time>="2014-08-06 00:00:00" AND w.create_time<"2014-08-08 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) AND lo.login_time>="2014-08-06 00:00:00" AND lo.login_time<"2014-08-08 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.383022s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) AND w.create_time>="2014-08-06 00:00:00" AND w.create_time<"2014-08-08 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) AND lo.login_time>="2014-08-06 00:00:00" AND lo.login_time<"2014-08-08 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.351020s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) AND w.create_time>="2014-08-06 00:00:00" AND w.create_time<"2014-08-08 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) AND lo.login_time>="2014-08-06 00:00:00" AND lo.login_time<"2014-08-08 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.375022s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) AND w.create_time>="2014-08-06 00:00:00" AND w.create_time<"2014-08-08 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) AND lo.login_time>="2014-08-06 00:00:00" AND lo.login_time<"2014-08-08 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.369021s ]
SQL: SELECT l.name,COALESCE(a.ulcount,0) b FROM  location l LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,28422)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>=(TIMESTAMP(ADDDATE(DATE(SYSDATE()),-(DAYOFWEEK(NOW())-2))))   GROUP BY ud.locid) a ON a.locid=l.id WHERE l.id IN (24521,28422) [ RunTime:0.074004s ]
INFO: [ view_parse ] --START--
INFO: ParseTemplate Behavior ::run [ RunTime:0.511029s ]
INFO: [ view_parse ] --END-- [ RunTime:0.515029s ]
INFO: [ view_filter ] --START--
INFO: ContentReplace Behavior ::run [ RunTime:0.008000s ]
INFO: TokenBuild Behavior ::run [ RunTime:0.008001s ]
INFO: WriteHtmlCache Behavior ::run [ RunTime:0.005000s ]
INFO: ShowRuntime Behavior ::run [ RunTime:0.012001s ]
INFO: [ view_filter ] --END-- [ RunTime:0.044002s ]
INFO: [ view_end ] --START--
INFO: ShowPageTrace Behavior ::run [ RunTime:0.013001s ]
INFO: [ view_end ] --END-- [ RunTime:0.026001s ]

[ 2014-08-08T15:17:56+08:00 ] 127.0.0.1 /php_demo/shizhan/10/10wish/index.php/Njb/index
INFO: [ route_check ] --START--
INFO: CheckRoute Behavior ::run [ RunTime:0.007000s ]
INFO: [ route_check ] --END-- [ RunTime:0.014001s ]
INFO: [ app_begin ] --START--
INFO: ReadHtmlCache Behavior ::run [ RunTime:0.008000s ]
INFO: [ app_begin ] --END-- [ RunTime:0.014000s ]
ERR: 无法加载模块:index

[ 2014-08-08T15:18:27+08:00 ] 127.0.0.1 /php_demo/shizhan/10/10wish/index.php/Njb/Index/
INFO: [ route_check ] --START--
INFO: CheckRoute Behavior ::run [ RunTime:0.007000s ]
INFO: [ route_check ] --END-- [ RunTime:0.011000s ]
INFO: [ app_begin ] --START--
INFO: ReadHtmlCache Behavior ::run [ RunTime:0.008001s ]
INFO: [ app_begin ] --END-- [ RunTime:0.013001s ]
INFO: [ view_parse ] --START--
INFO: ParseTemplate Behavior ::run [ RunTime:0.089005s ]
INFO: [ view_parse ] --END-- [ RunTime:0.095006s ]
INFO: [ view_filter ] --START--
INFO: ContentReplace Behavior ::run [ RunTime:0.008000s ]
INFO: TokenBuild Behavior ::run [ RunTime:0.013000s ]
INFO: WriteHtmlCache Behavior ::run [ RunTime:0.005001s ]
INFO: ShowRuntime Behavior ::run [ RunTime:0.012001s ]
INFO: [ view_filter ] --END-- [ RunTime:0.055003s ]
INFO: [ view_end ] --START--
INFO: ShowPageTrace Behavior ::run [ RunTime:0.009001s ]
INFO: [ view_end ] --END-- [ RunTime:0.013001s ]

[ 2014-08-08T15:18:34+08:00 ] 127.0.0.1 /php_demo/shizhan/10/10wish/index.php/Njb/Index/tongji?date_begin=&date_end=
INFO: [ route_check ] --START--
INFO: CheckRoute Behavior ::run [ RunTime:0.006001s ]
INFO: [ route_check ] --END-- [ RunTime:0.013001s ]
INFO: [ app_begin ] --START--
INFO: ReadHtmlCache Behavior ::run [ RunTime:0.009001s ]
INFO: [ app_begin ] --END-- [ RunTime:0.015001s ]
NOTIC: [8] Uninitialized string offset: 0 D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\APP\Lib\Action\Njb\IndexAction.class.php 第 16 行.
SQL: SELECT l.name,COALESCE(a.ucount,0) as yhs,COALESCE(c.ulcount,0) as dlyhs,COALESCE(c.logCount,0) as dlcs FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(ud.id) ucount FROM   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN()    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN()) ud     GROUP BY ud.locid  ) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN()   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN()) ud  WHERE lo.user_id=ud.id   AND lo.login_time>=" 00:00:00" AND lo.login_time<" 00:00:00"   GROUP BY ud.locid) c ON l.id=c.locid WHERE l.id IN() [ RunTime:0.001000s ]
ERR: 1064:You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near ')    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_' at line 1
 [ SQL语句 ] : SELECT l.name,COALESCE(a.ucount,0) as yhs,COALESCE(c.ulcount,0) as dlyhs,COALESCE(c.logCount,0) as dlcs FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(ud.id) ucount FROM   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN()    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN()) ud     GROUP BY ud.locid  ) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN()   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN()) ud  WHERE lo.user_id=ud.id   AND lo.login_time>=" 00:00:00" AND lo.login_time<" 00:00:00"   GROUP BY ud.locid) c ON l.id=c.locid WHERE l.id IN()
SQL: SELECT l.name,COALESCE(a.noticeCount,0) noticeCount,COALESCE(a.userCount,0) userCount FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(n.id) noticeCount,COUNT(DISTINCT ud.id) userCount FROM notice n,   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN()    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN()) ud   WHERE n.owner_id=ud.id AND n.publish_time>=" 00:00:00"    AND n.publish_time<" 00:00:00" GROUP BY ud.locid) a  ON l.id=a.locid WHERE l.id IN() [ RunTime:0.001000s ]
ERR: 1064:You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near ')    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_' at line 1
 [ SQL语句 ] : SELECT l.name,COALESCE(a.noticeCount,0) noticeCount,COALESCE(a.userCount,0) userCount FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(n.id) noticeCount,COUNT(DISTINCT ud.id) userCount FROM notice n,   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN()    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN()) ud   WHERE n.owner_id=ud.id AND n.publish_time>=" 00:00:00"    AND n.publish_time<" 00:00:00" GROUP BY ud.locid) a  ON l.id=a.locid WHERE l.id IN()
SQL: SELECT l.name,COALESCE(a.asCount,0) a,COALESCE(b.adminCount,0) b,COALESCE(c.noAdminCount,0) c FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(t.id) asCount FROM assignment t,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN()   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN()) ud  WHERE t.creator_id=ud.id AND t.create_time>=" 00:00:00" AND  t.create_time<" 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) adminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN()   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN()) ud   WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='TechAdmin'   AND t.create_time>=" 00:00:00" AND  t.create_time<" 00:00:00"  GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) noAdminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN()   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN()) ud  WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='Technician'   AND t.create_time>=" 00:00:00" AND  t.create_time<" 00:00:00"  GROUP BY ud.locid ) c ON l.id=c.locid  WHERE l.id IN() [ RunTime:0.001000s ]
ERR: 1064:You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near ')   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_i' at line 1
 [ SQL语句 ] : SELECT l.name,COALESCE(a.asCount,0) a,COALESCE(b.adminCount,0) b,COALESCE(c.noAdminCount,0) c FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(t.id) asCount FROM assignment t,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN()   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN()) ud  WHERE t.creator_id=ud.id AND t.create_time>=" 00:00:00" AND  t.create_time<" 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) adminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN()   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN()) ud   WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='TechAdmin'   AND t.create_time>=" 00:00:00" AND  t.create_time<" 00:00:00"  GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) noAdminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN()   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN()) ud  WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='Technician'   AND t.create_time>=" 00:00:00" AND  t.create_time<" 00:00:00"  GROUP BY ud.locid ) c ON l.id=c.locid  WHERE l.id IN()
SQL: SELECT l.name,COALESCE(a.worklogCount,0) a,COALESCE(a.uCount,0) b,COALESCE(b.docCount,0) c,COALESCE(c.phoCount,0) d,COALESCE(d.audioCount,0) e FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(DISTINCT w.id) worklogCount,COUNT(DISTINCT w.owner_id) uCount FROM work_log w,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN()   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN()) ud  WHERE w.owner_id=ud.id    AND w.create_time>=" 00:00:00" AND w.create_time<" 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) docCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN()   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN()) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>=" 00:00:00" AND w.create_time<" 00:00:00"  AND i.media_type=1   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) phoCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN()   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN()) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>=" 00:00:00" AND w.create_time<" 00:00:00"  AND i.media_type=2   GROUP BY ud.locid ) c ON l.id=c.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) audioCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN()   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN()) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>=" 00:00:00" AND w.create_time<" 00:00:00"  AND i.media_type=3   GROUP BY ud.locid ) d ON l.id=d.locid   WHERE l.id IN() [ RunTime:0.002000s ]
ERR: 1064:You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near ')   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_i' at line 1
 [ SQL语句 ] : SELECT l.name,COALESCE(a.worklogCount,0) a,COALESCE(a.uCount,0) b,COALESCE(b.docCount,0) c,COALESCE(c.phoCount,0) d,COALESCE(d.audioCount,0) e FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(DISTINCT w.id) worklogCount,COUNT(DISTINCT w.owner_id) uCount FROM work_log w,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN()   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN()) ud  WHERE w.owner_id=ud.id    AND w.create_time>=" 00:00:00" AND w.create_time<" 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) docCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN()   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN()) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>=" 00:00:00" AND w.create_time<" 00:00:00"  AND i.media_type=1   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) phoCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN()   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN()) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>=" 00:00:00" AND w.create_time<" 00:00:00"  AND i.media_type=2   GROUP BY ud.locid ) c ON l.id=c.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) audioCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN()   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN()) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>=" 00:00:00" AND w.create_time<" 00:00:00"  AND i.media_type=3   GROUP BY ud.locid ) d ON l.id=d.locid   WHERE l.id IN()
SQL: SELECT l.name,COALESCE(a.photoCount,0) a,COALESCE(a.ucount,0) b,COALESCE(b.priseCount,0) c,COALESCE(c.comCount,0) d FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(i.id) photoCount,COUNT(DISTINCT ud.id) ucount FROM album m,album_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN()  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN()) ud  WHERE m.owner_id=ud.id AND i.album_id=m.id   AND i.create_time>=" 00:00:00" AND i.create_time<" 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,COUNT(uc.id) priseCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN()  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN()) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='AlbumItem'   AND uc.create_time>" 00:00:00" AND uc.create_time<" 00:00:00"   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(uc.id) comCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN()  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN()) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='SystemComment'   AND uc.create_time>=" 00:00:00" AND uc.create_time<" 00:00:00"  GROUP BY ud.locid) c ON l.id=c.locid  WHERE l.id IN() [ RunTime:0.002000s ]
ERR: 1064:You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near ')  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id' at line 1
 [ SQL语句 ] : SELECT l.name,COALESCE(a.photoCount,0) a,COALESCE(a.ucount,0) b,COALESCE(b.priseCount,0) c,COALESCE(c.comCount,0) d FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(i.id) photoCount,COUNT(DISTINCT ud.id) ucount FROM album m,album_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN()  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN()) ud  WHERE m.owner_id=ud.id AND i.album_id=m.id   AND i.create_time>=" 00:00:00" AND i.create_time<" 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,COUNT(uc.id) priseCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN()  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN()) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='AlbumItem'   AND uc.create_time>" 00:00:00" AND uc.create_time<" 00:00:00"   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(uc.id) comCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN()  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN()) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='SystemComment'   AND uc.create_time>=" 00:00:00" AND uc.create_time<" 00:00:00"  GROUP BY ud.locid) c ON l.id=c.locid  WHERE l.id IN()
SQL: SELECT a.rname a,l.name b,d.name c,a.age d FROM (SELECT u.id uid,u.real_name rname,u.location_id locid,u.dept_id depId,(2014-(SELECT SUBSTR(u.identify_value,7,4))+0) age FROM app_user u WHERE NOT EXISTS ( SELECT lo.user_id FROM login_log lo WHERE u.id=lo.user_id  ) AND u.id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN()   UNION ALL SELECT u.id FROM app_user u WHERE u.location_id IN() )) a,location l,department d WHERE a.depId=d.id AND a.locid=l.id [ RunTime:0.002000s ]
ERR: 1064:You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near ')   UNION ALL SELECT u.id FROM app_user u WHERE u.location_id IN() )) a,location' at line 1
 [ SQL语句 ] : SELECT a.rname a,l.name b,d.name c,a.age d FROM (SELECT u.id uid,u.real_name rname,u.location_id locid,u.dept_id depId,(2014-(SELECT SUBSTR(u.identify_value,7,4))+0) age FROM app_user u WHERE NOT EXISTS ( SELECT lo.user_id FROM login_log lo WHERE u.id=lo.user_id  ) AND u.id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN()   UNION ALL SELECT u.id FROM app_user u WHERE u.location_id IN() )) a,location l,department d WHERE a.depId=d.id AND a.locid=l.id
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) AND w.create_time>=" 00:00:00" AND w.create_time<" 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) AND lo.login_time>=" 00:00:00" AND lo.login_time<" 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.406024s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) AND w.create_time>=" 00:00:00" AND w.create_time<" 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) AND lo.login_time>=" 00:00:00" AND lo.login_time<" 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.388022s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) AND w.create_time>=" 00:00:00" AND w.create_time<" 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) AND lo.login_time>=" 00:00:00" AND lo.login_time<" 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.373021s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) AND w.create_time>=" 00:00:00" AND w.create_time<" 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) AND lo.login_time>=" 00:00:00" AND lo.login_time<" 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.368021s ]
SQL: SELECT l.name,COALESCE(a.ulcount,0) b FROM  location l LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN()   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN()) ud  WHERE lo.user_id=ud.id   AND lo.login_time>=(TIMESTAMP(ADDDATE(DATE(SYSDATE()),-(DAYOFWEEK(NOW())-2))))   GROUP BY ud.locid) a ON a.locid=l.id WHERE l.id IN () [ RunTime:0.001001s ]
ERR: 1064:You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near ')   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_i' at line 1
 [ SQL语句 ] : SELECT l.name,COALESCE(a.ulcount,0) b FROM  location l LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN()   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN()) ud  WHERE lo.user_id=ud.id   AND lo.login_time>=(TIMESTAMP(ADDDATE(DATE(SYSDATE()),-(DAYOFWEEK(NOW())-2))))   GROUP BY ud.locid) a ON a.locid=l.id WHERE l.id IN ()
INFO: [ view_parse ] --START--
INFO: ParseTemplate Behavior ::run [ RunTime:0.508029s ]
INFO: [ view_parse ] --END-- [ RunTime:0.513030s ]
INFO: [ view_filter ] --START--
INFO: ContentReplace Behavior ::run [ RunTime:0.009001s ]
INFO: TokenBuild Behavior ::run [ RunTime:0.012000s ]
INFO: WriteHtmlCache Behavior ::run [ RunTime:0.007000s ]
INFO: ShowRuntime Behavior ::run [ RunTime:0.015001s ]
INFO: [ view_filter ] --END-- [ RunTime:0.057003s ]
INFO: [ view_end ] --START--
INFO: ShowPageTrace Behavior ::run [ RunTime:0.008000s ]
INFO: [ view_end ] --END-- [ RunTime:0.013001s ]

