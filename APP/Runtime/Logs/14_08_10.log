[ 2014-08-10T14:26:14+08:00 ] 127.0.0.1 /php_demo/shizhan/10/10wish/index.php/
INFO: [ route_check ] --START--
INFO: CheckRoute Behavior ::run [ RunTime:0.008001s ]
INFO: [ route_check ] --END-- [ RunTime:0.015001s ]
INFO: [ app_begin ] --START--
INFO: ReadHtmlCache Behavior ::run [ RunTime:0.009001s ]
INFO: [ app_begin ] --END-- [ RunTime:0.015001s ]
SQL: SHOW COLUMNS FROM `tp_wish` [ RunTime:0.014001s ]
SQL: SELECT * FROM `tp_wish`  [ RunTime:0.001000s ]
INFO: [ view_parse ] --START--
INFO: ParseTemplate Behavior ::run [ RunTime:0.205011s ]
INFO: [ view_parse ] --END-- [ RunTime:0.212012s ]
INFO: [ view_filter ] --START--
INFO: ContentReplace Behavior ::run [ RunTime:0.012001s ]
INFO: TokenBuild Behavior ::run [ RunTime:0.020001s ]
INFO: WriteHtmlCache Behavior ::run [ RunTime:0.009001s ]
INFO: ShowRuntime Behavior ::run [ RunTime:0.019001s ]
INFO: [ view_filter ] --END-- [ RunTime:0.075004s ]
INFO: [ view_end ] --START--
INFO: ShowPageTrace Behavior ::run [ RunTime:0.011000s ]
INFO: [ view_end ] --END-- [ RunTime:0.016001s ]

[ 2014-08-10T14:26:22+08:00 ] 127.0.0.1 /php_demo/shizhan/10/10wish/index.php/Njb/Index/
INFO: [ route_check ] --START--
INFO: CheckRoute Behavior ::run [ RunTime:0.009001s ]
INFO: [ route_check ] --END-- [ RunTime:0.017001s ]
INFO: [ app_begin ] --START--
INFO: ReadHtmlCache Behavior ::run [ RunTime:0.011000s ]
INFO: [ app_begin ] --END-- [ RunTime:0.017001s ]
INFO: [ view_parse ] --START--
INFO: ParseTemplate Behavior ::run [ RunTime:0.119007s ]
INFO: [ view_parse ] --END-- [ RunTime:0.125007s ]
INFO: [ view_filter ] --START--
INFO: ContentReplace Behavior ::run [ RunTime:0.007001s ]
INFO: TokenBuild Behavior ::run [ RunTime:0.010001s ]
INFO: WriteHtmlCache Behavior ::run [ RunTime:0.005000s ]
INFO: ShowRuntime Behavior ::run [ RunTime:0.016001s ]
INFO: [ view_filter ] --END-- [ RunTime:0.054003s ]
INFO: [ view_end ] --START--
INFO: ShowPageTrace Behavior ::run [ RunTime:0.009000s ]
INFO: [ view_end ] --END-- [ RunTime:0.013000s ]

[ 2014-08-10T14:27:21+08:00 ] 127.0.0.1 /php_demo/shizhan/10/10wish/index.php/Njb/Index/tongji?checkbox%5B%5D=24521&checkbox%5B%5D=24543&checkbox%5B%5D=24561&date_begin=2014-08-03&date_end=2014-08-09
INFO: [ route_check ] --START--
INFO: CheckRoute Behavior ::run [ RunTime:0.008001s ]
INFO: [ route_check ] --END-- [ RunTime:0.014001s ]
INFO: [ app_begin ] --START--
INFO: ReadHtmlCache Behavior ::run [ RunTime:0.010001s ]
INFO: [ app_begin ] --END-- [ RunTime:0.016001s ]
SQL: SELECT l.name,COALESCE(a.ucount,0) as yhs,COALESCE(c.ulcount,0) as dlyhs,COALESCE(c.logCount,0) as dlcs FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(ud.id) ucount FROM   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561)) ud     GROUP BY ud.locid  ) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>="2014-08-03 00:00:00" AND lo.login_time<"2014-08-09 00:00:00"   GROUP BY ud.locid) c ON l.id=c.locid WHERE l.id IN(24521,24543,24561) [ RunTime:0.335019s ]
SQL: SELECT l.name,COALESCE(a.noticeCount,0) noticeCount,COALESCE(a.userCount,0) userCount FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(n.id) noticeCount,COUNT(DISTINCT ud.id) userCount FROM notice n,   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561)) ud   WHERE n.owner_id=ud.id AND n.publish_time>="2014-08-03 00:00:00"    AND n.publish_time<"2014-08-09 00:00:00" GROUP BY ud.locid) a  ON l.id=a.locid WHERE l.id IN(24521,24543,24561) [ RunTime:0.005000s ]
SQL: SELECT l.name,COALESCE(a.asCount,0) a,COALESCE(b.adminCount,0) b,COALESCE(c.noAdminCount,0) c FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(t.id) asCount FROM assignment t,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561)) ud  WHERE t.creator_id=ud.id AND t.create_time>="2014-08-03 00:00:00" AND  t.create_time<"2014-08-09 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) adminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561)) ud   WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='TechAdmin'   AND t.create_time>="2014-08-03 00:00:00" AND  t.create_time<"2014-08-09 00:00:00"  GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) noAdminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561)) ud  WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='Technician'   AND t.create_time>="2014-08-03 00:00:00" AND  t.create_time<"2014-08-09 00:00:00"  GROUP BY ud.locid ) c ON l.id=c.locid  WHERE l.id IN(24521,24543,24561) [ RunTime:0.067004s ]
SQL: SELECT l.name,COALESCE(a.worklogCount,0) a,COALESCE(a.uCount,0) b,COALESCE(b.docCount,0) c,COALESCE(c.phoCount,0) d,COALESCE(d.audioCount,0) e FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(DISTINCT w.id) worklogCount,COUNT(DISTINCT w.owner_id) uCount FROM work_log w,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561)) ud  WHERE w.owner_id=ud.id    AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) docCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00"  AND i.media_type=1   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) phoCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00"  AND i.media_type=2   GROUP BY ud.locid ) c ON l.id=c.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) audioCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00"  AND i.media_type=3   GROUP BY ud.locid ) d ON l.id=d.locid   WHERE l.id IN(24521,24543,24561) [ RunTime:0.045003s ]
SQL: SELECT l.name,COALESCE(a.photoCount,0) a,COALESCE(a.ucount,0) b,COALESCE(b.priseCount,0) c,COALESCE(c.comCount,0) d FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(i.id) photoCount,COUNT(DISTINCT ud.id) ucount FROM album m,album_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561)) ud  WHERE m.owner_id=ud.id AND i.album_id=m.id   AND i.create_time>="2014-08-03 00:00:00" AND i.create_time<"2014-08-09 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,COUNT(uc.id) priseCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='AlbumItem'   AND uc.create_time>"2014-08-03 00:00:00" AND uc.create_time<"2014-08-09 00:00:00"   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(uc.id) comCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='SystemComment'   AND uc.create_time>="2014-08-03 00:00:00" AND uc.create_time<"2014-08-09 00:00:00"  GROUP BY ud.locid) c ON l.id=c.locid  WHERE l.id IN(24521,24543,24561) [ RunTime:0.085005s ]
SQL: SELECT a.rname a,l.name b,d.name c,a.age d FROM (SELECT u.id uid,u.real_name rname,u.location_id locid,u.dept_id depId,(2014-(SELECT SUBSTR(u.identify_value,7,4))+0) age FROM app_user u WHERE NOT EXISTS ( SELECT lo.user_id FROM login_log lo WHERE u.id=lo.user_id  ) AND u.id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561)   UNION ALL SELECT u.id FROM app_user u WHERE u.location_id IN(24521,24543,24561) )) a,location l,department d WHERE a.depId=d.id AND a.locid=l.id [ RunTime:3.946226s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) AND lo.login_time>="2014-08-03 00:00:00" AND lo.login_time<"2014-08-09 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.563032s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) AND lo.login_time>="2014-08-03 00:00:00" AND lo.login_time<"2014-08-09 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.482027s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) AND lo.login_time>="2014-08-03 00:00:00" AND lo.login_time<"2014-08-09 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.510029s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) AND lo.login_time>="2014-08-03 00:00:00" AND lo.login_time<"2014-08-09 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.516029s ]
SQL: SELECT l.name,COALESCE(a.ulcount,0) b FROM  location l LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>=(TIMESTAMP(ADDDATE(DATE(SYSDATE()),-(DAYOFWEEK(NOW())-2))))   GROUP BY ud.locid) a ON a.locid=l.id WHERE l.id IN (24521,24543,24561) [ RunTime:0.081005s ]
INFO: [ view_parse ] --START--
INFO: ParseTemplate Behavior ::run [ RunTime:0.791045s ]
INFO: [ view_parse ] --END-- [ RunTime:0.799045s ]
INFO: [ view_filter ] --START--
INFO: ContentReplace Behavior ::run [ RunTime:0.011001s ]
INFO: TokenBuild Behavior ::run [ RunTime:0.013001s ]
INFO: WriteHtmlCache Behavior ::run [ RunTime:0.007000s ]
INFO: ShowRuntime Behavior ::run [ RunTime:0.020002s ]
INFO: [ view_filter ] --END-- [ RunTime:0.069004s ]
INFO: [ view_end ] --START--
INFO: ShowPageTrace Behavior ::run [ RunTime:0.013000s ]
INFO: [ view_end ] --END-- [ RunTime:0.021002s ]

[ 2014-08-10T14:29:26+08:00 ] 127.0.0.1 /php_demo/shizhan/10/10wish/index.php/Njb/Index/tongji?checkbox%5B%5D=28422&date_begin=2014-08-03&date_end=2014-08-09
INFO: [ route_check ] --START--
INFO: CheckRoute Behavior ::run [ RunTime:0.009001s ]
INFO: [ route_check ] --END-- [ RunTime:0.014001s ]
INFO: [ app_begin ] --START--
INFO: ReadHtmlCache Behavior ::run [ RunTime:0.011000s ]
INFO: [ app_begin ] --END-- [ RunTime:0.017001s ]
SQL: SELECT l.name,COALESCE(a.ucount,0) as yhs,COALESCE(c.ulcount,0) as dlyhs,COALESCE(c.logCount,0) as dlcs FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(ud.id) ucount FROM   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(28422)) ud     GROUP BY ud.locid  ) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(28422)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>="2014-08-03 00:00:00" AND lo.login_time<"2014-08-09 00:00:00"   GROUP BY ud.locid) c ON l.id=c.locid WHERE l.id IN(28422) [ RunTime:0.101006s ]
SQL: SELECT l.name,COALESCE(a.noticeCount,0) noticeCount,COALESCE(a.userCount,0) userCount FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(n.id) noticeCount,COUNT(DISTINCT ud.id) userCount FROM notice n,   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(28422)) ud   WHERE n.owner_id=ud.id AND n.publish_time>="2014-08-03 00:00:00"    AND n.publish_time<"2014-08-09 00:00:00" GROUP BY ud.locid) a  ON l.id=a.locid WHERE l.id IN(28422) [ RunTime:0.004000s ]
SQL: SELECT l.name,COALESCE(a.asCount,0) a,COALESCE(b.adminCount,0) b,COALESCE(c.noAdminCount,0) c FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(t.id) asCount FROM assignment t,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(28422)) ud  WHERE t.creator_id=ud.id AND t.create_time>="2014-08-03 00:00:00" AND  t.create_time<"2014-08-09 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) adminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(28422)) ud   WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='TechAdmin'   AND t.create_time>="2014-08-03 00:00:00" AND  t.create_time<"2014-08-09 00:00:00"  GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) noAdminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(28422)) ud  WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='Technician'   AND t.create_time>="2014-08-03 00:00:00" AND  t.create_time<"2014-08-09 00:00:00"  GROUP BY ud.locid ) c ON l.id=c.locid  WHERE l.id IN(28422) [ RunTime:0.016001s ]
SQL: SELECT l.name,COALESCE(a.worklogCount,0) a,COALESCE(a.uCount,0) b,COALESCE(b.docCount,0) c,COALESCE(c.phoCount,0) d,COALESCE(d.audioCount,0) e FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(DISTINCT w.id) worklogCount,COUNT(DISTINCT w.owner_id) uCount FROM work_log w,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(28422)) ud  WHERE w.owner_id=ud.id    AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) docCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(28422)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00"  AND i.media_type=1   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) phoCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(28422)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00"  AND i.media_type=2   GROUP BY ud.locid ) c ON l.id=c.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) audioCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(28422)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00"  AND i.media_type=3   GROUP BY ud.locid ) d ON l.id=d.locid   WHERE l.id IN(28422) [ RunTime:0.012001s ]
SQL: SELECT l.name,COALESCE(a.photoCount,0) a,COALESCE(a.ucount,0) b,COALESCE(b.priseCount,0) c,COALESCE(c.comCount,0) d FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(i.id) photoCount,COUNT(DISTINCT ud.id) ucount FROM album m,album_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(28422)) ud  WHERE m.owner_id=ud.id AND i.album_id=m.id   AND i.create_time>="2014-08-03 00:00:00" AND i.create_time<"2014-08-09 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,COUNT(uc.id) priseCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(28422)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='AlbumItem'   AND uc.create_time>"2014-08-03 00:00:00" AND uc.create_time<"2014-08-09 00:00:00"   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(uc.id) comCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(28422)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='SystemComment'   AND uc.create_time>="2014-08-03 00:00:00" AND uc.create_time<"2014-08-09 00:00:00"  GROUP BY ud.locid) c ON l.id=c.locid  WHERE l.id IN(28422) [ RunTime:0.005000s ]
SQL: SELECT a.rname a,l.name b,d.name c,a.age d FROM (SELECT u.id uid,u.real_name rname,u.location_id locid,u.dept_id depId,(2014-(SELECT SUBSTR(u.identify_value,7,4))+0) age FROM app_user u WHERE NOT EXISTS ( SELECT lo.user_id FROM login_log lo WHERE u.id=lo.user_id  ) AND u.id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)   UNION ALL SELECT u.id FROM app_user u WHERE u.location_id IN(28422) )) a,location l,department d WHERE a.depId=d.id AND a.locid=l.id [ RunTime:2.692154s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) AND lo.login_time>="2014-08-03 00:00:00" AND lo.login_time<"2014-08-09 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.469027s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) AND lo.login_time>="2014-08-03 00:00:00" AND lo.login_time<"2014-08-09 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.482028s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) AND lo.login_time>="2014-08-03 00:00:00" AND lo.login_time<"2014-08-09 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.470026s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) AND lo.login_time>="2014-08-03 00:00:00" AND lo.login_time<"2014-08-09 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.485028s ]
SQL: SELECT l.name,COALESCE(a.ulcount,0) b FROM  location l LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(28422)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>=(TIMESTAMP(ADDDATE(DATE(SYSDATE()),-(DAYOFWEEK(NOW())-2))))   GROUP BY ud.locid) a ON a.locid=l.id WHERE l.id IN (28422) [ RunTime:0.026002s ]
INFO: [ view_parse ] --START--
INFO: ParseTemplate Behavior ::run [ RunTime:0.627035s ]
INFO: [ view_parse ] --END-- [ RunTime:0.634037s ]
INFO: [ view_filter ] --START--
INFO: ContentReplace Behavior ::run [ RunTime:0.016001s ]
INFO: TokenBuild Behavior ::run [ RunTime:0.018001s ]
INFO: WriteHtmlCache Behavior ::run [ RunTime:0.008000s ]
INFO: ShowRuntime Behavior ::run [ RunTime:0.020001s ]
INFO: [ view_filter ] --END-- [ RunTime:0.089005s ]
INFO: [ view_end ] --START--
INFO: ShowPageTrace Behavior ::run [ RunTime:0.014001s ]
INFO: [ view_end ] --END-- [ RunTime:0.021001s ]

[ 2014-08-10T14:35:59+08:00 ] 127.0.0.1 /php_demo/shizhan/10/10wish/index.php/Njb/Index/tongji?checkbox%5B%5D=28422&date_begin=2014-08-03&date_end=2014-08-09
INFO: [ route_check ] --START--
INFO: CheckRoute Behavior ::run [ RunTime:0.007001s ]
INFO: [ route_check ] --END-- [ RunTime:0.012001s ]
INFO: [ app_begin ] --START--
INFO: ReadHtmlCache Behavior ::run [ RunTime:0.008000s ]
INFO: [ app_begin ] --END-- [ RunTime:0.014001s ]
SQL: SELECT l.name,COALESCE(a.ucount,0) as yhs,COALESCE(c.ulcount,0) as dlyhs,COALESCE(c.logCount,0) as dlcs FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(ud.id) ucount FROM   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(28422)) ud     GROUP BY ud.locid  ) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(28422)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>="2014-08-03 00:00:00" AND lo.login_time<"2014-08-09 00:00:00"   GROUP BY ud.locid) c ON l.id=c.locid WHERE l.id IN(28422) [ RunTime:0.073005s ]
SQL: SELECT l.name,COALESCE(a.noticeCount,0) noticeCount,COALESCE(a.userCount,0) userCount FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(n.id) noticeCount,COUNT(DISTINCT ud.id) userCount FROM notice n,   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(28422)) ud   WHERE n.owner_id=ud.id AND n.publish_time>="2014-08-03 00:00:00"    AND n.publish_time<"2014-08-09 00:00:00" GROUP BY ud.locid) a  ON l.id=a.locid WHERE l.id IN(28422) [ RunTime:0.003000s ]
SQL: SELECT l.name,COALESCE(a.asCount,0) a,COALESCE(b.adminCount,0) b,COALESCE(c.noAdminCount,0) c FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(t.id) asCount FROM assignment t,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(28422)) ud  WHERE t.creator_id=ud.id AND t.create_time>="2014-08-03 00:00:00" AND  t.create_time<"2014-08-09 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) adminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(28422)) ud   WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='TechAdmin'   AND t.create_time>="2014-08-03 00:00:00" AND  t.create_time<"2014-08-09 00:00:00"  GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) noAdminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(28422)) ud  WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='Technician'   AND t.create_time>="2014-08-03 00:00:00" AND  t.create_time<"2014-08-09 00:00:00"  GROUP BY ud.locid ) c ON l.id=c.locid  WHERE l.id IN(28422) [ RunTime:0.005000s ]
SQL: SELECT l.name,COALESCE(a.worklogCount,0) a,COALESCE(a.uCount,0) b,COALESCE(b.docCount,0) c,COALESCE(c.phoCount,0) d,COALESCE(d.audioCount,0) e FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(DISTINCT w.id) worklogCount,COUNT(DISTINCT w.owner_id) uCount FROM work_log w,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(28422)) ud  WHERE w.owner_id=ud.id    AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) docCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(28422)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00"  AND i.media_type=1   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) phoCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(28422)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00"  AND i.media_type=2   GROUP BY ud.locid ) c ON l.id=c.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) audioCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(28422)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00"  AND i.media_type=3   GROUP BY ud.locid ) d ON l.id=d.locid   WHERE l.id IN(28422) [ RunTime:0.010001s ]
SQL: SELECT l.name,COALESCE(a.photoCount,0) a,COALESCE(a.ucount,0) b,COALESCE(b.priseCount,0) c,COALESCE(c.comCount,0) d FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(i.id) photoCount,COUNT(DISTINCT ud.id) ucount FROM album m,album_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(28422)) ud  WHERE m.owner_id=ud.id AND i.album_id=m.id   AND i.create_time>="2014-08-03 00:00:00" AND i.create_time<"2014-08-09 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,COUNT(uc.id) priseCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(28422)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='AlbumItem'   AND uc.create_time>"2014-08-03 00:00:00" AND uc.create_time<"2014-08-09 00:00:00"   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(uc.id) comCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(28422)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='SystemComment'   AND uc.create_time>="2014-08-03 00:00:00" AND uc.create_time<"2014-08-09 00:00:00"  GROUP BY ud.locid) c ON l.id=c.locid  WHERE l.id IN(28422) [ RunTime:0.005001s ]
SQL: SELECT a.rname a,l.name b,d.name c,a.age d FROM (SELECT u.id uid,u.real_name rname,u.location_id locid,u.dept_id depId,(2014-(SELECT SUBSTR(u.identify_value,7,4))+0) age FROM app_user u WHERE NOT EXISTS ( SELECT lo.user_id FROM login_log lo WHERE u.id=lo.user_id  ) AND u.id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)   UNION ALL SELECT u.id FROM app_user u WHERE u.location_id IN(28422) )) a,location l,department d WHERE a.depId=d.id AND a.locid=l.id [ RunTime:2.283131s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) AND lo.login_time>="2014-08-03 00:00:00" AND lo.login_time<"2014-08-09 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.362021s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) AND lo.login_time>="2014-08-03 00:00:00" AND lo.login_time<"2014-08-09 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.347020s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) AND lo.login_time>="2014-08-03 00:00:00" AND lo.login_time<"2014-08-09 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.354020s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) AND lo.login_time>="2014-08-03 00:00:00" AND lo.login_time<"2014-08-09 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.360021s ]
SQL: SELECT l.name,COALESCE(a.ulcount,0) b FROM  location l LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(28422)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>="2014-08-03 00:00:00"   GROUP BY ud.locid) a ON a.locid=l.id WHERE l.id IN (28422) [ RunTime:0.050003s ]
INFO: [ view_parse ] --START--
INFO: ParseTemplate Behavior ::run [ RunTime:0.535030s ]
INFO: [ view_parse ] --END-- [ RunTime:0.539031s ]
INFO: [ view_filter ] --START--
INFO: ContentReplace Behavior ::run [ RunTime:0.009000s ]
INFO: TokenBuild Behavior ::run [ RunTime:0.065003s ]
INFO: WriteHtmlCache Behavior ::run [ RunTime:0.005001s ]
INFO: ShowRuntime Behavior ::run [ RunTime:0.017001s ]
INFO: [ view_filter ] --END-- [ RunTime:0.106006s ]
INFO: [ view_end ] --START--
INFO: ShowPageTrace Behavior ::run [ RunTime:0.013001s ]
INFO: [ view_end ] --END-- [ RunTime:0.018001s ]

[ 2014-08-10T14:36:23+08:00 ] 127.0.0.1 /php_demo/shizhan/10/10wish/index.php/Njb/Index/tongji?checkbox%5B%5D=24521&checkbox%5B%5D=24543&checkbox%5B%5D=24561&date_begin=2014-08-03&date_end=2014-08-09
INFO: [ route_check ] --START--
INFO: CheckRoute Behavior ::run [ RunTime:0.006001s ]
INFO: [ route_check ] --END-- [ RunTime:0.011001s ]
INFO: [ app_begin ] --START--
INFO: ReadHtmlCache Behavior ::run [ RunTime:0.008000s ]
INFO: [ app_begin ] --END-- [ RunTime:0.012001s ]
SQL: SELECT l.name,COALESCE(a.ucount,0) as yhs,COALESCE(c.ulcount,0) as dlyhs,COALESCE(c.logCount,0) as dlcs FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(ud.id) ucount FROM   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561)) ud     GROUP BY ud.locid  ) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>="2014-08-03 00:00:00" AND lo.login_time<"2014-08-09 00:00:00"   GROUP BY ud.locid) c ON l.id=c.locid WHERE l.id IN(24521,24543,24561) [ RunTime:0.104006s ]
SQL: SELECT l.name,COALESCE(a.noticeCount,0) noticeCount,COALESCE(a.userCount,0) userCount FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(n.id) noticeCount,COUNT(DISTINCT ud.id) userCount FROM notice n,   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561)) ud   WHERE n.owner_id=ud.id AND n.publish_time>="2014-08-03 00:00:00"    AND n.publish_time<"2014-08-09 00:00:00" GROUP BY ud.locid) a  ON l.id=a.locid WHERE l.id IN(24521,24543,24561) [ RunTime:0.003000s ]
SQL: SELECT l.name,COALESCE(a.asCount,0) a,COALESCE(b.adminCount,0) b,COALESCE(c.noAdminCount,0) c FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(t.id) asCount FROM assignment t,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561)) ud  WHERE t.creator_id=ud.id AND t.create_time>="2014-08-03 00:00:00" AND  t.create_time<"2014-08-09 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) adminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561)) ud   WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='TechAdmin'   AND t.create_time>="2014-08-03 00:00:00" AND  t.create_time<"2014-08-09 00:00:00"  GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) noAdminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561)) ud  WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='Technician'   AND t.create_time>="2014-08-03 00:00:00" AND  t.create_time<"2014-08-09 00:00:00"  GROUP BY ud.locid ) c ON l.id=c.locid  WHERE l.id IN(24521,24543,24561) [ RunTime:0.008000s ]
SQL: SELECT l.name,COALESCE(a.worklogCount,0) a,COALESCE(a.uCount,0) b,COALESCE(b.docCount,0) c,COALESCE(c.phoCount,0) d,COALESCE(d.audioCount,0) e FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(DISTINCT w.id) worklogCount,COUNT(DISTINCT w.owner_id) uCount FROM work_log w,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561)) ud  WHERE w.owner_id=ud.id    AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) docCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00"  AND i.media_type=1   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) phoCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00"  AND i.media_type=2   GROUP BY ud.locid ) c ON l.id=c.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) audioCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00"  AND i.media_type=3   GROUP BY ud.locid ) d ON l.id=d.locid   WHERE l.id IN(24521,24543,24561) [ RunTime:0.031001s ]
SQL: SELECT l.name,COALESCE(a.photoCount,0) a,COALESCE(a.ucount,0) b,COALESCE(b.priseCount,0) c,COALESCE(c.comCount,0) d FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(i.id) photoCount,COUNT(DISTINCT ud.id) ucount FROM album m,album_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561)) ud  WHERE m.owner_id=ud.id AND i.album_id=m.id   AND i.create_time>="2014-08-03 00:00:00" AND i.create_time<"2014-08-09 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,COUNT(uc.id) priseCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='AlbumItem'   AND uc.create_time>"2014-08-03 00:00:00" AND uc.create_time<"2014-08-09 00:00:00"   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(uc.id) comCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='SystemComment'   AND uc.create_time>="2014-08-03 00:00:00" AND uc.create_time<"2014-08-09 00:00:00"  GROUP BY ud.locid) c ON l.id=c.locid  WHERE l.id IN(24521,24543,24561) [ RunTime:0.010000s ]
SQL: SELECT a.rname a,l.name b,d.name c,a.age d FROM (SELECT u.id uid,u.real_name rname,u.location_id locid,u.dept_id depId,(2014-(SELECT SUBSTR(u.identify_value,7,4))+0) age FROM app_user u WHERE NOT EXISTS ( SELECT lo.user_id FROM login_log lo WHERE u.id=lo.user_id  ) AND u.id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561)   UNION ALL SELECT u.id FROM app_user u WHERE u.location_id IN(24521,24543,24561) )) a,location l,department d WHERE a.depId=d.id AND a.locid=l.id [ RunTime:1.996114s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) AND lo.login_time>="2014-08-03 00:00:00" AND lo.login_time<"2014-08-09 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.398023s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) AND lo.login_time>="2014-08-03 00:00:00" AND lo.login_time<"2014-08-09 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.349020s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) AND lo.login_time>="2014-08-03 00:00:00" AND lo.login_time<"2014-08-09 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.359021s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) AND lo.login_time>="2014-08-03 00:00:00" AND lo.login_time<"2014-08-09 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.359021s ]
SQL: SELECT l.name,COALESCE(a.ulcount,0) b FROM  location l LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>="2014-08-03 00:00:00"   GROUP BY ud.locid) a ON a.locid=l.id WHERE l.id IN (24521,24543,24561) [ RunTime:0.113007s ]
INFO: [ view_parse ] --START--
INFO: ParseTemplate Behavior ::run [ RunTime:0.481028s ]
INFO: [ view_parse ] --END-- [ RunTime:0.486028s ]
INFO: [ view_filter ] --START--
INFO: ContentReplace Behavior ::run [ RunTime:0.007001s ]
INFO: TokenBuild Behavior ::run [ RunTime:0.009001s ]
INFO: WriteHtmlCache Behavior ::run [ RunTime:0.006000s ]
INFO: ShowRuntime Behavior ::run [ RunTime:0.017001s ]
INFO: [ view_filter ] --END-- [ RunTime:0.054003s ]
INFO: [ view_end ] --START--
INFO: ShowPageTrace Behavior ::run [ RunTime:0.008000s ]
INFO: [ view_end ] --END-- [ RunTime:0.013001s ]

[ 2014-08-10T15:01:17+08:00 ] 127.0.0.1 /php_demo/shizhan/10/10wish/index.php/Njb/Index/tongji?checkbox%5B%5D=28422&date_begin=2014-08-03&date_end=2014-08-09
INFO: [ route_check ] --START--
INFO: CheckRoute Behavior ::run [ RunTime:0.020001s ]
INFO: [ route_check ] --END-- [ RunTime:0.025002s ]
INFO: [ app_begin ] --START--
INFO: ReadHtmlCache Behavior ::run [ RunTime:0.019001s ]
INFO: [ app_begin ] --END-- [ RunTime:0.023002s ]

[ 2014-08-10T15:01:37+08:00 ] 127.0.0.1 /php_demo/shizhan/10/10wish/index.php/Njb/Index/tongji?checkbox%5B%5D=28422&date_begin=2014-08-03&date_end=2014-08-09
INFO: [ route_check ] --START--
INFO: CheckRoute Behavior ::run [ RunTime:0.006000s ]
INFO: [ route_check ] --END-- [ RunTime:0.011001s ]
INFO: [ app_begin ] --START--
INFO: ReadHtmlCache Behavior ::run [ RunTime:0.009000s ]
INFO: [ app_begin ] --END-- [ RunTime:0.013001s ]
SQL: SELECT l.name,COALESCE(a.ucount,0) as yhs,COALESCE(c.ulcount,0) as dlyhs,COALESCE(c.logCount,0) as dlcs FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(ud.id) ucount FROM   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(28422)) ud     GROUP BY ud.locid  ) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(28422)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>="2014-08-03 00:00:00" AND lo.login_time<"2014-08-09 00:00:00"   GROUP BY ud.locid) c ON l.id=c.locid WHERE l.id IN(28422) [ RunTime:0.048003s ]
SQL: SELECT l.name,COALESCE(a.noticeCount,0) noticeCount,COALESCE(a.userCount,0) userCount FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(n.id) noticeCount,COUNT(DISTINCT ud.id) userCount FROM notice n,   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(28422)) ud   WHERE n.owner_id=ud.id AND n.publish_time>="2014-08-03 00:00:00"    AND n.publish_time<"2014-08-09 00:00:00" GROUP BY ud.locid) a  ON l.id=a.locid WHERE l.id IN(28422) [ RunTime:0.002000s ]
SQL: SELECT l.name,COALESCE(a.asCount,0) a,COALESCE(b.adminCount,0) b,COALESCE(c.noAdminCount,0) c FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(t.id) asCount FROM assignment t,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(28422)) ud  WHERE t.creator_id=ud.id AND t.create_time>="2014-08-03 00:00:00" AND  t.create_time<"2014-08-09 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) adminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(28422)) ud   WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='TechAdmin'   AND t.create_time>="2014-08-03 00:00:00" AND  t.create_time<"2014-08-09 00:00:00"  GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) noAdminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(28422)) ud  WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='Technician'   AND t.create_time>="2014-08-03 00:00:00" AND  t.create_time<"2014-08-09 00:00:00"  GROUP BY ud.locid ) c ON l.id=c.locid  WHERE l.id IN(28422) [ RunTime:0.004000s ]
SQL: SELECT l.name,COALESCE(a.worklogCount,0) a,COALESCE(a.uCount,0) b,COALESCE(b.docCount,0) c,COALESCE(c.phoCount,0) d,COALESCE(d.audioCount,0) e FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(DISTINCT w.id) worklogCount,COUNT(DISTINCT w.owner_id) uCount FROM work_log w,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(28422)) ud  WHERE w.owner_id=ud.id    AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) docCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(28422)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00"  AND i.media_type=1   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) phoCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(28422)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00"  AND i.media_type=2   GROUP BY ud.locid ) c ON l.id=c.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) audioCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(28422)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00"  AND i.media_type=3   GROUP BY ud.locid ) d ON l.id=d.locid   WHERE l.id IN(28422) [ RunTime:0.009001s ]
SQL: SELECT l.name,COALESCE(a.photoCount,0) a,COALESCE(a.ucount,0) b,COALESCE(b.priseCount,0) c,COALESCE(c.comCount,0) d FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(i.id) photoCount,COUNT(DISTINCT ud.id) ucount FROM album m,album_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(28422)) ud  WHERE m.owner_id=ud.id AND i.album_id=m.id   AND i.create_time>="2014-08-03 00:00:00" AND i.create_time<"2014-08-09 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,COUNT(uc.id) priseCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(28422)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='AlbumItem'   AND uc.create_time>"2014-08-03 00:00:00" AND uc.create_time<"2014-08-09 00:00:00"   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(uc.id) comCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(28422)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='SystemComment'   AND uc.create_time>="2014-08-03 00:00:00" AND uc.create_time<"2014-08-09 00:00:00"  GROUP BY ud.locid) c ON l.id=c.locid  WHERE l.id IN(28422) [ RunTime:0.006001s ]
SQL: SELECT a.rname a,l.name b,d.name c,a.age d FROM (SELECT u.id uid,u.real_name rname,u.location_id locid,u.dept_id depId,(2014-(SELECT SUBSTR(u.identify_value,7,4))+0) age FROM app_user u WHERE NOT EXISTS ( SELECT lo.user_id FROM login_log lo WHERE u.id=lo.user_id  ) AND u.id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)   UNION ALL SELECT u.id FROM app_user u WHERE u.location_id IN(28422) )) a,location l,department d WHERE a.depId=d.id AND a.locid=l.id [ RunTime:2.022116s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) AND lo.login_time>="2014-08-03 00:00:00" AND lo.login_time<"2014-08-09 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.370021s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) AND lo.login_time>="2014-08-03 00:00:00" AND lo.login_time<"2014-08-09 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.351020s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) AND lo.login_time>="2014-08-03 00:00:00" AND lo.login_time<"2014-08-09 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.365021s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) AND lo.login_time>="2014-08-03 00:00:00" AND lo.login_time<"2014-08-09 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.359020s ]
SQL: SELECT l.name,COALESCE(a.ulcount,0) b FROM  location l LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(28422)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>="2014-08-03 00:00:00"   GROUP BY ud.locid) a ON a.locid=l.id WHERE l.id IN (28422) [ RunTime:0.051003s ]
INFO: [ view_parse ] --START--
INFO: ParseTemplate Behavior ::run [ RunTime:0.727042s ]
INFO: [ view_parse ] --END-- [ RunTime:0.732042s ]
INFO: [ view_filter ] --START--
INFO: ContentReplace Behavior ::run [ RunTime:0.027002s ]
INFO: TokenBuild Behavior ::run [ RunTime:0.020001s ]
INFO: WriteHtmlCache Behavior ::run [ RunTime:0.010001s ]
INFO: ShowRuntime Behavior ::run [ RunTime:0.017001s ]
INFO: [ view_filter ] --END-- [ RunTime:0.088005s ]
INFO: [ view_end ] --START--
INFO: ShowPageTrace Behavior ::run [ RunTime:0.010000s ]
INFO: [ view_end ] --END-- [ RunTime:0.014000s ]

[ 2014-08-10T15:06:51+08:00 ] 127.0.0.1 /php_demo/shizhan/10/10wish/index.php/Njb/Index/tongji?checkbox%5B%5D=28422&date_begin=2014-08-03&date_end=2014-08-09
INFO: [ route_check ] --START--
INFO: CheckRoute Behavior ::run [ RunTime:0.006000s ]
INFO: [ route_check ] --END-- [ RunTime:0.011000s ]
INFO: [ app_begin ] --START--
INFO: ReadHtmlCache Behavior ::run [ RunTime:0.008000s ]
INFO: [ app_begin ] --END-- [ RunTime:0.012001s ]
SQL: SELECT l.name,COALESCE(a.ucount,0) as yhs,COALESCE(c.ulcount,0) as dlyhs,COALESCE(c.logCount,0) as dlcs FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(ud.id) ucount FROM   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(28422)) ud     GROUP BY ud.locid  ) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(28422)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>="2014-08-03 00:00:00" AND lo.login_time<"2014-08-09 00:00:00"   GROUP BY ud.locid) c ON l.id=c.locid WHERE l.id IN(28422) [ RunTime:0.094006s ]
SQL: SELECT l.name,COALESCE(a.noticeCount,0) noticeCount,COALESCE(a.userCount,0) userCount FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(n.id) noticeCount,COUNT(DISTINCT ud.id) userCount FROM notice n,   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(28422)) ud   WHERE n.owner_id=ud.id AND n.publish_time>="2014-08-03 00:00:00"    AND n.publish_time<"2014-08-09 00:00:00" GROUP BY ud.locid) a  ON l.id=a.locid WHERE l.id IN(28422) [ RunTime:0.003000s ]
SQL: SELECT l.name,COALESCE(a.asCount,0) a,COALESCE(b.adminCount,0) b,COALESCE(c.noAdminCount,0) c FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(t.id) asCount FROM assignment t,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(28422)) ud  WHERE t.creator_id=ud.id AND t.create_time>="2014-08-03 00:00:00" AND  t.create_time<"2014-08-09 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) adminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(28422)) ud   WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='TechAdmin'   AND t.create_time>="2014-08-03 00:00:00" AND  t.create_time<"2014-08-09 00:00:00"  GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) noAdminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(28422)) ud  WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='Technician'   AND t.create_time>="2014-08-03 00:00:00" AND  t.create_time<"2014-08-09 00:00:00"  GROUP BY ud.locid ) c ON l.id=c.locid  WHERE l.id IN(28422) [ RunTime:0.005000s ]
SQL: SELECT l.name,COALESCE(a.worklogCount,0) a,COALESCE(a.uCount,0) b,COALESCE(b.docCount,0) c,COALESCE(c.phoCount,0) d,COALESCE(d.audioCount,0) e FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(DISTINCT w.id) worklogCount,COUNT(DISTINCT w.owner_id) uCount FROM work_log w,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(28422)) ud  WHERE w.owner_id=ud.id    AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) docCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(28422)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00"  AND i.media_type=1   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) phoCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(28422)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00"  AND i.media_type=2   GROUP BY ud.locid ) c ON l.id=c.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) audioCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(28422)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00"  AND i.media_type=3   GROUP BY ud.locid ) d ON l.id=d.locid   WHERE l.id IN(28422) [ RunTime:0.012001s ]
SQL: SELECT l.name,COALESCE(a.photoCount,0) a,COALESCE(a.ucount,0) b,COALESCE(b.priseCount,0) c,COALESCE(c.comCount,0) d FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(i.id) photoCount,COUNT(DISTINCT ud.id) ucount FROM album m,album_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(28422)) ud  WHERE m.owner_id=ud.id AND i.album_id=m.id   AND i.create_time>="2014-08-03 00:00:00" AND i.create_time<"2014-08-09 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,COUNT(uc.id) priseCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(28422)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='AlbumItem'   AND uc.create_time>"2014-08-03 00:00:00" AND uc.create_time<"2014-08-09 00:00:00"   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(uc.id) comCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(28422)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='SystemComment'   AND uc.create_time>="2014-08-03 00:00:00" AND uc.create_time<"2014-08-09 00:00:00"  GROUP BY ud.locid) c ON l.id=c.locid  WHERE l.id IN(28422) [ RunTime:0.005000s ]
SQL: SELECT a.rname a,l.name b,d.name c,a.age d FROM (SELECT u.id uid,u.real_name rname,u.location_id locid,u.dept_id depId,(2014-(SELECT SUBSTR(u.identify_value,7,4))+0) age FROM app_user u WHERE NOT EXISTS ( SELECT lo.user_id FROM login_log lo WHERE u.id=lo.user_id  ) AND u.id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)   UNION ALL SELECT u.id FROM app_user u WHERE u.location_id IN(28422) )) a,location l,department d WHERE a.depId=d.id AND a.locid=l.id [ RunTime:2.111121s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) AND lo.login_time>="2014-08-03 00:00:00" AND lo.login_time<"2014-08-09 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.441025s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) AND lo.login_time>="2014-08-03 00:00:00" AND lo.login_time<"2014-08-09 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.367021s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) AND lo.login_time>="2014-08-03 00:00:00" AND lo.login_time<"2014-08-09 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.367021s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) AND lo.login_time>="2014-08-03 00:00:00" AND lo.login_time<"2014-08-09 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.373022s ]
SQL: SELECT l.name,COALESCE(a.ulcount,0) b FROM  location l LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(28422)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>="2014-08-03 00:00:00"   GROUP BY ud.locid) a ON a.locid=l.id WHERE l.id IN (28422) [ RunTime:0.050003s ]
SQL:  [ RunTime:0.001000s ]
ERR: 1065:Query was empty
INFO: [ view_parse ] --START--
INFO: ParseTemplate Behavior ::run [ RunTime:0.555032s ]
INFO: [ view_parse ] --END-- [ RunTime:0.560032s ]
INFO: [ view_filter ] --START--
INFO: ContentReplace Behavior ::run [ RunTime:0.006000s ]
INFO: TokenBuild Behavior ::run [ RunTime:0.011001s ]
INFO: WriteHtmlCache Behavior ::run [ RunTime:0.004000s ]
INFO: ShowRuntime Behavior ::run [ RunTime:0.012001s ]
INFO: [ view_filter ] --END-- [ RunTime:0.046002s ]
INFO: [ view_end ] --START--
INFO: ShowPageTrace Behavior ::run [ RunTime:0.012000s ]
INFO: [ view_end ] --END-- [ RunTime:0.020001s ]

[ 2014-08-10T15:07:21+08:00 ] 127.0.0.1 /php_demo/shizhan/10/10wish/index.php/Njb/Index/tongji?checkbox%5B%5D=28422&date_begin=2014-08-03&date_end=2014-08-09
INFO: [ route_check ] --START--
INFO: CheckRoute Behavior ::run [ RunTime:0.006001s ]
INFO: [ route_check ] --END-- [ RunTime:0.011001s ]
INFO: [ app_begin ] --START--
INFO: ReadHtmlCache Behavior ::run [ RunTime:0.010000s ]
INFO: [ app_begin ] --END-- [ RunTime:0.015001s ]
SQL: SELECT l.name,COALESCE(a.ucount,0) as yhs,COALESCE(c.ulcount,0) as dlyhs,COALESCE(c.logCount,0) as dlcs FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(ud.id) ucount FROM   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(28422)) ud     GROUP BY ud.locid  ) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(28422)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>="2014-08-03 00:00:00" AND lo.login_time<"2014-08-09 00:00:00"   GROUP BY ud.locid) c ON l.id=c.locid WHERE l.id IN(28422) [ RunTime:0.048003s ]
SQL: SELECT l.name,COALESCE(a.noticeCount,0) noticeCount,COALESCE(a.userCount,0) userCount FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(n.id) noticeCount,COUNT(DISTINCT ud.id) userCount FROM notice n,   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(28422)) ud   WHERE n.owner_id=ud.id AND n.publish_time>="2014-08-03 00:00:00"    AND n.publish_time<"2014-08-09 00:00:00" GROUP BY ud.locid) a  ON l.id=a.locid WHERE l.id IN(28422) [ RunTime:0.003001s ]
SQL: SELECT l.name,COALESCE(a.asCount,0) a,COALESCE(b.adminCount,0) b,COALESCE(c.noAdminCount,0) c FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(t.id) asCount FROM assignment t,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(28422)) ud  WHERE t.creator_id=ud.id AND t.create_time>="2014-08-03 00:00:00" AND  t.create_time<"2014-08-09 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) adminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(28422)) ud   WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='TechAdmin'   AND t.create_time>="2014-08-03 00:00:00" AND  t.create_time<"2014-08-09 00:00:00"  GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) noAdminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(28422)) ud  WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='Technician'   AND t.create_time>="2014-08-03 00:00:00" AND  t.create_time<"2014-08-09 00:00:00"  GROUP BY ud.locid ) c ON l.id=c.locid  WHERE l.id IN(28422) [ RunTime:0.005000s ]
SQL: SELECT l.name,COALESCE(a.worklogCount,0) a,COALESCE(a.uCount,0) b,COALESCE(b.docCount,0) c,COALESCE(c.phoCount,0) d,COALESCE(d.audioCount,0) e FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(DISTINCT w.id) worklogCount,COUNT(DISTINCT w.owner_id) uCount FROM work_log w,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(28422)) ud  WHERE w.owner_id=ud.id    AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) docCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(28422)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00"  AND i.media_type=1   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) phoCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(28422)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00"  AND i.media_type=2   GROUP BY ud.locid ) c ON l.id=c.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) audioCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(28422)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00"  AND i.media_type=3   GROUP BY ud.locid ) d ON l.id=d.locid   WHERE l.id IN(28422) [ RunTime:0.009000s ]
SQL: SELECT l.name,COALESCE(a.photoCount,0) a,COALESCE(a.ucount,0) b,COALESCE(b.priseCount,0) c,COALESCE(c.comCount,0) d FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(i.id) photoCount,COUNT(DISTINCT ud.id) ucount FROM album m,album_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(28422)) ud  WHERE m.owner_id=ud.id AND i.album_id=m.id   AND i.create_time>="2014-08-03 00:00:00" AND i.create_time<"2014-08-09 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,COUNT(uc.id) priseCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(28422)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='AlbumItem'   AND uc.create_time>"2014-08-03 00:00:00" AND uc.create_time<"2014-08-09 00:00:00"   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(uc.id) comCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(28422)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='SystemComment'   AND uc.create_time>="2014-08-03 00:00:00" AND uc.create_time<"2014-08-09 00:00:00"  GROUP BY ud.locid) c ON l.id=c.locid  WHERE l.id IN(28422) [ RunTime:0.004000s ]
SQL: SELECT a.rname a,l.name b,d.name c,a.age d FROM (SELECT u.id uid,u.real_name rname,u.location_id locid,u.dept_id depId,(2014-(SELECT SUBSTR(u.identify_value,7,4))+0) age FROM app_user u WHERE NOT EXISTS ( SELECT lo.user_id FROM login_log lo WHERE u.id=lo.user_id  ) AND u.id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)   UNION ALL SELECT u.id FROM app_user u WHERE u.location_id IN(28422) )) a,location l,department d WHERE a.depId=d.id AND a.locid=l.id [ RunTime:2.300132s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) AND lo.login_time>="2014-08-03 00:00:00" AND lo.login_time<"2014-08-09 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.359020s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) AND lo.login_time>="2014-08-03 00:00:00" AND lo.login_time<"2014-08-09 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.350020s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) AND lo.login_time>="2014-08-03 00:00:00" AND lo.login_time<"2014-08-09 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.370021s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) AND lo.login_time>="2014-08-03 00:00:00" AND lo.login_time<"2014-08-09 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.374021s ]
SQL: SELECT l.name,COALESCE(a.ulcount,0) b FROM  location l LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(28422)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>="2014-08-03 00:00:00"   GROUP BY ud.locid) a ON a.locid=l.id WHERE l.id IN (28422) [ RunTime:0.052003s ]
NOTIC: [2] mysql_query(): 32 is not a valid MySQL-Link resource D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\ThinkPHP\Lib\Driver\Db\DbMysql.class.php  103 .
SQL: CALL count_worklog_all('2014-07-09 00:00:00','2014-08-08 00:00:00','24521,24543,24561') [ RunTime:0.004000s ]
NOTIC: [2] mysql_error(): 32 is not a valid MySQL-Link resource D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\ThinkPHP\Lib\Driver\Db\DbMysql.class.php  315 .
ERR: :
 [ SQL ] : CALL count_worklog_all('2014-07-09 00:00:00','2014-08-08 00:00:00','24521,24543,24561')
INFO: [ view_parse ] --START--
INFO: ParseTemplate Behavior ::run [ RunTime:0.518030s ]
INFO: [ view_parse ] --END-- [ RunTime:0.523030s ]
INFO: [ view_filter ] --START--
INFO: ContentReplace Behavior ::run [ RunTime:0.008001s ]
INFO: TokenBuild Behavior ::run [ RunTime:0.009000s ]
INFO: WriteHtmlCache Behavior ::run [ RunTime:0.004000s ]
INFO: ShowRuntime Behavior ::run [ RunTime:0.014001s ]
INFO: [ view_filter ] --END-- [ RunTime:0.047003s ]
INFO: [ view_end ] --START--
INFO: ShowPageTrace Behavior ::run [ RunTime:0.009000s ]
INFO: [ view_end ] --END-- [ RunTime:0.019001s ]

[ 2014-08-10T15:08:26+08:00 ] 127.0.0.1 /php_demo/shizhan/10/10wish/index.php/Njb/Index/tongji?checkbox%5B%5D=28422&date_begin=2014-08-03&date_end=2014-08-09
INFO: [ route_check ] --START--
INFO: CheckRoute Behavior ::run [ RunTime:0.006000s ]
INFO: [ route_check ] --END-- [ RunTime:0.010000s ]
INFO: [ app_begin ] --START--
INFO: ReadHtmlCache Behavior ::run [ RunTime:0.008001s ]
INFO: [ app_begin ] --END-- [ RunTime:0.013001s ]
SQL: SELECT l.name,COALESCE(a.ucount,0) as yhs,COALESCE(c.ulcount,0) as dlyhs,COALESCE(c.logCount,0) as dlcs FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(ud.id) ucount FROM   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(28422)) ud     GROUP BY ud.locid  ) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(28422)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>="2014-08-03 00:00:00" AND lo.login_time<"2014-08-09 00:00:00"   GROUP BY ud.locid) c ON l.id=c.locid WHERE l.id IN(28422) [ RunTime:0.047003s ]
SQL: SELECT l.name,COALESCE(a.noticeCount,0) noticeCount,COALESCE(a.userCount,0) userCount FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(n.id) noticeCount,COUNT(DISTINCT ud.id) userCount FROM notice n,   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(28422)) ud   WHERE n.owner_id=ud.id AND n.publish_time>="2014-08-03 00:00:00"    AND n.publish_time<"2014-08-09 00:00:00" GROUP BY ud.locid) a  ON l.id=a.locid WHERE l.id IN(28422) [ RunTime:0.002000s ]
SQL: SELECT l.name,COALESCE(a.asCount,0) a,COALESCE(b.adminCount,0) b,COALESCE(c.noAdminCount,0) c FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(t.id) asCount FROM assignment t,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(28422)) ud  WHERE t.creator_id=ud.id AND t.create_time>="2014-08-03 00:00:00" AND  t.create_time<"2014-08-09 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) adminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(28422)) ud   WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='TechAdmin'   AND t.create_time>="2014-08-03 00:00:00" AND  t.create_time<"2014-08-09 00:00:00"  GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) noAdminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(28422)) ud  WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='Technician'   AND t.create_time>="2014-08-03 00:00:00" AND  t.create_time<"2014-08-09 00:00:00"  GROUP BY ud.locid ) c ON l.id=c.locid  WHERE l.id IN(28422) [ RunTime:0.004000s ]
SQL: SELECT l.name,COALESCE(a.worklogCount,0) a,COALESCE(a.uCount,0) b,COALESCE(b.docCount,0) c,COALESCE(c.phoCount,0) d,COALESCE(d.audioCount,0) e FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(DISTINCT w.id) worklogCount,COUNT(DISTINCT w.owner_id) uCount FROM work_log w,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(28422)) ud  WHERE w.owner_id=ud.id    AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) docCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(28422)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00"  AND i.media_type=1   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) phoCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(28422)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00"  AND i.media_type=2   GROUP BY ud.locid ) c ON l.id=c.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) audioCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(28422)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00"  AND i.media_type=3   GROUP BY ud.locid ) d ON l.id=d.locid   WHERE l.id IN(28422) [ RunTime:0.009000s ]
SQL: SELECT l.name,COALESCE(a.photoCount,0) a,COALESCE(a.ucount,0) b,COALESCE(b.priseCount,0) c,COALESCE(c.comCount,0) d FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(i.id) photoCount,COUNT(DISTINCT ud.id) ucount FROM album m,album_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(28422)) ud  WHERE m.owner_id=ud.id AND i.album_id=m.id   AND i.create_time>="2014-08-03 00:00:00" AND i.create_time<"2014-08-09 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,COUNT(uc.id) priseCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(28422)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='AlbumItem'   AND uc.create_time>"2014-08-03 00:00:00" AND uc.create_time<"2014-08-09 00:00:00"   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(uc.id) comCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(28422)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='SystemComment'   AND uc.create_time>="2014-08-03 00:00:00" AND uc.create_time<"2014-08-09 00:00:00"  GROUP BY ud.locid) c ON l.id=c.locid  WHERE l.id IN(28422) [ RunTime:0.004000s ]
SQL: SELECT a.rname a,l.name b,d.name c,a.age d FROM (SELECT u.id uid,u.real_name rname,u.location_id locid,u.dept_id depId,(2014-(SELECT SUBSTR(u.identify_value,7,4))+0) age FROM app_user u WHERE NOT EXISTS ( SELECT lo.user_id FROM login_log lo WHERE u.id=lo.user_id  ) AND u.id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)   UNION ALL SELECT u.id FROM app_user u WHERE u.location_id IN(28422) )) a,location l,department d WHERE a.depId=d.id AND a.locid=l.id [ RunTime:2.029116s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) AND lo.login_time>="2014-08-03 00:00:00" AND lo.login_time<"2014-08-09 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.363021s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) AND lo.login_time>="2014-08-03 00:00:00" AND lo.login_time<"2014-08-09 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.351020s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) AND lo.login_time>="2014-08-03 00:00:00" AND lo.login_time<"2014-08-09 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.359021s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) AND lo.login_time>="2014-08-03 00:00:00" AND lo.login_time<"2014-08-09 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.377022s ]
SQL: SELECT l.name,COALESCE(a.ulcount,0) b FROM  location l LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(28422)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>="2014-08-03 00:00:00"   GROUP BY ud.locid) a ON a.locid=l.id WHERE l.id IN (28422) [ RunTime:0.052002s ]
NOTIC: [2] mysql_query(): 32 is not a valid MySQL-Link resource D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\ThinkPHP\Lib\Driver\Db\DbMysql.class.php  103 .
SQL: CALL count_worklog_all('2014-07-09 00:00:00','2014-08-08 00:00:00','24521,24543,24561') [ RunTime:0.004000s ]
NOTIC: [2] mysql_error(): 32 is not a valid MySQL-Link resource D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\ThinkPHP\Lib\Driver\Db\DbMysql.class.php  315 .
ERR: :
 [ SQL ] : CALL count_worklog_all('2014-07-09 00:00:00','2014-08-08 00:00:00','24521,24543,24561')
INFO: [ view_parse ] --START--
INFO: ParseTemplate Behavior ::run [ RunTime:0.522030s ]
INFO: [ view_parse ] --END-- [ RunTime:0.527030s ]
INFO: [ view_filter ] --START--
INFO: ContentReplace Behavior ::run [ RunTime:0.006000s ]
INFO: TokenBuild Behavior ::run [ RunTime:0.009001s ]
INFO: WriteHtmlCache Behavior ::run [ RunTime:0.006000s ]
INFO: ShowRuntime Behavior ::run [ RunTime:0.013001s ]
INFO: [ view_filter ] --END-- [ RunTime:0.048003s ]
INFO: [ view_end ] --START--
INFO: ShowPageTrace Behavior ::run [ RunTime:0.009000s ]
INFO: [ view_end ] --END-- [ RunTime:0.015001s ]

[ 2014-08-10T19:53:51+08:00 ] 127.0.0.1 /php_demo/shizhan/10/10wish/index.php/Njb/Index/tongji?checkbox%5B%5D=28422&date_begin=2014-08-03&date_end=2014-08-09
INFO: [ route_check ] --START--
INFO: CheckRoute Behavior ::run [ RunTime:0.009001s ]
INFO: [ route_check ] --END-- [ RunTime:0.015001s ]
INFO: [ app_begin ] --START--
INFO: ReadHtmlCache Behavior ::run [ RunTime:0.010000s ]
INFO: [ app_begin ] --END-- [ RunTime:0.014000s ]
SQL: SELECT l.name,COALESCE(a.ucount,0) as yhs,COALESCE(c.ulcount,0) as dlyhs,COALESCE(c.logCount,0) as dlcs FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(ud.id) ucount FROM   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(28422)) ud     GROUP BY ud.locid  ) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(28422)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>="2014-08-03 00:00:00" AND lo.login_time<"2014-08-09 00:00:00"   GROUP BY ud.locid) c ON l.id=c.locid WHERE l.id IN(28422) [ RunTime:0.064003s ]
SQL: SELECT l.name,COALESCE(a.noticeCount,0) noticeCount,COALESCE(a.userCount,0) userCount FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(n.id) noticeCount,COUNT(DISTINCT ud.id) userCount FROM notice n,   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(28422)) ud   WHERE n.owner_id=ud.id AND n.publish_time>="2014-08-03 00:00:00"    AND n.publish_time<"2014-08-09 00:00:00" GROUP BY ud.locid) a  ON l.id=a.locid WHERE l.id IN(28422) [ RunTime:0.003000s ]
SQL: SELECT l.name,COALESCE(a.asCount,0) a,COALESCE(b.adminCount,0) b,COALESCE(c.noAdminCount,0) c FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(t.id) asCount FROM assignment t,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(28422)) ud  WHERE t.creator_id=ud.id AND t.create_time>="2014-08-03 00:00:00" AND  t.create_time<"2014-08-09 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) adminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(28422)) ud   WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='TechAdmin'   AND t.create_time>="2014-08-03 00:00:00" AND  t.create_time<"2014-08-09 00:00:00"  GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) noAdminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(28422)) ud  WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='Technician'   AND t.create_time>="2014-08-03 00:00:00" AND  t.create_time<"2014-08-09 00:00:00"  GROUP BY ud.locid ) c ON l.id=c.locid  WHERE l.id IN(28422) [ RunTime:0.004001s ]
SQL: SELECT l.name,COALESCE(a.worklogCount,0) a,COALESCE(a.uCount,0) b,COALESCE(b.docCount,0) c,COALESCE(c.phoCount,0) d,COALESCE(d.audioCount,0) e FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(DISTINCT w.id) worklogCount,COUNT(DISTINCT w.owner_id) uCount FROM work_log w,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(28422)) ud  WHERE w.owner_id=ud.id    AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) docCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(28422)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00"  AND i.media_type=1   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) phoCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(28422)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00"  AND i.media_type=2   GROUP BY ud.locid ) c ON l.id=c.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) audioCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(28422)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00"  AND i.media_type=3   GROUP BY ud.locid ) d ON l.id=d.locid   WHERE l.id IN(28422) [ RunTime:0.009001s ]
SQL: SELECT l.name,COALESCE(a.photoCount,0) a,COALESCE(a.ucount,0) b,COALESCE(b.priseCount,0) c,COALESCE(c.comCount,0) d FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(i.id) photoCount,COUNT(DISTINCT ud.id) ucount FROM album m,album_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(28422)) ud  WHERE m.owner_id=ud.id AND i.album_id=m.id   AND i.create_time>="2014-08-03 00:00:00" AND i.create_time<"2014-08-09 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,COUNT(uc.id) priseCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(28422)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='AlbumItem'   AND uc.create_time>"2014-08-03 00:00:00" AND uc.create_time<"2014-08-09 00:00:00"   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(uc.id) comCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(28422)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='SystemComment'   AND uc.create_time>="2014-08-03 00:00:00" AND uc.create_time<"2014-08-09 00:00:00"  GROUP BY ud.locid) c ON l.id=c.locid  WHERE l.id IN(28422) [ RunTime:0.005000s ]
SQL: SELECT a.rname a,l.name b,d.name c,a.age d FROM (SELECT u.id uid,u.real_name rname,u.location_id locid,u.dept_id depId,(2014-(SELECT SUBSTR(u.identify_value,7,4))+0) age FROM app_user u WHERE NOT EXISTS ( SELECT lo.user_id FROM login_log lo WHERE u.id=lo.user_id  ) AND u.id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)   UNION ALL SELECT u.id FROM app_user u WHERE u.location_id IN(28422) )) a,location l,department d WHERE a.depId=d.id AND a.locid=l.id [ RunTime:2.051117s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) AND lo.login_time>="2014-08-03 00:00:00" AND lo.login_time<"2014-08-09 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.367021s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) AND lo.login_time>="2014-08-03 00:00:00" AND lo.login_time<"2014-08-09 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.348020s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) AND lo.login_time>="2014-08-03 00:00:00" AND lo.login_time<"2014-08-09 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.357021s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) AND lo.login_time>="2014-08-03 00:00:00" AND lo.login_time<"2014-08-09 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.356021s ]
SQL: SELECT l.name,COALESCE(a.ulcount,0) b FROM  location l LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(28422)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>="2014-08-03 00:00:00"   GROUP BY ud.locid) a ON a.locid=l.id WHERE l.id IN (28422) [ RunTime:0.050003s ]
NOTIC: [2] mysql_query(): 32 is not a valid MySQL-Link resource D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\ThinkPHP\Lib\Driver\Db\DbMysql.class.php  103 .
SQL: CALL count_worklog_all('2014-07-09 00:00:00','2014-08-08 00:00:00','24521,24543,24561') [ RunTime:0.003001s ]
NOTIC: [2] mysql_error(): 32 is not a valid MySQL-Link resource D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\ThinkPHP\Lib\Driver\Db\DbMysql.class.php  315 .
ERR: :
 [ SQL ] : CALL count_worklog_all('2014-07-09 00:00:00','2014-08-08 00:00:00','24521,24543,24561')
INFO: [ view_parse ] --START--
INFO: ParseTemplate Behavior ::run [ RunTime:0.546031s ]
INFO: [ view_parse ] --END-- [ RunTime:0.551032s ]
INFO: [ view_filter ] --START--
INFO: ContentReplace Behavior ::run [ RunTime:0.013001s ]
INFO: TokenBuild Behavior ::run [ RunTime:0.038002s ]
INFO: WriteHtmlCache Behavior ::run [ RunTime:0.014000s ]
INFO: ShowRuntime Behavior ::run [ RunTime:0.021002s ]
INFO: [ view_filter ] --END-- [ RunTime:0.099006s ]
INFO: [ view_end ] --START--
INFO: ShowPageTrace Behavior ::run [ RunTime:0.018001s ]
INFO: [ view_end ] --END-- [ RunTime:0.025002s ]

[ 2014-08-10T19:59:20+08:00 ] 127.0.0.1 /php_demo/shizhan/10/10wish/index.php/Njb/Index/tongji?checkbox%5B%5D=28422&date_begin=2014-08-03&date_end=2014-08-09
INFO: [ route_check ] --START--
INFO: CheckRoute Behavior ::run [ RunTime:0.006000s ]
INFO: [ route_check ] --END-- [ RunTime:0.011000s ]
INFO: [ app_begin ] --START--
INFO: ReadHtmlCache Behavior ::run [ RunTime:0.008001s ]
INFO: [ app_begin ] --END-- [ RunTime:0.013001s ]
SQL: SELECT l.name,COALESCE(a.ucount,0) as yhs,COALESCE(c.ulcount,0) as dlyhs,COALESCE(c.logCount,0) as dlcs FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(ud.id) ucount FROM   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(28422)) ud     GROUP BY ud.locid  ) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(28422)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>="2014-08-03 00:00:00" AND lo.login_time<"2014-08-09 00:00:00"   GROUP BY ud.locid) c ON l.id=c.locid WHERE l.id IN(28422) [ RunTime:0.048003s ]
SQL: SELECT l.name,COALESCE(a.noticeCount,0) noticeCount,COALESCE(a.userCount,0) userCount FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(n.id) noticeCount,COUNT(DISTINCT ud.id) userCount FROM notice n,   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(28422)) ud   WHERE n.owner_id=ud.id AND n.publish_time>="2014-08-03 00:00:00"    AND n.publish_time<"2014-08-09 00:00:00" GROUP BY ud.locid) a  ON l.id=a.locid WHERE l.id IN(28422) [ RunTime:0.003000s ]
SQL: SELECT l.name,COALESCE(a.asCount,0) a,COALESCE(b.adminCount,0) b,COALESCE(c.noAdminCount,0) c FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(t.id) asCount FROM assignment t,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(28422)) ud  WHERE t.creator_id=ud.id AND t.create_time>="2014-08-03 00:00:00" AND  t.create_time<"2014-08-09 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) adminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(28422)) ud   WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='TechAdmin'   AND t.create_time>="2014-08-03 00:00:00" AND  t.create_time<"2014-08-09 00:00:00"  GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) noAdminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(28422)) ud  WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='Technician'   AND t.create_time>="2014-08-03 00:00:00" AND  t.create_time<"2014-08-09 00:00:00"  GROUP BY ud.locid ) c ON l.id=c.locid  WHERE l.id IN(28422) [ RunTime:0.004000s ]
SQL: SELECT l.name,COALESCE(a.worklogCount,0) a,COALESCE(a.uCount,0) b,COALESCE(b.docCount,0) c,COALESCE(c.phoCount,0) d,COALESCE(d.audioCount,0) e FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(DISTINCT w.id) worklogCount,COUNT(DISTINCT w.owner_id) uCount FROM work_log w,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(28422)) ud  WHERE w.owner_id=ud.id    AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) docCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(28422)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00"  AND i.media_type=1   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) phoCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(28422)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00"  AND i.media_type=2   GROUP BY ud.locid ) c ON l.id=c.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) audioCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(28422)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00"  AND i.media_type=3   GROUP BY ud.locid ) d ON l.id=d.locid   WHERE l.id IN(28422) [ RunTime:0.009000s ]
SQL: SELECT l.name,COALESCE(a.photoCount,0) a,COALESCE(a.ucount,0) b,COALESCE(b.priseCount,0) c,COALESCE(c.comCount,0) d FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(i.id) photoCount,COUNT(DISTINCT ud.id) ucount FROM album m,album_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(28422)) ud  WHERE m.owner_id=ud.id AND i.album_id=m.id   AND i.create_time>="2014-08-03 00:00:00" AND i.create_time<"2014-08-09 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,COUNT(uc.id) priseCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(28422)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='AlbumItem'   AND uc.create_time>"2014-08-03 00:00:00" AND uc.create_time<"2014-08-09 00:00:00"   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(uc.id) comCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(28422)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='SystemComment'   AND uc.create_time>="2014-08-03 00:00:00" AND uc.create_time<"2014-08-09 00:00:00"  GROUP BY ud.locid) c ON l.id=c.locid  WHERE l.id IN(28422) [ RunTime:0.005000s ]
SQL: SELECT a.rname a,l.name b,d.name c,a.age d FROM (SELECT u.id uid,u.real_name rname,u.location_id locid,u.dept_id depId,(2014-(SELECT SUBSTR(u.identify_value,7,4))+0) age FROM app_user u WHERE NOT EXISTS ( SELECT lo.user_id FROM login_log lo WHERE u.id=lo.user_id  ) AND u.id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)   UNION ALL SELECT u.id FROM app_user u WHERE u.location_id IN(28422) )) a,location l,department d WHERE a.depId=d.id AND a.locid=l.id [ RunTime:2.049118s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) AND lo.login_time>="2014-08-03 00:00:00" AND lo.login_time<"2014-08-09 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.367021s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) AND lo.login_time>="2014-08-03 00:00:00" AND lo.login_time<"2014-08-09 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.356020s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) AND lo.login_time>="2014-08-03 00:00:00" AND lo.login_time<"2014-08-09 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.347020s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) AND lo.login_time>="2014-08-03 00:00:00" AND lo.login_time<"2014-08-09 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.361020s ]
SQL: SELECT l.name,COALESCE(a.ulcount,0) b FROM  location l LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(28422)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>="2014-08-03 00:00:00"   GROUP BY ud.locid) a ON a.locid=l.id WHERE l.id IN (28422) [ RunTime:0.050003s ]
NOTIC: [2] mysql_query(): 32 is not a valid MySQL-Link resource D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\ThinkPHP\Lib\Driver\Db\DbMysql.class.php  103 .
SQL: CALL count_worklog_all('2014-07-09 00:00:00','2014-08-08 00:00:00','24521,24543,24561') [ RunTime:0.003000s ]
NOTIC: [2] mysql_error(): 32 is not a valid MySQL-Link resource D:\Dropbox-List\Net\Dropbox\WebDev\xampp\htdocs\php_demo\shizhan\10\10wish\ThinkPHP\Lib\Driver\Db\DbMysql.class.php  315 .
ERR: :
 [ SQL ] : CALL count_worklog_all('2014-07-09 00:00:00','2014-08-08 00:00:00','24521,24543,24561')
INFO: [ view_parse ] --START--
INFO: ParseTemplate Behavior ::run [ RunTime:0.515030s ]
INFO: [ view_parse ] --END-- [ RunTime:0.521030s ]
INFO: [ view_filter ] --START--
INFO: ContentReplace Behavior ::run [ RunTime:0.007001s ]
INFO: TokenBuild Behavior ::run [ RunTime:0.011001s ]
INFO: WriteHtmlCache Behavior ::run [ RunTime:0.007000s ]
INFO: ShowRuntime Behavior ::run [ RunTime:0.013001s ]
INFO: [ view_filter ] --END-- [ RunTime:0.053003s ]
INFO: [ view_end ] --START--
INFO: ShowPageTrace Behavior ::run [ RunTime:0.014001s ]
INFO: [ view_end ] --END-- [ RunTime:0.021001s ]

[ 2014-08-10T20:07:17+08:00 ] 127.0.0.1 /php_demo/shizhan/10/10wish/index.php/Njb/Index/tongji?checkbox%5B%5D=28422&date_begin=2014-08-03&date_end=2014-08-09
INFO: [ route_check ] --START--
INFO: CheckRoute Behavior ::run [ RunTime:0.006000s ]
INFO: [ route_check ] --END-- [ RunTime:0.011000s ]
INFO: [ app_begin ] --START--
INFO: ReadHtmlCache Behavior ::run [ RunTime:0.008000s ]
INFO: [ app_begin ] --END-- [ RunTime:0.013001s ]
SQL: SELECT l.name,COALESCE(a.ucount,0) as yhs,COALESCE(c.ulcount,0) as dlyhs,COALESCE(c.logCount,0) as dlcs FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(ud.id) ucount FROM   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(28422)) ud     GROUP BY ud.locid  ) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(28422)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>="2014-08-03 00:00:00" AND lo.login_time<"2014-08-09 00:00:00"   GROUP BY ud.locid) c ON l.id=c.locid WHERE l.id IN(28422) [ RunTime:0.050003s ]
SQL: SELECT l.name,COALESCE(a.noticeCount,0) noticeCount,COALESCE(a.userCount,0) userCount FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(n.id) noticeCount,COUNT(DISTINCT ud.id) userCount FROM notice n,   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(28422)) ud   WHERE n.owner_id=ud.id AND n.publish_time>="2014-08-03 00:00:00"    AND n.publish_time<"2014-08-09 00:00:00" GROUP BY ud.locid) a  ON l.id=a.locid WHERE l.id IN(28422) [ RunTime:0.003001s ]
SQL: SELECT l.name,COALESCE(a.asCount,0) a,COALESCE(b.adminCount,0) b,COALESCE(c.noAdminCount,0) c FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(t.id) asCount FROM assignment t,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(28422)) ud  WHERE t.creator_id=ud.id AND t.create_time>="2014-08-03 00:00:00" AND  t.create_time<"2014-08-09 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) adminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(28422)) ud   WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='TechAdmin'   AND t.create_time>="2014-08-03 00:00:00" AND  t.create_time<"2014-08-09 00:00:00"  GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) noAdminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(28422)) ud  WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='Technician'   AND t.create_time>="2014-08-03 00:00:00" AND  t.create_time<"2014-08-09 00:00:00"  GROUP BY ud.locid ) c ON l.id=c.locid  WHERE l.id IN(28422) [ RunTime:0.006000s ]
SQL: SELECT l.name,COALESCE(a.worklogCount,0) a,COALESCE(a.uCount,0) b,COALESCE(b.docCount,0) c,COALESCE(c.phoCount,0) d,COALESCE(d.audioCount,0) e FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(DISTINCT w.id) worklogCount,COUNT(DISTINCT w.owner_id) uCount FROM work_log w,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(28422)) ud  WHERE w.owner_id=ud.id    AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) docCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(28422)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00"  AND i.media_type=1   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) phoCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(28422)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00"  AND i.media_type=2   GROUP BY ud.locid ) c ON l.id=c.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) audioCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(28422)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00"  AND i.media_type=3   GROUP BY ud.locid ) d ON l.id=d.locid   WHERE l.id IN(28422) [ RunTime:0.012000s ]
SQL: SELECT l.name,COALESCE(a.photoCount,0) a,COALESCE(a.ucount,0) b,COALESCE(b.priseCount,0) c,COALESCE(c.comCount,0) d FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(i.id) photoCount,COUNT(DISTINCT ud.id) ucount FROM album m,album_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(28422)) ud  WHERE m.owner_id=ud.id AND i.album_id=m.id   AND i.create_time>="2014-08-03 00:00:00" AND i.create_time<"2014-08-09 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,COUNT(uc.id) priseCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(28422)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='AlbumItem'   AND uc.create_time>"2014-08-03 00:00:00" AND uc.create_time<"2014-08-09 00:00:00"   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(uc.id) comCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(28422)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='SystemComment'   AND uc.create_time>="2014-08-03 00:00:00" AND uc.create_time<"2014-08-09 00:00:00"  GROUP BY ud.locid) c ON l.id=c.locid  WHERE l.id IN(28422) [ RunTime:0.005000s ]
SQL: SELECT a.rname a,l.name b,d.name c,a.age d FROM (SELECT u.id uid,u.real_name rname,u.location_id locid,u.dept_id depId,(2014-(SELECT SUBSTR(u.identify_value,7,4))+0) age FROM app_user u WHERE NOT EXISTS ( SELECT lo.user_id FROM login_log lo WHERE u.id=lo.user_id  ) AND u.id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)   UNION ALL SELECT u.id FROM app_user u WHERE u.location_id IN(28422) )) a,location l,department d WHERE a.depId=d.id AND a.locid=l.id [ RunTime:2.068118s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) AND lo.login_time>="2014-08-03 00:00:00" AND lo.login_time<"2014-08-09 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.354021s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) AND lo.login_time>="2014-08-03 00:00:00" AND lo.login_time<"2014-08-09 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.353020s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) AND lo.login_time>="2014-08-03 00:00:00" AND lo.login_time<"2014-08-09 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.358020s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) AND lo.login_time>="2014-08-03 00:00:00" AND lo.login_time<"2014-08-09 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.357020s ]
SQL: SELECT l.name,COALESCE(a.ulcount,0) b FROM  location l LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(28422)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>="2014-08-03 00:00:00"   GROUP BY ud.locid) a ON a.locid=l.id WHERE l.id IN (28422) [ RunTime:0.050003s ]
SQL: 
				show create procedure count_worklog_all
				 [ RunTime:0.079005s ]
INFO: [ view_parse ] --START--
INFO: ParseTemplate Behavior ::run [ RunTime:0.523030s ]
INFO: [ view_parse ] --END-- [ RunTime:0.527030s ]
INFO: [ view_filter ] --START--
INFO: ContentReplace Behavior ::run [ RunTime:0.008000s ]
INFO: TokenBuild Behavior ::run [ RunTime:0.011001s ]
INFO: WriteHtmlCache Behavior ::run [ RunTime:0.004001s ]
INFO: ShowRuntime Behavior ::run [ RunTime:0.012000s ]
INFO: [ view_filter ] --END-- [ RunTime:0.050002s ]
INFO: [ view_end ] --START--
INFO: ShowPageTrace Behavior ::run [ RunTime:0.010001s ]
INFO: [ view_end ] --END-- [ RunTime:0.018001s ]

[ 2014-08-10T20:08:12+08:00 ] 127.0.0.1 /php_demo/shizhan/10/10wish/index.php/Njb/Index/tongji?checkbox%5B%5D=28422&date_begin=2014-08-03&date_end=2014-08-09
INFO: [ route_check ] --START--
INFO: CheckRoute Behavior ::run [ RunTime:0.006000s ]
INFO: [ route_check ] --END-- [ RunTime:0.011001s ]
INFO: [ app_begin ] --START--
INFO: ReadHtmlCache Behavior ::run [ RunTime:0.008001s ]
INFO: [ app_begin ] --END-- [ RunTime:0.012001s ]
SQL: SELECT l.name,COALESCE(a.ucount,0) as yhs,COALESCE(c.ulcount,0) as dlyhs,COALESCE(c.logCount,0) as dlcs FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(ud.id) ucount FROM   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(28422)) ud     GROUP BY ud.locid  ) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(28422)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>="2014-08-03 00:00:00" AND lo.login_time<"2014-08-09 00:00:00"   GROUP BY ud.locid) c ON l.id=c.locid WHERE l.id IN(28422) [ RunTime:0.049003s ]
SQL: SELECT l.name,COALESCE(a.noticeCount,0) noticeCount,COALESCE(a.userCount,0) userCount FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(n.id) noticeCount,COUNT(DISTINCT ud.id) userCount FROM notice n,   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(28422)) ud   WHERE n.owner_id=ud.id AND n.publish_time>="2014-08-03 00:00:00"    AND n.publish_time<"2014-08-09 00:00:00" GROUP BY ud.locid) a  ON l.id=a.locid WHERE l.id IN(28422) [ RunTime:0.003001s ]
SQL: SELECT l.name,COALESCE(a.asCount,0) a,COALESCE(b.adminCount,0) b,COALESCE(c.noAdminCount,0) c FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(t.id) asCount FROM assignment t,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(28422)) ud  WHERE t.creator_id=ud.id AND t.create_time>="2014-08-03 00:00:00" AND  t.create_time<"2014-08-09 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) adminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(28422)) ud   WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='TechAdmin'   AND t.create_time>="2014-08-03 00:00:00" AND  t.create_time<"2014-08-09 00:00:00"  GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) noAdminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(28422)) ud  WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='Technician'   AND t.create_time>="2014-08-03 00:00:00" AND  t.create_time<"2014-08-09 00:00:00"  GROUP BY ud.locid ) c ON l.id=c.locid  WHERE l.id IN(28422) [ RunTime:0.004000s ]
SQL: SELECT l.name,COALESCE(a.worklogCount,0) a,COALESCE(a.uCount,0) b,COALESCE(b.docCount,0) c,COALESCE(c.phoCount,0) d,COALESCE(d.audioCount,0) e FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(DISTINCT w.id) worklogCount,COUNT(DISTINCT w.owner_id) uCount FROM work_log w,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(28422)) ud  WHERE w.owner_id=ud.id    AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) docCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(28422)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00"  AND i.media_type=1   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) phoCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(28422)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00"  AND i.media_type=2   GROUP BY ud.locid ) c ON l.id=c.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) audioCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(28422)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00"  AND i.media_type=3   GROUP BY ud.locid ) d ON l.id=d.locid   WHERE l.id IN(28422) [ RunTime:0.008000s ]
SQL: SELECT l.name,COALESCE(a.photoCount,0) a,COALESCE(a.ucount,0) b,COALESCE(b.priseCount,0) c,COALESCE(c.comCount,0) d FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(i.id) photoCount,COUNT(DISTINCT ud.id) ucount FROM album m,album_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(28422)) ud  WHERE m.owner_id=ud.id AND i.album_id=m.id   AND i.create_time>="2014-08-03 00:00:00" AND i.create_time<"2014-08-09 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,COUNT(uc.id) priseCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(28422)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='AlbumItem'   AND uc.create_time>"2014-08-03 00:00:00" AND uc.create_time<"2014-08-09 00:00:00"   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(uc.id) comCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(28422)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='SystemComment'   AND uc.create_time>="2014-08-03 00:00:00" AND uc.create_time<"2014-08-09 00:00:00"  GROUP BY ud.locid) c ON l.id=c.locid  WHERE l.id IN(28422) [ RunTime:0.006000s ]
SQL: SELECT a.rname a,l.name b,d.name c,a.age d FROM (SELECT u.id uid,u.real_name rname,u.location_id locid,u.dept_id depId,(2014-(SELECT SUBSTR(u.identify_value,7,4))+0) age FROM app_user u WHERE NOT EXISTS ( SELECT lo.user_id FROM login_log lo WHERE u.id=lo.user_id  ) AND u.id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)   UNION ALL SELECT u.id FROM app_user u WHERE u.location_id IN(28422) )) a,location l,department d WHERE a.depId=d.id AND a.locid=l.id [ RunTime:2.044117s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) AND lo.login_time>="2014-08-03 00:00:00" AND lo.login_time<"2014-08-09 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.354020s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) AND lo.login_time>="2014-08-03 00:00:00" AND lo.login_time<"2014-08-09 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.353020s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) AND lo.login_time>="2014-08-03 00:00:00" AND lo.login_time<"2014-08-09 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.359021s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) AND lo.login_time>="2014-08-03 00:00:00" AND lo.login_time<"2014-08-09 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.360021s ]
SQL: SELECT l.name,COALESCE(a.ulcount,0) b FROM  location l LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(28422)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>="2014-08-03 00:00:00"   GROUP BY ud.locid) a ON a.locid=l.id WHERE l.id IN (28422) [ RunTime:0.052003s ]
SQL: 
				CALL count_worklog_all('2014-07-09 00:00:00','2014-08-08 00:00:00','24521,24543,24561')
				 [ RunTime:0.072004s ]
INFO: [ view_parse ] --START--
INFO: ParseTemplate Behavior ::run [ RunTime:0.510029s ]
INFO: [ view_parse ] --END-- [ RunTime:0.515029s ]
INFO: [ view_filter ] --START--
INFO: ContentReplace Behavior ::run [ RunTime:0.009001s ]
INFO: TokenBuild Behavior ::run [ RunTime:0.010001s ]
INFO: WriteHtmlCache Behavior ::run [ RunTime:0.004000s ]
INFO: ShowRuntime Behavior ::run [ RunTime:0.015001s ]
INFO: [ view_filter ] --END-- [ RunTime:0.053003s ]
INFO: [ view_end ] --START--
INFO: ShowPageTrace Behavior ::run [ RunTime:0.012000s ]
INFO: [ view_end ] --END-- [ RunTime:0.019001s ]

[ 2014-08-10T20:10:29+08:00 ] 127.0.0.1 /php_demo/shizhan/10/10wish/index.php/Njb/Index/tongji?checkbox%5B%5D=28422&date_begin=2014-08-03&date_end=2014-08-09
INFO: [ route_check ] --START--
INFO: CheckRoute Behavior ::run [ RunTime:0.006000s ]
INFO: [ route_check ] --END-- [ RunTime:0.010001s ]
INFO: [ app_begin ] --START--
INFO: ReadHtmlCache Behavior ::run [ RunTime:0.008001s ]
INFO: [ app_begin ] --END-- [ RunTime:0.012001s ]
SQL: SELECT l.name,COALESCE(a.ucount,0) as yhs,COALESCE(c.ulcount,0) as dlyhs,COALESCE(c.logCount,0) as dlcs FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(ud.id) ucount FROM   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(28422)) ud     GROUP BY ud.locid  ) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(28422)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>="2014-08-03 00:00:00" AND lo.login_time<"2014-08-09 00:00:00"   GROUP BY ud.locid) c ON l.id=c.locid WHERE l.id IN(28422) [ RunTime:0.086005s ]
SQL: SELECT l.name,COALESCE(a.noticeCount,0) noticeCount,COALESCE(a.userCount,0) userCount FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(n.id) noticeCount,COUNT(DISTINCT ud.id) userCount FROM notice n,   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(28422)) ud   WHERE n.owner_id=ud.id AND n.publish_time>="2014-08-03 00:00:00"    AND n.publish_time<"2014-08-09 00:00:00" GROUP BY ud.locid) a  ON l.id=a.locid WHERE l.id IN(28422) [ RunTime:0.004000s ]
SQL: SELECT l.name,COALESCE(a.asCount,0) a,COALESCE(b.adminCount,0) b,COALESCE(c.noAdminCount,0) c FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(t.id) asCount FROM assignment t,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(28422)) ud  WHERE t.creator_id=ud.id AND t.create_time>="2014-08-03 00:00:00" AND  t.create_time<"2014-08-09 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) adminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(28422)) ud   WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='TechAdmin'   AND t.create_time>="2014-08-03 00:00:00" AND  t.create_time<"2014-08-09 00:00:00"  GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) noAdminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(28422)) ud  WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='Technician'   AND t.create_time>="2014-08-03 00:00:00" AND  t.create_time<"2014-08-09 00:00:00"  GROUP BY ud.locid ) c ON l.id=c.locid  WHERE l.id IN(28422) [ RunTime:0.007000s ]
SQL: SELECT l.name,COALESCE(a.worklogCount,0) a,COALESCE(a.uCount,0) b,COALESCE(b.docCount,0) c,COALESCE(c.phoCount,0) d,COALESCE(d.audioCount,0) e FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(DISTINCT w.id) worklogCount,COUNT(DISTINCT w.owner_id) uCount FROM work_log w,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(28422)) ud  WHERE w.owner_id=ud.id    AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) docCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(28422)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00"  AND i.media_type=1   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) phoCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(28422)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00"  AND i.media_type=2   GROUP BY ud.locid ) c ON l.id=c.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) audioCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(28422)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00"  AND i.media_type=3   GROUP BY ud.locid ) d ON l.id=d.locid   WHERE l.id IN(28422) [ RunTime:0.014001s ]
SQL: SELECT l.name,COALESCE(a.photoCount,0) a,COALESCE(a.ucount,0) b,COALESCE(b.priseCount,0) c,COALESCE(c.comCount,0) d FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(i.id) photoCount,COUNT(DISTINCT ud.id) ucount FROM album m,album_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(28422)) ud  WHERE m.owner_id=ud.id AND i.album_id=m.id   AND i.create_time>="2014-08-03 00:00:00" AND i.create_time<"2014-08-09 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,COUNT(uc.id) priseCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(28422)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='AlbumItem'   AND uc.create_time>"2014-08-03 00:00:00" AND uc.create_time<"2014-08-09 00:00:00"   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(uc.id) comCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(28422)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='SystemComment'   AND uc.create_time>="2014-08-03 00:00:00" AND uc.create_time<"2014-08-09 00:00:00"  GROUP BY ud.locid) c ON l.id=c.locid  WHERE l.id IN(28422) [ RunTime:0.007000s ]
SQL: SELECT a.rname a,l.name b,d.name c,a.age d FROM (SELECT u.id uid,u.real_name rname,u.location_id locid,u.dept_id depId,(2014-(SELECT SUBSTR(u.identify_value,7,4))+0) age FROM app_user u WHERE NOT EXISTS ( SELECT lo.user_id FROM login_log lo WHERE u.id=lo.user_id  ) AND u.id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)   UNION ALL SELECT u.id FROM app_user u WHERE u.location_id IN(28422) )) a,location l,department d WHERE a.depId=d.id AND a.locid=l.id [ RunTime:2.547145s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) AND lo.login_time>="2014-08-03 00:00:00" AND lo.login_time<"2014-08-09 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.433025s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) AND lo.login_time>="2014-08-03 00:00:00" AND lo.login_time<"2014-08-09 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.371021s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) AND lo.login_time>="2014-08-03 00:00:00" AND lo.login_time<"2014-08-09 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.390022s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) AND lo.login_time>="2014-08-03 00:00:00" AND lo.login_time<"2014-08-09 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.362020s ]
SQL: SELECT l.name,COALESCE(a.ulcount,0) b FROM  location l LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(28422)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>="2014-08-03 00:00:00"   GROUP BY ud.locid) a ON a.locid=l.id WHERE l.id IN (28422) [ RunTime:0.052003s ]
SQL: 
				CALL count_worklog_all('2014-07-09 00:00:00','2014-08-08 00:00:00','24521,24543,24561')
				 [ RunTime:0.046003s ]
INFO: [ view_parse ] --START--
INFO: ParseTemplate Behavior ::run [ RunTime:0.548031s ]
INFO: [ view_parse ] --END-- [ RunTime:0.552032s ]
INFO: [ view_filter ] --START--
INFO: ContentReplace Behavior ::run [ RunTime:0.006001s ]
INFO: TokenBuild Behavior ::run [ RunTime:0.008000s ]
INFO: WriteHtmlCache Behavior ::run [ RunTime:0.005001s ]
INFO: ShowRuntime Behavior ::run [ RunTime:0.012001s ]
INFO: [ view_filter ] --END-- [ RunTime:0.045003s ]
INFO: [ view_end ] --START--
INFO: ShowPageTrace Behavior ::run [ RunTime:0.012001s ]
INFO: [ view_end ] --END-- [ RunTime:0.020001s ]

[ 2014-08-10T20:14:04+08:00 ] 127.0.0.1 /php_demo/shizhan/10/10wish/index.php/Njb/Index/tongji?checkbox%5B%5D=28422&date_begin=2014-08-03&date_end=2014-08-09
INFO: [ route_check ] --START--
INFO: CheckRoute Behavior ::run [ RunTime:0.006000s ]
INFO: [ route_check ] --END-- [ RunTime:0.011001s ]
INFO: [ app_begin ] --START--
INFO: ReadHtmlCache Behavior ::run [ RunTime:0.008000s ]
INFO: [ app_begin ] --END-- [ RunTime:0.013000s ]
SQL: SELECT l.name,COALESCE(a.ucount,0) as yhs,COALESCE(c.ulcount,0) as dlyhs,COALESCE(c.logCount,0) as dlcs FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(ud.id) ucount FROM   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(28422)) ud     GROUP BY ud.locid  ) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(28422)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>="2014-08-03 00:00:00" AND lo.login_time<"2014-08-09 00:00:00"   GROUP BY ud.locid) c ON l.id=c.locid WHERE l.id IN(28422) [ RunTime:0.048003s ]
SQL: SELECT l.name,COALESCE(a.noticeCount,0) noticeCount,COALESCE(a.userCount,0) userCount FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(n.id) noticeCount,COUNT(DISTINCT ud.id) userCount FROM notice n,   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(28422)) ud   WHERE n.owner_id=ud.id AND n.publish_time>="2014-08-03 00:00:00"    AND n.publish_time<"2014-08-09 00:00:00" GROUP BY ud.locid) a  ON l.id=a.locid WHERE l.id IN(28422) [ RunTime:0.002000s ]
SQL: SELECT l.name,COALESCE(a.asCount,0) a,COALESCE(b.adminCount,0) b,COALESCE(c.noAdminCount,0) c FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(t.id) asCount FROM assignment t,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(28422)) ud  WHERE t.creator_id=ud.id AND t.create_time>="2014-08-03 00:00:00" AND  t.create_time<"2014-08-09 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) adminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(28422)) ud   WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='TechAdmin'   AND t.create_time>="2014-08-03 00:00:00" AND  t.create_time<"2014-08-09 00:00:00"  GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) noAdminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(28422)) ud  WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='Technician'   AND t.create_time>="2014-08-03 00:00:00" AND  t.create_time<"2014-08-09 00:00:00"  GROUP BY ud.locid ) c ON l.id=c.locid  WHERE l.id IN(28422) [ RunTime:0.004000s ]
SQL: SELECT l.name,COALESCE(a.worklogCount,0) a,COALESCE(a.uCount,0) b,COALESCE(b.docCount,0) c,COALESCE(c.phoCount,0) d,COALESCE(d.audioCount,0) e FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(DISTINCT w.id) worklogCount,COUNT(DISTINCT w.owner_id) uCount FROM work_log w,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(28422)) ud  WHERE w.owner_id=ud.id    AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) docCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(28422)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00"  AND i.media_type=1   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) phoCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(28422)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00"  AND i.media_type=2   GROUP BY ud.locid ) c ON l.id=c.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) audioCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(28422)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00"  AND i.media_type=3   GROUP BY ud.locid ) d ON l.id=d.locid   WHERE l.id IN(28422) [ RunTime:0.009001s ]
SQL: SELECT l.name,COALESCE(a.photoCount,0) a,COALESCE(a.ucount,0) b,COALESCE(b.priseCount,0) c,COALESCE(c.comCount,0) d FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(i.id) photoCount,COUNT(DISTINCT ud.id) ucount FROM album m,album_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(28422)) ud  WHERE m.owner_id=ud.id AND i.album_id=m.id   AND i.create_time>="2014-08-03 00:00:00" AND i.create_time<"2014-08-09 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,COUNT(uc.id) priseCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(28422)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='AlbumItem'   AND uc.create_time>"2014-08-03 00:00:00" AND uc.create_time<"2014-08-09 00:00:00"   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(uc.id) comCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(28422)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='SystemComment'   AND uc.create_time>="2014-08-03 00:00:00" AND uc.create_time<"2014-08-09 00:00:00"  GROUP BY ud.locid) c ON l.id=c.locid  WHERE l.id IN(28422) [ RunTime:0.004000s ]
SQL: SELECT a.rname a,l.name b,d.name c,a.age d FROM (SELECT u.id uid,u.real_name rname,u.location_id locid,u.dept_id depId,(2014-(SELECT SUBSTR(u.identify_value,7,4))+0) age FROM app_user u WHERE NOT EXISTS ( SELECT lo.user_id FROM login_log lo WHERE u.id=lo.user_id  ) AND u.id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)   UNION ALL SELECT u.id FROM app_user u WHERE u.location_id IN(28422) )) a,location l,department d WHERE a.depId=d.id AND a.locid=l.id [ RunTime:2.082119s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) AND lo.login_time>="2014-08-03 00:00:00" AND lo.login_time<"2014-08-09 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.426025s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) AND lo.login_time>="2014-08-03 00:00:00" AND lo.login_time<"2014-08-09 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.352020s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) AND lo.login_time>="2014-08-03 00:00:00" AND lo.login_time<"2014-08-09 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.366021s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) AND lo.login_time>="2014-08-03 00:00:00" AND lo.login_time<"2014-08-09 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.369021s ]
SQL: SELECT l.name,COALESCE(a.ulcount,0) b FROM  location l LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(28422)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>="2014-08-03 00:00:00"   GROUP BY ud.locid) a ON a.locid=l.id WHERE l.id IN (28422) [ RunTime:0.054003s ]
SQL: 
				CALL count_worklog_all('2014-07-09 00:00:00','2014-08-08 00:00:00','24521,24543,24561')
				 [ RunTime:0.047003s ]
INFO: [ view_parse ] --START--
INFO: ParseTemplate Behavior ::run [ RunTime:0.527030s ]
INFO: [ view_parse ] --END-- [ RunTime:0.531030s ]
INFO: [ view_filter ] --START--
INFO: ContentReplace Behavior ::run [ RunTime:0.007001s ]
INFO: TokenBuild Behavior ::run [ RunTime:0.008001s ]
INFO: WriteHtmlCache Behavior ::run [ RunTime:0.004000s ]
INFO: ShowRuntime Behavior ::run [ RunTime:0.011001s ]
INFO: [ view_filter ] --END-- [ RunTime:0.045003s ]
INFO: [ view_end ] --START--
INFO: ShowPageTrace Behavior ::run [ RunTime:0.015001s ]
INFO: [ view_end ] --END-- [ RunTime:0.022001s ]

[ 2014-08-10T20:15:46+08:00 ] 127.0.0.1 /php_demo/shizhan/10/10wish/index.php/Njb/Index/tongji?checkbox%5B%5D=28422&date_begin=2014-08-03&date_end=2014-08-09
INFO: [ route_check ] --START--
INFO: CheckRoute Behavior ::run [ RunTime:0.008001s ]
INFO: [ route_check ] --END-- [ RunTime:0.013001s ]
INFO: [ app_begin ] --START--
INFO: ReadHtmlCache Behavior ::run [ RunTime:0.008000s ]
INFO: [ app_begin ] --END-- [ RunTime:0.013000s ]
SQL: SELECT l.name,COALESCE(a.ucount,0) as yhs,COALESCE(c.ulcount,0) as dlyhs,COALESCE(c.logCount,0) as dlcs FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(ud.id) ucount FROM   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(28422)) ud     GROUP BY ud.locid  ) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(28422)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>="2014-08-03 00:00:00" AND lo.login_time<"2014-08-09 00:00:00"   GROUP BY ud.locid) c ON l.id=c.locid WHERE l.id IN(28422) [ RunTime:0.057003s ]
SQL: SELECT l.name,COALESCE(a.noticeCount,0) noticeCount,COALESCE(a.userCount,0) userCount FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(n.id) noticeCount,COUNT(DISTINCT ud.id) userCount FROM notice n,   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(28422)) ud   WHERE n.owner_id=ud.id AND n.publish_time>="2014-08-03 00:00:00"    AND n.publish_time<"2014-08-09 00:00:00" GROUP BY ud.locid) a  ON l.id=a.locid WHERE l.id IN(28422) [ RunTime:0.003000s ]
SQL: SELECT l.name,COALESCE(a.asCount,0) a,COALESCE(b.adminCount,0) b,COALESCE(c.noAdminCount,0) c FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(t.id) asCount FROM assignment t,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(28422)) ud  WHERE t.creator_id=ud.id AND t.create_time>="2014-08-03 00:00:00" AND  t.create_time<"2014-08-09 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) adminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(28422)) ud   WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='TechAdmin'   AND t.create_time>="2014-08-03 00:00:00" AND  t.create_time<"2014-08-09 00:00:00"  GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) noAdminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(28422)) ud  WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='Technician'   AND t.create_time>="2014-08-03 00:00:00" AND  t.create_time<"2014-08-09 00:00:00"  GROUP BY ud.locid ) c ON l.id=c.locid  WHERE l.id IN(28422) [ RunTime:0.006000s ]
SQL: SELECT l.name,COALESCE(a.worklogCount,0) a,COALESCE(a.uCount,0) b,COALESCE(b.docCount,0) c,COALESCE(c.phoCount,0) d,COALESCE(d.audioCount,0) e FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(DISTINCT w.id) worklogCount,COUNT(DISTINCT w.owner_id) uCount FROM work_log w,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(28422)) ud  WHERE w.owner_id=ud.id    AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) docCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(28422)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00"  AND i.media_type=1   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) phoCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(28422)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00"  AND i.media_type=2   GROUP BY ud.locid ) c ON l.id=c.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) audioCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(28422)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00"  AND i.media_type=3   GROUP BY ud.locid ) d ON l.id=d.locid   WHERE l.id IN(28422) [ RunTime:0.012000s ]
SQL: SELECT l.name,COALESCE(a.photoCount,0) a,COALESCE(a.ucount,0) b,COALESCE(b.priseCount,0) c,COALESCE(c.comCount,0) d FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(i.id) photoCount,COUNT(DISTINCT ud.id) ucount FROM album m,album_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(28422)) ud  WHERE m.owner_id=ud.id AND i.album_id=m.id   AND i.create_time>="2014-08-03 00:00:00" AND i.create_time<"2014-08-09 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,COUNT(uc.id) priseCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(28422)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='AlbumItem'   AND uc.create_time>"2014-08-03 00:00:00" AND uc.create_time<"2014-08-09 00:00:00"   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(uc.id) comCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(28422)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='SystemComment'   AND uc.create_time>="2014-08-03 00:00:00" AND uc.create_time<"2014-08-09 00:00:00"  GROUP BY ud.locid) c ON l.id=c.locid  WHERE l.id IN(28422) [ RunTime:0.006000s ]
SQL: SELECT a.rname a,l.name b,d.name c,a.age d FROM (SELECT u.id uid,u.real_name rname,u.location_id locid,u.dept_id depId,(2014-(SELECT SUBSTR(u.identify_value,7,4))+0) age FROM app_user u WHERE NOT EXISTS ( SELECT lo.user_id FROM login_log lo WHERE u.id=lo.user_id  ) AND u.id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)   UNION ALL SELECT u.id FROM app_user u WHERE u.location_id IN(28422) )) a,location l,department d WHERE a.depId=d.id AND a.locid=l.id [ RunTime:2.482142s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) AND lo.login_time>="2014-08-03 00:00:00" AND lo.login_time<"2014-08-09 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.384022s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) AND lo.login_time>="2014-08-03 00:00:00" AND lo.login_time<"2014-08-09 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.354020s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) AND lo.login_time>="2014-08-03 00:00:00" AND lo.login_time<"2014-08-09 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.363021s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) AND lo.login_time>="2014-08-03 00:00:00" AND lo.login_time<"2014-08-09 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.363021s ]
SQL: SELECT l.name,COALESCE(a.ulcount,0) b FROM  location l LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(28422)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>="2014-08-03 00:00:00"   GROUP BY ud.locid) a ON a.locid=l.id WHERE l.id IN (28422) [ RunTime:0.052003s ]
SQL: 
				CALL count_worklog_all('2014-07-09 00:00:00','2014-08-08 00:00:00','24521,24543,24561')
				 [ RunTime:0.046003s ]
INFO: [ view_parse ] --START--
INFO: ParseTemplate Behavior ::run [ RunTime:0.529031s ]
INFO: [ view_parse ] --END-- [ RunTime:0.534031s ]
INFO: [ view_filter ] --START--
INFO: ContentReplace Behavior ::run [ RunTime:0.007001s ]
INFO: TokenBuild Behavior ::run [ RunTime:0.009000s ]
INFO: WriteHtmlCache Behavior ::run [ RunTime:0.004001s ]
INFO: ShowRuntime Behavior ::run [ RunTime:0.011000s ]
INFO: [ view_filter ] --END-- [ RunTime:0.045003s ]
INFO: [ view_end ] --START--
INFO: ShowPageTrace Behavior ::run [ RunTime:0.012001s ]
INFO: [ view_end ] --END-- [ RunTime:0.018001s ]

[ 2014-08-10T20:16:10+08:00 ] 127.0.0.1 /php_demo/shizhan/10/10wish/index.php/Njb/Index/tongji?checkbox%5B%5D=28422&date_begin=2014-08-03&date_end=2014-08-09
INFO: [ route_check ] --START--
INFO: CheckRoute Behavior ::run [ RunTime:0.007000s ]
INFO: [ route_check ] --END-- [ RunTime:0.012000s ]
INFO: [ app_begin ] --START--
INFO: ReadHtmlCache Behavior ::run [ RunTime:0.008001s ]
INFO: [ app_begin ] --END-- [ RunTime:0.012001s ]
SQL: SELECT l.name,COALESCE(a.ucount,0) as yhs,COALESCE(c.ulcount,0) as dlyhs,COALESCE(c.logCount,0) as dlcs FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(ud.id) ucount FROM   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(28422)) ud     GROUP BY ud.locid  ) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(28422)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>="2014-08-03 00:00:00" AND lo.login_time<"2014-08-09 00:00:00"   GROUP BY ud.locid) c ON l.id=c.locid WHERE l.id IN(28422) [ RunTime:0.047003s ]
SQL: SELECT l.name,COALESCE(a.noticeCount,0) noticeCount,COALESCE(a.userCount,0) userCount FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(n.id) noticeCount,COUNT(DISTINCT ud.id) userCount FROM notice n,   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(28422)) ud   WHERE n.owner_id=ud.id AND n.publish_time>="2014-08-03 00:00:00"    AND n.publish_time<"2014-08-09 00:00:00" GROUP BY ud.locid) a  ON l.id=a.locid WHERE l.id IN(28422) [ RunTime:0.004000s ]
SQL: SELECT l.name,COALESCE(a.asCount,0) a,COALESCE(b.adminCount,0) b,COALESCE(c.noAdminCount,0) c FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(t.id) asCount FROM assignment t,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(28422)) ud  WHERE t.creator_id=ud.id AND t.create_time>="2014-08-03 00:00:00" AND  t.create_time<"2014-08-09 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) adminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(28422)) ud   WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='TechAdmin'   AND t.create_time>="2014-08-03 00:00:00" AND  t.create_time<"2014-08-09 00:00:00"  GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) noAdminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(28422)) ud  WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='Technician'   AND t.create_time>="2014-08-03 00:00:00" AND  t.create_time<"2014-08-09 00:00:00"  GROUP BY ud.locid ) c ON l.id=c.locid  WHERE l.id IN(28422) [ RunTime:0.004001s ]
SQL: SELECT l.name,COALESCE(a.worklogCount,0) a,COALESCE(a.uCount,0) b,COALESCE(b.docCount,0) c,COALESCE(c.phoCount,0) d,COALESCE(d.audioCount,0) e FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(DISTINCT w.id) worklogCount,COUNT(DISTINCT w.owner_id) uCount FROM work_log w,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(28422)) ud  WHERE w.owner_id=ud.id    AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) docCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(28422)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00"  AND i.media_type=1   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) phoCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(28422)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00"  AND i.media_type=2   GROUP BY ud.locid ) c ON l.id=c.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) audioCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(28422)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00"  AND i.media_type=3   GROUP BY ud.locid ) d ON l.id=d.locid   WHERE l.id IN(28422) [ RunTime:0.009001s ]
SQL: SELECT l.name,COALESCE(a.photoCount,0) a,COALESCE(a.ucount,0) b,COALESCE(b.priseCount,0) c,COALESCE(c.comCount,0) d FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(i.id) photoCount,COUNT(DISTINCT ud.id) ucount FROM album m,album_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(28422)) ud  WHERE m.owner_id=ud.id AND i.album_id=m.id   AND i.create_time>="2014-08-03 00:00:00" AND i.create_time<"2014-08-09 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,COUNT(uc.id) priseCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(28422)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='AlbumItem'   AND uc.create_time>"2014-08-03 00:00:00" AND uc.create_time<"2014-08-09 00:00:00"   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(uc.id) comCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(28422)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='SystemComment'   AND uc.create_time>="2014-08-03 00:00:00" AND uc.create_time<"2014-08-09 00:00:00"  GROUP BY ud.locid) c ON l.id=c.locid  WHERE l.id IN(28422) [ RunTime:0.005000s ]
SQL: SELECT a.rname a,l.name b,d.name c,a.age d FROM (SELECT u.id uid,u.real_name rname,u.location_id locid,u.dept_id depId,(2014-(SELECT SUBSTR(u.identify_value,7,4))+0) age FROM app_user u WHERE NOT EXISTS ( SELECT lo.user_id FROM login_log lo WHERE u.id=lo.user_id  ) AND u.id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)   UNION ALL SELECT u.id FROM app_user u WHERE u.location_id IN(28422) )) a,location l,department d WHERE a.depId=d.id AND a.locid=l.id [ RunTime:2.036116s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) AND lo.login_time>="2014-08-03 00:00:00" AND lo.login_time<"2014-08-09 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.366020s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) AND lo.login_time>="2014-08-03 00:00:00" AND lo.login_time<"2014-08-09 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.354020s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) AND lo.login_time>="2014-08-03 00:00:00" AND lo.login_time<"2014-08-09 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.367021s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) AND lo.login_time>="2014-08-03 00:00:00" AND lo.login_time<"2014-08-09 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.363021s ]
SQL: SELECT l.name,COALESCE(a.ulcount,0) b FROM  location l LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(28422)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(28422)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>="2014-08-03 00:00:00"   GROUP BY ud.locid) a ON a.locid=l.id WHERE l.id IN (28422) [ RunTime:0.050003s ]
SQL: 
				CALL count_worklog_all('2014-07-09 00:00:00','2014-08-08 00:00:00','24521,24543,24561')
				 [ RunTime:0.046002s ]
INFO: [ view_parse ] --START--
INFO: ParseTemplate Behavior ::run [ RunTime:0.531030s ]
INFO: [ view_parse ] --END-- [ RunTime:0.536031s ]
INFO: [ view_filter ] --START--
INFO: ContentReplace Behavior ::run [ RunTime:0.007000s ]
INFO: TokenBuild Behavior ::run [ RunTime:0.009000s ]
INFO: WriteHtmlCache Behavior ::run [ RunTime:0.007001s ]
INFO: ShowRuntime Behavior ::run [ RunTime:0.013001s ]
INFO: [ view_filter ] --END-- [ RunTime:0.051003s ]
INFO: [ view_end ] --START--
INFO: ShowPageTrace Behavior ::run [ RunTime:0.012001s ]
INFO: [ view_end ] --END-- [ RunTime:0.020001s ]

[ 2014-08-10T20:18:48+08:00 ] 127.0.0.1 /php_demo/shizhan/10/10wish/index.php/Njb/Index/tongji?checkbox%5B%5D=24521&checkbox%5B%5D=24543&checkbox%5B%5D=24561&date_begin=2014-08-03&date_end=2014-08-09
INFO: [ route_check ] --START--
INFO: CheckRoute Behavior ::run [ RunTime:0.006000s ]
INFO: [ route_check ] --END-- [ RunTime:0.012000s ]
INFO: [ app_begin ] --START--
INFO: ReadHtmlCache Behavior ::run [ RunTime:0.008001s ]
INFO: [ app_begin ] --END-- [ RunTime:0.013001s ]
SQL: SELECT l.name,COALESCE(a.ucount,0) as yhs,COALESCE(c.ulcount,0) as dlyhs,COALESCE(c.logCount,0) as dlcs FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(ud.id) ucount FROM   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561)) ud     GROUP BY ud.locid  ) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>="2014-08-03 00:00:00" AND lo.login_time<"2014-08-09 00:00:00"   GROUP BY ud.locid) c ON l.id=c.locid WHERE l.id IN(24521,24543,24561) [ RunTime:0.146008s ]
SQL: SELECT l.name,COALESCE(a.noticeCount,0) noticeCount,COALESCE(a.userCount,0) userCount FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(n.id) noticeCount,COUNT(DISTINCT ud.id) userCount FROM notice n,   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561)) ud   WHERE n.owner_id=ud.id AND n.publish_time>="2014-08-03 00:00:00"    AND n.publish_time<"2014-08-09 00:00:00" GROUP BY ud.locid) a  ON l.id=a.locid WHERE l.id IN(24521,24543,24561) [ RunTime:0.014001s ]
SQL: SELECT l.name,COALESCE(a.asCount,0) a,COALESCE(b.adminCount,0) b,COALESCE(c.noAdminCount,0) c FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(t.id) asCount FROM assignment t,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561)) ud  WHERE t.creator_id=ud.id AND t.create_time>="2014-08-03 00:00:00" AND  t.create_time<"2014-08-09 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) adminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561)) ud   WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='TechAdmin'   AND t.create_time>="2014-08-03 00:00:00" AND  t.create_time<"2014-08-09 00:00:00"  GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) noAdminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561)) ud  WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='Technician'   AND t.create_time>="2014-08-03 00:00:00" AND  t.create_time<"2014-08-09 00:00:00"  GROUP BY ud.locid ) c ON l.id=c.locid  WHERE l.id IN(24521,24543,24561) [ RunTime:0.021001s ]
SQL: SELECT l.name,COALESCE(a.worklogCount,0) a,COALESCE(a.uCount,0) b,COALESCE(b.docCount,0) c,COALESCE(c.phoCount,0) d,COALESCE(d.audioCount,0) e FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(DISTINCT w.id) worklogCount,COUNT(DISTINCT w.owner_id) uCount FROM work_log w,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561)) ud  WHERE w.owner_id=ud.id    AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) docCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00"  AND i.media_type=1   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) phoCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00"  AND i.media_type=2   GROUP BY ud.locid ) c ON l.id=c.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) audioCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00"  AND i.media_type=3   GROUP BY ud.locid ) d ON l.id=d.locid   WHERE l.id IN(24521,24543,24561) [ RunTime:0.046003s ]
SQL: SELECT l.name,COALESCE(a.photoCount,0) a,COALESCE(a.ucount,0) b,COALESCE(b.priseCount,0) c,COALESCE(c.comCount,0) d FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(i.id) photoCount,COUNT(DISTINCT ud.id) ucount FROM album m,album_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561)) ud  WHERE m.owner_id=ud.id AND i.album_id=m.id   AND i.create_time>="2014-08-03 00:00:00" AND i.create_time<"2014-08-09 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,COUNT(uc.id) priseCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='AlbumItem'   AND uc.create_time>"2014-08-03 00:00:00" AND uc.create_time<"2014-08-09 00:00:00"   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(uc.id) comCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='SystemComment'   AND uc.create_time>="2014-08-03 00:00:00" AND uc.create_time<"2014-08-09 00:00:00"  GROUP BY ud.locid) c ON l.id=c.locid  WHERE l.id IN(24521,24543,24561) [ RunTime:0.014001s ]
SQL: SELECT a.rname a,l.name b,d.name c,a.age d FROM (SELECT u.id uid,u.real_name rname,u.location_id locid,u.dept_id depId,(2014-(SELECT SUBSTR(u.identify_value,7,4))+0) age FROM app_user u WHERE NOT EXISTS ( SELECT lo.user_id FROM login_log lo WHERE u.id=lo.user_id  ) AND u.id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561)   UNION ALL SELECT u.id FROM app_user u WHERE u.location_id IN(24521,24543,24561) )) a,location l,department d WHERE a.depId=d.id AND a.locid=l.id [ RunTime:2.041116s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) AND lo.login_time>="2014-08-03 00:00:00" AND lo.login_time<"2014-08-09 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.438025s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) AND lo.login_time>="2014-08-03 00:00:00" AND lo.login_time<"2014-08-09 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.350020s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) AND lo.login_time>="2014-08-03 00:00:00" AND lo.login_time<"2014-08-09 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.359020s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) AND lo.login_time>="2014-08-03 00:00:00" AND lo.login_time<"2014-08-09 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.359020s ]
SQL: SELECT l.name,COALESCE(a.ulcount,0) b FROM  location l LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>="2014-08-03 00:00:00"   GROUP BY ud.locid) a ON a.locid=l.id WHERE l.id IN (24521,24543,24561) [ RunTime:0.116007s ]
SQL: 
				CALL count_worklog_all('2014-07-09 00:00:00','2014-08-08 00:00:00','24521,24543,24561')
				 [ RunTime:0.046003s ]
INFO: [ view_parse ] --START--
INFO: ParseTemplate Behavior ::run [ RunTime:0.527031s ]
INFO: [ view_parse ] --END-- [ RunTime:0.533031s ]
INFO: [ view_filter ] --START--
INFO: ContentReplace Behavior ::run [ RunTime:0.006000s ]
INFO: TokenBuild Behavior ::run [ RunTime:0.009000s ]
INFO: WriteHtmlCache Behavior ::run [ RunTime:0.005001s ]
INFO: ShowRuntime Behavior ::run [ RunTime:0.015001s ]
INFO: [ view_filter ] --END-- [ RunTime:0.048003s ]
INFO: [ view_end ] --START--
INFO: ShowPageTrace Behavior ::run [ RunTime:0.009001s ]
INFO: [ view_end ] --END-- [ RunTime:0.016001s ]

[ 2014-08-10T20:52:28+08:00 ] 127.0.0.1 /php_demo/shizhan/10/10wish/index.php/Njb/Index/tongji?checkbox%5B%5D=24521&checkbox%5B%5D=24543&checkbox%5B%5D=24561&date_begin=2014-08-03&date_end=2014-08-09
INFO: [ route_check ] --START--
INFO: CheckRoute Behavior ::run [ RunTime:0.006000s ]
INFO: [ route_check ] --END-- [ RunTime:0.011001s ]
INFO: [ app_begin ] --START--
INFO: ReadHtmlCache Behavior ::run [ RunTime:0.009000s ]
INFO: [ app_begin ] --END-- [ RunTime:0.013001s ]
SQL: SELECT l.name,COALESCE(a.ucount,0) as yhs,COALESCE(c.ulcount,0) as dlyhs,COALESCE(c.logCount,0) as dlcs FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(ud.id) ucount FROM   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561)) ud     GROUP BY ud.locid  ) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>="2014-08-03 00:00:00" AND lo.login_time<"2014-08-09 00:00:00"   GROUP BY ud.locid) c ON l.id=c.locid WHERE l.id IN(24521,24543,24561) [ RunTime:0.106006s ]
SQL: SELECT l.name,COALESCE(a.noticeCount,0) noticeCount,COALESCE(a.userCount,0) userCount FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(n.id) noticeCount,COUNT(DISTINCT ud.id) userCount FROM notice n,   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561)) ud   WHERE n.owner_id=ud.id AND n.publish_time>="2014-08-03 00:00:00"    AND n.publish_time<"2014-08-09 00:00:00" GROUP BY ud.locid) a  ON l.id=a.locid WHERE l.id IN(24521,24543,24561) [ RunTime:0.003000s ]
SQL: SELECT l.name,COALESCE(a.asCount,0) a,COALESCE(b.adminCount,0) b,COALESCE(c.noAdminCount,0) c FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(t.id) asCount FROM assignment t,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561)) ud  WHERE t.creator_id=ud.id AND t.create_time>="2014-08-03 00:00:00" AND  t.create_time<"2014-08-09 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) adminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561)) ud   WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='TechAdmin'   AND t.create_time>="2014-08-03 00:00:00" AND  t.create_time<"2014-08-09 00:00:00"  GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) noAdminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561)) ud  WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='Technician'   AND t.create_time>="2014-08-03 00:00:00" AND  t.create_time<"2014-08-09 00:00:00"  GROUP BY ud.locid ) c ON l.id=c.locid  WHERE l.id IN(24521,24543,24561) [ RunTime:0.008000s ]
SQL: SELECT l.name,COALESCE(a.worklogCount,0) a,COALESCE(a.uCount,0) b,COALESCE(b.docCount,0) c,COALESCE(c.phoCount,0) d,COALESCE(d.audioCount,0) e FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(DISTINCT w.id) worklogCount,COUNT(DISTINCT w.owner_id) uCount FROM work_log w,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561)) ud  WHERE w.owner_id=ud.id    AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) docCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00"  AND i.media_type=1   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) phoCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00"  AND i.media_type=2   GROUP BY ud.locid ) c ON l.id=c.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) audioCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00"  AND i.media_type=3   GROUP BY ud.locid ) d ON l.id=d.locid   WHERE l.id IN(24521,24543,24561) [ RunTime:0.031001s ]
SQL: SELECT l.name,COALESCE(a.photoCount,0) a,COALESCE(a.ucount,0) b,COALESCE(b.priseCount,0) c,COALESCE(c.comCount,0) d FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(i.id) photoCount,COUNT(DISTINCT ud.id) ucount FROM album m,album_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561)) ud  WHERE m.owner_id=ud.id AND i.album_id=m.id   AND i.create_time>="2014-08-03 00:00:00" AND i.create_time<"2014-08-09 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,COUNT(uc.id) priseCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='AlbumItem'   AND uc.create_time>"2014-08-03 00:00:00" AND uc.create_time<"2014-08-09 00:00:00"   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(uc.id) comCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='SystemComment'   AND uc.create_time>="2014-08-03 00:00:00" AND uc.create_time<"2014-08-09 00:00:00"  GROUP BY ud.locid) c ON l.id=c.locid  WHERE l.id IN(24521,24543,24561) [ RunTime:0.011001s ]
SQL: SELECT a.rname a,l.name b,d.name c,a.age d FROM (SELECT u.id uid,u.real_name rname,u.location_id locid,u.dept_id depId,(2014-(SELECT SUBSTR(u.identify_value,7,4))+0) age FROM app_user u WHERE NOT EXISTS ( SELECT lo.user_id FROM login_log lo WHERE u.id=lo.user_id  ) AND u.id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561)   UNION ALL SELECT u.id FROM app_user u WHERE u.location_id IN(24521,24543,24561) )) a,location l,department d WHERE a.depId=d.id AND a.locid=l.id [ RunTime:2.157123s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) AND lo.login_time>="2014-08-03 00:00:00" AND lo.login_time<"2014-08-09 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.361020s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) AND lo.login_time>="2014-08-03 00:00:00" AND lo.login_time<"2014-08-09 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.352020s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) AND lo.login_time>="2014-08-03 00:00:00" AND lo.login_time<"2014-08-09 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.383021s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) AND lo.login_time>="2014-08-03 00:00:00" AND lo.login_time<"2014-08-09 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.365021s ]
SQL: SELECT l.name,COALESCE(a.ulcount,0) b FROM  location l LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>="2014-08-03 00:00:00"   GROUP BY ud.locid) a ON a.locid=l.id WHERE l.id IN (24521,24543,24561) [ RunTime:0.114007s ]
SQL: 
				CALL count_worklog_all('2014-07-09 00:00:00','2014-08-08 00:00:00','24521,24543,24561')
				 [ RunTime:0.047003s ]
INFO: [ view_parse ] --START--
INFO: ParseTemplate Behavior ::run [ RunTime:0.545031s ]
INFO: [ view_parse ] --END-- [ RunTime:0.551031s ]
INFO: [ view_filter ] --START--
INFO: ContentReplace Behavior ::run [ RunTime:0.010000s ]
INFO: TokenBuild Behavior ::run [ RunTime:0.012001s ]
INFO: WriteHtmlCache Behavior ::run [ RunTime:0.005001s ]
INFO: ShowRuntime Behavior ::run [ RunTime:0.012000s ]
INFO: [ view_filter ] --END-- [ RunTime:0.054004s ]
INFO: [ view_end ] --START--
INFO: ShowPageTrace Behavior ::run [ RunTime:0.014001s ]
INFO: [ view_end ] --END-- [ RunTime:0.021001s ]

[ 2014-08-10T20:55:44+08:00 ] 127.0.0.1 /php_demo/shizhan/10/10wish/index.php/Njb/Index/tongji?checkbox%5B%5D=24521&checkbox%5B%5D=24543&checkbox%5B%5D=24561&date_begin=2014-08-03&date_end=2014-08-09
INFO: [ route_check ] --START--
INFO: CheckRoute Behavior ::run [ RunTime:0.006001s ]
INFO: [ route_check ] --END-- [ RunTime:0.011001s ]
INFO: [ app_begin ] --START--
INFO: ReadHtmlCache Behavior ::run [ RunTime:0.008000s ]
INFO: [ app_begin ] --END-- [ RunTime:0.013001s ]
SQL: SELECT l.name,COALESCE(a.ucount,0) as yhs,COALESCE(c.ulcount,0) as dlyhs,COALESCE(c.logCount,0) as dlcs FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(ud.id) ucount FROM   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561)) ud     GROUP BY ud.locid  ) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>="2014-08-03 00:00:00" AND lo.login_time<"2014-08-09 00:00:00"   GROUP BY ud.locid) c ON l.id=c.locid WHERE l.id IN(24521,24543,24561) [ RunTime:0.106006s ]
SQL: SELECT l.name,COALESCE(a.noticeCount,0) noticeCount,COALESCE(a.userCount,0) userCount FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(n.id) noticeCount,COUNT(DISTINCT ud.id) userCount FROM notice n,   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561)) ud   WHERE n.owner_id=ud.id AND n.publish_time>="2014-08-03 00:00:00"    AND n.publish_time<"2014-08-09 00:00:00" GROUP BY ud.locid) a  ON l.id=a.locid WHERE l.id IN(24521,24543,24561) [ RunTime:0.004000s ]
SQL: SELECT l.name,COALESCE(a.asCount,0) a,COALESCE(b.adminCount,0) b,COALESCE(c.noAdminCount,0) c FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(t.id) asCount FROM assignment t,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561)) ud  WHERE t.creator_id=ud.id AND t.create_time>="2014-08-03 00:00:00" AND  t.create_time<"2014-08-09 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) adminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561)) ud   WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='TechAdmin'   AND t.create_time>="2014-08-03 00:00:00" AND  t.create_time<"2014-08-09 00:00:00"  GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) noAdminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561)) ud  WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='Technician'   AND t.create_time>="2014-08-03 00:00:00" AND  t.create_time<"2014-08-09 00:00:00"  GROUP BY ud.locid ) c ON l.id=c.locid  WHERE l.id IN(24521,24543,24561) [ RunTime:0.008000s ]
SQL: SELECT l.name,COALESCE(a.worklogCount,0) a,COALESCE(a.uCount,0) b,COALESCE(b.docCount,0) c,COALESCE(c.phoCount,0) d,COALESCE(d.audioCount,0) e FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(DISTINCT w.id) worklogCount,COUNT(DISTINCT w.owner_id) uCount FROM work_log w,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561)) ud  WHERE w.owner_id=ud.id    AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) docCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00"  AND i.media_type=1   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) phoCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00"  AND i.media_type=2   GROUP BY ud.locid ) c ON l.id=c.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) audioCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00"  AND i.media_type=3   GROUP BY ud.locid ) d ON l.id=d.locid   WHERE l.id IN(24521,24543,24561) [ RunTime:0.030001s ]
SQL: SELECT l.name,COALESCE(a.photoCount,0) a,COALESCE(a.ucount,0) b,COALESCE(b.priseCount,0) c,COALESCE(c.comCount,0) d FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(i.id) photoCount,COUNT(DISTINCT ud.id) ucount FROM album m,album_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561)) ud  WHERE m.owner_id=ud.id AND i.album_id=m.id   AND i.create_time>="2014-08-03 00:00:00" AND i.create_time<"2014-08-09 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,COUNT(uc.id) priseCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='AlbumItem'   AND uc.create_time>"2014-08-03 00:00:00" AND uc.create_time<"2014-08-09 00:00:00"   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(uc.id) comCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='SystemComment'   AND uc.create_time>="2014-08-03 00:00:00" AND uc.create_time<"2014-08-09 00:00:00"  GROUP BY ud.locid) c ON l.id=c.locid  WHERE l.id IN(24521,24543,24561) [ RunTime:0.010000s ]
SQL: SELECT a.rname a,l.name b,d.name c,a.age d FROM (SELECT u.id uid,u.real_name rname,u.location_id locid,u.dept_id depId,(2014-(SELECT SUBSTR(u.identify_value,7,4))+0) age FROM app_user u WHERE NOT EXISTS ( SELECT lo.user_id FROM login_log lo WHERE u.id=lo.user_id  ) AND u.id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561)   UNION ALL SELECT u.id FROM app_user u WHERE u.location_id IN(24521,24543,24561) )) a,location l,department d WHERE a.depId=d.id AND a.locid=l.id [ RunTime:2.059118s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) AND lo.login_time>="2014-08-03 00:00:00" AND lo.login_time<"2014-08-09 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.353020s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) AND lo.login_time>="2014-08-03 00:00:00" AND lo.login_time<"2014-08-09 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.367021s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) AND lo.login_time>="2014-08-03 00:00:00" AND lo.login_time<"2014-08-09 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.361021s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) AND lo.login_time>="2014-08-03 00:00:00" AND lo.login_time<"2014-08-09 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.363021s ]
SQL: SELECT l.name,COALESCE(a.ulcount,0) b FROM  location l LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>="2014-08-03 00:00:00"   GROUP BY ud.locid) a ON a.locid=l.id WHERE l.id IN (24521,24543,24561) [ RunTime:0.112006s ]
SQL: 
				CALL count_worklog_all("2014-08-03 00:00:00","2014-08-09 00:00:00",24521,24543,24561)
				 [ RunTime:0.051003s ]
ERR: 1318:Incorrect number of arguments for PROCEDURE njb.count_worklog_all; expected 3, got 5
 [ SQL ] : 
				CALL count_worklog_all("2014-08-03 00:00:00","2014-08-09 00:00:00",24521,24543,24561)
				
INFO: [ view_parse ] --START--
INFO: ParseTemplate Behavior ::run [ RunTime:0.551031s ]
INFO: [ view_parse ] --END-- [ RunTime:0.558032s ]
INFO: [ view_filter ] --START--
INFO: ContentReplace Behavior ::run [ RunTime:0.008001s ]
INFO: TokenBuild Behavior ::run [ RunTime:0.008000s ]
INFO: WriteHtmlCache Behavior ::run [ RunTime:0.006000s ]
INFO: ShowRuntime Behavior ::run [ RunTime:0.011001s ]
INFO: [ view_filter ] --END-- [ RunTime:0.047003s ]
INFO: [ view_end ] --START--
INFO: ShowPageTrace Behavior ::run [ RunTime:0.007001s ]
INFO: [ view_end ] --END-- [ RunTime:0.012001s ]

[ 2014-08-10T20:56:04+08:00 ] 127.0.0.1 /php_demo/shizhan/10/10wish/index.php/Njb/Index/tongji?checkbox%5B%5D=24521&checkbox%5B%5D=24543&checkbox%5B%5D=24561&date_begin=2014-08-03&date_end=2014-08-09
INFO: [ route_check ] --START--
INFO: CheckRoute Behavior ::run [ RunTime:0.006000s ]
INFO: [ route_check ] --END-- [ RunTime:0.011001s ]
INFO: [ app_begin ] --START--
INFO: ReadHtmlCache Behavior ::run [ RunTime:0.009001s ]
INFO: [ app_begin ] --END-- [ RunTime:0.014001s ]
SQL: SELECT l.name,COALESCE(a.ucount,0) as yhs,COALESCE(c.ulcount,0) as dlyhs,COALESCE(c.logCount,0) as dlcs FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(ud.id) ucount FROM   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561)) ud     GROUP BY ud.locid  ) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>="2014-08-03 00:00:00" AND lo.login_time<"2014-08-09 00:00:00"   GROUP BY ud.locid) c ON l.id=c.locid WHERE l.id IN(24521,24543,24561) [ RunTime:0.106006s ]
SQL: SELECT l.name,COALESCE(a.noticeCount,0) noticeCount,COALESCE(a.userCount,0) userCount FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(n.id) noticeCount,COUNT(DISTINCT ud.id) userCount FROM notice n,   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561)) ud   WHERE n.owner_id=ud.id AND n.publish_time>="2014-08-03 00:00:00"    AND n.publish_time<"2014-08-09 00:00:00" GROUP BY ud.locid) a  ON l.id=a.locid WHERE l.id IN(24521,24543,24561) [ RunTime:0.003000s ]
SQL: SELECT l.name,COALESCE(a.asCount,0) a,COALESCE(b.adminCount,0) b,COALESCE(c.noAdminCount,0) c FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(t.id) asCount FROM assignment t,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561)) ud  WHERE t.creator_id=ud.id AND t.create_time>="2014-08-03 00:00:00" AND  t.create_time<"2014-08-09 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) adminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561)) ud   WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='TechAdmin'   AND t.create_time>="2014-08-03 00:00:00" AND  t.create_time<"2014-08-09 00:00:00"  GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) noAdminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561)) ud  WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='Technician'   AND t.create_time>="2014-08-03 00:00:00" AND  t.create_time<"2014-08-09 00:00:00"  GROUP BY ud.locid ) c ON l.id=c.locid  WHERE l.id IN(24521,24543,24561) [ RunTime:0.008000s ]
SQL: SELECT l.name,COALESCE(a.worklogCount,0) a,COALESCE(a.uCount,0) b,COALESCE(b.docCount,0) c,COALESCE(c.phoCount,0) d,COALESCE(d.audioCount,0) e FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(DISTINCT w.id) worklogCount,COUNT(DISTINCT w.owner_id) uCount FROM work_log w,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561)) ud  WHERE w.owner_id=ud.id    AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) docCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00"  AND i.media_type=1   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) phoCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00"  AND i.media_type=2   GROUP BY ud.locid ) c ON l.id=c.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) audioCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00"  AND i.media_type=3   GROUP BY ud.locid ) d ON l.id=d.locid   WHERE l.id IN(24521,24543,24561) [ RunTime:0.029001s ]
SQL: SELECT l.name,COALESCE(a.photoCount,0) a,COALESCE(a.ucount,0) b,COALESCE(b.priseCount,0) c,COALESCE(c.comCount,0) d FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(i.id) photoCount,COUNT(DISTINCT ud.id) ucount FROM album m,album_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561)) ud  WHERE m.owner_id=ud.id AND i.album_id=m.id   AND i.create_time>="2014-08-03 00:00:00" AND i.create_time<"2014-08-09 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,COUNT(uc.id) priseCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='AlbumItem'   AND uc.create_time>"2014-08-03 00:00:00" AND uc.create_time<"2014-08-09 00:00:00"   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(uc.id) comCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='SystemComment'   AND uc.create_time>="2014-08-03 00:00:00" AND uc.create_time<"2014-08-09 00:00:00"  GROUP BY ud.locid) c ON l.id=c.locid  WHERE l.id IN(24521,24543,24561) [ RunTime:0.010000s ]
SQL: SELECT a.rname a,l.name b,d.name c,a.age d FROM (SELECT u.id uid,u.real_name rname,u.location_id locid,u.dept_id depId,(2014-(SELECT SUBSTR(u.identify_value,7,4))+0) age FROM app_user u WHERE NOT EXISTS ( SELECT lo.user_id FROM login_log lo WHERE u.id=lo.user_id  ) AND u.id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561)   UNION ALL SELECT u.id FROM app_user u WHERE u.location_id IN(24521,24543,24561) )) a,location l,department d WHERE a.depId=d.id AND a.locid=l.id [ RunTime:2.043117s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) AND lo.login_time>="2014-08-03 00:00:00" AND lo.login_time<"2014-08-09 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.370021s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) AND lo.login_time>="2014-08-03 00:00:00" AND lo.login_time<"2014-08-09 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.366021s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) AND lo.login_time>="2014-08-03 00:00:00" AND lo.login_time<"2014-08-09 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.402023s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) AND lo.login_time>="2014-08-03 00:00:00" AND lo.login_time<"2014-08-09 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.371021s ]
SQL: SELECT l.name,COALESCE(a.ulcount,0) b FROM  location l LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>="2014-08-03 00:00:00"   GROUP BY ud.locid) a ON a.locid=l.id WHERE l.id IN (24521,24543,24561) [ RunTime:0.113006s ]
SQL: 
				CALL count_worklog_all("2014-08-03 00:00:00","2014-08-09 00:00:00",24521,24543,24561)
				 [ RunTime:0.001001s ]
ERR: 1318:Incorrect number of arguments for PROCEDURE njb.count_worklog_all; expected 3, got 5
 [ SQL ] : 
				CALL count_worklog_all("2014-08-03 00:00:00","2014-08-09 00:00:00",24521,24543,24561)
				
INFO: [ view_parse ] --START--
INFO: ParseTemplate Behavior ::run [ RunTime:0.537031s ]
INFO: [ view_parse ] --END-- [ RunTime:0.541031s ]
INFO: [ view_filter ] --START--
INFO: ContentReplace Behavior ::run [ RunTime:0.008000s ]
INFO: TokenBuild Behavior ::run [ RunTime:0.008001s ]
INFO: WriteHtmlCache Behavior ::run [ RunTime:0.004000s ]
INFO: ShowRuntime Behavior ::run [ RunTime:0.013001s ]
INFO: [ view_filter ] --END-- [ RunTime:0.047003s ]
INFO: [ view_end ] --START--
INFO: ShowPageTrace Behavior ::run [ RunTime:0.007000s ]
INFO: [ view_end ] --END-- [ RunTime:0.012001s ]

[ 2014-08-10T20:56:50+08:00 ] 127.0.0.1 /php_demo/shizhan/10/10wish/index.php/Njb/Index/tongji?checkbox%5B%5D=24521&checkbox%5B%5D=24543&checkbox%5B%5D=24561&date_begin=2014-08-03&date_end=2014-08-09
INFO: [ route_check ] --START--
INFO: CheckRoute Behavior ::run [ RunTime:0.007000s ]
INFO: [ route_check ] --END-- [ RunTime:0.011001s ]
INFO: [ app_begin ] --START--
INFO: ReadHtmlCache Behavior ::run [ RunTime:0.008001s ]
INFO: [ app_begin ] --END-- [ RunTime:0.012001s ]
SQL: SELECT l.name,COALESCE(a.ucount,0) as yhs,COALESCE(c.ulcount,0) as dlyhs,COALESCE(c.logCount,0) as dlcs FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(ud.id) ucount FROM   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561)) ud     GROUP BY ud.locid  ) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>="2014-08-03 00:00:00" AND lo.login_time<"2014-08-09 00:00:00"   GROUP BY ud.locid) c ON l.id=c.locid WHERE l.id IN(24521,24543,24561) [ RunTime:0.105006s ]
SQL: SELECT l.name,COALESCE(a.noticeCount,0) noticeCount,COALESCE(a.userCount,0) userCount FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(n.id) noticeCount,COUNT(DISTINCT ud.id) userCount FROM notice n,   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561)) ud   WHERE n.owner_id=ud.id AND n.publish_time>="2014-08-03 00:00:00"    AND n.publish_time<"2014-08-09 00:00:00" GROUP BY ud.locid) a  ON l.id=a.locid WHERE l.id IN(24521,24543,24561) [ RunTime:0.003000s ]
SQL: SELECT l.name,COALESCE(a.asCount,0) a,COALESCE(b.adminCount,0) b,COALESCE(c.noAdminCount,0) c FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(t.id) asCount FROM assignment t,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561)) ud  WHERE t.creator_id=ud.id AND t.create_time>="2014-08-03 00:00:00" AND  t.create_time<"2014-08-09 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) adminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561)) ud   WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='TechAdmin'   AND t.create_time>="2014-08-03 00:00:00" AND  t.create_time<"2014-08-09 00:00:00"  GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) noAdminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561)) ud  WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='Technician'   AND t.create_time>="2014-08-03 00:00:00" AND  t.create_time<"2014-08-09 00:00:00"  GROUP BY ud.locid ) c ON l.id=c.locid  WHERE l.id IN(24521,24543,24561) [ RunTime:0.008001s ]
SQL: SELECT l.name,COALESCE(a.worklogCount,0) a,COALESCE(a.uCount,0) b,COALESCE(b.docCount,0) c,COALESCE(c.phoCount,0) d,COALESCE(d.audioCount,0) e FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(DISTINCT w.id) worklogCount,COUNT(DISTINCT w.owner_id) uCount FROM work_log w,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561)) ud  WHERE w.owner_id=ud.id    AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) docCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00"  AND i.media_type=1   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) phoCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00"  AND i.media_type=2   GROUP BY ud.locid ) c ON l.id=c.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) audioCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00"  AND i.media_type=3   GROUP BY ud.locid ) d ON l.id=d.locid   WHERE l.id IN(24521,24543,24561) [ RunTime:0.030002s ]
SQL: SELECT l.name,COALESCE(a.photoCount,0) a,COALESCE(a.ucount,0) b,COALESCE(b.priseCount,0) c,COALESCE(c.comCount,0) d FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(i.id) photoCount,COUNT(DISTINCT ud.id) ucount FROM album m,album_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561)) ud  WHERE m.owner_id=ud.id AND i.album_id=m.id   AND i.create_time>="2014-08-03 00:00:00" AND i.create_time<"2014-08-09 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,COUNT(uc.id) priseCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='AlbumItem'   AND uc.create_time>"2014-08-03 00:00:00" AND uc.create_time<"2014-08-09 00:00:00"   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(uc.id) comCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='SystemComment'   AND uc.create_time>="2014-08-03 00:00:00" AND uc.create_time<"2014-08-09 00:00:00"  GROUP BY ud.locid) c ON l.id=c.locid  WHERE l.id IN(24521,24543,24561) [ RunTime:0.010001s ]
SQL: SELECT a.rname a,l.name b,d.name c,a.age d FROM (SELECT u.id uid,u.real_name rname,u.location_id locid,u.dept_id depId,(2014-(SELECT SUBSTR(u.identify_value,7,4))+0) age FROM app_user u WHERE NOT EXISTS ( SELECT lo.user_id FROM login_log lo WHERE u.id=lo.user_id  ) AND u.id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561)   UNION ALL SELECT u.id FROM app_user u WHERE u.location_id IN(24521,24543,24561) )) a,location l,department d WHERE a.depId=d.id AND a.locid=l.id [ RunTime:2.065118s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) AND lo.login_time>="2014-08-03 00:00:00" AND lo.login_time<"2014-08-09 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.361020s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) AND lo.login_time>="2014-08-03 00:00:00" AND lo.login_time<"2014-08-09 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.357020s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) AND lo.login_time>="2014-08-03 00:00:00" AND lo.login_time<"2014-08-09 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.353020s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) AND lo.login_time>="2014-08-03 00:00:00" AND lo.login_time<"2014-08-09 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.362021s ]
SQL: SELECT l.name,COALESCE(a.ulcount,0) b FROM  location l LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>="2014-08-03 00:00:00"   GROUP BY ud.locid) a ON a.locid=l.id WHERE l.id IN (24521,24543,24561) [ RunTime:0.117007s ]
SQL: 
				CALL count_worklog_all("2014-08-03 00:00:00","2014-08-09 00:00:00",24521,24543,24561)
				 [ RunTime:0.001000s ]
ERR: 1318:Incorrect number of arguments for PROCEDURE njb.count_worklog_all; expected 3, got 5
 [ SQL ] : 
				CALL count_worklog_all("2014-08-03 00:00:00","2014-08-09 00:00:00",24521,24543,24561)
				
INFO: [ view_parse ] --START--
INFO: ParseTemplate Behavior ::run [ RunTime:0.534031s ]
INFO: [ view_parse ] --END-- [ RunTime:0.538031s ]
INFO: [ view_filter ] --START--
INFO: ContentReplace Behavior ::run [ RunTime:0.006000s ]
INFO: TokenBuild Behavior ::run [ RunTime:0.008000s ]
INFO: WriteHtmlCache Behavior ::run [ RunTime:0.004000s ]
INFO: ShowRuntime Behavior ::run [ RunTime:0.011000s ]
INFO: [ view_filter ] --END-- [ RunTime:0.042002s ]
INFO: [ view_end ] --START--
INFO: ShowPageTrace Behavior ::run [ RunTime:0.009000s ]
INFO: [ view_end ] --END-- [ RunTime:0.013000s ]

[ 2014-08-10T21:47:42+08:00 ] 127.0.0.1 /php_demo/shizhan/10/10wish/index.php/Njb/Index/tongji?checkbox%5B%5D=24521&checkbox%5B%5D=24543&checkbox%5B%5D=24561&date_begin=2014-08-03&date_end=2014-08-09
INFO: [ route_check ] --START--
INFO: CheckRoute Behavior ::run [ RunTime:0.010001s ]
INFO: [ route_check ] --END-- [ RunTime:0.016001s ]
INFO: [ app_begin ] --START--
INFO: ReadHtmlCache Behavior ::run [ RunTime:0.009000s ]
INFO: [ app_begin ] --END-- [ RunTime:0.013000s ]
SQL: SELECT l.name,COALESCE(a.ucount,0) as yhs,COALESCE(c.ulcount,0) as dlyhs,COALESCE(c.logCount,0) as dlcs FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(ud.id) ucount FROM   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561)) ud     GROUP BY ud.locid  ) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>="2014-08-03 00:00:00" AND lo.login_time<"2014-08-09 00:00:00"   GROUP BY ud.locid) c ON l.id=c.locid WHERE l.id IN(24521,24543,24561) [ RunTime:0.116007s ]
SQL: SELECT l.name,COALESCE(a.noticeCount,0) noticeCount,COALESCE(a.userCount,0) userCount FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(n.id) noticeCount,COUNT(DISTINCT ud.id) userCount FROM notice n,   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561)) ud   WHERE n.owner_id=ud.id AND n.publish_time>="2014-08-03 00:00:00"    AND n.publish_time<"2014-08-09 00:00:00" GROUP BY ud.locid) a  ON l.id=a.locid WHERE l.id IN(24521,24543,24561) [ RunTime:0.003000s ]
SQL: SELECT l.name,COALESCE(a.asCount,0) a,COALESCE(b.adminCount,0) b,COALESCE(c.noAdminCount,0) c FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(t.id) asCount FROM assignment t,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561)) ud  WHERE t.creator_id=ud.id AND t.create_time>="2014-08-03 00:00:00" AND  t.create_time<"2014-08-09 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) adminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561)) ud   WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='TechAdmin'   AND t.create_time>="2014-08-03 00:00:00" AND  t.create_time<"2014-08-09 00:00:00"  GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) noAdminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561)) ud  WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='Technician'   AND t.create_time>="2014-08-03 00:00:00" AND  t.create_time<"2014-08-09 00:00:00"  GROUP BY ud.locid ) c ON l.id=c.locid  WHERE l.id IN(24521,24543,24561) [ RunTime:0.008001s ]
SQL: SELECT l.name,COALESCE(a.worklogCount,0) a,COALESCE(a.uCount,0) b,COALESCE(b.docCount,0) c,COALESCE(c.phoCount,0) d,COALESCE(d.audioCount,0) e FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(DISTINCT w.id) worklogCount,COUNT(DISTINCT w.owner_id) uCount FROM work_log w,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561)) ud  WHERE w.owner_id=ud.id    AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) docCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00"  AND i.media_type=1   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) phoCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00"  AND i.media_type=2   GROUP BY ud.locid ) c ON l.id=c.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) audioCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00"  AND i.media_type=3   GROUP BY ud.locid ) d ON l.id=d.locid   WHERE l.id IN(24521,24543,24561) [ RunTime:0.030002s ]
SQL: SELECT l.name,COALESCE(a.photoCount,0) a,COALESCE(a.ucount,0) b,COALESCE(b.priseCount,0) c,COALESCE(c.comCount,0) d FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(i.id) photoCount,COUNT(DISTINCT ud.id) ucount FROM album m,album_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561)) ud  WHERE m.owner_id=ud.id AND i.album_id=m.id   AND i.create_time>="2014-08-03 00:00:00" AND i.create_time<"2014-08-09 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,COUNT(uc.id) priseCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='AlbumItem'   AND uc.create_time>"2014-08-03 00:00:00" AND uc.create_time<"2014-08-09 00:00:00"   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(uc.id) comCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='SystemComment'   AND uc.create_time>="2014-08-03 00:00:00" AND uc.create_time<"2014-08-09 00:00:00"  GROUP BY ud.locid) c ON l.id=c.locid  WHERE l.id IN(24521,24543,24561) [ RunTime:0.010001s ]
SQL: SELECT a.rname a,l.name b,d.name c,a.age d FROM (SELECT u.id uid,u.real_name rname,u.location_id locid,u.dept_id depId,(2014-(SELECT SUBSTR(u.identify_value,7,4))+0) age FROM app_user u WHERE NOT EXISTS ( SELECT lo.user_id FROM login_log lo WHERE u.id=lo.user_id  ) AND u.id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561)   UNION ALL SELECT u.id FROM app_user u WHERE u.location_id IN(24521,24543,24561) )) a,location l,department d WHERE a.depId=d.id AND a.locid=l.id [ RunTime:2.093120s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) AND lo.login_time>="2014-08-03 00:00:00" AND lo.login_time<"2014-08-09 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.375021s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) AND lo.login_time>="2014-08-03 00:00:00" AND lo.login_time<"2014-08-09 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.369021s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) AND lo.login_time>="2014-08-03 00:00:00" AND lo.login_time<"2014-08-09 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.368022s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) AND lo.login_time>="2014-08-03 00:00:00" AND lo.login_time<"2014-08-09 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.373021s ]
SQL: SELECT l.name,COALESCE(a.ulcount,0) b FROM  location l LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>="2014-08-03 00:00:00"   GROUP BY ud.locid) a ON a.locid=l.id WHERE l.id IN (24521,24543,24561) [ RunTime:0.117007s ]
SQL: 
				CALL count_worklog_all("2014-08-03 00:00:00","2014-08-09 00:00:00",(24521,24543,24561))
				 [ RunTime:0.040002s ]
ERR: 1241:Operand should contain 1 column(s)
 [ SQL ] : 
				CALL count_worklog_all("2014-08-03 00:00:00","2014-08-09 00:00:00",(24521,24543,24561))
				
INFO: [ view_parse ] --START--
INFO: ParseTemplate Behavior ::run [ RunTime:0.542031s ]
INFO: [ view_parse ] --END-- [ RunTime:0.548031s ]
INFO: [ view_filter ] --START--
INFO: ContentReplace Behavior ::run [ RunTime:0.008000s ]
INFO: TokenBuild Behavior ::run [ RunTime:0.008001s ]
INFO: WriteHtmlCache Behavior ::run [ RunTime:0.004000s ]
INFO: ShowRuntime Behavior ::run [ RunTime:0.014001s ]
INFO: [ view_filter ] --END-- [ RunTime:0.049002s ]
INFO: [ view_end ] --START--
INFO: ShowPageTrace Behavior ::run [ RunTime:0.010000s ]
INFO: [ view_end ] --END-- [ RunTime:0.016001s ]

[ 2014-08-10T21:48:11+08:00 ] 127.0.0.1 /php_demo/shizhan/10/10wish/index.php/Njb/Index/tongji?checkbox%5B%5D=24521&checkbox%5B%5D=24543&checkbox%5B%5D=24561&date_begin=2014-08-03&date_end=2014-08-09
INFO: [ route_check ] --START--
INFO: CheckRoute Behavior ::run [ RunTime:0.008000s ]
INFO: [ route_check ] --END-- [ RunTime:0.012001s ]
INFO: [ app_begin ] --START--
INFO: ReadHtmlCache Behavior ::run [ RunTime:0.009001s ]
INFO: [ app_begin ] --END-- [ RunTime:0.013001s ]
SQL: SELECT l.name,COALESCE(a.ucount,0) as yhs,COALESCE(c.ulcount,0) as dlyhs,COALESCE(c.logCount,0) as dlcs FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(ud.id) ucount FROM   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561)) ud     GROUP BY ud.locid  ) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>="2014-08-03 00:00:00" AND lo.login_time<"2014-08-09 00:00:00"   GROUP BY ud.locid) c ON l.id=c.locid WHERE l.id IN(24521,24543,24561) [ RunTime:0.107006s ]
SQL: SELECT l.name,COALESCE(a.noticeCount,0) noticeCount,COALESCE(a.userCount,0) userCount FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(n.id) noticeCount,COUNT(DISTINCT ud.id) userCount FROM notice n,   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561)) ud   WHERE n.owner_id=ud.id AND n.publish_time>="2014-08-03 00:00:00"    AND n.publish_time<"2014-08-09 00:00:00" GROUP BY ud.locid) a  ON l.id=a.locid WHERE l.id IN(24521,24543,24561) [ RunTime:0.003000s ]
SQL: SELECT l.name,COALESCE(a.asCount,0) a,COALESCE(b.adminCount,0) b,COALESCE(c.noAdminCount,0) c FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(t.id) asCount FROM assignment t,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561)) ud  WHERE t.creator_id=ud.id AND t.create_time>="2014-08-03 00:00:00" AND  t.create_time<"2014-08-09 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) adminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561)) ud   WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='TechAdmin'   AND t.create_time>="2014-08-03 00:00:00" AND  t.create_time<"2014-08-09 00:00:00"  GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) noAdminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561)) ud  WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='Technician'   AND t.create_time>="2014-08-03 00:00:00" AND  t.create_time<"2014-08-09 00:00:00"  GROUP BY ud.locid ) c ON l.id=c.locid  WHERE l.id IN(24521,24543,24561) [ RunTime:0.008000s ]
SQL: SELECT l.name,COALESCE(a.worklogCount,0) a,COALESCE(a.uCount,0) b,COALESCE(b.docCount,0) c,COALESCE(c.phoCount,0) d,COALESCE(d.audioCount,0) e FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(DISTINCT w.id) worklogCount,COUNT(DISTINCT w.owner_id) uCount FROM work_log w,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561)) ud  WHERE w.owner_id=ud.id    AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) docCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00"  AND i.media_type=1   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) phoCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00"  AND i.media_type=2   GROUP BY ud.locid ) c ON l.id=c.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) audioCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00"  AND i.media_type=3   GROUP BY ud.locid ) d ON l.id=d.locid   WHERE l.id IN(24521,24543,24561) [ RunTime:0.030001s ]
SQL: SELECT l.name,COALESCE(a.photoCount,0) a,COALESCE(a.ucount,0) b,COALESCE(b.priseCount,0) c,COALESCE(c.comCount,0) d FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(i.id) photoCount,COUNT(DISTINCT ud.id) ucount FROM album m,album_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561)) ud  WHERE m.owner_id=ud.id AND i.album_id=m.id   AND i.create_time>="2014-08-03 00:00:00" AND i.create_time<"2014-08-09 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,COUNT(uc.id) priseCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='AlbumItem'   AND uc.create_time>"2014-08-03 00:00:00" AND uc.create_time<"2014-08-09 00:00:00"   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(uc.id) comCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='SystemComment'   AND uc.create_time>="2014-08-03 00:00:00" AND uc.create_time<"2014-08-09 00:00:00"  GROUP BY ud.locid) c ON l.id=c.locid  WHERE l.id IN(24521,24543,24561) [ RunTime:0.010000s ]
SQL: SELECT a.rname a,l.name b,d.name c,a.age d FROM (SELECT u.id uid,u.real_name rname,u.location_id locid,u.dept_id depId,(2014-(SELECT SUBSTR(u.identify_value,7,4))+0) age FROM app_user u WHERE NOT EXISTS ( SELECT lo.user_id FROM login_log lo WHERE u.id=lo.user_id  ) AND u.id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561)   UNION ALL SELECT u.id FROM app_user u WHERE u.location_id IN(24521,24543,24561) )) a,location l,department d WHERE a.depId=d.id AND a.locid=l.id [ RunTime:2.139122s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) AND lo.login_time>="2014-08-03 00:00:00" AND lo.login_time<"2014-08-09 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.386023s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) AND lo.login_time>="2014-08-03 00:00:00" AND lo.login_time<"2014-08-09 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.376021s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) AND lo.login_time>="2014-08-03 00:00:00" AND lo.login_time<"2014-08-09 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.366021s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) AND lo.login_time>="2014-08-03 00:00:00" AND lo.login_time<"2014-08-09 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.387023s ]
SQL: SELECT l.name,COALESCE(a.ulcount,0) b FROM  location l LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>="2014-08-03 00:00:00"   GROUP BY ud.locid) a ON a.locid=l.id WHERE l.id IN (24521,24543,24561) [ RunTime:0.117007s ]
SQL: 
				CALL count_worklog_all("2014-08-03 00:00:00","2014-08-09 00:00:00",("24521,24543,24561"))
				 [ RunTime:0.043003s ]
INFO: [ view_parse ] --START--
INFO: ParseTemplate Behavior ::run [ RunTime:0.552032s ]
INFO: [ view_parse ] --END-- [ RunTime:0.557032s ]
INFO: [ view_filter ] --START--
INFO: ContentReplace Behavior ::run [ RunTime:0.008000s ]
INFO: TokenBuild Behavior ::run [ RunTime:0.008001s ]
INFO: WriteHtmlCache Behavior ::run [ RunTime:0.007000s ]
INFO: ShowRuntime Behavior ::run [ RunTime:0.014000s ]
INFO: [ view_filter ] --END-- [ RunTime:0.054003s ]
INFO: [ view_end ] --START--
INFO: ShowPageTrace Behavior ::run [ RunTime:0.015001s ]
INFO: [ view_end ] --END-- [ RunTime:0.025001s ]

[ 2014-08-10T21:48:35+08:00 ] 127.0.0.1 /php_demo/shizhan/10/10wish/index.php/Njb/Index/tongji?checkbox%5B%5D=24521&checkbox%5B%5D=24543&checkbox%5B%5D=24561&date_begin=2014-08-03&date_end=2014-08-09
INFO: [ route_check ] --START--
INFO: CheckRoute Behavior ::run [ RunTime:0.007000s ]
INFO: [ route_check ] --END-- [ RunTime:0.011000s ]
INFO: [ app_begin ] --START--
INFO: ReadHtmlCache Behavior ::run [ RunTime:0.008001s ]
INFO: [ app_begin ] --END-- [ RunTime:0.013001s ]
SQL: SELECT l.name,COALESCE(a.ucount,0) as yhs,COALESCE(c.ulcount,0) as dlyhs,COALESCE(c.logCount,0) as dlcs FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(ud.id) ucount FROM   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561)) ud     GROUP BY ud.locid  ) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>="2014-08-03 00:00:00" AND lo.login_time<"2014-08-09 00:00:00"   GROUP BY ud.locid) c ON l.id=c.locid WHERE l.id IN(24521,24543,24561) [ RunTime:0.105006s ]
SQL: SELECT l.name,COALESCE(a.noticeCount,0) noticeCount,COALESCE(a.userCount,0) userCount FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(n.id) noticeCount,COUNT(DISTINCT ud.id) userCount FROM notice n,   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561)) ud   WHERE n.owner_id=ud.id AND n.publish_time>="2014-08-03 00:00:00"    AND n.publish_time<"2014-08-09 00:00:00" GROUP BY ud.locid) a  ON l.id=a.locid WHERE l.id IN(24521,24543,24561) [ RunTime:0.003000s ]
SQL: SELECT l.name,COALESCE(a.asCount,0) a,COALESCE(b.adminCount,0) b,COALESCE(c.noAdminCount,0) c FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(t.id) asCount FROM assignment t,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561)) ud  WHERE t.creator_id=ud.id AND t.create_time>="2014-08-03 00:00:00" AND  t.create_time<"2014-08-09 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) adminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561)) ud   WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='TechAdmin'   AND t.create_time>="2014-08-03 00:00:00" AND  t.create_time<"2014-08-09 00:00:00"  GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) noAdminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561)) ud  WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='Technician'   AND t.create_time>="2014-08-03 00:00:00" AND  t.create_time<"2014-08-09 00:00:00"  GROUP BY ud.locid ) c ON l.id=c.locid  WHERE l.id IN(24521,24543,24561) [ RunTime:0.008001s ]
SQL: SELECT l.name,COALESCE(a.worklogCount,0) a,COALESCE(a.uCount,0) b,COALESCE(b.docCount,0) c,COALESCE(c.phoCount,0) d,COALESCE(d.audioCount,0) e FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(DISTINCT w.id) worklogCount,COUNT(DISTINCT w.owner_id) uCount FROM work_log w,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561)) ud  WHERE w.owner_id=ud.id    AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) docCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00"  AND i.media_type=1   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) phoCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00"  AND i.media_type=2   GROUP BY ud.locid ) c ON l.id=c.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) audioCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00"  AND i.media_type=3   GROUP BY ud.locid ) d ON l.id=d.locid   WHERE l.id IN(24521,24543,24561) [ RunTime:0.030002s ]
SQL: SELECT l.name,COALESCE(a.photoCount,0) a,COALESCE(a.ucount,0) b,COALESCE(b.priseCount,0) c,COALESCE(c.comCount,0) d FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(i.id) photoCount,COUNT(DISTINCT ud.id) ucount FROM album m,album_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561)) ud  WHERE m.owner_id=ud.id AND i.album_id=m.id   AND i.create_time>="2014-08-03 00:00:00" AND i.create_time<"2014-08-09 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,COUNT(uc.id) priseCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='AlbumItem'   AND uc.create_time>"2014-08-03 00:00:00" AND uc.create_time<"2014-08-09 00:00:00"   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(uc.id) comCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='SystemComment'   AND uc.create_time>="2014-08-03 00:00:00" AND uc.create_time<"2014-08-09 00:00:00"  GROUP BY ud.locid) c ON l.id=c.locid  WHERE l.id IN(24521,24543,24561) [ RunTime:0.010001s ]
SQL: SELECT a.rname a,l.name b,d.name c,a.age d FROM (SELECT u.id uid,u.real_name rname,u.location_id locid,u.dept_id depId,(2014-(SELECT SUBSTR(u.identify_value,7,4))+0) age FROM app_user u WHERE NOT EXISTS ( SELECT lo.user_id FROM login_log lo WHERE u.id=lo.user_id  ) AND u.id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561)   UNION ALL SELECT u.id FROM app_user u WHERE u.location_id IN(24521,24543,24561) )) a,location l,department d WHERE a.depId=d.id AND a.locid=l.id [ RunTime:2.165124s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) AND lo.login_time>="2014-08-03 00:00:00" AND lo.login_time<"2014-08-09 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.372021s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) AND lo.login_time>="2014-08-03 00:00:00" AND lo.login_time<"2014-08-09 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.361021s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) AND lo.login_time>="2014-08-03 00:00:00" AND lo.login_time<"2014-08-09 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.372022s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) AND lo.login_time>="2014-08-03 00:00:00" AND lo.login_time<"2014-08-09 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.370021s ]
SQL: SELECT l.name,COALESCE(a.ulcount,0) b FROM  location l LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>="2014-08-03 00:00:00"   GROUP BY ud.locid) a ON a.locid=l.id WHERE l.id IN (24521,24543,24561) [ RunTime:0.115006s ]
SQL: 
				CALL count_worklog_all("2014-08-03 00:00:00","2014-08-09 00:00:00",("24521,24543,24561"))
				 [ RunTime:0.041002s ]
INFO: [ view_parse ] --START--
INFO: ParseTemplate Behavior ::run [ RunTime:0.546031s ]
INFO: [ view_parse ] --END-- [ RunTime:0.551031s ]
INFO: [ view_filter ] --START--
INFO: ContentReplace Behavior ::run [ RunTime:0.009000s ]
INFO: TokenBuild Behavior ::run [ RunTime:0.008001s ]
INFO: WriteHtmlCache Behavior ::run [ RunTime:0.004000s ]
INFO: ShowRuntime Behavior ::run [ RunTime:0.012001s ]
INFO: [ view_filter ] --END-- [ RunTime:0.046002s ]
INFO: [ view_end ] --START--
INFO: ShowPageTrace Behavior ::run [ RunTime:0.007000s ]
INFO: [ view_end ] --END-- [ RunTime:0.011000s ]

[ 2014-08-10T21:49:15+08:00 ] 127.0.0.1 /php_demo/shizhan/10/10wish/index.php/Njb/Index/tongji?checkbox%5B%5D=24521&checkbox%5B%5D=24543&checkbox%5B%5D=24561&date_begin=2014-08-03&date_end=2014-08-09
INFO: [ route_check ] --START--
INFO: CheckRoute Behavior ::run [ RunTime:0.012000s ]
INFO: [ route_check ] --END-- [ RunTime:0.018001s ]
INFO: [ app_begin ] --START--
INFO: ReadHtmlCache Behavior ::run [ RunTime:0.013001s ]
INFO: [ app_begin ] --END-- [ RunTime:0.019001s ]
SQL: SELECT l.name,COALESCE(a.ucount,0) as yhs,COALESCE(c.ulcount,0) as dlyhs,COALESCE(c.logCount,0) as dlcs FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(ud.id) ucount FROM   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561)) ud     GROUP BY ud.locid  ) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>="2014-08-03 00:00:00" AND lo.login_time<"2014-08-09 00:00:00"   GROUP BY ud.locid) c ON l.id=c.locid WHERE l.id IN(24521,24543,24561) [ RunTime:0.119007s ]
SQL: SELECT l.name,COALESCE(a.noticeCount,0) noticeCount,COALESCE(a.userCount,0) userCount FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(n.id) noticeCount,COUNT(DISTINCT ud.id) userCount FROM notice n,   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561)) ud   WHERE n.owner_id=ud.id AND n.publish_time>="2014-08-03 00:00:00"    AND n.publish_time<"2014-08-09 00:00:00" GROUP BY ud.locid) a  ON l.id=a.locid WHERE l.id IN(24521,24543,24561) [ RunTime:0.005000s ]
SQL: SELECT l.name,COALESCE(a.asCount,0) a,COALESCE(b.adminCount,0) b,COALESCE(c.noAdminCount,0) c FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(t.id) asCount FROM assignment t,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561)) ud  WHERE t.creator_id=ud.id AND t.create_time>="2014-08-03 00:00:00" AND  t.create_time<"2014-08-09 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) adminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561)) ud   WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='TechAdmin'   AND t.create_time>="2014-08-03 00:00:00" AND  t.create_time<"2014-08-09 00:00:00"  GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) noAdminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561)) ud  WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='Technician'   AND t.create_time>="2014-08-03 00:00:00" AND  t.create_time<"2014-08-09 00:00:00"  GROUP BY ud.locid ) c ON l.id=c.locid  WHERE l.id IN(24521,24543,24561) [ RunTime:0.013001s ]
SQL: SELECT l.name,COALESCE(a.worklogCount,0) a,COALESCE(a.uCount,0) b,COALESCE(b.docCount,0) c,COALESCE(c.phoCount,0) d,COALESCE(d.audioCount,0) e FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(DISTINCT w.id) worklogCount,COUNT(DISTINCT w.owner_id) uCount FROM work_log w,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561)) ud  WHERE w.owner_id=ud.id    AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) docCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00"  AND i.media_type=1   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) phoCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00"  AND i.media_type=2   GROUP BY ud.locid ) c ON l.id=c.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) audioCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00"  AND i.media_type=3   GROUP BY ud.locid ) d ON l.id=d.locid   WHERE l.id IN(24521,24543,24561) [ RunTime:0.030002s ]
SQL: SELECT l.name,COALESCE(a.photoCount,0) a,COALESCE(a.ucount,0) b,COALESCE(b.priseCount,0) c,COALESCE(c.comCount,0) d FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(i.id) photoCount,COUNT(DISTINCT ud.id) ucount FROM album m,album_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561)) ud  WHERE m.owner_id=ud.id AND i.album_id=m.id   AND i.create_time>="2014-08-03 00:00:00" AND i.create_time<"2014-08-09 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,COUNT(uc.id) priseCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='AlbumItem'   AND uc.create_time>"2014-08-03 00:00:00" AND uc.create_time<"2014-08-09 00:00:00"   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(uc.id) comCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='SystemComment'   AND uc.create_time>="2014-08-03 00:00:00" AND uc.create_time<"2014-08-09 00:00:00"  GROUP BY ud.locid) c ON l.id=c.locid  WHERE l.id IN(24521,24543,24561) [ RunTime:0.011001s ]
SQL: SELECT a.rname a,l.name b,d.name c,a.age d FROM (SELECT u.id uid,u.real_name rname,u.location_id locid,u.dept_id depId,(2014-(SELECT SUBSTR(u.identify_value,7,4))+0) age FROM app_user u WHERE NOT EXISTS ( SELECT lo.user_id FROM login_log lo WHERE u.id=lo.user_id  ) AND u.id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561)   UNION ALL SELECT u.id FROM app_user u WHERE u.location_id IN(24521,24543,24561) )) a,location l,department d WHERE a.depId=d.id AND a.locid=l.id [ RunTime:2.125122s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) AND lo.login_time>="2014-08-03 00:00:00" AND lo.login_time<"2014-08-09 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.369021s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) AND lo.login_time>="2014-08-03 00:00:00" AND lo.login_time<"2014-08-09 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.356020s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) AND lo.login_time>="2014-08-03 00:00:00" AND lo.login_time<"2014-08-09 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.376021s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) AND lo.login_time>="2014-08-03 00:00:00" AND lo.login_time<"2014-08-09 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.377021s ]
SQL: SELECT l.name,COALESCE(a.ulcount,0) b FROM  location l LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>="2014-08-03 00:00:00"   GROUP BY ud.locid) a ON a.locid=l.id WHERE l.id IN (24521,24543,24561) [ RunTime:0.116006s ]
SQL: 
				CALL count_worklog_all("2014-08-03 00:00:00","2014-08-09 00:00:00",("24521,24543,24561"))
				 [ RunTime:0.041002s ]
INFO: [ view_parse ] --START--
INFO: ParseTemplate Behavior ::run [ RunTime:0.550031s ]
INFO: [ view_parse ] --END-- [ RunTime:0.556032s ]
INFO: [ view_filter ] --START--
INFO: ContentReplace Behavior ::run [ RunTime:0.008000s ]
INFO: TokenBuild Behavior ::run [ RunTime:0.009001s ]
INFO: WriteHtmlCache Behavior ::run [ RunTime:0.004000s ]
INFO: ShowRuntime Behavior ::run [ RunTime:0.019001s ]
INFO: [ view_filter ] --END-- [ RunTime:0.055003s ]
INFO: [ view_end ] --START--
INFO: ShowPageTrace Behavior ::run [ RunTime:0.008000s ]
INFO: [ view_end ] --END-- [ RunTime:0.013001s ]

[ 2014-08-10T21:49:50+08:00 ] 127.0.0.1 /php_demo/shizhan/10/10wish/index.php/Njb/Index/tongji?checkbox%5B%5D=24521&checkbox%5B%5D=24543&checkbox%5B%5D=24561&date_begin=2014-08-03&date_end=2014-08-09
INFO: [ route_check ] --START--
INFO: CheckRoute Behavior ::run [ RunTime:0.006000s ]
INFO: [ route_check ] --END-- [ RunTime:0.011001s ]
INFO: [ app_begin ] --START--
INFO: ReadHtmlCache Behavior ::run [ RunTime:0.008001s ]
INFO: [ app_begin ] --END-- [ RunTime:0.013001s ]
SQL: SELECT l.name,COALESCE(a.ucount,0) as yhs,COALESCE(c.ulcount,0) as dlyhs,COALESCE(c.logCount,0) as dlcs FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(ud.id) ucount FROM   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561)) ud     GROUP BY ud.locid  ) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>="2014-08-03 00:00:00" AND lo.login_time<"2014-08-09 00:00:00"   GROUP BY ud.locid) c ON l.id=c.locid WHERE l.id IN(24521,24543,24561) [ RunTime:0.106006s ]
SQL: SELECT l.name,COALESCE(a.noticeCount,0) noticeCount,COALESCE(a.userCount,0) userCount FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(n.id) noticeCount,COUNT(DISTINCT ud.id) userCount FROM notice n,   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561)) ud   WHERE n.owner_id=ud.id AND n.publish_time>="2014-08-03 00:00:00"    AND n.publish_time<"2014-08-09 00:00:00" GROUP BY ud.locid) a  ON l.id=a.locid WHERE l.id IN(24521,24543,24561) [ RunTime:0.003001s ]
SQL: SELECT l.name,COALESCE(a.asCount,0) a,COALESCE(b.adminCount,0) b,COALESCE(c.noAdminCount,0) c FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(t.id) asCount FROM assignment t,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561)) ud  WHERE t.creator_id=ud.id AND t.create_time>="2014-08-03 00:00:00" AND  t.create_time<"2014-08-09 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) adminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561)) ud   WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='TechAdmin'   AND t.create_time>="2014-08-03 00:00:00" AND  t.create_time<"2014-08-09 00:00:00"  GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) noAdminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561)) ud  WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='Technician'   AND t.create_time>="2014-08-03 00:00:00" AND  t.create_time<"2014-08-09 00:00:00"  GROUP BY ud.locid ) c ON l.id=c.locid  WHERE l.id IN(24521,24543,24561) [ RunTime:0.007000s ]
SQL: SELECT l.name,COALESCE(a.worklogCount,0) a,COALESCE(a.uCount,0) b,COALESCE(b.docCount,0) c,COALESCE(c.phoCount,0) d,COALESCE(d.audioCount,0) e FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(DISTINCT w.id) worklogCount,COUNT(DISTINCT w.owner_id) uCount FROM work_log w,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561)) ud  WHERE w.owner_id=ud.id    AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) docCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00"  AND i.media_type=1   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) phoCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00"  AND i.media_type=2   GROUP BY ud.locid ) c ON l.id=c.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) audioCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00"  AND i.media_type=3   GROUP BY ud.locid ) d ON l.id=d.locid   WHERE l.id IN(24521,24543,24561) [ RunTime:0.029002s ]
SQL: SELECT l.name,COALESCE(a.photoCount,0) a,COALESCE(a.ucount,0) b,COALESCE(b.priseCount,0) c,COALESCE(c.comCount,0) d FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(i.id) photoCount,COUNT(DISTINCT ud.id) ucount FROM album m,album_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561)) ud  WHERE m.owner_id=ud.id AND i.album_id=m.id   AND i.create_time>="2014-08-03 00:00:00" AND i.create_time<"2014-08-09 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,COUNT(uc.id) priseCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='AlbumItem'   AND uc.create_time>"2014-08-03 00:00:00" AND uc.create_time<"2014-08-09 00:00:00"   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(uc.id) comCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='SystemComment'   AND uc.create_time>="2014-08-03 00:00:00" AND uc.create_time<"2014-08-09 00:00:00"  GROUP BY ud.locid) c ON l.id=c.locid  WHERE l.id IN(24521,24543,24561) [ RunTime:0.010001s ]
SQL: SELECT a.rname a,l.name b,d.name c,a.age d FROM (SELECT u.id uid,u.real_name rname,u.location_id locid,u.dept_id depId,(2014-(SELECT SUBSTR(u.identify_value,7,4))+0) age FROM app_user u WHERE NOT EXISTS ( SELECT lo.user_id FROM login_log lo WHERE u.id=lo.user_id  ) AND u.id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561)   UNION ALL SELECT u.id FROM app_user u WHERE u.location_id IN(24521,24543,24561) )) a,location l,department d WHERE a.depId=d.id AND a.locid=l.id [ RunTime:2.134122s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) AND lo.login_time>="2014-08-03 00:00:00" AND lo.login_time<"2014-08-09 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.372022s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) AND lo.login_time>="2014-08-03 00:00:00" AND lo.login_time<"2014-08-09 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.363021s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) AND lo.login_time>="2014-08-03 00:00:00" AND lo.login_time<"2014-08-09 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.369022s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) AND lo.login_time>="2014-08-03 00:00:00" AND lo.login_time<"2014-08-09 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.371021s ]
SQL: SELECT l.name,COALESCE(a.ulcount,0) b FROM  location l LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>="2014-08-03 00:00:00"   GROUP BY ud.locid) a ON a.locid=l.id WHERE l.id IN (24521,24543,24561) [ RunTime:0.117006s ]
SQL: 
				CALL count_worklog_all("2014-08-03 00:00:00","2014-08-09 00:00:00",("24521,24543,24561"))
				 [ RunTime:0.041002s ]
INFO: [ view_parse ] --START--
INFO: ParseTemplate Behavior ::run [ RunTime:0.546031s ]
INFO: [ view_parse ] --END-- [ RunTime:0.552031s ]
INFO: [ view_filter ] --START--
INFO: ContentReplace Behavior ::run [ RunTime:0.007000s ]
INFO: TokenBuild Behavior ::run [ RunTime:0.012001s ]
INFO: WriteHtmlCache Behavior ::run [ RunTime:0.004000s ]
INFO: ShowRuntime Behavior ::run [ RunTime:0.011000s ]
INFO: [ view_filter ] --END-- [ RunTime:0.048002s ]
INFO: [ view_end ] --START--
INFO: ShowPageTrace Behavior ::run [ RunTime:0.011001s ]
INFO: [ view_end ] --END-- [ RunTime:0.018001s ]

[ 2014-08-10T21:50:21+08:00 ] 127.0.0.1 /php_demo/shizhan/10/10wish/index.php/Njb/Index/tongji?checkbox%5B%5D=24521&checkbox%5B%5D=24543&checkbox%5B%5D=24561&date_begin=2014-08-03&date_end=2014-08-09
INFO: [ route_check ] --START--
INFO: CheckRoute Behavior ::run [ RunTime:0.009001s ]
INFO: [ route_check ] --END-- [ RunTime:0.016001s ]
INFO: [ app_begin ] --START--
INFO: ReadHtmlCache Behavior ::run [ RunTime:0.012001s ]
INFO: [ app_begin ] --END-- [ RunTime:0.020001s ]
SQL: SELECT l.name,COALESCE(a.ucount,0) as yhs,COALESCE(c.ulcount,0) as dlyhs,COALESCE(c.logCount,0) as dlcs FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(ud.id) ucount FROM   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561)) ud     GROUP BY ud.locid  ) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>="2014-08-03 00:00:00" AND lo.login_time<"2014-08-09 00:00:00"   GROUP BY ud.locid) c ON l.id=c.locid WHERE l.id IN(24521,24543,24561) [ RunTime:0.140008s ]
SQL: SELECT l.name,COALESCE(a.noticeCount,0) noticeCount,COALESCE(a.userCount,0) userCount FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(n.id) noticeCount,COUNT(DISTINCT ud.id) userCount FROM notice n,   (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561)    UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561)) ud   WHERE n.owner_id=ud.id AND n.publish_time>="2014-08-03 00:00:00"    AND n.publish_time<"2014-08-09 00:00:00" GROUP BY ud.locid) a  ON l.id=a.locid WHERE l.id IN(24521,24543,24561) [ RunTime:0.004001s ]
SQL: SELECT l.name,COALESCE(a.asCount,0) a,COALESCE(b.adminCount,0) b,COALESCE(c.noAdminCount,0) c FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(t.id) asCount FROM assignment t,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561)) ud  WHERE t.creator_id=ud.id AND t.create_time>="2014-08-03 00:00:00" AND  t.create_time<"2014-08-09 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid  LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) adminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561)) ud   WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='TechAdmin'   AND t.create_time>="2014-08-03 00:00:00" AND  t.create_time<"2014-08-09 00:00:00"  GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) noAdminCount FROM assignment t,app_user_role r,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561)) ud  WHERE t.creator_id=ud.id AND ud.id=r.user_id AND r.role='Technician'   AND t.create_time>="2014-08-03 00:00:00" AND  t.create_time<"2014-08-09 00:00:00"  GROUP BY ud.locid ) c ON l.id=c.locid  WHERE l.id IN(24521,24543,24561) [ RunTime:0.008000s ]
SQL: SELECT l.name,COALESCE(a.worklogCount,0) a,COALESCE(a.uCount,0) b,COALESCE(b.docCount,0) c,COALESCE(c.phoCount,0) d,COALESCE(d.audioCount,0) e FROM location l LEFT JOIN  (SELECT ud.locid locid,COUNT(DISTINCT w.id) worklogCount,COUNT(DISTINCT w.owner_id) uCount FROM work_log w,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561)) ud  WHERE w.owner_id=ud.id    AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) docCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00"  AND i.media_type=1   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) phoCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00"  AND i.media_type=2   GROUP BY ud.locid ) c ON l.id=c.locid LEFT JOIN  (SELECT ud.locid locid,i.media_type,COUNT(i.id) audioCount FROM work_log w,work_log_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561)) ud  WHERE w.owner_id=ud.id AND w.id=i.work_log_id   AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00"  AND i.media_type=3   GROUP BY ud.locid ) d ON l.id=d.locid   WHERE l.id IN(24521,24543,24561) [ RunTime:0.029002s ]
SQL: SELECT l.name,COALESCE(a.photoCount,0) a,COALESCE(a.ucount,0) b,COALESCE(b.priseCount,0) c,COALESCE(c.comCount,0) d FROM location l LEFT JOIN (SELECT ud.locid locid,COUNT(i.id) photoCount,COUNT(DISTINCT ud.id) ucount FROM album m,album_item i,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561)) ud  WHERE m.owner_id=ud.id AND i.album_id=m.id   AND i.create_time>="2014-08-03 00:00:00" AND i.create_time<"2014-08-09 00:00:00"  GROUP BY ud.locid) a ON l.id=a.locid LEFT JOIN  (SELECT ud.locid locid,COUNT(uc.id) priseCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='AlbumItem'   AND uc.create_time>"2014-08-03 00:00:00" AND uc.create_time<"2014-08-09 00:00:00"   GROUP BY ud.locid ) b ON l.id=b.locid LEFT JOIN (SELECT ud.locid locid,COUNT(uc.id) comCount FROM user_comment uc,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561)  UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561)) ud  WHERE ud.id=uc.creator_id AND uc.obj_type='SystemComment'   AND uc.create_time>="2014-08-03 00:00:00" AND uc.create_time<"2014-08-09 00:00:00"  GROUP BY ud.locid) c ON l.id=c.locid  WHERE l.id IN(24521,24543,24561) [ RunTime:0.010001s ]
SQL: SELECT a.rname a,l.name b,d.name c,a.age d FROM (SELECT u.id uid,u.real_name rname,u.location_id locid,u.dept_id depId,(2014-(SELECT SUBSTR(u.identify_value,7,4))+0) age FROM app_user u WHERE NOT EXISTS ( SELECT lo.user_id FROM login_log lo WHERE u.id=lo.user_id  ) AND u.id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561)   UNION ALL SELECT u.id FROM app_user u WHERE u.location_id IN(24521,24543,24561) )) a,location l,department d WHERE a.depId=d.id AND a.locid=l.id [ RunTime:2.136122s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) AND lo.login_time>="2014-08-03 00:00:00" AND lo.login_time<"2014-08-09 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24561 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24561 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.370021s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) AND lo.login_time>="2014-08-03 00:00:00" AND lo.login_time<"2014-08-09 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24521 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24521 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.366021s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) AND lo.login_time>="2014-08-03 00:00:00" AND lo.login_time<"2014-08-09 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =24543 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =24543 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.372021s ]
SQL: SELECT u.id,u.real_name,COALESCE(a.worklogCount,0) worklogCount,COALESCE(b.logCount,0) logCount FROM app_user u LEFT JOIN (SELECT w.owner_id uid,COALESCE(COUNT(w.id)) worklogCount FROM work_log w WHERE w.owner_id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) AND w.create_time>="2014-08-03 00:00:00" AND w.create_time<"2014-08-09 00:00:00" GROUP BY w.owner_id) a ON u.id=a.uid LEFT JOIN (SELECT lo.user_id uid,COUNT(lo.user_id) logCount FROM login_log lo WHERE lo.user_id IN( SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) AND lo.login_time>="2014-08-03 00:00:00" AND lo.login_time<"2014-08-09 00:00:00" GROUP BY lo.user_id ) b ON u.id=b.uid WHERE u.id IN(SELECT u.id FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id =28422 UNION ALL SELECT u.id FROM app_user u WHERE u.location_id =28422 ) ORDER BY a.worklogCount DESC,b.logCount DESC LIMIT 10 [ RunTime:0.379022s ]
SQL: SELECT l.name,COALESCE(a.ulcount,0) b FROM  location l LEFT JOIN (SELECT ud.locid locid,COUNT(DISTINCT ud.id) ulcount,COUNT(ud.id) logCount FROM login_log lo,  (SELECT u.id,f.ancestor_id locid FROM app_user u,location_flat f WHERE u.location_id=f.location_id AND f.ancestor_id IN(24521,24543,24561)   UNION ALL SELECT u.id,u.location_id locid FROM app_user u WHERE u.location_id IN(24521,24543,24561)) ud  WHERE lo.user_id=ud.id   AND lo.login_time>="2014-08-03 00:00:00"   GROUP BY ud.locid) a ON a.locid=l.id WHERE l.id IN (24521,24543,24561) [ RunTime:0.122007s ]
SQL: 
				CALL count_worklog_all("2014-08-03 00:00:00","2014-08-09 00:00:00",("24521,24543,24561"))
				 [ RunTime:0.041002s ]
INFO: [ view_parse ] --START--
INFO: ParseTemplate Behavior ::run [ RunTime:0.548032s ]
INFO: [ view_parse ] --END-- [ RunTime:0.552032s ]
INFO: [ view_filter ] --START--
INFO: ContentReplace Behavior ::run [ RunTime:0.007000s ]
INFO: TokenBuild Behavior ::run [ RunTime:0.011000s ]
INFO: WriteHtmlCache Behavior ::run [ RunTime:0.004001s ]
INFO: ShowRuntime Behavior ::run [ RunTime:0.017001s ]
INFO: [ view_filter ] --END-- [ RunTime:0.055003s ]
INFO: [ view_end ] --START--
INFO: ShowPageTrace Behavior ::run [ RunTime:0.008001s ]
INFO: [ view_end ] --END-- [ RunTime:0.013001s ]

